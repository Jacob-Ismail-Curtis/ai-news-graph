(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function tg(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var xL={exports:{}},w0={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uG=Symbol.for("react.transitional.element"),cG=Symbol.for("react.fragment");function TL(n,e,t){var i=null;if(t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),"key"in e){t={};for(var r in e)r!=="key"&&(t[r]=e[r])}else t=e;return e=t.ref,{$$typeof:uG,type:n,key:i,ref:e!==void 0?e:null,props:t}}w0.Fragment=cG;w0.jsx=TL;w0.jsxs=TL;xL.exports=w0;var Tt=xL.exports,EL={exports:{}},Lt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gM=Symbol.for("react.transitional.element"),hG=Symbol.for("react.portal"),dG=Symbol.for("react.fragment"),fG=Symbol.for("react.strict_mode"),pG=Symbol.for("react.profiler"),mG=Symbol.for("react.consumer"),gG=Symbol.for("react.context"),_G=Symbol.for("react.forward_ref"),yG=Symbol.for("react.suspense"),vG=Symbol.for("react.memo"),ML=Symbol.for("react.lazy"),zR=Symbol.iterator;function bG(n){return n===null||typeof n!="object"?null:(n=zR&&n[zR]||n["@@iterator"],typeof n=="function"?n:null)}var wL={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},AL=Object.assign,RL={};function ff(n,e,t){this.props=n,this.context=e,this.refs=RL,this.updater=t||wL}ff.prototype.isReactComponent={};ff.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};ff.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function NL(){}NL.prototype=ff.prototype;function _M(n,e,t){this.props=n,this.context=e,this.refs=RL,this.updater=t||wL}var yM=_M.prototype=new NL;yM.constructor=_M;AL(yM,ff.prototype);yM.isPureReactComponent=!0;var GR=Array.isArray,Vn={H:null,A:null,T:null,S:null,V:null},CL=Object.prototype.hasOwnProperty;function vM(n,e,t,i,r,s){return t=s.ref,{$$typeof:gM,type:n,key:e,ref:t!==void 0?t:null,props:s}}function SG(n,e){return vM(n.type,e,void 0,void 0,void 0,n.props)}function bM(n){return typeof n=="object"&&n!==null&&n.$$typeof===gM}function xG(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var VR=/\/+/g;function Pb(n,e){return typeof n=="object"&&n!==null&&n.key!=null?xG(""+n.key):e.toString(36)}function HR(){}function TG(n){switch(n.status){case"fulfilled":return n.value;case"rejected":throw n.reason;default:switch(typeof n.status=="string"?n.then(HR,HR):(n.status="pending",n.then(function(e){n.status==="pending"&&(n.status="fulfilled",n.value=e)},function(e){n.status==="pending"&&(n.status="rejected",n.reason=e)})),n.status){case"fulfilled":return n.value;case"rejected":throw n.reason}}throw n}function ch(n,e,t,i,r){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(s){case"bigint":case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case gM:case hG:a=!0;break;case ML:return a=n._init,ch(a(n._payload),e,t,i,r)}}if(a)return r=r(n),a=i===""?"."+Pb(n,0):i,GR(r)?(t="",a!=null&&(t=a.replace(VR,"$&/")+"/"),ch(r,e,t,"",function(u){return u})):r!=null&&(bM(r)&&(r=SG(r,t+(r.key==null||n&&n.key===r.key?"":(""+r.key).replace(VR,"$&/")+"/")+a)),e.push(r)),1;a=0;var o=i===""?".":i+":";if(GR(n))for(var l=0;l<n.length;l++)i=n[l],s=o+Pb(i,l),a+=ch(i,e,t,s,r);else if(l=bG(n),typeof l=="function")for(n=l.call(n),l=0;!(i=n.next()).done;)i=i.value,s=o+Pb(i,l++),a+=ch(i,e,t,s,r);else if(s==="object"){if(typeof n.then=="function")return ch(TG(n),e,t,i,r);throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return a}function jg(n,e,t){if(n==null)return n;var i=[],r=0;return ch(n,i,"","",function(s){return e.call(t,s,r++)}),i}function EG(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var $R=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)};function MG(){}Lt.Children={map:jg,forEach:function(n,e,t){jg(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return jg(n,function(){e++}),e},toArray:function(n){return jg(n,function(e){return e})||[]},only:function(n){if(!bM(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Lt.Component=ff;Lt.Fragment=dG;Lt.Profiler=pG;Lt.PureComponent=_M;Lt.StrictMode=fG;Lt.Suspense=yG;Lt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Vn;Lt.__COMPILER_RUNTIME={__proto__:null,c:function(n){return Vn.H.useMemoCache(n)}};Lt.cache=function(n){return function(){return n.apply(null,arguments)}};Lt.cloneElement=function(n,e,t){if(n==null)throw Error("The argument must be a React element, but you passed "+n+".");var i=AL({},n.props),r=n.key,s=void 0;if(e!=null)for(a in e.ref!==void 0&&(s=void 0),e.key!==void 0&&(r=""+e.key),e)!CL.call(e,a)||a==="key"||a==="__self"||a==="__source"||a==="ref"&&e.ref===void 0||(i[a]=e[a]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var o=Array(a),l=0;l<a;l++)o[l]=arguments[l+2];i.children=o}return vM(n.type,r,void 0,void 0,s,i)};Lt.createContext=function(n){return n={$$typeof:gG,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null},n.Provider=n,n.Consumer={$$typeof:mG,_context:n},n};Lt.createElement=function(n,e,t){var i,r={},s=null;if(e!=null)for(i in e.key!==void 0&&(s=""+e.key),e)CL.call(e,i)&&i!=="key"&&i!=="__self"&&i!=="__source"&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=t;else if(1<a){for(var o=Array(a),l=0;l<a;l++)o[l]=arguments[l+2];r.children=o}if(n&&n.defaultProps)for(i in a=n.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return vM(n,s,void 0,void 0,null,r)};Lt.createRef=function(){return{current:null}};Lt.forwardRef=function(n){return{$$typeof:_G,render:n}};Lt.isValidElement=bM;Lt.lazy=function(n){return{$$typeof:ML,_payload:{_status:-1,_result:n},_init:EG}};Lt.memo=function(n,e){return{$$typeof:vG,type:n,compare:e===void 0?null:e}};Lt.startTransition=function(n){var e=Vn.T,t={};Vn.T=t;try{var i=n(),r=Vn.S;r!==null&&r(t,i),typeof i=="object"&&i!==null&&typeof i.then=="function"&&i.then(MG,$R)}catch(s){$R(s)}finally{Vn.T=e}};Lt.unstable_useCacheRefresh=function(){return Vn.H.useCacheRefresh()};Lt.use=function(n){return Vn.H.use(n)};Lt.useActionState=function(n,e,t){return Vn.H.useActionState(n,e,t)};Lt.useCallback=function(n,e){return Vn.H.useCallback(n,e)};Lt.useContext=function(n){return Vn.H.useContext(n)};Lt.useDebugValue=function(){};Lt.useDeferredValue=function(n,e){return Vn.H.useDeferredValue(n,e)};Lt.useEffect=function(n,e,t){var i=Vn.H;if(typeof t=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return i.useEffect(n,e)};Lt.useId=function(){return Vn.H.useId()};Lt.useImperativeHandle=function(n,e,t){return Vn.H.useImperativeHandle(n,e,t)};Lt.useInsertionEffect=function(n,e){return Vn.H.useInsertionEffect(n,e)};Lt.useLayoutEffect=function(n,e){return Vn.H.useLayoutEffect(n,e)};Lt.useMemo=function(n,e){return Vn.H.useMemo(n,e)};Lt.useOptimistic=function(n,e){return Vn.H.useOptimistic(n,e)};Lt.useReducer=function(n,e,t){return Vn.H.useReducer(n,e,t)};Lt.useRef=function(n){return Vn.H.useRef(n)};Lt.useState=function(n){return Vn.H.useState(n)};Lt.useSyncExternalStore=function(n,e,t){return Vn.H.useSyncExternalStore(n,e,t)};Lt.useTransition=function(){return Vn.H.useTransition()};Lt.version="19.1.1";EL.exports=Lt;var ne=EL.exports;const DL=tg(ne);var LL={exports:{}},A0={},PL={exports:{}},UL={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(C,q){var z=C.length;C.push(q);e:for(;0<z;){var re=z-1>>>1,X=C[re];if(0<r(X,q))C[re]=q,C[z]=X,z=re;else break e}}function t(C){return C.length===0?null:C[0]}function i(C){if(C.length===0)return null;var q=C[0],z=C.pop();if(z!==q){C[0]=z;e:for(var re=0,X=C.length,oe=X>>>1;re<oe;){var be=2*(re+1)-1,Oe=C[be],st=be+1,ie=C[st];if(0>r(Oe,z))st<X&&0>r(ie,Oe)?(C[re]=ie,C[st]=z,re=st):(C[re]=Oe,C[be]=z,re=be);else if(st<X&&0>r(ie,z))C[re]=ie,C[st]=z,re=st;else break e}}return q}function r(C,q){var z=C.sortIndex-q.sortIndex;return z!==0?z:C.id-q.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,h=null,d=3,f=!1,m=!1,_=!1,g=!1,p=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;function b(C){for(var q=t(u);q!==null;){if(q.callback===null)i(u);else if(q.startTime<=C)i(u),q.sortIndex=q.expirationTime,e(l,q);else break;q=t(u)}}function S(C){if(_=!1,b(C),!m)if(t(l)!==null)m=!0,x||(x=!0,U());else{var q=t(u);q!==null&&O(S,q.startTime-C)}}var x=!1,T=-1,w=5,E=-1;function M(){return g?!0:!(n.unstable_now()-E<w)}function N(){if(g=!1,x){var C=n.unstable_now();E=C;var q=!0;try{e:{m=!1,_&&(_=!1,y(T),T=-1),f=!0;var z=d;try{t:{for(b(C),h=t(l);h!==null&&!(h.expirationTime>C&&M());){var re=h.callback;if(typeof re=="function"){h.callback=null,d=h.priorityLevel;var X=re(h.expirationTime<=C);if(C=n.unstable_now(),typeof X=="function"){h.callback=X,b(C),q=!0;break t}h===t(l)&&i(l),b(C)}else i(l);h=t(l)}if(h!==null)q=!0;else{var oe=t(u);oe!==null&&O(S,oe.startTime-C),q=!1}}break e}finally{h=null,d=z,f=!1}q=void 0}}finally{q?U():x=!1}}}var U;if(typeof v=="function")U=function(){v(N)};else if(typeof MessageChannel<"u"){var k=new MessageChannel,P=k.port2;k.port1.onmessage=N,U=function(){P.postMessage(null)}}else U=function(){p(N,0)};function O(C,q){T=p(function(){C(n.unstable_now())},q)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(C){C.callback=null},n.unstable_forceFrameRate=function(C){0>C||125<C?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):w=0<C?Math.floor(1e3/C):5},n.unstable_getCurrentPriorityLevel=function(){return d},n.unstable_next=function(C){switch(d){case 1:case 2:case 3:var q=3;break;default:q=d}var z=d;d=q;try{return C()}finally{d=z}},n.unstable_requestPaint=function(){g=!0},n.unstable_runWithPriority=function(C,q){switch(C){case 1:case 2:case 3:case 4:case 5:break;default:C=3}var z=d;d=C;try{return q()}finally{d=z}},n.unstable_scheduleCallback=function(C,q,z){var re=n.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?re+z:re):z=re,C){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=z+X,C={id:c++,callback:q,priorityLevel:C,startTime:z,expirationTime:X,sortIndex:-1},z>re?(C.sortIndex=z,e(u,C),t(l)===null&&C===t(u)&&(_?(y(T),T=-1):_=!0,O(S,z-re))):(C.sortIndex=X,e(l,C),m||f||(m=!0,x||(x=!0,U()))),C},n.unstable_shouldYield=M,n.unstable_wrapCallback=function(C){var q=d;return function(){var z=d;d=q;try{return C.apply(this,arguments)}finally{d=z}}}})(UL);PL.exports=UL;var wG=PL.exports,OL={exports:{}},Tr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AG=ne;function IL(n){var e="https://react.dev/errors/"+n;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var t=2;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t])}return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function hl(){}var vr={d:{f:hl,r:function(){throw Error(IL(522))},D:hl,C:hl,L:hl,m:hl,X:hl,S:hl,M:hl},p:0,findDOMNode:null},RG=Symbol.for("react.portal");function NG(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:RG,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}var Bp=AG.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function R0(n,e){if(n==="font")return"";if(typeof e=="string")return e==="use-credentials"?e:""}Tr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=vr;Tr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)throw Error(IL(299));return NG(n,e,null,t)};Tr.flushSync=function(n){var e=Bp.T,t=vr.p;try{if(Bp.T=null,vr.p=2,n)return n()}finally{Bp.T=e,vr.p=t,vr.d.f()}};Tr.preconnect=function(n,e){typeof n=="string"&&(e?(e=e.crossOrigin,e=typeof e=="string"?e==="use-credentials"?e:"":void 0):e=null,vr.d.C(n,e))};Tr.prefetchDNS=function(n){typeof n=="string"&&vr.d.D(n)};Tr.preinit=function(n,e){if(typeof n=="string"&&e&&typeof e.as=="string"){var t=e.as,i=R0(t,e.crossOrigin),r=typeof e.integrity=="string"?e.integrity:void 0,s=typeof e.fetchPriority=="string"?e.fetchPriority:void 0;t==="style"?vr.d.S(n,typeof e.precedence=="string"?e.precedence:void 0,{crossOrigin:i,integrity:r,fetchPriority:s}):t==="script"&&vr.d.X(n,{crossOrigin:i,integrity:r,fetchPriority:s,nonce:typeof e.nonce=="string"?e.nonce:void 0})}};Tr.preinitModule=function(n,e){if(typeof n=="string")if(typeof e=="object"&&e!==null){if(e.as==null||e.as==="script"){var t=R0(e.as,e.crossOrigin);vr.d.M(n,{crossOrigin:t,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0})}}else e==null&&vr.d.M(n)};Tr.preload=function(n,e){if(typeof n=="string"&&typeof e=="object"&&e!==null&&typeof e.as=="string"){var t=e.as,i=R0(t,e.crossOrigin);vr.d.L(n,t,{crossOrigin:i,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0,type:typeof e.type=="string"?e.type:void 0,fetchPriority:typeof e.fetchPriority=="string"?e.fetchPriority:void 0,referrerPolicy:typeof e.referrerPolicy=="string"?e.referrerPolicy:void 0,imageSrcSet:typeof e.imageSrcSet=="string"?e.imageSrcSet:void 0,imageSizes:typeof e.imageSizes=="string"?e.imageSizes:void 0,media:typeof e.media=="string"?e.media:void 0})}};Tr.preloadModule=function(n,e){if(typeof n=="string")if(e){var t=R0(e.as,e.crossOrigin);vr.d.m(n,{as:typeof e.as=="string"&&e.as!=="script"?e.as:void 0,crossOrigin:t,integrity:typeof e.integrity=="string"?e.integrity:void 0})}else vr.d.m(n)};Tr.requestFormReset=function(n){vr.d.r(n)};Tr.unstable_batchedUpdates=function(n,e){return n(e)};Tr.useFormState=function(n,e,t){return Bp.H.useFormState(n,e,t)};Tr.useFormStatus=function(){return Bp.H.useHostTransitionStatus()};Tr.version="19.1.1";function BL(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(BL)}catch(n){console.error(n)}}BL(),OL.exports=Tr;var CG=OL.exports;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ai=wG,FL=ne,DG=CG;function ce(n){var e="https://react.dev/errors/"+n;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var t=2;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t])}return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function kL(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function ng(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function zL(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function WR(n){if(ng(n)!==n)throw Error(ce(188))}function LG(n){var e=n.alternate;if(!e){if(e=ng(n),e===null)throw Error(ce(188));return e!==n?null:n}for(var t=n,i=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){t=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return WR(r),n;if(s===i)return WR(r),e;s=s.sibling}throw Error(ce(188))}if(t.return!==i.return)t=r,i=s;else{for(var a=!1,o=r.child;o;){if(o===t){a=!0,t=r,i=s;break}if(o===i){a=!0,i=r,t=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===t){a=!0,t=s,i=r;break}if(o===i){a=!0,i=s,t=r;break}o=o.sibling}if(!a)throw Error(ce(189))}}if(t.alternate!==i)throw Error(ce(190))}if(t.tag!==3)throw Error(ce(188));return t.stateNode.current===t?n:e}function GL(n){var e=n.tag;if(e===5||e===26||e===27||e===6)return n;for(n=n.child;n!==null;){if(e=GL(n),e!==null)return e;n=n.sibling}return null}var Fn=Object.assign,PG=Symbol.for("react.element"),qg=Symbol.for("react.transitional.element"),_p=Symbol.for("react.portal"),Eh=Symbol.for("react.fragment"),VL=Symbol.for("react.strict_mode"),uT=Symbol.for("react.profiler"),UG=Symbol.for("react.provider"),HL=Symbol.for("react.consumer"),Po=Symbol.for("react.context"),SM=Symbol.for("react.forward_ref"),cT=Symbol.for("react.suspense"),hT=Symbol.for("react.suspense_list"),xM=Symbol.for("react.memo"),Ml=Symbol.for("react.lazy"),dT=Symbol.for("react.activity"),OG=Symbol.for("react.memo_cache_sentinel"),jR=Symbol.iterator;function If(n){return n===null||typeof n!="object"?null:(n=jR&&n[jR]||n["@@iterator"],typeof n=="function"?n:null)}var IG=Symbol.for("react.client.reference");function fT(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===IG?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Eh:return"Fragment";case uT:return"Profiler";case VL:return"StrictMode";case cT:return"Suspense";case hT:return"SuspenseList";case dT:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case _p:return"Portal";case Po:return(n.displayName||"Context")+".Provider";case HL:return(n._context.displayName||"Context")+".Consumer";case SM:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case xM:return e=n.displayName||null,e!==null?e:fT(n.type)||"Memo";case Ml:e=n._payload,n=n._init;try{return fT(n(e))}catch{}}return null}var yp=Array.isArray,gt=FL.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,tn=DG.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Zu={pending:!1,data:null,method:null,action:null},pT=[],Mh=-1;function to(n){return{current:n}}function ki(n){0>Mh||(n.current=pT[Mh],pT[Mh]=null,Mh--)}function Hn(n,e){Mh++,pT[Mh]=n.current,n.current=e}var Va=to(null),cm=to(null),zl=to(null),Yy=to(null);function Ky(n,e){switch(Hn(zl,e),Hn(cm,n),Hn(Va,null),e.nodeType){case 9:case 11:n=(n=e.documentElement)&&(n=n.namespaceURI)?Q1(n):0;break;default:if(n=e.tagName,e=e.namespaceURI)e=Q1(e),n=aO(e,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}ki(Va),Hn(Va,n)}function dd(){ki(Va),ki(cm),ki(zl)}function mT(n){n.memoizedState!==null&&Hn(Yy,n);var e=Va.current,t=aO(e,n.type);e!==t&&(Hn(cm,n),Hn(Va,t))}function Qy(n){cm.current===n&&(ki(Va),ki(cm)),Yy.current===n&&(ki(Yy),bm._currentValue=Zu)}var gT=Object.prototype.hasOwnProperty,TM=Ai.unstable_scheduleCallback,Ub=Ai.unstable_cancelCallback,BG=Ai.unstable_shouldYield,FG=Ai.unstable_requestPaint,Ha=Ai.unstable_now,kG=Ai.unstable_getCurrentPriorityLevel,$L=Ai.unstable_ImmediatePriority,WL=Ai.unstable_UserBlockingPriority,Zy=Ai.unstable_NormalPriority,zG=Ai.unstable_LowPriority,jL=Ai.unstable_IdlePriority,GG=Ai.log,VG=Ai.unstable_setDisableYieldValue,ig=null,cs=null;function Il(n){if(typeof GG=="function"&&VG(n),cs&&typeof cs.setStrictMode=="function")try{cs.setStrictMode(ig,n)}catch{}}var hs=Math.clz32?Math.clz32:WG,HG=Math.log,$G=Math.LN2;function WG(n){return n>>>=0,n===0?32:31-(HG(n)/$G|0)|0}var Xg=256,Yg=4194304;function Bu(n){var e=n&42;if(e!==0)return e;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function N0(n,e,t){var i=n.pendingLanes;if(i===0)return 0;var r=0,s=n.suspendedLanes,a=n.pingedLanes;n=n.warmLanes;var o=i&134217727;return o!==0?(i=o&~s,i!==0?r=Bu(i):(a&=o,a!==0?r=Bu(a):t||(t=o&~n,t!==0&&(r=Bu(t))))):(o=i&~s,o!==0?r=Bu(o):a!==0?r=Bu(a):t||(t=i&~n,t!==0&&(r=Bu(t)))),r===0?0:e!==0&&e!==r&&!(e&s)&&(s=r&-r,t=e&-e,s>=t||s===32&&(t&4194048)!==0)?e:r}function rg(n,e){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&e)===0}function jG(n,e){switch(n){case 1:case 2:case 4:case 8:case 64:return e+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qL(){var n=Xg;return Xg<<=1,!(Xg&4194048)&&(Xg=256),n}function XL(){var n=Yg;return Yg<<=1,!(Yg&62914560)&&(Yg=4194304),n}function Ob(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function sg(n,e){n.pendingLanes|=e,e!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function qG(n,e,t,i,r,s){var a=n.pendingLanes;n.pendingLanes=t,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=t,n.entangledLanes&=t,n.errorRecoveryDisabledLanes&=t,n.shellSuspendCounter=0;var o=n.entanglements,l=n.expirationTimes,u=n.hiddenUpdates;for(t=a&~t;0<t;){var c=31-hs(t),h=1<<c;o[c]=0,l[c]=-1;var d=u[c];if(d!==null)for(u[c]=null,c=0;c<d.length;c++){var f=d[c];f!==null&&(f.lane&=-536870913)}t&=~h}i!==0&&YL(n,i,0),s!==0&&r===0&&n.tag!==0&&(n.suspendedLanes|=s&~(a&~e))}function YL(n,e,t){n.pendingLanes|=e,n.suspendedLanes&=~e;var i=31-hs(e);n.entangledLanes|=e,n.entanglements[i]=n.entanglements[i]|1073741824|t&4194090}function KL(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-hs(t),r=1<<i;r&e|n[i]&e&&(n[i]|=e),t&=~r}}function EM(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function MM(n){return n&=-n,2<n?8<n?n&134217727?32:268435456:8:2}function QL(){var n=tn.p;return n!==0?n:(n=window.event,n===void 0?32:gO(n.type))}function XG(n,e){var t=tn.p;try{return tn.p=n,e()}finally{tn.p=t}}var du=Math.random().toString(36).slice(2),er="__reactFiber$"+du,Gr="__reactProps$"+du,pf="__reactContainer$"+du,_T="__reactEvents$"+du,YG="__reactListeners$"+du,KG="__reactHandles$"+du,qR="__reactResources$"+du,ag="__reactMarker$"+du;function wM(n){delete n[er],delete n[Gr],delete n[_T],delete n[YG],delete n[KG]}function wh(n){var e=n[er];if(e)return e;for(var t=n.parentNode;t;){if(e=t[pf]||t[er]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=eN(n);n!==null;){if(t=n[er])return t;n=eN(n)}return e}n=t,t=n.parentNode}return null}function mf(n){if(n=n[er]||n[pf]){var e=n.tag;if(e===5||e===6||e===13||e===26||e===27||e===3)return n}return null}function vp(n){var e=n.tag;if(e===5||e===26||e===27||e===6)return n.stateNode;throw Error(ce(33))}function Wh(n){var e=n[qR];return e||(e=n[qR]={hoistableStyles:new Map,hoistableScripts:new Map}),e}function Ui(n){n[ag]=!0}var ZL=new Set,JL={};function Ec(n,e){fd(n,e),fd(n+"Capture",e)}function fd(n,e){for(JL[n]=e,n=0;n<e.length;n++)ZL.add(e[n])}var QG=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),XR={},YR={};function ZG(n){return gT.call(YR,n)?!0:gT.call(XR,n)?!1:QG.test(n)?YR[n]=!0:(XR[n]=!0,!1)}function hy(n,e,t){if(ZG(e))if(t===null)n.removeAttribute(e);else{switch(typeof t){case"undefined":case"function":case"symbol":n.removeAttribute(e);return;case"boolean":var i=e.toLowerCase().slice(0,5);if(i!=="data-"&&i!=="aria-"){n.removeAttribute(e);return}}n.setAttribute(e,""+t)}}function Kg(n,e,t){if(t===null)n.removeAttribute(e);else{switch(typeof t){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(e);return}n.setAttribute(e,""+t)}}function oo(n,e,t,i){if(i===null)n.removeAttribute(t);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(t);return}n.setAttributeNS(e,t,""+i)}}var Ib,KR;function hh(n){if(Ib===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Ib=e&&e[1]||"",KR=-1<t.stack.indexOf(`
    at`)?" (<anonymous>)":-1<t.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ib+n+KR}var Bb=!1;function Fb(n,e){if(!n||Bb)return"";Bb=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(e){var h=function(){throw Error()};if(Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(f){var d=f}Reflect.construct(n,[],h)}else{try{h.call()}catch(f){d=f}n.call(h.prototype)}}else{try{throw Error()}catch(f){d=f}(h=n())&&typeof h.catch=="function"&&h.catch(function(){})}}catch(f){if(f&&d&&typeof f.stack=="string")return[f.stack,d.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var r=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");r&&r.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var s=i.DetermineComponentFrameRoot(),a=s[0],o=s[1];if(a&&o){var l=a.split(`
`),u=o.split(`
`);for(r=i=0;i<l.length&&!l[i].includes("DetermineComponentFrameRoot");)i++;for(;r<u.length&&!u[r].includes("DetermineComponentFrameRoot");)r++;if(i===l.length||r===u.length)for(i=l.length-1,r=u.length-1;1<=i&&0<=r&&l[i]!==u[r];)r--;for(;1<=i&&0<=r;i--,r--)if(l[i]!==u[r]){if(i!==1||r!==1)do if(i--,r--,0>r||l[i]!==u[r]){var c=`
`+l[i].replace(" at new "," at ");return n.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",n.displayName)),c}while(1<=i&&0<=r);break}}}finally{Bb=!1,Error.prepareStackTrace=t}return(t=n?n.displayName||n.name:"")?hh(t):""}function JG(n){switch(n.tag){case 26:case 27:case 5:return hh(n.type);case 16:return hh("Lazy");case 13:return hh("Suspense");case 19:return hh("SuspenseList");case 0:case 15:return Fb(n.type,!1);case 11:return Fb(n.type.render,!1);case 1:return Fb(n.type,!0);case 31:return hh("Activity");default:return""}}function QR(n){try{var e="";do e+=JG(n),n=n.return;while(n);return e}catch(t){return`
Error generating stack: `+t.message+`
`+t.stack}}function Ns(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function eP(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function eV(n){var e=eP(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(a){i=""+a,s.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(a){i=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Jy(n){n._valueTracker||(n._valueTracker=eV(n))}function tP(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=eP(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function ev(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var tV=/[\n"\\]/g;function Os(n){return n.replace(tV,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function yT(n,e,t,i,r,s,a,o){n.name="",a!=null&&typeof a!="function"&&typeof a!="symbol"&&typeof a!="boolean"?n.type=a:n.removeAttribute("type"),e!=null?a==="number"?(e===0&&n.value===""||n.value!=e)&&(n.value=""+Ns(e)):n.value!==""+Ns(e)&&(n.value=""+Ns(e)):a!=="submit"&&a!=="reset"||n.removeAttribute("value"),e!=null?vT(n,a,Ns(e)):t!=null?vT(n,a,Ns(t)):i!=null&&n.removeAttribute("value"),r==null&&s!=null&&(n.defaultChecked=!!s),r!=null&&(n.checked=r&&typeof r!="function"&&typeof r!="symbol"),o!=null&&typeof o!="function"&&typeof o!="symbol"&&typeof o!="boolean"?n.name=""+Ns(o):n.removeAttribute("name")}function nP(n,e,t,i,r,s,a,o){if(s!=null&&typeof s!="function"&&typeof s!="symbol"&&typeof s!="boolean"&&(n.type=s),e!=null||t!=null){if(!(s!=="submit"&&s!=="reset"||e!=null))return;t=t!=null?""+Ns(t):"",e=e!=null?""+Ns(e):t,o||e===n.value||(n.value=e),n.defaultValue=e}i=i??r,i=typeof i!="function"&&typeof i!="symbol"&&!!i,n.checked=o?n.checked:!!i,n.defaultChecked=!!i,a!=null&&typeof a!="function"&&typeof a!="symbol"&&typeof a!="boolean"&&(n.name=a)}function vT(n,e,t){e==="number"&&ev(n.ownerDocument)===n||n.defaultValue===""+t||(n.defaultValue=""+t)}function jh(n,e,t,i){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&i&&(n[t].defaultSelected=!0)}else{for(t=""+Ns(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,i&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function iP(n,e,t){if(e!=null&&(e=""+Ns(e),e!==n.value&&(n.value=e),t==null)){n.defaultValue!==e&&(n.defaultValue=e);return}n.defaultValue=t!=null?""+Ns(t):""}function rP(n,e,t,i){if(e==null){if(i!=null){if(t!=null)throw Error(ce(92));if(yp(i)){if(1<i.length)throw Error(ce(93));i=i[0]}t=i}t==null&&(t=""),e=t}t=Ns(e),n.defaultValue=t,i=n.textContent,i===t&&i!==""&&i!==null&&(n.value=i)}function pd(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var nV=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ZR(n,e,t){var i=e.indexOf("--")===0;t==null||typeof t=="boolean"||t===""?i?n.setProperty(e,""):e==="float"?n.cssFloat="":n[e]="":i?n.setProperty(e,t):typeof t!="number"||t===0||nV.has(e)?e==="float"?n.cssFloat=t:n[e]=(""+t).trim():n[e]=t+"px"}function sP(n,e,t){if(e!=null&&typeof e!="object")throw Error(ce(62));if(n=n.style,t!=null){for(var i in t)!t.hasOwnProperty(i)||e!=null&&e.hasOwnProperty(i)||(i.indexOf("--")===0?n.setProperty(i,""):i==="float"?n.cssFloat="":n[i]="");for(var r in e)i=e[r],e.hasOwnProperty(r)&&t[r]!==i&&ZR(n,r,i)}else for(var s in e)e.hasOwnProperty(s)&&ZR(n,s,e[s])}function AM(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var iV=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),rV=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function dy(n){return rV.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}var bT=null;function RM(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Ah=null,qh=null;function JR(n){var e=mf(n);if(e&&(n=e.stateNode)){var t=n[Gr]||null;e:switch(n=e.stateNode,e.type){case"input":if(yT(n,t.value,t.defaultValue,t.defaultValue,t.checked,t.defaultChecked,t.type,t.name),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll('input[name="'+Os(""+e)+'"][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var r=i[Gr]||null;if(!r)throw Error(ce(90));yT(i,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(e=0;e<t.length;e++)i=t[e],i.form===n.form&&tP(i)}break e;case"textarea":iP(n,t.value,t.defaultValue);break e;case"select":e=t.value,e!=null&&jh(n,!!t.multiple,e,!1)}}}var kb=!1;function aP(n,e,t){if(kb)return n(e,t);kb=!0;try{var i=n(e);return i}finally{if(kb=!1,(Ah!==null||qh!==null)&&(k0(),Ah&&(e=Ah,n=qh,qh=Ah=null,JR(e),n)))for(e=0;e<n.length;e++)JR(n[e])}}function hm(n,e){var t=n.stateNode;if(t===null)return null;var i=t[Gr]||null;if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(ce(231,e,typeof t));return t}var Ko=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ST=!1;if(Ko)try{var Bf={};Object.defineProperty(Bf,"passive",{get:function(){ST=!0}}),window.addEventListener("test",Bf,Bf),window.removeEventListener("test",Bf,Bf)}catch{ST=!1}var Bl=null,NM=null,fy=null;function oP(){if(fy)return fy;var n,e=NM,t=e.length,i,r="value"in Bl?Bl.value:Bl.textContent,s=r.length;for(n=0;n<t&&e[n]===r[n];n++);var a=t-n;for(i=1;i<=a&&e[t-i]===r[s-i];i++);return fy=r.slice(n,1<i?1-i:void 0)}function py(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Qg(){return!0}function e1(){return!1}function qr(n){function e(t,i,r,s,a){this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Qg:e1,this.isPropagationStopped=e1,this}return Fn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Qg)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Qg)},persist:function(){},isPersistent:Qg}),e}var Mc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},C0=qr(Mc),og=Fn({},Mc,{view:0,detail:0}),sV=qr(og),zb,Gb,Ff,D0=Fn({},og,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:CM,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Ff&&(Ff&&n.type==="mousemove"?(zb=n.screenX-Ff.screenX,Gb=n.screenY-Ff.screenY):Gb=zb=0,Ff=n),zb)},movementY:function(n){return"movementY"in n?n.movementY:Gb}}),t1=qr(D0),aV=Fn({},D0,{dataTransfer:0}),oV=qr(aV),lV=Fn({},og,{relatedTarget:0}),Vb=qr(lV),uV=Fn({},Mc,{animationName:0,elapsedTime:0,pseudoElement:0}),cV=qr(uV),hV=Fn({},Mc,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),dV=qr(hV),fV=Fn({},Mc,{data:0}),n1=qr(fV),pV={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},mV={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gV={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _V(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=gV[n])?!!e[n]:!1}function CM(){return _V}var yV=Fn({},og,{key:function(n){if(n.key){var e=pV[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=py(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?mV[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:CM,charCode:function(n){return n.type==="keypress"?py(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?py(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),vV=qr(yV),bV=Fn({},D0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),i1=qr(bV),SV=Fn({},og,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:CM}),xV=qr(SV),TV=Fn({},Mc,{propertyName:0,elapsedTime:0,pseudoElement:0}),EV=qr(TV),MV=Fn({},D0,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),wV=qr(MV),AV=Fn({},Mc,{newState:0,oldState:0}),RV=qr(AV),NV=[9,13,27,32],DM=Ko&&"CompositionEvent"in window,Fp=null;Ko&&"documentMode"in document&&(Fp=document.documentMode);var CV=Ko&&"TextEvent"in window&&!Fp,lP=Ko&&(!DM||Fp&&8<Fp&&11>=Fp),r1=" ",s1=!1;function uP(n,e){switch(n){case"keyup":return NV.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function cP(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Rh=!1;function DV(n,e){switch(n){case"compositionend":return cP(e);case"keypress":return e.which!==32?null:(s1=!0,r1);case"textInput":return n=e.data,n===r1&&s1?null:n;default:return null}}function LV(n,e){if(Rh)return n==="compositionend"||!DM&&uP(n,e)?(n=oP(),fy=NM=Bl=null,Rh=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return lP&&e.locale!=="ko"?null:e.data;default:return null}}var PV={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function a1(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!PV[n.type]:e==="textarea"}function hP(n,e,t,i){Ah?qh?qh.push(i):qh=[i]:Ah=i,e=yv(e,"onChange"),0<e.length&&(t=new C0("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var kp=null,dm=null;function UV(n){iO(n,0)}function L0(n){var e=vp(n);if(tP(e))return n}function o1(n,e){if(n==="change")return e}var dP=!1;if(Ko){var Hb;if(Ko){var $b="oninput"in document;if(!$b){var l1=document.createElement("div");l1.setAttribute("oninput","return;"),$b=typeof l1.oninput=="function"}Hb=$b}else Hb=!1;dP=Hb&&(!document.documentMode||9<document.documentMode)}function u1(){kp&&(kp.detachEvent("onpropertychange",fP),dm=kp=null)}function fP(n){if(n.propertyName==="value"&&L0(dm)){var e=[];hP(e,dm,n,RM(n)),aP(UV,e)}}function OV(n,e,t){n==="focusin"?(u1(),kp=e,dm=t,kp.attachEvent("onpropertychange",fP)):n==="focusout"&&u1()}function IV(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return L0(dm)}function BV(n,e){if(n==="click")return L0(e)}function FV(n,e){if(n==="input"||n==="change")return L0(e)}function kV(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var bs=typeof Object.is=="function"?Object.is:kV;function fm(n,e){if(bs(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var r=t[i];if(!gT.call(e,r)||!bs(n[r],e[r]))return!1}return!0}function c1(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function h1(n,e){var t=c1(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=c1(t)}}function pP(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?pP(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function mP(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var e=ev(n.document);e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=ev(n.document)}return e}function LM(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}var zV=Ko&&"documentMode"in document&&11>=document.documentMode,Nh=null,xT=null,zp=null,TT=!1;function d1(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;TT||Nh==null||Nh!==ev(i)||(i=Nh,"selectionStart"in i&&LM(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),zp&&fm(zp,i)||(zp=i,i=yv(xT,"onSelect"),0<i.length&&(e=new C0("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=Nh)))}function Eu(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Ch={animationend:Eu("Animation","AnimationEnd"),animationiteration:Eu("Animation","AnimationIteration"),animationstart:Eu("Animation","AnimationStart"),transitionrun:Eu("Transition","TransitionRun"),transitionstart:Eu("Transition","TransitionStart"),transitioncancel:Eu("Transition","TransitionCancel"),transitionend:Eu("Transition","TransitionEnd")},Wb={},gP={};Ko&&(gP=document.createElement("div").style,"AnimationEvent"in window||(delete Ch.animationend.animation,delete Ch.animationiteration.animation,delete Ch.animationstart.animation),"TransitionEvent"in window||delete Ch.transitionend.transition);function wc(n){if(Wb[n])return Wb[n];if(!Ch[n])return n;var e=Ch[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in gP)return Wb[n]=e[t];return n}var _P=wc("animationend"),yP=wc("animationiteration"),vP=wc("animationstart"),GV=wc("transitionrun"),VV=wc("transitionstart"),HV=wc("transitioncancel"),bP=wc("transitionend"),SP=new Map,ET="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ET.push("scrollEnd");function pa(n,e){SP.set(n,e),Ec(e,[n])}var f1=new WeakMap;function Is(n,e){if(typeof n=="object"&&n!==null){var t=f1.get(n);return t!==void 0?t:(e={value:n,source:e,stack:QR(e)},f1.set(n,e),e)}return{value:n,source:e,stack:QR(e)}}var As=[],Dh=0,PM=0;function P0(){for(var n=Dh,e=PM=Dh=0;e<n;){var t=As[e];As[e++]=null;var i=As[e];As[e++]=null;var r=As[e];As[e++]=null;var s=As[e];if(As[e++]=null,i!==null&&r!==null){var a=i.pending;a===null?r.next=r:(r.next=a.next,a.next=r),i.pending=r}s!==0&&xP(t,r,s)}}function U0(n,e,t,i){As[Dh++]=n,As[Dh++]=e,As[Dh++]=t,As[Dh++]=i,PM|=i,n.lanes|=i,n=n.alternate,n!==null&&(n.lanes|=i)}function UM(n,e,t,i){return U0(n,e,t,i),tv(n)}function gf(n,e){return U0(n,null,null,e),tv(n)}function xP(n,e,t){n.lanes|=t;var i=n.alternate;i!==null&&(i.lanes|=t);for(var r=!1,s=n.return;s!==null;)s.childLanes|=t,i=s.alternate,i!==null&&(i.childLanes|=t),s.tag===22&&(n=s.stateNode,n===null||n._visibility&1||(r=!0)),n=s,s=s.return;return n.tag===3?(s=n.stateNode,r&&e!==null&&(r=31-hs(t),n=s.hiddenUpdates,i=n[r],i===null?n[r]=[e]:i.push(e),e.lane=t|536870912),s):null}function tv(n){if(50<Kp)throw Kp=0,WT=null,Error(ce(185));for(var e=n.return;e!==null;)n=e,e=n.return;return n.tag===3?n.stateNode:null}var Lh={};function $V(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function us(n,e,t,i){return new $V(n,e,t,i)}function OM(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Vo(n,e){var t=n.alternate;return t===null?(t=us(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&65011712,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t.refCleanup=n.refCleanup,t}function TP(n,e){n.flags&=65011714;var t=n.alternate;return t===null?(n.childLanes=0,n.lanes=e,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,n.type=t.type,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n}function my(n,e,t,i,r,s){var a=0;if(i=n,typeof n=="function")OM(n)&&(a=1);else if(typeof n=="string")a=j4(n,t,Va.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case dT:return n=us(31,t,e,r),n.elementType=dT,n.lanes=s,n;case Eh:return Ju(t.children,r,s,e);case VL:a=8,r|=24;break;case uT:return n=us(12,t,e,r|2),n.elementType=uT,n.lanes=s,n;case cT:return n=us(13,t,e,r),n.elementType=cT,n.lanes=s,n;case hT:return n=us(19,t,e,r),n.elementType=hT,n.lanes=s,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case UG:case Po:a=10;break e;case HL:a=9;break e;case SM:a=11;break e;case xM:a=14;break e;case Ml:a=16,i=null;break e}a=29,t=Error(ce(130,n===null?"null":typeof n,"")),i=null}return e=us(a,t,e,r),e.elementType=n,e.type=i,e.lanes=s,e}function Ju(n,e,t,i){return n=us(7,n,i,e),n.lanes=t,n}function jb(n,e,t){return n=us(6,n,null,e),n.lanes=t,n}function qb(n,e,t){return e=us(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}var Ph=[],Uh=0,nv=null,iv=0,Cs=[],Ds=0,ec=null,Uo=1,Oo="";function Fu(n,e){Ph[Uh++]=iv,Ph[Uh++]=nv,nv=n,iv=e}function EP(n,e,t){Cs[Ds++]=Uo,Cs[Ds++]=Oo,Cs[Ds++]=ec,ec=n;var i=Uo;n=Oo;var r=32-hs(i)-1;i&=~(1<<r),t+=1;var s=32-hs(e)+r;if(30<s){var a=r-r%5;s=(i&(1<<a)-1).toString(32),i>>=a,r-=a,Uo=1<<32-hs(e)+r|t<<r|i,Oo=s+n}else Uo=1<<s|t<<r|i,Oo=n}function IM(n){n.return!==null&&(Fu(n,1),EP(n,1,0))}function BM(n){for(;n===nv;)nv=Ph[--Uh],Ph[Uh]=null,iv=Ph[--Uh],Ph[Uh]=null;for(;n===ec;)ec=Cs[--Ds],Cs[Ds]=null,Oo=Cs[--Ds],Cs[Ds]=null,Uo=Cs[--Ds],Cs[Ds]=null}var pr=null,ti=null,en=!1,tc=null,Ca=!1,MT=Error(ce(519));function cc(n){var e=Error(ce(418,""));throw pm(Is(e,n)),MT}function p1(n){var e=n.stateNode,t=n.type,i=n.memoizedProps;switch(e[er]=n,e[Gr]=i,t){case"dialog":Ft("cancel",e),Ft("close",e);break;case"iframe":case"object":case"embed":Ft("load",e);break;case"video":case"audio":for(t=0;t<_m.length;t++)Ft(_m[t],e);break;case"source":Ft("error",e);break;case"img":case"image":case"link":Ft("error",e),Ft("load",e);break;case"details":Ft("toggle",e);break;case"input":Ft("invalid",e),nP(e,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0),Jy(e);break;case"select":Ft("invalid",e);break;case"textarea":Ft("invalid",e),rP(e,i.value,i.defaultValue,i.children),Jy(e)}t=i.children,typeof t!="string"&&typeof t!="number"&&typeof t!="bigint"||e.textContent===""+t||i.suppressHydrationWarning===!0||sO(e.textContent,t)?(i.popover!=null&&(Ft("beforetoggle",e),Ft("toggle",e)),i.onScroll!=null&&Ft("scroll",e),i.onScrollEnd!=null&&Ft("scrollend",e),i.onClick!=null&&(e.onclick=V0),e=!0):e=!1,e||cc(n)}function m1(n){for(pr=n.return;pr;)switch(pr.tag){case 5:case 13:Ca=!1;return;case 27:case 3:Ca=!0;return;default:pr=pr.return}}function kf(n){if(n!==pr)return!1;if(!en)return m1(n),en=!0,!1;var e=n.tag,t;if((t=e!==3&&e!==27)&&((t=e===5)&&(t=n.type,t=!(t!=="form"&&t!=="button")||QT(n.type,n.memoizedProps)),t=!t),t&&ti&&cc(n),m1(n),e===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(ce(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8)if(t=n.data,t==="/$"){if(e===0){ti=ca(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++;n=n.nextSibling}ti=null}}else e===27?(e=ti,fu(n.type)?(n=eE,eE=null,ti=n):ti=e):ti=pr?ca(n.stateNode.nextSibling):null;return!0}function lg(){ti=pr=null,en=!1}function g1(){var n=tc;return n!==null&&(Dr===null?Dr=n:Dr.push.apply(Dr,n),tc=null),n}function pm(n){tc===null?tc=[n]:tc.push(n)}var wT=to(null),Ac=null,Io=null;function Cl(n,e,t){Hn(wT,e._currentValue),e._currentValue=t}function Ho(n){n._currentValue=wT.current,ki(wT)}function AT(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function RT(n,e,t,i){var r=n.child;for(r!==null&&(r.return=n);r!==null;){var s=r.dependencies;if(s!==null){var a=r.child;s=s.firstContext;e:for(;s!==null;){var o=s;s=r;for(var l=0;l<e.length;l++)if(o.context===e[l]){s.lanes|=t,o=s.alternate,o!==null&&(o.lanes|=t),AT(s.return,t,n),i||(a=null);break e}s=o.next}}else if(r.tag===18){if(a=r.return,a===null)throw Error(ce(341));a.lanes|=t,s=a.alternate,s!==null&&(s.lanes|=t),AT(a,t,n),a=null}else a=r.child;if(a!==null)a.return=r;else for(a=r;a!==null;){if(a===n){a=null;break}if(r=a.sibling,r!==null){r.return=a.return,a=r;break}a=a.return}r=a}}function ug(n,e,t,i){n=null;for(var r=e,s=!1;r!==null;){if(!s){if(r.flags&524288)s=!0;else if(r.flags&262144)break}if(r.tag===10){var a=r.alternate;if(a===null)throw Error(ce(387));if(a=a.memoizedProps,a!==null){var o=r.type;bs(r.pendingProps.value,a.value)||(n!==null?n.push(o):n=[o])}}else if(r===Yy.current){if(a=r.alternate,a===null)throw Error(ce(387));a.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(n!==null?n.push(bm):n=[bm])}r=r.return}n!==null&&RT(e,n,t,i),e.flags|=262144}function rv(n){for(n=n.firstContext;n!==null;){if(!bs(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function hc(n){Ac=n,Io=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function tr(n){return MP(Ac,n)}function Zg(n,e){return Ac===null&&hc(n),MP(n,e)}function MP(n,e){var t=e._currentValue;if(e={context:e,memoizedValue:t,next:null},Io===null){if(n===null)throw Error(ce(308));Io=e,n.dependencies={lanes:0,firstContext:e},n.flags|=524288}else Io=Io.next=e;return t}var WV=typeof AbortController<"u"?AbortController:function(){var n=[],e=this.signal={aborted:!1,addEventListener:function(t,i){n.push(i)}};this.abort=function(){e.aborted=!0,n.forEach(function(t){return t()})}},jV=Ai.unstable_scheduleCallback,qV=Ai.unstable_NormalPriority,xi={$$typeof:Po,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function FM(){return{controller:new WV,data:new Map,refCount:0}}function cg(n){n.refCount--,n.refCount===0&&jV(qV,function(){n.controller.abort()})}var Gp=null,NT=0,md=0,Xh=null;function XV(n,e){if(Gp===null){var t=Gp=[];NT=0,md=ow(),Xh={status:"pending",value:void 0,then:function(i){t.push(i)}}}return NT++,e.then(_1,_1),e}function _1(){if(--NT===0&&Gp!==null){Xh!==null&&(Xh.status="fulfilled");var n=Gp;Gp=null,md=0,Xh=null;for(var e=0;e<n.length;e++)(0,n[e])()}}function YV(n,e){var t=[],i={status:"pending",value:null,reason:null,then:function(r){t.push(r)}};return n.then(function(){i.status="fulfilled",i.value=e;for(var r=0;r<t.length;r++)(0,t[r])(e)},function(r){for(i.status="rejected",i.reason=r,r=0;r<t.length;r++)(0,t[r])(void 0)}),i}var y1=gt.S;gt.S=function(n,e){typeof e=="object"&&e!==null&&typeof e.then=="function"&&XV(n,e),y1!==null&&y1(n,e)};var nc=to(null);function kM(){var n=nc.current;return n!==null?n:Pn.pooledCache}function gy(n,e){e===null?Hn(nc,nc.current):Hn(nc,e.pool)}function wP(){var n=kM();return n===null?null:{parent:xi._currentValue,pool:n}}var hg=Error(ce(460)),AP=Error(ce(474)),O0=Error(ce(542)),CT={then:function(){}};function v1(n){return n=n.status,n==="fulfilled"||n==="rejected"}function Jg(){}function RP(n,e,t){switch(t=n[t],t===void 0?n.push(e):t!==e&&(e.then(Jg,Jg),e=t),e.status){case"fulfilled":return e.value;case"rejected":throw n=e.reason,S1(n),n;default:if(typeof e.status=="string")e.then(Jg,Jg);else{if(n=Pn,n!==null&&100<n.shellSuspendCounter)throw Error(ce(482));n=e,n.status="pending",n.then(function(i){if(e.status==="pending"){var r=e;r.status="fulfilled",r.value=i}},function(i){if(e.status==="pending"){var r=e;r.status="rejected",r.reason=i}})}switch(e.status){case"fulfilled":return e.value;case"rejected":throw n=e.reason,S1(n),n}throw Vp=e,hg}}var Vp=null;function b1(){if(Vp===null)throw Error(ce(459));var n=Vp;return Vp=null,n}function S1(n){if(n===hg||n===O0)throw Error(ce(483))}var wl=!1;function zM(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function DT(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function Gl(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function Vl(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,pn&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,e=tv(n),xP(n,null,t),e}return U0(n,i,e,t),tv(n)}function Hp(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194048)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,KL(n,t)}}function Xb(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var a={lane:t.lane,tag:t.tag,payload:t.payload,callback:null,next:null};s===null?r=s=a:s=s.next=a,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,callbacks:i.callbacks},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}var LT=!1;function $p(){if(LT){var n=Xh;if(n!==null)throw n}}function Wp(n,e,t,i){LT=!1;var r=n.updateQueue;wl=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(o!==null){r.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?s=u:a.next=u,a=l;var c=n.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==a&&(o===null?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l))}if(s!==null){var h=r.baseState;a=0,c=u=l=null,o=s;do{var d=o.lane&-536870913,f=d!==o.lane;if(f?(Wt&d)===d:(i&d)===d){d!==0&&d===md&&(LT=!0),c!==null&&(c=c.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var m=n,_=o;d=e;var g=t;switch(_.tag){case 1:if(m=_.payload,typeof m=="function"){h=m.call(g,h,d);break e}h=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=_.payload,d=typeof m=="function"?m.call(g,h,d):m,d==null)break e;h=Fn({},h,d);break e;case 2:wl=!0}}d=o.callback,d!==null&&(n.flags|=64,f&&(n.flags|=8192),f=r.callbacks,f===null?r.callbacks=[d]:f.push(d))}else f={lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(u=c=f,l=h):c=c.next=f,a|=d;if(o=o.next,o===null){if(o=r.shared.pending,o===null)break;f=o,o=f.next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}while(!0);c===null&&(l=h),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,s===null&&(r.shared.lanes=0),nu|=a,n.lanes=a,n.memoizedState=h}}function NP(n,e){if(typeof n!="function")throw Error(ce(191,n));n.call(e)}function CP(n,e){var t=n.callbacks;if(t!==null)for(n.callbacks=null,n=0;n<t.length;n++)NP(t[n],e)}var gd=to(null),sv=to(0);function x1(n,e){n=Jo,Hn(sv,n),Hn(gd,e),Jo=n|e.baseLanes}function PT(){Hn(sv,Jo),Hn(gd,gd.current)}function GM(){Jo=sv.current,ki(gd),ki(sv)}var eu=0,Pt=null,yn=null,pi=null,av=!1,Yh=!1,dc=!1,ov=0,mm=0,Kh=null,KV=0;function ai(){throw Error(ce(321))}function VM(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!bs(n[t],e[t]))return!1;return!0}function HM(n,e,t,i,r,s){return eu=s,Pt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,gt.H=n===null||n.memoizedState===null?oU:lU,dc=!1,s=t(i,r),dc=!1,Yh&&(s=LP(e,t,i,r)),DP(n),s}function DP(n){gt.H=lv;var e=yn!==null&&yn.next!==null;if(eu=0,pi=yn=Pt=null,av=!1,mm=0,Kh=null,e)throw Error(ce(300));n===null||Bi||(n=n.dependencies,n!==null&&rv(n)&&(Bi=!0))}function LP(n,e,t,i){Pt=n;var r=0;do{if(Yh&&(Kh=null),mm=0,Yh=!1,25<=r)throw Error(ce(301));if(r+=1,pi=yn=null,n.updateQueue!=null){var s=n.updateQueue;s.lastEffect=null,s.events=null,s.stores=null,s.memoCache!=null&&(s.memoCache.index=0)}gt.H=i4,s=e(t,i)}while(Yh);return s}function QV(){var n=gt.H,e=n.useState()[0];return e=typeof e.then=="function"?dg(e):e,n=n.useState()[0],(yn!==null?yn.memoizedState:null)!==n&&(Pt.flags|=1024),e}function $M(){var n=ov!==0;return ov=0,n}function WM(n,e,t){e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~t}function jM(n){if(av){for(n=n.memoizedState;n!==null;){var e=n.queue;e!==null&&(e.pending=null),n=n.next}av=!1}eu=0,pi=yn=Pt=null,Yh=!1,mm=ov=0,Kh=null}function Nr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pi===null?Pt.memoizedState=pi=n:pi=pi.next=n,pi}function gi(){if(yn===null){var n=Pt.alternate;n=n!==null?n.memoizedState:null}else n=yn.next;var e=pi===null?Pt.memoizedState:pi.next;if(e!==null)pi=e,yn=n;else{if(n===null)throw Pt.alternate===null?Error(ce(467)):Error(ce(310));yn=n,n={memoizedState:yn.memoizedState,baseState:yn.baseState,baseQueue:yn.baseQueue,queue:yn.queue,next:null},pi===null?Pt.memoizedState=pi=n:pi=pi.next=n}return pi}function qM(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function dg(n){var e=mm;return mm+=1,Kh===null&&(Kh=[]),n=RP(Kh,n,e),e=Pt,(pi===null?e.memoizedState:pi.next)===null&&(e=e.alternate,gt.H=e===null||e.memoizedState===null?oU:lU),n}function I0(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return dg(n);if(n.$$typeof===Po)return tr(n)}throw Error(ce(438,String(n)))}function XM(n){var e=null,t=Pt.updateQueue;if(t!==null&&(e=t.memoCache),e==null){var i=Pt.alternate;i!==null&&(i=i.updateQueue,i!==null&&(i=i.memoCache,i!=null&&(e={data:i.data.map(function(r){return r.slice()}),index:0})))}if(e==null&&(e={data:[],index:0}),t===null&&(t=qM(),Pt.updateQueue=t),t.memoCache=e,t=e.data[e.index],t===void 0)for(t=e.data[e.index]=Array(n),i=0;i<n;i++)t[i]=OG;return e.index++,t}function Qo(n,e){return typeof e=="function"?e(n):e}function _y(n){var e=gi();return YM(e,yn,n)}function YM(n,e,t){var i=n.queue;if(i===null)throw Error(ce(311));i.lastRenderedReducer=t;var r=n.baseQueue,s=i.pending;if(s!==null){if(r!==null){var a=r.next;r.next=s.next,s.next=a}e.baseQueue=r=s,i.pending=null}if(s=n.baseState,r===null)n.memoizedState=s;else{e=r.next;var o=a=null,l=null,u=e,c=!1;do{var h=u.lane&-536870913;if(h!==u.lane?(Wt&h)===h:(eu&h)===h){var d=u.revertLane;if(d===0)l!==null&&(l=l.next={lane:0,revertLane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),h===md&&(c=!0);else if((eu&d)===d){u=u.next,d===md&&(c=!0);continue}else h={lane:0,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},l===null?(o=l=h,a=s):l=l.next=h,Pt.lanes|=d,nu|=d;h=u.action,dc&&t(s,h),s=u.hasEagerState?u.eagerState:t(s,h)}else d={lane:h,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},l===null?(o=l=d,a=s):l=l.next=d,Pt.lanes|=h,nu|=h;u=u.next}while(u!==null&&u!==e);if(l===null?a=s:l.next=o,!bs(s,n.memoizedState)&&(Bi=!0,c&&(t=Xh,t!==null)))throw t;n.memoizedState=s,n.baseState=a,n.baseQueue=l,i.lastRenderedState=s}return r===null&&(i.lanes=0),[n.memoizedState,i.dispatch]}function Yb(n){var e=gi(),t=e.queue;if(t===null)throw Error(ce(311));t.lastRenderedReducer=n;var i=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var a=r=r.next;do s=n(s,a.action),a=a.next;while(a!==r);bs(s,e.memoizedState)||(Bi=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,i]}function PP(n,e,t){var i=Pt,r=gi(),s=en;if(s){if(t===void 0)throw Error(ce(407));t=t()}else t=e();var a=!bs((yn||r).memoizedState,t);a&&(r.memoizedState=t,Bi=!0),r=r.queue;var o=IP.bind(null,i,r,n);if(fg(2048,8,o,[n]),r.getSnapshot!==e||a||pi!==null&&pi.memoizedState.tag&1){if(i.flags|=2048,_d(9,B0(),OP.bind(null,i,r,t,e),null),Pn===null)throw Error(ce(349));s||eu&124||UP(i,e,t)}return t}function UP(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Pt.updateQueue,e===null?(e=qM(),Pt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function OP(n,e,t,i){e.value=t,e.getSnapshot=i,BP(e)&&FP(n)}function IP(n,e,t){return t(function(){BP(e)&&FP(n)})}function BP(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!bs(n,t)}catch{return!0}}function FP(n){var e=gf(n,2);e!==null&&fs(e,n,2)}function UT(n){var e=Nr();if(typeof n=="function"){var t=n;if(n=t(),dc){Il(!0);try{t()}finally{Il(!1)}}}return e.memoizedState=e.baseState=n,e.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qo,lastRenderedState:n},e}function kP(n,e,t,i){return n.baseState=t,YM(n,yn,typeof i=="function"?i:Qo)}function ZV(n,e,t,i,r){if(F0(n))throw Error(ce(485));if(n=e.action,n!==null){var s={payload:r,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(a){s.listeners.push(a)}};gt.T!==null?t(!0):s.isTransition=!1,i(s),t=e.pending,t===null?(s.next=e.pending=s,zP(e,s)):(s.next=t.next,e.pending=t.next=s)}}function zP(n,e){var t=e.action,i=e.payload,r=n.state;if(e.isTransition){var s=gt.T,a={};gt.T=a;try{var o=t(r,i),l=gt.S;l!==null&&l(a,o),T1(n,e,o)}catch(u){OT(n,e,u)}finally{gt.T=s}}else try{s=t(r,i),T1(n,e,s)}catch(u){OT(n,e,u)}}function T1(n,e,t){t!==null&&typeof t=="object"&&typeof t.then=="function"?t.then(function(i){E1(n,e,i)},function(i){return OT(n,e,i)}):E1(n,e,t)}function E1(n,e,t){e.status="fulfilled",e.value=t,GP(e),n.state=t,e=n.pending,e!==null&&(t=e.next,t===e?n.pending=null:(t=t.next,e.next=t,zP(n,t)))}function OT(n,e,t){var i=n.pending;if(n.pending=null,i!==null){i=i.next;do e.status="rejected",e.reason=t,GP(e),e=e.next;while(e!==i)}n.action=null}function GP(n){n=n.listeners;for(var e=0;e<n.length;e++)(0,n[e])()}function VP(n,e){return e}function M1(n,e){if(en){var t=Pn.formState;if(t!==null){e:{var i=Pt;if(en){if(ti){t:{for(var r=ti,s=Ca;r.nodeType!==8;){if(!s){r=null;break t}if(r=ca(r.nextSibling),r===null){r=null;break t}}s=r.data,r=s==="F!"||s==="F"?r:null}if(r){ti=ca(r.nextSibling),i=r.data==="F!";break e}}cc(i)}i=!1}i&&(e=t[0])}}return t=Nr(),t.memoizedState=t.baseState=e,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:VP,lastRenderedState:e},t.queue=i,t=rU.bind(null,Pt,i),i.dispatch=t,i=UT(!1),s=JM.bind(null,Pt,!1,i.queue),i=Nr(),r={state:e,dispatch:null,action:n,pending:null},i.queue=r,t=ZV.bind(null,Pt,r,s,t),r.dispatch=t,i.memoizedState=n,[e,t,!1]}function w1(n){var e=gi();return HP(e,yn,n)}function HP(n,e,t){if(e=YM(n,e,VP)[0],n=_y(Qo)[0],typeof e=="object"&&e!==null&&typeof e.then=="function")try{var i=dg(e)}catch(a){throw a===hg?O0:a}else i=e;e=gi();var r=e.queue,s=r.dispatch;return t!==e.memoizedState&&(Pt.flags|=2048,_d(9,B0(),JV.bind(null,r,t),null)),[i,s,n]}function JV(n,e){n.action=e}function A1(n){var e=gi(),t=yn;if(t!==null)return HP(e,t,n);gi(),e=e.memoizedState,t=gi();var i=t.queue.dispatch;return t.memoizedState=n,[e,i,!1]}function _d(n,e,t,i){return n={tag:n,create:t,deps:i,inst:e,next:null},e=Pt.updateQueue,e===null&&(e=qM(),Pt.updateQueue=e),t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n),n}function B0(){return{destroy:void 0,resource:void 0}}function $P(){return gi().memoizedState}function yy(n,e,t,i){var r=Nr();i=i===void 0?null:i,Pt.flags|=n,r.memoizedState=_d(1|e,B0(),t,i)}function fg(n,e,t,i){var r=gi();i=i===void 0?null:i;var s=r.memoizedState.inst;yn!==null&&i!==null&&VM(i,yn.memoizedState.deps)?r.memoizedState=_d(e,s,t,i):(Pt.flags|=n,r.memoizedState=_d(1|e,s,t,i))}function R1(n,e){yy(8390656,8,n,e)}function WP(n,e){fg(2048,8,n,e)}function jP(n,e){return fg(4,2,n,e)}function qP(n,e){return fg(4,4,n,e)}function XP(n,e){if(typeof e=="function"){n=n();var t=e(n);return function(){typeof t=="function"?t():e(null)}}if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function YP(n,e,t){t=t!=null?t.concat([n]):null,fg(4,4,XP.bind(null,e,n),t)}function KM(){}function KP(n,e){var t=gi();e=e===void 0?null:e;var i=t.memoizedState;return e!==null&&VM(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function QP(n,e){var t=gi();e=e===void 0?null:e;var i=t.memoizedState;if(e!==null&&VM(e,i[1]))return i[0];if(i=n(),dc){Il(!0);try{n()}finally{Il(!1)}}return t.memoizedState=[i,e],i}function QM(n,e,t){return t===void 0||eu&1073741824?n.memoizedState=e:(n.memoizedState=t,n=GU(),Pt.lanes|=n,nu|=n,t)}function ZP(n,e,t,i){return bs(t,e)?t:gd.current!==null?(n=QM(n,t,i),bs(n,e)||(Bi=!0),n):eu&42?(n=GU(),Pt.lanes|=n,nu|=n,e):(Bi=!0,n.memoizedState=t)}function JP(n,e,t,i,r){var s=tn.p;tn.p=s!==0&&8>s?s:8;var a=gt.T,o={};gt.T=o,JM(n,!1,e,t);try{var l=r(),u=gt.S;if(u!==null&&u(o,l),l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=YV(l,i);jp(n,e,c,ds(n))}else jp(n,e,i,ds(n))}catch(h){jp(n,e,{then:function(){},status:"rejected",reason:h},ds())}finally{tn.p=s,gt.T=a}}function e4(){}function IT(n,e,t,i){if(n.tag!==5)throw Error(ce(476));var r=eU(n).queue;JP(n,r,e,Zu,t===null?e4:function(){return tU(n),t(i)})}function eU(n){var e=n.memoizedState;if(e!==null)return e;e={memoizedState:Zu,baseState:Zu,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qo,lastRenderedState:Zu},next:null};var t={};return e.next={memoizedState:t,baseState:t,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qo,lastRenderedState:t},next:null},n.memoizedState=e,n=n.alternate,n!==null&&(n.memoizedState=e),e}function tU(n){var e=eU(n).next.queue;jp(n,e,{},ds())}function ZM(){return tr(bm)}function nU(){return gi().memoizedState}function iU(){return gi().memoizedState}function t4(n){for(var e=n.return;e!==null;){switch(e.tag){case 24:case 3:var t=ds();n=Gl(t);var i=Vl(e,n,t);i!==null&&(fs(i,e,t),Hp(i,e,t)),e={cache:FM()},n.payload=e;return}e=e.return}}function n4(n,e,t){var i=ds();t={lane:i,revertLane:0,action:t,hasEagerState:!1,eagerState:null,next:null},F0(n)?sU(e,t):(t=UM(n,e,t,i),t!==null&&(fs(t,n,i),aU(t,e,i)))}function rU(n,e,t){var i=ds();jp(n,e,t,i)}function jp(n,e,t,i){var r={lane:i,revertLane:0,action:t,hasEagerState:!1,eagerState:null,next:null};if(F0(n))sU(e,r);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,o=s(a,t);if(r.hasEagerState=!0,r.eagerState=o,bs(o,a))return U0(n,e,r,0),Pn===null&&P0(),!1}catch{}finally{}if(t=UM(n,e,r,i),t!==null)return fs(t,n,i),aU(t,e,i),!0}return!1}function JM(n,e,t,i){if(i={lane:2,revertLane:ow(),action:i,hasEagerState:!1,eagerState:null,next:null},F0(n)){if(e)throw Error(ce(479))}else e=UM(n,t,i,2),e!==null&&fs(e,n,2)}function F0(n){var e=n.alternate;return n===Pt||e!==null&&e===Pt}function sU(n,e){Yh=av=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function aU(n,e,t){if(t&4194048){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,KL(n,t)}}var lv={readContext:tr,use:I0,useCallback:ai,useContext:ai,useEffect:ai,useImperativeHandle:ai,useLayoutEffect:ai,useInsertionEffect:ai,useMemo:ai,useReducer:ai,useRef:ai,useState:ai,useDebugValue:ai,useDeferredValue:ai,useTransition:ai,useSyncExternalStore:ai,useId:ai,useHostTransitionStatus:ai,useFormState:ai,useActionState:ai,useOptimistic:ai,useMemoCache:ai,useCacheRefresh:ai},oU={readContext:tr,use:I0,useCallback:function(n,e){return Nr().memoizedState=[n,e===void 0?null:e],n},useContext:tr,useEffect:R1,useImperativeHandle:function(n,e,t){t=t!=null?t.concat([n]):null,yy(4194308,4,XP.bind(null,e,n),t)},useLayoutEffect:function(n,e){return yy(4194308,4,n,e)},useInsertionEffect:function(n,e){yy(4,2,n,e)},useMemo:function(n,e){var t=Nr();e=e===void 0?null:e;var i=n();if(dc){Il(!0);try{n()}finally{Il(!1)}}return t.memoizedState=[i,e],i},useReducer:function(n,e,t){var i=Nr();if(t!==void 0){var r=t(e);if(dc){Il(!0);try{t(e)}finally{Il(!1)}}}else r=e;return i.memoizedState=i.baseState=r,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:r},i.queue=n,n=n.dispatch=n4.bind(null,Pt,n),[i.memoizedState,n]},useRef:function(n){var e=Nr();return n={current:n},e.memoizedState=n},useState:function(n){n=UT(n);var e=n.queue,t=rU.bind(null,Pt,e);return e.dispatch=t,[n.memoizedState,t]},useDebugValue:KM,useDeferredValue:function(n,e){var t=Nr();return QM(t,n,e)},useTransition:function(){var n=UT(!1);return n=JP.bind(null,Pt,n.queue,!0,!1),Nr().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,e,t){var i=Pt,r=Nr();if(en){if(t===void 0)throw Error(ce(407));t=t()}else{if(t=e(),Pn===null)throw Error(ce(349));Wt&124||UP(i,e,t)}r.memoizedState=t;var s={value:t,getSnapshot:e};return r.queue=s,R1(IP.bind(null,i,s,n),[n]),i.flags|=2048,_d(9,B0(),OP.bind(null,i,s,t,e),null),t},useId:function(){var n=Nr(),e=Pn.identifierPrefix;if(en){var t=Oo,i=Uo;t=(i&~(1<<32-hs(i)-1)).toString(32)+t,e="«"+e+"R"+t,t=ov++,0<t&&(e+="H"+t.toString(32)),e+="»"}else t=KV++,e="«"+e+"r"+t.toString(32)+"»";return n.memoizedState=e},useHostTransitionStatus:ZM,useFormState:M1,useActionState:M1,useOptimistic:function(n){var e=Nr();e.memoizedState=e.baseState=n;var t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return e.queue=t,e=JM.bind(null,Pt,!0,t),t.dispatch=e,[n,e]},useMemoCache:XM,useCacheRefresh:function(){return Nr().memoizedState=t4.bind(null,Pt)}},lU={readContext:tr,use:I0,useCallback:KP,useContext:tr,useEffect:WP,useImperativeHandle:YP,useInsertionEffect:jP,useLayoutEffect:qP,useMemo:QP,useReducer:_y,useRef:$P,useState:function(){return _y(Qo)},useDebugValue:KM,useDeferredValue:function(n,e){var t=gi();return ZP(t,yn.memoizedState,n,e)},useTransition:function(){var n=_y(Qo)[0],e=gi().memoizedState;return[typeof n=="boolean"?n:dg(n),e]},useSyncExternalStore:PP,useId:nU,useHostTransitionStatus:ZM,useFormState:w1,useActionState:w1,useOptimistic:function(n,e){var t=gi();return kP(t,yn,n,e)},useMemoCache:XM,useCacheRefresh:iU},i4={readContext:tr,use:I0,useCallback:KP,useContext:tr,useEffect:WP,useImperativeHandle:YP,useInsertionEffect:jP,useLayoutEffect:qP,useMemo:QP,useReducer:Yb,useRef:$P,useState:function(){return Yb(Qo)},useDebugValue:KM,useDeferredValue:function(n,e){var t=gi();return yn===null?QM(t,n,e):ZP(t,yn.memoizedState,n,e)},useTransition:function(){var n=Yb(Qo)[0],e=gi().memoizedState;return[typeof n=="boolean"?n:dg(n),e]},useSyncExternalStore:PP,useId:nU,useHostTransitionStatus:ZM,useFormState:A1,useActionState:A1,useOptimistic:function(n,e){var t=gi();return yn!==null?kP(t,yn,n,e):(t.baseState=n,[n,t.queue.dispatch])},useMemoCache:XM,useCacheRefresh:iU},Qh=null,gm=0;function e_(n){var e=gm;return gm+=1,Qh===null&&(Qh=[]),RP(Qh,n,e)}function zf(n,e){e=e.props.ref,n.ref=e!==void 0?e:null}function t_(n,e){throw e.$$typeof===PG?Error(ce(525)):(n=Object.prototype.toString.call(e),Error(ce(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n)))}function N1(n){var e=n._init;return e(n._payload)}function uU(n){function e(p,y){if(n){var v=p.deletions;v===null?(p.deletions=[y],p.flags|=16):v.push(y)}}function t(p,y){if(!n)return null;for(;y!==null;)e(p,y),y=y.sibling;return null}function i(p){for(var y=new Map;p!==null;)p.key!==null?y.set(p.key,p):y.set(p.index,p),p=p.sibling;return y}function r(p,y){return p=Vo(p,y),p.index=0,p.sibling=null,p}function s(p,y,v){return p.index=v,n?(v=p.alternate,v!==null?(v=v.index,v<y?(p.flags|=67108866,y):v):(p.flags|=67108866,y)):(p.flags|=1048576,y)}function a(p){return n&&p.alternate===null&&(p.flags|=67108866),p}function o(p,y,v,b){return y===null||y.tag!==6?(y=jb(v,p.mode,b),y.return=p,y):(y=r(y,v),y.return=p,y)}function l(p,y,v,b){var S=v.type;return S===Eh?c(p,y,v.props.children,b,v.key):y!==null&&(y.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Ml&&N1(S)===y.type)?(y=r(y,v.props),zf(y,v),y.return=p,y):(y=my(v.type,v.key,v.props,null,p.mode,b),zf(y,v),y.return=p,y)}function u(p,y,v,b){return y===null||y.tag!==4||y.stateNode.containerInfo!==v.containerInfo||y.stateNode.implementation!==v.implementation?(y=qb(v,p.mode,b),y.return=p,y):(y=r(y,v.children||[]),y.return=p,y)}function c(p,y,v,b,S){return y===null||y.tag!==7?(y=Ju(v,p.mode,b,S),y.return=p,y):(y=r(y,v),y.return=p,y)}function h(p,y,v){if(typeof y=="string"&&y!==""||typeof y=="number"||typeof y=="bigint")return y=jb(""+y,p.mode,v),y.return=p,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case qg:return v=my(y.type,y.key,y.props,null,p.mode,v),zf(v,y),v.return=p,v;case _p:return y=qb(y,p.mode,v),y.return=p,y;case Ml:var b=y._init;return y=b(y._payload),h(p,y,v)}if(yp(y)||If(y))return y=Ju(y,p.mode,v,null),y.return=p,y;if(typeof y.then=="function")return h(p,e_(y),v);if(y.$$typeof===Po)return h(p,Zg(p,y),v);t_(p,y)}return null}function d(p,y,v,b){var S=y!==null?y.key:null;if(typeof v=="string"&&v!==""||typeof v=="number"||typeof v=="bigint")return S!==null?null:o(p,y,""+v,b);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case qg:return v.key===S?l(p,y,v,b):null;case _p:return v.key===S?u(p,y,v,b):null;case Ml:return S=v._init,v=S(v._payload),d(p,y,v,b)}if(yp(v)||If(v))return S!==null?null:c(p,y,v,b,null);if(typeof v.then=="function")return d(p,y,e_(v),b);if(v.$$typeof===Po)return d(p,y,Zg(p,v),b);t_(p,v)}return null}function f(p,y,v,b,S){if(typeof b=="string"&&b!==""||typeof b=="number"||typeof b=="bigint")return p=p.get(v)||null,o(y,p,""+b,S);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case qg:return p=p.get(b.key===null?v:b.key)||null,l(y,p,b,S);case _p:return p=p.get(b.key===null?v:b.key)||null,u(y,p,b,S);case Ml:var x=b._init;return b=x(b._payload),f(p,y,v,b,S)}if(yp(b)||If(b))return p=p.get(v)||null,c(y,p,b,S,null);if(typeof b.then=="function")return f(p,y,v,e_(b),S);if(b.$$typeof===Po)return f(p,y,v,Zg(y,b),S);t_(y,b)}return null}function m(p,y,v,b){for(var S=null,x=null,T=y,w=y=0,E=null;T!==null&&w<v.length;w++){T.index>w?(E=T,T=null):E=T.sibling;var M=d(p,T,v[w],b);if(M===null){T===null&&(T=E);break}n&&T&&M.alternate===null&&e(p,T),y=s(M,y,w),x===null?S=M:x.sibling=M,x=M,T=E}if(w===v.length)return t(p,T),en&&Fu(p,w),S;if(T===null){for(;w<v.length;w++)T=h(p,v[w],b),T!==null&&(y=s(T,y,w),x===null?S=T:x.sibling=T,x=T);return en&&Fu(p,w),S}for(T=i(T);w<v.length;w++)E=f(T,p,w,v[w],b),E!==null&&(n&&E.alternate!==null&&T.delete(E.key===null?w:E.key),y=s(E,y,w),x===null?S=E:x.sibling=E,x=E);return n&&T.forEach(function(N){return e(p,N)}),en&&Fu(p,w),S}function _(p,y,v,b){if(v==null)throw Error(ce(151));for(var S=null,x=null,T=y,w=y=0,E=null,M=v.next();T!==null&&!M.done;w++,M=v.next()){T.index>w?(E=T,T=null):E=T.sibling;var N=d(p,T,M.value,b);if(N===null){T===null&&(T=E);break}n&&T&&N.alternate===null&&e(p,T),y=s(N,y,w),x===null?S=N:x.sibling=N,x=N,T=E}if(M.done)return t(p,T),en&&Fu(p,w),S;if(T===null){for(;!M.done;w++,M=v.next())M=h(p,M.value,b),M!==null&&(y=s(M,y,w),x===null?S=M:x.sibling=M,x=M);return en&&Fu(p,w),S}for(T=i(T);!M.done;w++,M=v.next())M=f(T,p,w,M.value,b),M!==null&&(n&&M.alternate!==null&&T.delete(M.key===null?w:M.key),y=s(M,y,w),x===null?S=M:x.sibling=M,x=M);return n&&T.forEach(function(U){return e(p,U)}),en&&Fu(p,w),S}function g(p,y,v,b){if(typeof v=="object"&&v!==null&&v.type===Eh&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case qg:e:{for(var S=v.key;y!==null;){if(y.key===S){if(S=v.type,S===Eh){if(y.tag===7){t(p,y.sibling),b=r(y,v.props.children),b.return=p,p=b;break e}}else if(y.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Ml&&N1(S)===y.type){t(p,y.sibling),b=r(y,v.props),zf(b,v),b.return=p,p=b;break e}t(p,y);break}else e(p,y);y=y.sibling}v.type===Eh?(b=Ju(v.props.children,p.mode,b,v.key),b.return=p,p=b):(b=my(v.type,v.key,v.props,null,p.mode,b),zf(b,v),b.return=p,p=b)}return a(p);case _p:e:{for(S=v.key;y!==null;){if(y.key===S)if(y.tag===4&&y.stateNode.containerInfo===v.containerInfo&&y.stateNode.implementation===v.implementation){t(p,y.sibling),b=r(y,v.children||[]),b.return=p,p=b;break e}else{t(p,y);break}else e(p,y);y=y.sibling}b=qb(v,p.mode,b),b.return=p,p=b}return a(p);case Ml:return S=v._init,v=S(v._payload),g(p,y,v,b)}if(yp(v))return m(p,y,v,b);if(If(v)){if(S=If(v),typeof S!="function")throw Error(ce(150));return v=S.call(v),_(p,y,v,b)}if(typeof v.then=="function")return g(p,y,e_(v),b);if(v.$$typeof===Po)return g(p,y,Zg(p,v),b);t_(p,v)}return typeof v=="string"&&v!==""||typeof v=="number"||typeof v=="bigint"?(v=""+v,y!==null&&y.tag===6?(t(p,y.sibling),b=r(y,v),b.return=p,p=b):(t(p,y),b=jb(v,p.mode,b),b.return=p,p=b),a(p)):t(p,y)}return function(p,y,v,b){try{gm=0;var S=g(p,y,v,b);return Qh=null,S}catch(T){if(T===hg||T===O0)throw T;var x=us(29,T,null,p.mode);return x.lanes=b,x.return=p,x}finally{}}}var yd=uU(!0),cU=uU(!1),Vs=to(null),$a=null;function Dl(n){var e=n.alternate;Hn(Mi,Mi.current&1),Hn(Vs,n),$a===null&&(e===null||gd.current!==null||e.memoizedState!==null)&&($a=n)}function hU(n){if(n.tag===22){if(Hn(Mi,Mi.current),Hn(Vs,n),$a===null){var e=n.alternate;e!==null&&e.memoizedState!==null&&($a=n)}}else Ll()}function Ll(){Hn(Mi,Mi.current),Hn(Vs,Vs.current)}function Bo(n){ki(Vs),$a===n&&($a=null),ki(Mi)}var Mi=to(0);function uv(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||JT(t)))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}function Kb(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:Fn({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var BT={enqueueSetState:function(n,e,t){n=n._reactInternals;var i=ds(),r=Gl(i);r.payload=e,t!=null&&(r.callback=t),e=Vl(n,r,i),e!==null&&(fs(e,n,i),Hp(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=ds(),r=Gl(i);r.tag=1,r.payload=e,t!=null&&(r.callback=t),e=Vl(n,r,i),e!==null&&(fs(e,n,i),Hp(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=ds(),i=Gl(t);i.tag=2,e!=null&&(i.callback=e),e=Vl(n,i,t),e!==null&&(fs(e,n,t),Hp(e,n,t))}};function C1(n,e,t,i,r,s,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,s,a):e.prototype&&e.prototype.isPureReactComponent?!fm(t,i)||!fm(r,s):!0}function D1(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&BT.enqueueReplaceState(e,e.state,null)}function fc(n,e){var t=e;if("ref"in e){t={};for(var i in e)i!=="ref"&&(t[i]=e[i])}if(n=n.defaultProps){t===e&&(t=Fn({},t));for(var r in n)t[r]===void 0&&(t[r]=n[r])}return t}var cv=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)};function dU(n){cv(n)}function fU(n){console.error(n)}function pU(n){cv(n)}function hv(n,e){try{var t=n.onUncaughtError;t(e.value,{componentStack:e.stack})}catch(i){setTimeout(function(){throw i})}}function L1(n,e,t){try{var i=n.onCaughtError;i(t.value,{componentStack:t.stack,errorBoundary:e.tag===1?e.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function FT(n,e,t){return t=Gl(t),t.tag=3,t.payload={element:null},t.callback=function(){hv(n,e)},t}function mU(n){return n=Gl(n),n.tag=3,n}function gU(n,e,t,i){var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=i.value;n.payload=function(){return r(s)},n.callback=function(){L1(e,t,i)}}var a=t.stateNode;a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){L1(e,t,i),typeof r!="function"&&(Hl===null?Hl=new Set([this]):Hl.add(this));var o=i.stack;this.componentDidCatch(i.value,{componentStack:o!==null?o:""})})}function r4(n,e,t,i,r){if(t.flags|=32768,i!==null&&typeof i=="object"&&typeof i.then=="function"){if(e=t.alternate,e!==null&&ug(e,t,r,!0),t=Vs.current,t!==null){switch(t.tag){case 13:return $a===null?jT():t.alternate===null&&ni===0&&(ni=3),t.flags&=-257,t.flags|=65536,t.lanes=r,i===CT?t.flags|=16384:(e=t.updateQueue,e===null?t.updateQueue=new Set([i]):e.add(i),oS(n,i,r)),!1;case 22:return t.flags|=65536,i===CT?t.flags|=16384:(e=t.updateQueue,e===null?(e={transitions:null,markerInstances:null,retryQueue:new Set([i])},t.updateQueue=e):(t=e.retryQueue,t===null?e.retryQueue=new Set([i]):t.add(i)),oS(n,i,r)),!1}throw Error(ce(435,t.tag))}return oS(n,i,r),jT(),!1}if(en)return e=Vs.current,e!==null?(!(e.flags&65536)&&(e.flags|=256),e.flags|=65536,e.lanes=r,i!==MT&&(n=Error(ce(422),{cause:i}),pm(Is(n,t)))):(i!==MT&&(e=Error(ce(423),{cause:i}),pm(Is(e,t))),n=n.current.alternate,n.flags|=65536,r&=-r,n.lanes|=r,i=Is(i,t),r=FT(n.stateNode,i,r),Xb(n,r),ni!==4&&(ni=2)),!1;var s=Error(ce(520),{cause:i});if(s=Is(s,t),Yp===null?Yp=[s]:Yp.push(s),ni!==4&&(ni=2),e===null)return!0;i=Is(i,t),t=e;do{switch(t.tag){case 3:return t.flags|=65536,n=r&-r,t.lanes|=n,n=FT(t.stateNode,i,n),Xb(t,n),!1;case 1:if(e=t.type,s=t.stateNode,(t.flags&128)===0&&(typeof e.getDerivedStateFromError=="function"||s!==null&&typeof s.componentDidCatch=="function"&&(Hl===null||!Hl.has(s))))return t.flags|=65536,r&=-r,t.lanes|=r,r=mU(r),gU(r,n,t,i),Xb(t,r),!1}t=t.return}while(t!==null);return!1}var _U=Error(ce(461)),Bi=!1;function Gi(n,e,t,i){e.child=n===null?cU(e,null,t,i):yd(e,n.child,t,i)}function P1(n,e,t,i,r){t=t.render;var s=e.ref;if("ref"in i){var a={};for(var o in i)o!=="ref"&&(a[o]=i[o])}else a=i;return hc(e),i=HM(n,e,t,a,s,r),o=$M(),n!==null&&!Bi?(WM(n,e,r),Zo(n,e,r)):(en&&o&&IM(e),e.flags|=1,Gi(n,e,i,r),e.child)}function U1(n,e,t,i,r){if(n===null){var s=t.type;return typeof s=="function"&&!OM(s)&&s.defaultProps===void 0&&t.compare===null?(e.tag=15,e.type=s,yU(n,e,s,i,r)):(n=my(t.type,null,i,e,e.mode,r),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!ew(n,r)){var a=s.memoizedProps;if(t=t.compare,t=t!==null?t:fm,t(a,i)&&n.ref===e.ref)return Zo(n,e,r)}return e.flags|=1,n=Vo(s,i),n.ref=e.ref,n.return=e,e.child=n}function yU(n,e,t,i,r){if(n!==null){var s=n.memoizedProps;if(fm(s,i)&&n.ref===e.ref)if(Bi=!1,e.pendingProps=i=s,ew(n,r))n.flags&131072&&(Bi=!0);else return e.lanes=n.lanes,Zo(n,e,r)}return kT(n,e,t,i,r)}function vU(n,e,t){var i=e.pendingProps,r=i.children,s=n!==null?n.memoizedState:null;if(i.mode==="hidden"){if(e.flags&128){if(i=s!==null?s.baseLanes|t:t,n!==null){for(r=e.child=n.child,s=0;r!==null;)s=s|r.lanes|r.childLanes,r=r.sibling;e.childLanes=s&~i}else e.childLanes=0,e.child=null;return O1(n,e,i,t)}if(t&536870912)e.memoizedState={baseLanes:0,cachePool:null},n!==null&&gy(e,s!==null?s.cachePool:null),s!==null?x1(e,s):PT(),hU(e);else return e.lanes=e.childLanes=536870912,O1(n,e,s!==null?s.baseLanes|t:t,t)}else s!==null?(gy(e,s.cachePool),x1(e,s),Ll(),e.memoizedState=null):(n!==null&&gy(e,null),PT(),Ll());return Gi(n,e,r,t),e.child}function O1(n,e,t,i){var r=kM();return r=r===null?null:{parent:xi._currentValue,pool:r},e.memoizedState={baseLanes:t,cachePool:r},n!==null&&gy(e,null),PT(),hU(e),n!==null&&ug(n,e,i,!0),null}function vy(n,e){var t=e.ref;if(t===null)n!==null&&n.ref!==null&&(e.flags|=4194816);else{if(typeof t!="function"&&typeof t!="object")throw Error(ce(284));(n===null||n.ref!==t)&&(e.flags|=4194816)}}function kT(n,e,t,i,r){return hc(e),t=HM(n,e,t,i,void 0,r),i=$M(),n!==null&&!Bi?(WM(n,e,r),Zo(n,e,r)):(en&&i&&IM(e),e.flags|=1,Gi(n,e,t,r),e.child)}function I1(n,e,t,i,r,s){return hc(e),e.updateQueue=null,t=LP(e,i,t,r),DP(n),i=$M(),n!==null&&!Bi?(WM(n,e,s),Zo(n,e,s)):(en&&i&&IM(e),e.flags|=1,Gi(n,e,t,s),e.child)}function B1(n,e,t,i,r){if(hc(e),e.stateNode===null){var s=Lh,a=t.contextType;typeof a=="object"&&a!==null&&(s=tr(a)),s=new t(i,s),e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=BT,e.stateNode=s,s._reactInternals=e,s=e.stateNode,s.props=i,s.state=e.memoizedState,s.refs={},zM(e),a=t.contextType,s.context=typeof a=="object"&&a!==null?tr(a):Lh,s.state=e.memoizedState,a=t.getDerivedStateFromProps,typeof a=="function"&&(Kb(e,t,a,i),s.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(a=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),a!==s.state&&BT.enqueueReplaceState(s,s.state,null),Wp(e,i,s,r),$p(),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308),i=!0}else if(n===null){s=e.stateNode;var o=e.memoizedProps,l=fc(t,o);s.props=l;var u=s.context,c=t.contextType;a=Lh,typeof c=="object"&&c!==null&&(a=tr(c));var h=t.getDerivedStateFromProps;c=typeof h=="function"||typeof s.getSnapshotBeforeUpdate=="function",o=e.pendingProps!==o,c||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(o||u!==a)&&D1(e,s,i,a),wl=!1;var d=e.memoizedState;s.state=d,Wp(e,i,s,r),$p(),u=e.memoizedState,o||d!==u||wl?(typeof h=="function"&&(Kb(e,t,h,i),u=e.memoizedState),(l=wl||C1(e,t,l,i,d,u,a))?(c||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=u),s.props=i,s.state=u,s.context=a,i=l):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{s=e.stateNode,DT(n,e),a=e.memoizedProps,c=fc(t,a),s.props=c,h=e.pendingProps,d=s.context,u=t.contextType,l=Lh,typeof u=="object"&&u!==null&&(l=tr(u)),o=t.getDerivedStateFromProps,(u=typeof o=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==h||d!==l)&&D1(e,s,i,l),wl=!1,d=e.memoizedState,s.state=d,Wp(e,i,s,r),$p();var f=e.memoizedState;a!==h||d!==f||wl||n!==null&&n.dependencies!==null&&rv(n.dependencies)?(typeof o=="function"&&(Kb(e,t,o,i),f=e.memoizedState),(c=wl||C1(e,t,c,i,d,f,l)||n!==null&&n.dependencies!==null&&rv(n.dependencies))?(u||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(i,f,l),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(i,f,l)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=f),s.props=i,s.state=f,s.context=l,i=c):(typeof s.componentDidUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),i=!1)}return s=i,vy(n,e),i=(e.flags&128)!==0,s||i?(s=e.stateNode,t=i&&typeof t.getDerivedStateFromError!="function"?null:s.render(),e.flags|=1,n!==null&&i?(e.child=yd(e,n.child,null,r),e.child=yd(e,null,t,r)):Gi(n,e,t,r),e.memoizedState=s.state,n=e.child):n=Zo(n,e,r),n}function F1(n,e,t,i){return lg(),e.flags|=256,Gi(n,e,t,i),e.child}var Qb={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Zb(n){return{baseLanes:n,cachePool:wP()}}function Jb(n,e,t){return n=n!==null?n.childLanes&~t:0,e&&(n|=Bs),n}function bU(n,e,t){var i=e.pendingProps,r=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=n!==null&&n.memoizedState===null?!1:(Mi.current&2)!==0),a&&(r=!0,e.flags&=-129),a=(e.flags&32)!==0,e.flags&=-33,n===null){if(en){if(r?Dl(e):Ll(),en){var o=ti,l;if(l=o){e:{for(l=o,o=Ca;l.nodeType!==8;){if(!o){o=null;break e}if(l=ca(l.nextSibling),l===null){o=null;break e}}o=l}o!==null?(e.memoizedState={dehydrated:o,treeContext:ec!==null?{id:Uo,overflow:Oo}:null,retryLane:536870912,hydrationErrors:null},l=us(18,null,null,0),l.stateNode=o,l.return=e,e.child=l,pr=e,ti=null,l=!0):l=!1}l||cc(e)}if(o=e.memoizedState,o!==null&&(o=o.dehydrated,o!==null))return JT(o)?e.lanes=32:e.lanes=536870912,null;Bo(e)}return o=i.children,i=i.fallback,r?(Ll(),r=e.mode,o=dv({mode:"hidden",children:o},r),i=Ju(i,r,t,null),o.return=e,i.return=e,o.sibling=i,e.child=o,r=e.child,r.memoizedState=Zb(t),r.childLanes=Jb(n,a,t),e.memoizedState=Qb,i):(Dl(e),zT(e,o))}if(l=n.memoizedState,l!==null&&(o=l.dehydrated,o!==null)){if(s)e.flags&256?(Dl(e),e.flags&=-257,e=eS(n,e,t)):e.memoizedState!==null?(Ll(),e.child=n.child,e.flags|=128,e=null):(Ll(),r=i.fallback,o=e.mode,i=dv({mode:"visible",children:i.children},o),r=Ju(r,o,t,null),r.flags|=2,i.return=e,r.return=e,i.sibling=r,e.child=i,yd(e,n.child,null,t),i=e.child,i.memoizedState=Zb(t),i.childLanes=Jb(n,a,t),e.memoizedState=Qb,e=r);else if(Dl(e),JT(o)){if(a=o.nextSibling&&o.nextSibling.dataset,a)var u=a.dgst;a=u,i=Error(ce(419)),i.stack="",i.digest=a,pm({value:i,source:null,stack:null}),e=eS(n,e,t)}else if(Bi||ug(n,e,t,!1),a=(t&n.childLanes)!==0,Bi||a){if(a=Pn,a!==null&&(i=t&-t,i=i&42?1:EM(i),i=i&(a.suspendedLanes|t)?0:i,i!==0&&i!==l.retryLane))throw l.retryLane=i,gf(n,i),fs(a,n,i),_U;o.data==="$?"||jT(),e=eS(n,e,t)}else o.data==="$?"?(e.flags|=192,e.child=n.child,e=null):(n=l.treeContext,ti=ca(o.nextSibling),pr=e,en=!0,tc=null,Ca=!1,n!==null&&(Cs[Ds++]=Uo,Cs[Ds++]=Oo,Cs[Ds++]=ec,Uo=n.id,Oo=n.overflow,ec=e),e=zT(e,i.children),e.flags|=4096);return e}return r?(Ll(),r=i.fallback,o=e.mode,l=n.child,u=l.sibling,i=Vo(l,{mode:"hidden",children:i.children}),i.subtreeFlags=l.subtreeFlags&65011712,u!==null?r=Vo(u,r):(r=Ju(r,o,t,null),r.flags|=2),r.return=e,i.return=e,i.sibling=r,e.child=i,i=r,r=e.child,o=n.child.memoizedState,o===null?o=Zb(t):(l=o.cachePool,l!==null?(u=xi._currentValue,l=l.parent!==u?{parent:u,pool:u}:l):l=wP(),o={baseLanes:o.baseLanes|t,cachePool:l}),r.memoizedState=o,r.childLanes=Jb(n,a,t),e.memoizedState=Qb,i):(Dl(e),t=n.child,n=t.sibling,t=Vo(t,{mode:"visible",children:i.children}),t.return=e,t.sibling=null,n!==null&&(a=e.deletions,a===null?(e.deletions=[n],e.flags|=16):a.push(n)),e.child=t,e.memoizedState=null,t)}function zT(n,e){return e=dv({mode:"visible",children:e},n.mode),e.return=n,n.child=e}function dv(n,e){return n=us(22,n,null,e),n.lanes=0,n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},n}function eS(n,e,t){return yd(e,n.child,null,t),n=zT(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function k1(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),AT(n.return,e,t)}function tS(n,e,t,i,r){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=t,s.tailMode=r)}function SU(n,e,t){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Gi(n,e,i.children,t),i=Mi.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&k1(n,t,e);else if(n.tag===19)k1(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}switch(Hn(Mi,i),r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&uv(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),tS(e,!1,r,t,s);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&uv(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}tS(e,!0,t,null,s);break;case"together":tS(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Zo(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),nu|=e.lanes,!(t&e.childLanes))if(n!==null){if(ug(n,e,t,!1),(t&e.childLanes)===0)return null}else return null;if(n!==null&&e.child!==n.child)throw Error(ce(153));if(e.child!==null){for(n=e.child,t=Vo(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Vo(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function ew(n,e){return n.lanes&e?!0:(n=n.dependencies,!!(n!==null&&rv(n)))}function s4(n,e,t){switch(e.tag){case 3:Ky(e,e.stateNode.containerInfo),Cl(e,xi,n.memoizedState.cache),lg();break;case 27:case 5:mT(e);break;case 4:Ky(e,e.stateNode.containerInfo);break;case 10:Cl(e,e.type,e.memoizedProps.value);break;case 13:var i=e.memoizedState;if(i!==null)return i.dehydrated!==null?(Dl(e),e.flags|=128,null):t&e.child.childLanes?bU(n,e,t):(Dl(e),n=Zo(n,e,t),n!==null?n.sibling:null);Dl(e);break;case 19:var r=(n.flags&128)!==0;if(i=(t&e.childLanes)!==0,i||(ug(n,e,t,!1),i=(t&e.childLanes)!==0),r){if(i)return SU(n,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Hn(Mi,Mi.current),i)break;return null;case 22:case 23:return e.lanes=0,vU(n,e,t);case 24:Cl(e,xi,n.memoizedState.cache)}return Zo(n,e,t)}function xU(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps)Bi=!0;else{if(!ew(n,t)&&!(e.flags&128))return Bi=!1,s4(n,e,t);Bi=!!(n.flags&131072)}else Bi=!1,en&&e.flags&1048576&&EP(e,iv,e.index);switch(e.lanes=0,e.tag){case 16:e:{n=e.pendingProps;var i=e.elementType,r=i._init;if(i=r(i._payload),e.type=i,typeof i=="function")OM(i)?(n=fc(i,n),e.tag=1,e=B1(null,e,i,n,t)):(e.tag=0,e=kT(null,e,i,n,t));else{if(i!=null){if(r=i.$$typeof,r===SM){e.tag=11,e=P1(null,e,i,n,t);break e}else if(r===xM){e.tag=14,e=U1(null,e,i,n,t);break e}}throw e=fT(i)||i,Error(ce(306,e,""))}}return e;case 0:return kT(n,e,e.type,e.pendingProps,t);case 1:return i=e.type,r=fc(i,e.pendingProps),B1(n,e,i,r,t);case 3:e:{if(Ky(e,e.stateNode.containerInfo),n===null)throw Error(ce(387));i=e.pendingProps;var s=e.memoizedState;r=s.element,DT(n,e),Wp(e,i,null,t);var a=e.memoizedState;if(i=a.cache,Cl(e,xi,i),i!==s.cache&&RT(e,[xi],t,!0),$p(),i=a.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:a.cache},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){e=F1(n,e,i,t);break e}else if(i!==r){r=Is(Error(ce(424)),e),pm(r),e=F1(n,e,i,t);break e}else{switch(n=e.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(ti=ca(n.firstChild),pr=e,en=!0,tc=null,Ca=!0,t=cU(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling}else{if(lg(),i===r){e=Zo(n,e,t);break e}Gi(n,e,i,t)}e=e.child}return e;case 26:return vy(n,e),n===null?(t=nN(e.type,null,e.pendingProps,null))?e.memoizedState=t:en||(t=e.type,n=e.pendingProps,i=vv(zl.current).createElement(t),i[er]=e,i[Gr]=n,$i(i,t,n),Ui(i),e.stateNode=i):e.memoizedState=nN(e.type,n.memoizedProps,e.pendingProps,n.memoizedState),null;case 27:return mT(e),n===null&&en&&(i=e.stateNode=lO(e.type,e.pendingProps,zl.current),pr=e,Ca=!0,r=ti,fu(e.type)?(eE=r,ti=ca(i.firstChild)):ti=r),Gi(n,e,e.pendingProps.children,t),vy(n,e),n===null&&(e.flags|=4194304),e.child;case 5:return n===null&&en&&((r=i=ti)&&(i=P4(i,e.type,e.pendingProps,Ca),i!==null?(e.stateNode=i,pr=e,ti=ca(i.firstChild),Ca=!1,r=!0):r=!1),r||cc(e)),mT(e),r=e.type,s=e.pendingProps,a=n!==null?n.memoizedProps:null,i=s.children,QT(r,s)?i=null:a!==null&&QT(r,a)&&(e.flags|=32),e.memoizedState!==null&&(r=HM(n,e,QV,null,null,t),bm._currentValue=r),vy(n,e),Gi(n,e,i,t),e.child;case 6:return n===null&&en&&((n=t=ti)&&(t=U4(t,e.pendingProps,Ca),t!==null?(e.stateNode=t,pr=e,ti=null,n=!0):n=!1),n||cc(e)),null;case 13:return bU(n,e,t);case 4:return Ky(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=yd(e,null,i,t):Gi(n,e,i,t),e.child;case 11:return P1(n,e,e.type,e.pendingProps,t);case 7:return Gi(n,e,e.pendingProps,t),e.child;case 8:return Gi(n,e,e.pendingProps.children,t),e.child;case 12:return Gi(n,e,e.pendingProps.children,t),e.child;case 10:return i=e.pendingProps,Cl(e,e.type,i.value),Gi(n,e,i.children,t),e.child;case 9:return r=e.type._context,i=e.pendingProps.children,hc(e),r=tr(r),i=i(r),e.flags|=1,Gi(n,e,i,t),e.child;case 14:return U1(n,e,e.type,e.pendingProps,t);case 15:return yU(n,e,e.type,e.pendingProps,t);case 19:return SU(n,e,t);case 31:return i=e.pendingProps,t=e.mode,i={mode:i.mode,children:i.children},n===null?(t=dv(i,t),t.ref=e.ref,e.child=t,t.return=e,e=t):(t=Vo(n.child,i),t.ref=e.ref,e.child=t,t.return=e,e=t),e;case 22:return vU(n,e,t);case 24:return hc(e),i=tr(xi),n===null?(r=kM(),r===null&&(r=Pn,s=FM(),r.pooledCache=s,s.refCount++,s!==null&&(r.pooledCacheLanes|=t),r=s),e.memoizedState={parent:i,cache:r},zM(e),Cl(e,xi,r)):(n.lanes&t&&(DT(n,e),Wp(e,null,null,t),$p()),r=n.memoizedState,s=e.memoizedState,r.parent!==i?(r={parent:i,cache:i},e.memoizedState=r,e.lanes===0&&(e.memoizedState=e.updateQueue.baseState=r),Cl(e,xi,i)):(i=s.cache,Cl(e,xi,i),i!==r.cache&&RT(e,[xi],t,!0))),Gi(n,e,e.pendingProps.children,t),e.child;case 29:throw e.pendingProps}throw Error(ce(156,e.tag))}function lo(n){n.flags|=4}function z1(n,e){if(e.type!=="stylesheet"||e.state.loading&4)n.flags&=-16777217;else if(n.flags|=16777216,!hO(e)){if(e=Vs.current,e!==null&&((Wt&4194048)===Wt?$a!==null:(Wt&62914560)!==Wt&&!(Wt&536870912)||e!==$a))throw Vp=CT,AP;n.flags|=8192}}function n_(n,e){e!==null&&(n.flags|=4),n.flags&16384&&(e=n.tag!==22?XL():536870912,n.lanes|=e,vd|=e)}function Gf(n,e){if(!en)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function Xn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags&65011712,i|=r.flags&65011712,r.return=n,r=r.sibling;else for(r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=n,r=r.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function a4(n,e,t){var i=e.pendingProps;switch(BM(e),e.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xn(e),null;case 1:return Xn(e),null;case 3:return t=e.stateNode,i=null,n!==null&&(i=n.memoizedState.cache),e.memoizedState.cache!==i&&(e.flags|=2048),Ho(xi),dd(),t.pendingContext&&(t.context=t.pendingContext,t.pendingContext=null),(n===null||n.child===null)&&(kf(e)?lo(e):n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,g1())),Xn(e),null;case 26:return t=e.memoizedState,n===null?(lo(e),t!==null?(Xn(e),z1(e,t)):(Xn(e),e.flags&=-16777217)):t?t!==n.memoizedState?(lo(e),Xn(e),z1(e,t)):(Xn(e),e.flags&=-16777217):(n.memoizedProps!==i&&lo(e),Xn(e),e.flags&=-16777217),null;case 27:Qy(e),t=zl.current;var r=e.type;if(n!==null&&e.stateNode!=null)n.memoizedProps!==i&&lo(e);else{if(!i){if(e.stateNode===null)throw Error(ce(166));return Xn(e),null}n=Va.current,kf(e)?p1(e):(n=lO(r,i,t),e.stateNode=n,lo(e))}return Xn(e),null;case 5:if(Qy(e),t=e.type,n!==null&&e.stateNode!=null)n.memoizedProps!==i&&lo(e);else{if(!i){if(e.stateNode===null)throw Error(ce(166));return Xn(e),null}if(n=Va.current,kf(e))p1(e);else{switch(r=vv(zl.current),n){case 1:n=r.createElementNS("http://www.w3.org/2000/svg",t);break;case 2:n=r.createElementNS("http://www.w3.org/1998/Math/MathML",t);break;default:switch(t){case"svg":n=r.createElementNS("http://www.w3.org/2000/svg",t);break;case"math":n=r.createElementNS("http://www.w3.org/1998/Math/MathML",t);break;case"script":n=r.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild);break;case"select":n=typeof i.is=="string"?r.createElement("select",{is:i.is}):r.createElement("select"),i.multiple?n.multiple=!0:i.size&&(n.size=i.size);break;default:n=typeof i.is=="string"?r.createElement(t,{is:i.is}):r.createElement(t)}}n[er]=e,n[Gr]=i;e:for(r=e.child;r!==null;){if(r.tag===5||r.tag===6)n.appendChild(r.stateNode);else if(r.tag!==4&&r.tag!==27&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}e.stateNode=n;e:switch($i(n,t,i),t){case"button":case"input":case"select":case"textarea":n=!!i.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&lo(e)}}return Xn(e),e.flags&=-16777217,null;case 6:if(n&&e.stateNode!=null)n.memoizedProps!==i&&lo(e);else{if(typeof i!="string"&&e.stateNode===null)throw Error(ce(166));if(n=zl.current,kf(e)){if(n=e.stateNode,t=e.memoizedProps,i=null,r=pr,r!==null)switch(r.tag){case 27:case 5:i=r.memoizedProps}n[er]=e,n=!!(n.nodeValue===t||i!==null&&i.suppressHydrationWarning===!0||sO(n.nodeValue,t)),n||cc(e)}else n=vv(n).createTextNode(i),n[er]=e,e.stateNode=n}return Xn(e),null;case 13:if(i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(r=kf(e),i!==null&&i.dehydrated!==null){if(n===null){if(!r)throw Error(ce(318));if(r=e.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(ce(317));r[er]=e}else lg(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Xn(e),r=!1}else r=g1(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=r),r=!0;if(!r)return e.flags&256?(Bo(e),e):(Bo(e),null)}if(Bo(e),e.flags&128)return e.lanes=t,e;if(t=i!==null,n=n!==null&&n.memoizedState!==null,t){i=e.child,r=null,i.alternate!==null&&i.alternate.memoizedState!==null&&i.alternate.memoizedState.cachePool!==null&&(r=i.alternate.memoizedState.cachePool.pool);var s=null;i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(s=i.memoizedState.cachePool.pool),s!==r&&(i.flags|=2048)}return t!==n&&t&&(e.child.flags|=8192),n_(e,e.updateQueue),Xn(e),null;case 4:return dd(),n===null&&lw(e.stateNode.containerInfo),Xn(e),null;case 10:return Ho(e.type),Xn(e),null;case 19:if(ki(Mi),r=e.memoizedState,r===null)return Xn(e),null;if(i=(e.flags&128)!==0,s=r.rendering,s===null)if(i)Gf(r,!1);else{if(ni!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(s=uv(n),s!==null){for(e.flags|=128,Gf(r,!1),n=s.updateQueue,e.updateQueue=n,n_(e,n),e.subtreeFlags=0,n=t,t=e.child;t!==null;)TP(t,n),t=t.sibling;return Hn(Mi,Mi.current&1|2),e.child}n=n.sibling}r.tail!==null&&Ha()>pv&&(e.flags|=128,i=!0,Gf(r,!1),e.lanes=4194304)}else{if(!i)if(n=uv(s),n!==null){if(e.flags|=128,i=!0,n=n.updateQueue,e.updateQueue=n,n_(e,n),Gf(r,!0),r.tail===null&&r.tailMode==="hidden"&&!s.alternate&&!en)return Xn(e),null}else 2*Ha()-r.renderingStartTime>pv&&t!==536870912&&(e.flags|=128,i=!0,Gf(r,!1),e.lanes=4194304);r.isBackwards?(s.sibling=e.child,e.child=s):(n=r.last,n!==null?n.sibling=s:e.child=s,r.last=s)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=Ha(),e.sibling=null,n=Mi.current,Hn(Mi,i?n&1|2:n&1),e):(Xn(e),null);case 22:case 23:return Bo(e),GM(),i=e.memoizedState!==null,n!==null?n.memoizedState!==null!==i&&(e.flags|=8192):i&&(e.flags|=8192),i?t&536870912&&!(e.flags&128)&&(Xn(e),e.subtreeFlags&6&&(e.flags|=8192)):Xn(e),t=e.updateQueue,t!==null&&n_(e,t.retryQueue),t=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(t=n.memoizedState.cachePool.pool),i=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),i!==t&&(e.flags|=2048),n!==null&&ki(nc),null;case 24:return t=null,n!==null&&(t=n.memoizedState.cache),e.memoizedState.cache!==t&&(e.flags|=2048),Ho(xi),Xn(e),null;case 25:return null;case 30:return null}throw Error(ce(156,e.tag))}function o4(n,e){switch(BM(e),e.tag){case 1:return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Ho(xi),dd(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 26:case 27:case 5:return Qy(e),null;case 13:if(Bo(e),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(ce(340));lg()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return ki(Mi),null;case 4:return dd(),null;case 10:return Ho(e.type),null;case 22:case 23:return Bo(e),GM(),n!==null&&ki(nc),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 24:return Ho(xi),null;case 25:return null;default:return null}}function TU(n,e){switch(BM(e),e.tag){case 3:Ho(xi),dd();break;case 26:case 27:case 5:Qy(e);break;case 4:dd();break;case 13:Bo(e);break;case 19:ki(Mi);break;case 10:Ho(e.type);break;case 22:case 23:Bo(e),GM(),n!==null&&ki(nc);break;case 24:Ho(xi)}}function pg(n,e){try{var t=e.updateQueue,i=t!==null?t.lastEffect:null;if(i!==null){var r=i.next;t=r;do{if((t.tag&n)===n){i=void 0;var s=t.create,a=t.inst;i=s(),a.destroy=i}t=t.next}while(t!==r)}}catch(o){An(e,e.return,o)}}function tu(n,e,t){try{var i=e.updateQueue,r=i!==null?i.lastEffect:null;if(r!==null){var s=r.next;i=s;do{if((i.tag&n)===n){var a=i.inst,o=a.destroy;if(o!==void 0){a.destroy=void 0,r=e;var l=t,u=o;try{u()}catch(c){An(r,l,c)}}}i=i.next}while(i!==s)}}catch(c){An(e,e.return,c)}}function EU(n){var e=n.updateQueue;if(e!==null){var t=n.stateNode;try{CP(e,t)}catch(i){An(n,n.return,i)}}}function MU(n,e,t){t.props=fc(n.type,n.memoizedProps),t.state=n.memoizedState;try{t.componentWillUnmount()}catch(i){An(n,e,i)}}function qp(n,e){try{var t=n.ref;if(t!==null){switch(n.tag){case 26:case 27:case 5:var i=n.stateNode;break;case 30:i=n.stateNode;break;default:i=n.stateNode}typeof t=="function"?n.refCleanup=t(i):t.current=i}}catch(r){An(n,e,r)}}function Oa(n,e){var t=n.ref,i=n.refCleanup;if(t!==null)if(typeof i=="function")try{i()}catch(r){An(n,e,r)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof t=="function")try{t(null)}catch(r){An(n,e,r)}else t.current=null}function wU(n){var e=n.type,t=n.memoizedProps,i=n.stateNode;try{e:switch(e){case"button":case"input":case"select":case"textarea":t.autoFocus&&i.focus();break e;case"img":t.src?i.src=t.src:t.srcSet&&(i.srcset=t.srcSet)}}catch(r){An(n,n.return,r)}}function nS(n,e,t){try{var i=n.stateNode;R4(i,n.type,t,e),i[Gr]=e}catch(r){An(n,n.return,r)}}function AU(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&fu(n.type)||n.tag===4}function iS(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||AU(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&fu(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function GT(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t).insertBefore(n,e):(e=t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,e.appendChild(n),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=V0));else if(i!==4&&(i===27&&fu(n.type)&&(t=n.stateNode,e=null),n=n.child,n!==null))for(GT(n,e,t),n=n.sibling;n!==null;)GT(n,e,t),n=n.sibling}function fv(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(i===27&&fu(n.type)&&(t=n.stateNode),n=n.child,n!==null))for(fv(n,e,t),n=n.sibling;n!==null;)fv(n,e,t),n=n.sibling}function RU(n){var e=n.stateNode,t=n.memoizedProps;try{for(var i=n.type,r=e.attributes;r.length;)e.removeAttributeNode(r[0]);$i(e,i,t),e[er]=n,e[Gr]=t}catch(s){An(n,n.return,s)}}var wo=!1,oi=!1,rS=!1,G1=typeof WeakSet=="function"?WeakSet:Set,Pi=null;function l4(n,e){if(n=n.containerInfo,YT=Tv,n=mP(n),LM(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,u=0,c=0,h=n,d=null;t:for(;;){for(var f;h!==t||r!==0&&h.nodeType!==3||(o=a+r),h!==s||i!==0&&h.nodeType!==3||(l=a+i),h.nodeType===3&&(a+=h.nodeValue.length),(f=h.firstChild)!==null;)d=h,h=f;for(;;){if(h===n)break t;if(d===t&&++u===r&&(o=a),d===s&&++c===i&&(l=a),(f=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=f}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(KT={focusedElem:n,selectionRange:t},Tv=!1,Pi=e;Pi!==null;)if(e=Pi,n=e.child,(e.subtreeFlags&1024)!==0&&n!==null)n.return=e,Pi=n;else for(;Pi!==null;){switch(e=Pi,s=e.alternate,n=e.flags,e.tag){case 0:break;case 11:case 15:break;case 1:if(n&1024&&s!==null){n=void 0,t=e,r=s.memoizedProps,s=s.memoizedState,i=t.stateNode;try{var m=fc(t.type,r,t.elementType===t.type);n=i.getSnapshotBeforeUpdate(m,s),i.__reactInternalSnapshotBeforeUpdate=n}catch(_){An(t,t.return,_)}}break;case 3:if(n&1024){if(n=e.stateNode.containerInfo,t=n.nodeType,t===9)ZT(n);else if(t===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":ZT(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(n&1024)throw Error(ce(163))}if(n=e.sibling,n!==null){n.return=e.return,Pi=n;break}Pi=e.return}}function NU(n,e,t){var i=t.flags;switch(t.tag){case 0:case 11:case 15:dl(n,t),i&4&&pg(5,t);break;case 1:if(dl(n,t),i&4)if(n=t.stateNode,e===null)try{n.componentDidMount()}catch(a){An(t,t.return,a)}else{var r=fc(t.type,e.memoizedProps);e=e.memoizedState;try{n.componentDidUpdate(r,e,n.__reactInternalSnapshotBeforeUpdate)}catch(a){An(t,t.return,a)}}i&64&&EU(t),i&512&&qp(t,t.return);break;case 3:if(dl(n,t),i&64&&(n=t.updateQueue,n!==null)){if(e=null,t.child!==null)switch(t.child.tag){case 27:case 5:e=t.child.stateNode;break;case 1:e=t.child.stateNode}try{CP(n,e)}catch(a){An(t,t.return,a)}}break;case 27:e===null&&i&4&&RU(t);case 26:case 5:dl(n,t),e===null&&i&4&&wU(t),i&512&&qp(t,t.return);break;case 12:dl(n,t);break;case 13:dl(n,t),i&4&&LU(n,t),i&64&&(n=t.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(t=_4.bind(null,t),O4(n,t))));break;case 22:if(i=t.memoizedState!==null||wo,!i){e=e!==null&&e.memoizedState!==null||oi,r=wo;var s=oi;wo=i,(oi=e)&&!s?Tl(n,t,(t.subtreeFlags&8772)!==0):dl(n,t),wo=r,oi=s}break;case 30:break;default:dl(n,t)}}function CU(n){var e=n.alternate;e!==null&&(n.alternate=null,CU(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&wM(e)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var zn=null,Cr=!1;function uo(n,e,t){for(t=t.child;t!==null;)DU(n,e,t),t=t.sibling}function DU(n,e,t){if(cs&&typeof cs.onCommitFiberUnmount=="function")try{cs.onCommitFiberUnmount(ig,t)}catch{}switch(t.tag){case 26:oi||Oa(t,e),uo(n,e,t),t.memoizedState?t.memoizedState.count--:t.stateNode&&(t=t.stateNode,t.parentNode.removeChild(t));break;case 27:oi||Oa(t,e);var i=zn,r=Cr;fu(t.type)&&(zn=t.stateNode,Cr=!1),uo(n,e,t),Qp(t.stateNode),zn=i,Cr=r;break;case 5:oi||Oa(t,e);case 6:if(i=zn,r=Cr,zn=null,uo(n,e,t),zn=i,Cr=r,zn!==null)if(Cr)try{(zn.nodeType===9?zn.body:zn.nodeName==="HTML"?zn.ownerDocument.body:zn).removeChild(t.stateNode)}catch(s){An(t,e,s)}else try{zn.removeChild(t.stateNode)}catch(s){An(t,e,s)}break;case 18:zn!==null&&(Cr?(n=zn,J1(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,t.stateNode),Tm(n)):J1(zn,t.stateNode));break;case 4:i=zn,r=Cr,zn=t.stateNode.containerInfo,Cr=!0,uo(n,e,t),zn=i,Cr=r;break;case 0:case 11:case 14:case 15:oi||tu(2,t,e),oi||tu(4,t,e),uo(n,e,t);break;case 1:oi||(Oa(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"&&MU(t,e,i)),uo(n,e,t);break;case 21:uo(n,e,t);break;case 22:oi=(i=oi)||t.memoizedState!==null,uo(n,e,t),oi=i;break;default:uo(n,e,t)}}function LU(n,e){if(e.memoizedState===null&&(n=e.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{Tm(n)}catch(t){An(e,e.return,t)}}function u4(n){switch(n.tag){case 13:case 19:var e=n.stateNode;return e===null&&(e=n.stateNode=new G1),e;case 22:return n=n.stateNode,e=n._retryCache,e===null&&(e=n._retryCache=new G1),e;default:throw Error(ce(435,n.tag))}}function sS(n,e){var t=u4(n);e.forEach(function(i){var r=y4.bind(null,n,i);t.has(i)||(t.add(i),i.then(r,r))})}function Qr(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var r=t[i],s=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 27:if(fu(o.type)){zn=o.stateNode,Cr=!1;break e}break;case 5:zn=o.stateNode,Cr=!1;break e;case 3:case 4:zn=o.stateNode.containerInfo,Cr=!0;break e}o=o.return}if(zn===null)throw Error(ce(160));DU(s,a,r),zn=null,Cr=!1,s=r.alternate,s!==null&&(s.return=null),r.return=null}if(e.subtreeFlags&13878)for(e=e.child;e!==null;)PU(e,n),e=e.sibling}var ea=null;function PU(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:Qr(e,n),Zr(n),i&4&&(tu(3,n,n.return),pg(3,n),tu(5,n,n.return));break;case 1:Qr(e,n),Zr(n),i&512&&(oi||t===null||Oa(t,t.return)),i&64&&wo&&(n=n.updateQueue,n!==null&&(i=n.callbacks,i!==null&&(t=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=t===null?i:t.concat(i))));break;case 26:var r=ea;if(Qr(e,n),Zr(n),i&512&&(oi||t===null||Oa(t,t.return)),i&4){var s=t!==null?t.memoizedState:null;if(i=n.memoizedState,t===null)if(i===null)if(n.stateNode===null){e:{i=n.type,t=n.memoizedProps,r=r.ownerDocument||r;t:switch(i){case"title":s=r.getElementsByTagName("title")[0],(!s||s[ag]||s[er]||s.namespaceURI==="http://www.w3.org/2000/svg"||s.hasAttribute("itemprop"))&&(s=r.createElement(i),r.head.insertBefore(s,r.querySelector("head > title"))),$i(s,i,t),s[er]=n,Ui(s),i=s;break e;case"link":var a=rN("link","href",r).get(i+(t.href||""));if(a){for(var o=0;o<a.length;o++)if(s=a[o],s.getAttribute("href")===(t.href==null||t.href===""?null:t.href)&&s.getAttribute("rel")===(t.rel==null?null:t.rel)&&s.getAttribute("title")===(t.title==null?null:t.title)&&s.getAttribute("crossorigin")===(t.crossOrigin==null?null:t.crossOrigin)){a.splice(o,1);break t}}s=r.createElement(i),$i(s,i,t),r.head.appendChild(s);break;case"meta":if(a=rN("meta","content",r).get(i+(t.content||""))){for(o=0;o<a.length;o++)if(s=a[o],s.getAttribute("content")===(t.content==null?null:""+t.content)&&s.getAttribute("name")===(t.name==null?null:t.name)&&s.getAttribute("property")===(t.property==null?null:t.property)&&s.getAttribute("http-equiv")===(t.httpEquiv==null?null:t.httpEquiv)&&s.getAttribute("charset")===(t.charSet==null?null:t.charSet)){a.splice(o,1);break t}}s=r.createElement(i),$i(s,i,t),r.head.appendChild(s);break;default:throw Error(ce(468,i))}s[er]=n,Ui(s),i=s}n.stateNode=i}else sN(r,n.type,n.stateNode);else n.stateNode=iN(r,i,n.memoizedProps);else s!==i?(s===null?t.stateNode!==null&&(t=t.stateNode,t.parentNode.removeChild(t)):s.count--,i===null?sN(r,n.type,n.stateNode):iN(r,i,n.memoizedProps)):i===null&&n.stateNode!==null&&nS(n,n.memoizedProps,t.memoizedProps)}break;case 27:Qr(e,n),Zr(n),i&512&&(oi||t===null||Oa(t,t.return)),t!==null&&i&4&&nS(n,n.memoizedProps,t.memoizedProps);break;case 5:if(Qr(e,n),Zr(n),i&512&&(oi||t===null||Oa(t,t.return)),n.flags&32){r=n.stateNode;try{pd(r,"")}catch(f){An(n,n.return,f)}}i&4&&n.stateNode!=null&&(r=n.memoizedProps,nS(n,r,t!==null?t.memoizedProps:r)),i&1024&&(rS=!0);break;case 6:if(Qr(e,n),Zr(n),i&4){if(n.stateNode===null)throw Error(ce(162));i=n.memoizedProps,t=n.stateNode;try{t.nodeValue=i}catch(f){An(n,n.return,f)}}break;case 3:if(xy=null,r=ea,ea=bv(e.containerInfo),Qr(e,n),ea=r,Zr(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{Tm(e.containerInfo)}catch(f){An(n,n.return,f)}rS&&(rS=!1,UU(n));break;case 4:i=ea,ea=bv(n.stateNode.containerInfo),Qr(e,n),Zr(n),ea=i;break;case 12:Qr(e,n),Zr(n);break;case 13:Qr(e,n),Zr(n),n.child.flags&8192&&n.memoizedState!==null!=(t!==null&&t.memoizedState!==null)&&(sw=Ha()),i&4&&(i=n.updateQueue,i!==null&&(n.updateQueue=null,sS(n,i)));break;case 22:r=n.memoizedState!==null;var l=t!==null&&t.memoizedState!==null,u=wo,c=oi;if(wo=u||r,oi=c||l,Qr(e,n),oi=c,wo=u,Zr(n),i&8192)e:for(e=n.stateNode,e._visibility=r?e._visibility&-2:e._visibility|1,r&&(t===null||l||wo||oi||ku(n)),t=null,e=n;;){if(e.tag===5||e.tag===26){if(t===null){l=t=e;try{if(s=l.stateNode,r)a=s.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none";else{o=l.stateNode;var h=l.memoizedProps.style,d=h!=null&&h.hasOwnProperty("display")?h.display:null;o.style.display=d==null||typeof d=="boolean"?"":(""+d).trim()}}catch(f){An(l,l.return,f)}}}else if(e.tag===6){if(t===null){l=e;try{l.stateNode.nodeValue=r?"":l.memoizedProps}catch(f){An(l,l.return,f)}}}else if((e.tag!==22&&e.tag!==23||e.memoizedState===null||e===n)&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;t===e&&(t=null),e=e.return}t===e&&(t=null),e.sibling.return=e.return,e=e.sibling}i&4&&(i=n.updateQueue,i!==null&&(t=i.retryQueue,t!==null&&(i.retryQueue=null,sS(n,t))));break;case 19:Qr(e,n),Zr(n),i&4&&(i=n.updateQueue,i!==null&&(n.updateQueue=null,sS(n,i)));break;case 30:break;case 21:break;default:Qr(e,n),Zr(n)}}function Zr(n){var e=n.flags;if(e&2){try{for(var t,i=n.return;i!==null;){if(AU(i)){t=i;break}i=i.return}if(t==null)throw Error(ce(160));switch(t.tag){case 27:var r=t.stateNode,s=iS(n);fv(n,s,r);break;case 5:var a=t.stateNode;t.flags&32&&(pd(a,""),t.flags&=-33);var o=iS(n);fv(n,o,a);break;case 3:case 4:var l=t.stateNode.containerInfo,u=iS(n);GT(n,u,l);break;default:throw Error(ce(161))}}catch(c){An(n,n.return,c)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function UU(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var e=n;UU(e),e.tag===5&&e.flags&1024&&e.stateNode.reset(),n=n.sibling}}function dl(n,e){if(e.subtreeFlags&8772)for(e=e.child;e!==null;)NU(n,e.alternate,e),e=e.sibling}function ku(n){for(n=n.child;n!==null;){var e=n;switch(e.tag){case 0:case 11:case 14:case 15:tu(4,e,e.return),ku(e);break;case 1:Oa(e,e.return);var t=e.stateNode;typeof t.componentWillUnmount=="function"&&MU(e,e.return,t),ku(e);break;case 27:Qp(e.stateNode);case 26:case 5:Oa(e,e.return),ku(e);break;case 22:e.memoizedState===null&&ku(e);break;case 30:ku(e);break;default:ku(e)}n=n.sibling}}function Tl(n,e,t){for(t=t&&(e.subtreeFlags&8772)!==0,e=e.child;e!==null;){var i=e.alternate,r=n,s=e,a=s.flags;switch(s.tag){case 0:case 11:case 15:Tl(r,s,t),pg(4,s);break;case 1:if(Tl(r,s,t),i=s,r=i.stateNode,typeof r.componentDidMount=="function")try{r.componentDidMount()}catch(u){An(i,i.return,u)}if(i=s,r=i.updateQueue,r!==null){var o=i.stateNode;try{var l=r.shared.hiddenCallbacks;if(l!==null)for(r.shared.hiddenCallbacks=null,r=0;r<l.length;r++)NP(l[r],o)}catch(u){An(i,i.return,u)}}t&&a&64&&EU(s),qp(s,s.return);break;case 27:RU(s);case 26:case 5:Tl(r,s,t),t&&i===null&&a&4&&wU(s),qp(s,s.return);break;case 12:Tl(r,s,t);break;case 13:Tl(r,s,t),t&&a&4&&LU(r,s);break;case 22:s.memoizedState===null&&Tl(r,s,t),qp(s,s.return);break;case 30:break;default:Tl(r,s,t)}e=e.sibling}}function tw(n,e){var t=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(t=n.memoizedState.cachePool.pool),n=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(n=e.memoizedState.cachePool.pool),n!==t&&(n!=null&&n.refCount++,t!=null&&cg(t))}function nw(n,e){n=null,e.alternate!==null&&(n=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==n&&(e.refCount++,n!=null&&cg(n))}function _a(n,e,t,i){if(e.subtreeFlags&10256)for(e=e.child;e!==null;)OU(n,e,t,i),e=e.sibling}function OU(n,e,t,i){var r=e.flags;switch(e.tag){case 0:case 11:case 15:_a(n,e,t,i),r&2048&&pg(9,e);break;case 1:_a(n,e,t,i);break;case 3:_a(n,e,t,i),r&2048&&(n=null,e.alternate!==null&&(n=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==n&&(e.refCount++,n!=null&&cg(n)));break;case 12:if(r&2048){_a(n,e,t,i),n=e.stateNode;try{var s=e.memoizedProps,a=s.id,o=s.onPostCommit;typeof o=="function"&&o(a,e.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(l){An(e,e.return,l)}}else _a(n,e,t,i);break;case 13:_a(n,e,t,i);break;case 23:break;case 22:s=e.stateNode,a=e.alternate,e.memoizedState!==null?s._visibility&2?_a(n,e,t,i):Xp(n,e):s._visibility&2?_a(n,e,t,i):(s._visibility|=2,dh(n,e,t,i,(e.subtreeFlags&10256)!==0)),r&2048&&tw(a,e);break;case 24:_a(n,e,t,i),r&2048&&nw(e.alternate,e);break;default:_a(n,e,t,i)}}function dh(n,e,t,i,r){for(r=r&&(e.subtreeFlags&10256)!==0,e=e.child;e!==null;){var s=n,a=e,o=t,l=i,u=a.flags;switch(a.tag){case 0:case 11:case 15:dh(s,a,o,l,r),pg(8,a);break;case 23:break;case 22:var c=a.stateNode;a.memoizedState!==null?c._visibility&2?dh(s,a,o,l,r):Xp(s,a):(c._visibility|=2,dh(s,a,o,l,r)),r&&u&2048&&tw(a.alternate,a);break;case 24:dh(s,a,o,l,r),r&&u&2048&&nw(a.alternate,a);break;default:dh(s,a,o,l,r)}e=e.sibling}}function Xp(n,e){if(e.subtreeFlags&10256)for(e=e.child;e!==null;){var t=n,i=e,r=i.flags;switch(i.tag){case 22:Xp(t,i),r&2048&&tw(i.alternate,i);break;case 24:Xp(t,i),r&2048&&nw(i.alternate,i);break;default:Xp(t,i)}e=e.sibling}}var bp=8192;function Ic(n){if(n.subtreeFlags&bp)for(n=n.child;n!==null;)IU(n),n=n.sibling}function IU(n){switch(n.tag){case 26:Ic(n),n.flags&bp&&n.memoizedState!==null&&X4(ea,n.memoizedState,n.memoizedProps);break;case 5:Ic(n);break;case 3:case 4:var e=ea;ea=bv(n.stateNode.containerInfo),Ic(n),ea=e;break;case 22:n.memoizedState===null&&(e=n.alternate,e!==null&&e.memoizedState!==null?(e=bp,bp=16777216,Ic(n),bp=e):Ic(n));break;default:Ic(n)}}function BU(n){var e=n.alternate;if(e!==null&&(n=e.child,n!==null)){e.child=null;do e=n.sibling,n.sibling=null,n=e;while(n!==null)}}function Vf(n){var e=n.deletions;if(n.flags&16){if(e!==null)for(var t=0;t<e.length;t++){var i=e[t];Pi=i,kU(i,n)}BU(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)FU(n),n=n.sibling}function FU(n){switch(n.tag){case 0:case 11:case 15:Vf(n),n.flags&2048&&tu(9,n,n.return);break;case 3:Vf(n);break;case 12:Vf(n);break;case 22:var e=n.stateNode;n.memoizedState!==null&&e._visibility&2&&(n.return===null||n.return.tag!==13)?(e._visibility&=-3,by(n)):Vf(n);break;default:Vf(n)}}function by(n){var e=n.deletions;if(n.flags&16){if(e!==null)for(var t=0;t<e.length;t++){var i=e[t];Pi=i,kU(i,n)}BU(n)}for(n=n.child;n!==null;){switch(e=n,e.tag){case 0:case 11:case 15:tu(8,e,e.return),by(e);break;case 22:t=e.stateNode,t._visibility&2&&(t._visibility&=-3,by(e));break;default:by(e)}n=n.sibling}}function kU(n,e){for(;Pi!==null;){var t=Pi;switch(t.tag){case 0:case 11:case 15:tu(8,t,e);break;case 23:case 22:if(t.memoizedState!==null&&t.memoizedState.cachePool!==null){var i=t.memoizedState.cachePool.pool;i!=null&&i.refCount++}break;case 24:cg(t.memoizedState.cache)}if(i=t.child,i!==null)i.return=t,Pi=i;else e:for(t=n;Pi!==null;){i=Pi;var r=i.sibling,s=i.return;if(CU(i),i===t){Pi=null;break e}if(r!==null){r.return=s,Pi=r;break e}Pi=s}}}var c4={getCacheForType:function(n){var e=tr(xi),t=e.data.get(n);return t===void 0&&(t=n(),e.data.set(n,t)),t}},h4=typeof WeakMap=="function"?WeakMap:Map,pn=0,Pn=null,kt=null,Wt=0,hn=0,as=null,Fl=!1,_f=!1,iw=!1,Jo=0,ni=0,nu=0,ic=0,rw=0,Bs=0,vd=0,Yp=null,Dr=null,VT=!1,sw=0,pv=1/0,mv=null,Hl=null,Vi=0,$l=null,bd=null,Zh=0,HT=0,$T=null,zU=null,Kp=0,WT=null;function ds(){if(pn&2&&Wt!==0)return Wt&-Wt;if(gt.T!==null){var n=md;return n!==0?n:ow()}return QL()}function GU(){Bs===0&&(Bs=!(Wt&536870912)||en?qL():536870912);var n=Vs.current;return n!==null&&(n.flags|=32),Bs}function fs(n,e,t){(n===Pn&&(hn===2||hn===9)||n.cancelPendingCommit!==null)&&(Sd(n,0),kl(n,Wt,Bs,!1)),sg(n,t),(!(pn&2)||n!==Pn)&&(n===Pn&&(!(pn&2)&&(ic|=t),ni===4&&kl(n,Wt,Bs,!1)),no(n))}function VU(n,e,t){if(pn&6)throw Error(ce(327));var i=!t&&(e&124)===0&&(e&n.expiredLanes)===0||rg(n,e),r=i?p4(n,e):aS(n,e,!0),s=i;do{if(r===0){_f&&!i&&kl(n,e,0,!1);break}else{if(t=n.current.alternate,s&&!d4(t)){r=aS(n,e,!1),s=!1;continue}if(r===2){if(s=e,n.errorRecoveryDisabledLanes&s)var a=0;else a=n.pendingLanes&-536870913,a=a!==0?a:a&536870912?536870912:0;if(a!==0){e=a;e:{var o=n;r=Yp;var l=o.current.memoizedState.isDehydrated;if(l&&(Sd(o,a).flags|=256),a=aS(o,a,!1),a!==2){if(iw&&!l){o.errorRecoveryDisabledLanes|=s,ic|=s,r=4;break e}s=Dr,Dr=r,s!==null&&(Dr===null?Dr=s:Dr.push.apply(Dr,s))}r=a}if(s=!1,r!==2)continue}}if(r===1){Sd(n,0),kl(n,e,0,!0);break}e:{switch(i=n,s=r,s){case 0:case 1:throw Error(ce(345));case 4:if((e&4194048)!==e)break;case 6:kl(i,e,Bs,!Fl);break e;case 2:Dr=null;break;case 3:case 5:break;default:throw Error(ce(329))}if((e&62914560)===e&&(r=sw+300-Ha(),10<r)){if(kl(i,e,Bs,!Fl),N0(i,0,!0)!==0)break e;i.timeoutHandle=oO(V1.bind(null,i,t,Dr,mv,VT,e,Bs,ic,vd,Fl,s,2,-0,0),r);break e}V1(i,t,Dr,mv,VT,e,Bs,ic,vd,Fl,s,0,-0,0)}}break}while(!0);no(n)}function V1(n,e,t,i,r,s,a,o,l,u,c,h,d,f){if(n.timeoutHandle=-1,h=e.subtreeFlags,(h&8192||(h&16785408)===16785408)&&(vm={stylesheets:null,count:0,unsuspend:q4},IU(e),h=Y4(),h!==null)){n.cancelPendingCommit=h($1.bind(null,n,e,s,t,i,r,a,o,l,c,1,d,f)),kl(n,s,a,!u);return}$1(n,e,s,t,i,r,a,o,l)}function d4(n){for(var e=n;;){var t=e.tag;if((t===0||t===11||t===15)&&e.flags&16384&&(t=e.updateQueue,t!==null&&(t=t.stores,t!==null)))for(var i=0;i<t.length;i++){var r=t[i],s=r.getSnapshot;r=r.value;try{if(!bs(s(),r))return!1}catch{return!1}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function kl(n,e,t,i){e&=~rw,e&=~ic,n.suspendedLanes|=e,n.pingedLanes&=~e,i&&(n.warmLanes|=e),i=n.expirationTimes;for(var r=e;0<r;){var s=31-hs(r),a=1<<s;i[s]=-1,r&=~a}t!==0&&YL(n,t,e)}function k0(){return pn&6?!0:(mg(0),!1)}function aw(){if(kt!==null){if(hn===0)var n=kt.return;else n=kt,Io=Ac=null,jM(n),Qh=null,gm=0,n=kt;for(;n!==null;)TU(n.alternate,n),n=n.return;kt=null}}function Sd(n,e){var t=n.timeoutHandle;t!==-1&&(n.timeoutHandle=-1,C4(t)),t=n.cancelPendingCommit,t!==null&&(n.cancelPendingCommit=null,t()),aw(),Pn=n,kt=t=Vo(n.current,null),Wt=e,hn=0,as=null,Fl=!1,_f=rg(n,e),iw=!1,vd=Bs=rw=ic=nu=ni=0,Dr=Yp=null,VT=!1,e&8&&(e|=e&32);var i=n.entangledLanes;if(i!==0)for(n=n.entanglements,i&=e;0<i;){var r=31-hs(i),s=1<<r;e|=n[r],i&=~s}return Jo=e,P0(),t}function HU(n,e){Pt=null,gt.H=lv,e===hg||e===O0?(e=b1(),hn=3):e===AP?(e=b1(),hn=4):hn=e===_U?8:e!==null&&typeof e=="object"&&typeof e.then=="function"?6:1,as=e,kt===null&&(ni=1,hv(n,Is(e,n.current)))}function $U(){var n=gt.H;return gt.H=lv,n===null?lv:n}function WU(){var n=gt.A;return gt.A=c4,n}function jT(){ni=4,Fl||(Wt&4194048)!==Wt&&Vs.current!==null||(_f=!0),!(nu&134217727)&&!(ic&134217727)||Pn===null||kl(Pn,Wt,Bs,!1)}function aS(n,e,t){var i=pn;pn|=2;var r=$U(),s=WU();(Pn!==n||Wt!==e)&&(mv=null,Sd(n,e)),e=!1;var a=ni;e:do try{if(hn!==0&&kt!==null){var o=kt,l=as;switch(hn){case 8:aw(),a=6;break e;case 3:case 2:case 9:case 6:Vs.current===null&&(e=!0);var u=hn;if(hn=0,as=null,Oh(n,o,l,u),t&&_f){a=0;break e}break;default:u=hn,hn=0,as=null,Oh(n,o,l,u)}}f4(),a=ni;break}catch(c){HU(n,c)}while(!0);return e&&n.shellSuspendCounter++,Io=Ac=null,pn=i,gt.H=r,gt.A=s,kt===null&&(Pn=null,Wt=0,P0()),a}function f4(){for(;kt!==null;)jU(kt)}function p4(n,e){var t=pn;pn|=2;var i=$U(),r=WU();Pn!==n||Wt!==e?(mv=null,pv=Ha()+500,Sd(n,e)):_f=rg(n,e);e:do try{if(hn!==0&&kt!==null){e=kt;var s=as;t:switch(hn){case 1:hn=0,as=null,Oh(n,e,s,1);break;case 2:case 9:if(v1(s)){hn=0,as=null,H1(e);break}e=function(){hn!==2&&hn!==9||Pn!==n||(hn=7),no(n)},s.then(e,e);break e;case 3:hn=7;break e;case 4:hn=5;break e;case 7:v1(s)?(hn=0,as=null,H1(e)):(hn=0,as=null,Oh(n,e,s,7));break;case 5:var a=null;switch(kt.tag){case 26:a=kt.memoizedState;case 5:case 27:var o=kt;if(!a||hO(a)){hn=0,as=null;var l=o.sibling;if(l!==null)kt=l;else{var u=o.return;u!==null?(kt=u,z0(u)):kt=null}break t}}hn=0,as=null,Oh(n,e,s,5);break;case 6:hn=0,as=null,Oh(n,e,s,6);break;case 8:aw(),ni=6;break e;default:throw Error(ce(462))}}m4();break}catch(c){HU(n,c)}while(!0);return Io=Ac=null,gt.H=i,gt.A=r,pn=t,kt!==null?0:(Pn=null,Wt=0,P0(),ni)}function m4(){for(;kt!==null&&!BG();)jU(kt)}function jU(n){var e=xU(n.alternate,n,Jo);n.memoizedProps=n.pendingProps,e===null?z0(n):kt=e}function H1(n){var e=n,t=e.alternate;switch(e.tag){case 15:case 0:e=I1(t,e,e.pendingProps,e.type,void 0,Wt);break;case 11:e=I1(t,e,e.pendingProps,e.type.render,e.ref,Wt);break;case 5:jM(e);default:TU(t,e),e=kt=TP(e,Jo),e=xU(t,e,Jo)}n.memoizedProps=n.pendingProps,e===null?z0(n):kt=e}function Oh(n,e,t,i){Io=Ac=null,jM(e),Qh=null,gm=0;var r=e.return;try{if(r4(n,r,e,t,Wt)){ni=1,hv(n,Is(t,n.current)),kt=null;return}}catch(s){if(r!==null)throw kt=r,s;ni=1,hv(n,Is(t,n.current)),kt=null;return}e.flags&32768?(en||i===1?n=!0:_f||Wt&536870912?n=!1:(Fl=n=!0,(i===2||i===9||i===3||i===6)&&(i=Vs.current,i!==null&&i.tag===13&&(i.flags|=16384))),qU(e,n)):z0(e)}function z0(n){var e=n;do{if(e.flags&32768){qU(e,Fl);return}n=e.return;var t=a4(e.alternate,e,Jo);if(t!==null){kt=t;return}if(e=e.sibling,e!==null){kt=e;return}kt=e=n}while(e!==null);ni===0&&(ni=5)}function qU(n,e){do{var t=o4(n.alternate,n);if(t!==null){t.flags&=32767,kt=t;return}if(t=n.return,t!==null&&(t.flags|=32768,t.subtreeFlags=0,t.deletions=null),!e&&(n=n.sibling,n!==null)){kt=n;return}kt=n=t}while(n!==null);ni=6,kt=null}function $1(n,e,t,i,r,s,a,o,l){n.cancelPendingCommit=null;do G0();while(Vi!==0);if(pn&6)throw Error(ce(327));if(e!==null){if(e===n.current)throw Error(ce(177));if(s=e.lanes|e.childLanes,s|=PM,qG(n,t,s,a,o,l),n===Pn&&(kt=Pn=null,Wt=0),bd=e,$l=n,Zh=t,HT=s,$T=r,zU=i,e.subtreeFlags&10256||e.flags&10256?(n.callbackNode=null,n.callbackPriority=0,v4(Zy,function(){return ZU(),null})):(n.callbackNode=null,n.callbackPriority=0),i=(e.flags&13878)!==0,e.subtreeFlags&13878||i){i=gt.T,gt.T=null,r=tn.p,tn.p=2,a=pn,pn|=4;try{l4(n,e,t)}finally{pn=a,tn.p=r,gt.T=i}}Vi=1,XU(),YU(),KU()}}function XU(){if(Vi===1){Vi=0;var n=$l,e=bd,t=(e.flags&13878)!==0;if(e.subtreeFlags&13878||t){t=gt.T,gt.T=null;var i=tn.p;tn.p=2;var r=pn;pn|=4;try{PU(e,n);var s=KT,a=mP(n.containerInfo),o=s.focusedElem,l=s.selectionRange;if(a!==o&&o&&o.ownerDocument&&pP(o.ownerDocument.documentElement,o)){if(l!==null&&LM(o)){var u=l.start,c=l.end;if(c===void 0&&(c=u),"selectionStart"in o)o.selectionStart=u,o.selectionEnd=Math.min(c,o.value.length);else{var h=o.ownerDocument||document,d=h&&h.defaultView||window;if(d.getSelection){var f=d.getSelection(),m=o.textContent.length,_=Math.min(l.start,m),g=l.end===void 0?_:Math.min(l.end,m);!f.extend&&_>g&&(a=g,g=_,_=a);var p=h1(o,_),y=h1(o,g);if(p&&y&&(f.rangeCount!==1||f.anchorNode!==p.node||f.anchorOffset!==p.offset||f.focusNode!==y.node||f.focusOffset!==y.offset)){var v=h.createRange();v.setStart(p.node,p.offset),f.removeAllRanges(),_>g?(f.addRange(v),f.extend(y.node,y.offset)):(v.setEnd(y.node,y.offset),f.addRange(v))}}}}for(h=[],f=o;f=f.parentNode;)f.nodeType===1&&h.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<h.length;o++){var b=h[o];b.element.scrollLeft=b.left,b.element.scrollTop=b.top}}Tv=!!YT,KT=YT=null}finally{pn=r,tn.p=i,gt.T=t}}n.current=e,Vi=2}}function YU(){if(Vi===2){Vi=0;var n=$l,e=bd,t=(e.flags&8772)!==0;if(e.subtreeFlags&8772||t){t=gt.T,gt.T=null;var i=tn.p;tn.p=2;var r=pn;pn|=4;try{NU(n,e.alternate,e)}finally{pn=r,tn.p=i,gt.T=t}}Vi=3}}function KU(){if(Vi===4||Vi===3){Vi=0,FG();var n=$l,e=bd,t=Zh,i=zU;e.subtreeFlags&10256||e.flags&10256?Vi=5:(Vi=0,bd=$l=null,QU(n,n.pendingLanes));var r=n.pendingLanes;if(r===0&&(Hl=null),MM(t),e=e.stateNode,cs&&typeof cs.onCommitFiberRoot=="function")try{cs.onCommitFiberRoot(ig,e,void 0,(e.current.flags&128)===128)}catch{}if(i!==null){e=gt.T,r=tn.p,tn.p=2,gt.T=null;try{for(var s=n.onRecoverableError,a=0;a<i.length;a++){var o=i[a];s(o.value,{componentStack:o.stack})}}finally{gt.T=e,tn.p=r}}Zh&3&&G0(),no(n),r=n.pendingLanes,t&4194090&&r&42?n===WT?Kp++:(Kp=0,WT=n):Kp=0,mg(0)}}function QU(n,e){(n.pooledCacheLanes&=e)===0&&(e=n.pooledCache,e!=null&&(n.pooledCache=null,cg(e)))}function G0(n){return XU(),YU(),KU(),ZU()}function ZU(){if(Vi!==5)return!1;var n=$l,e=HT;HT=0;var t=MM(Zh),i=gt.T,r=tn.p;try{tn.p=32>t?32:t,gt.T=null,t=$T,$T=null;var s=$l,a=Zh;if(Vi=0,bd=$l=null,Zh=0,pn&6)throw Error(ce(331));var o=pn;if(pn|=4,FU(s.current),OU(s,s.current,a,t),pn=o,mg(0,!1),cs&&typeof cs.onPostCommitFiberRoot=="function")try{cs.onPostCommitFiberRoot(ig,s)}catch{}return!0}finally{tn.p=r,gt.T=i,QU(n,e)}}function W1(n,e,t){e=Is(t,e),e=FT(n.stateNode,e,2),n=Vl(n,e,2),n!==null&&(sg(n,2),no(n))}function An(n,e,t){if(n.tag===3)W1(n,n,t);else for(;e!==null;){if(e.tag===3){W1(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Hl===null||!Hl.has(i))){n=Is(t,n),t=mU(2),i=Vl(e,t,2),i!==null&&(gU(t,i,e,n),sg(i,2),no(i));break}}e=e.return}}function oS(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new h4;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(t)||(iw=!0,r.add(t),n=g4.bind(null,n,e,t),e.then(n,n))}function g4(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),n.pingedLanes|=n.suspendedLanes&t,n.warmLanes&=~t,Pn===n&&(Wt&t)===t&&(ni===4||ni===3&&(Wt&62914560)===Wt&&300>Ha()-sw?!(pn&2)&&Sd(n,0):rw|=t,vd===Wt&&(vd=0)),no(n)}function JU(n,e){e===0&&(e=XL()),n=gf(n,e),n!==null&&(sg(n,e),no(n))}function _4(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),JU(n,t)}function y4(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,r=n.memoizedState;r!==null&&(t=r.retryLane);break;case 19:i=n.stateNode;break;case 22:i=n.stateNode._retryCache;break;default:throw Error(ce(314))}i!==null&&i.delete(e),JU(n,t)}function v4(n,e){return TM(n,e)}var gv=null,fh=null,qT=!1,_v=!1,lS=!1,rc=0;function no(n){n!==fh&&n.next===null&&(fh===null?gv=fh=n:fh=fh.next=n),_v=!0,qT||(qT=!0,S4())}function mg(n,e){if(!lS&&_v){lS=!0;do for(var t=!1,i=gv;i!==null;){if(n!==0){var r=i.pendingLanes;if(r===0)var s=0;else{var a=i.suspendedLanes,o=i.pingedLanes;s=(1<<31-hs(42|n)+1)-1,s&=r&~(a&~o),s=s&201326741?s&201326741|1:s?s|2:0}s!==0&&(t=!0,j1(i,s))}else s=Wt,s=N0(i,i===Pn?s:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),!(s&3)||rg(i,s)||(t=!0,j1(i,s));i=i.next}while(t);lS=!1}}function b4(){eO()}function eO(){_v=qT=!1;var n=0;rc!==0&&(N4()&&(n=rc),rc=0);for(var e=Ha(),t=null,i=gv;i!==null;){var r=i.next,s=tO(i,e);s===0?(i.next=null,t===null?gv=r:t.next=r,r===null&&(fh=t)):(t=i,(n!==0||s&3)&&(_v=!0)),i=r}mg(n)}function tO(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,r=n.expirationTimes,s=n.pendingLanes&-62914561;0<s;){var a=31-hs(s),o=1<<a,l=r[a];l===-1?(!(o&t)||o&i)&&(r[a]=jG(o,e)):l<=e&&(n.expiredLanes|=o),s&=~o}if(e=Pn,t=Wt,t=N0(n,n===e?t:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),i=n.callbackNode,t===0||n===e&&(hn===2||hn===9)||n.cancelPendingCommit!==null)return i!==null&&i!==null&&Ub(i),n.callbackNode=null,n.callbackPriority=0;if(!(t&3)||rg(n,t)){if(e=t&-t,e===n.callbackPriority)return e;switch(i!==null&&Ub(i),MM(t)){case 2:case 8:t=WL;break;case 32:t=Zy;break;case 268435456:t=jL;break;default:t=Zy}return i=nO.bind(null,n),t=TM(t,i),n.callbackPriority=e,n.callbackNode=t,e}return i!==null&&i!==null&&Ub(i),n.callbackPriority=2,n.callbackNode=null,2}function nO(n,e){if(Vi!==0&&Vi!==5)return n.callbackNode=null,n.callbackPriority=0,null;var t=n.callbackNode;if(G0()&&n.callbackNode!==t)return null;var i=Wt;return i=N0(n,n===Pn?i:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),i===0?null:(VU(n,i,e),tO(n,Ha()),n.callbackNode!=null&&n.callbackNode===t?nO.bind(null,n):null)}function j1(n,e){if(G0())return null;VU(n,e,!0)}function S4(){D4(function(){pn&6?TM($L,b4):eO()})}function ow(){return rc===0&&(rc=qL()),rc}function q1(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:dy(""+n)}function X1(n,e){var t=e.ownerDocument.createElement("input");return t.name=e.name,t.value=e.value,n.id&&t.setAttribute("form",n.id),e.parentNode.insertBefore(t,e),n=new FormData(n),t.parentNode.removeChild(t),n}function x4(n,e,t,i,r){if(e==="submit"&&t&&t.stateNode===r){var s=q1((r[Gr]||null).action),a=i.submitter;a&&(e=(e=a[Gr]||null)?q1(e.formAction):a.getAttribute("formAction"),e!==null&&(s=e,a=null));var o=new C0("action","action",null,i,r);n.push({event:o,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(rc!==0){var l=a?X1(r,a):new FormData(r);IT(t,{pending:!0,data:l,method:r.method,action:s},null,l)}}else typeof s=="function"&&(o.preventDefault(),l=a?X1(r,a):new FormData(r),IT(t,{pending:!0,data:l,method:r.method,action:s},s,l))},currentTarget:r}]})}}for(var uS=0;uS<ET.length;uS++){var cS=ET[uS],T4=cS.toLowerCase(),E4=cS[0].toUpperCase()+cS.slice(1);pa(T4,"on"+E4)}pa(_P,"onAnimationEnd");pa(yP,"onAnimationIteration");pa(vP,"onAnimationStart");pa("dblclick","onDoubleClick");pa("focusin","onFocus");pa("focusout","onBlur");pa(GV,"onTransitionRun");pa(VV,"onTransitionStart");pa(HV,"onTransitionCancel");pa(bP,"onTransitionEnd");fd("onMouseEnter",["mouseout","mouseover"]);fd("onMouseLeave",["mouseout","mouseover"]);fd("onPointerEnter",["pointerout","pointerover"]);fd("onPointerLeave",["pointerout","pointerover"]);Ec("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ec("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ec("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ec("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ec("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ec("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _m="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),M4=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(_m));function iO(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break e;s=o,r.currentTarget=u;try{s(r)}catch(c){cv(c)}r.currentTarget=null,s=l}else for(a=0;a<i.length;a++){if(o=i[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break e;s=o,r.currentTarget=u;try{s(r)}catch(c){cv(c)}r.currentTarget=null,s=l}}}}function Ft(n,e){var t=e[_T];t===void 0&&(t=e[_T]=new Set);var i=n+"__bubble";t.has(i)||(rO(e,n,2,!1),t.add(i))}function hS(n,e,t){var i=0;e&&(i|=4),rO(t,n,i,e)}var i_="_reactListening"+Math.random().toString(36).slice(2);function lw(n){if(!n[i_]){n[i_]=!0,ZL.forEach(function(t){t!=="selectionchange"&&(M4.has(t)||hS(t,!1,n),hS(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[i_]||(e[i_]=!0,hS("selectionchange",!1,e))}}function rO(n,e,t,i){switch(gO(e)){case 2:var r=Z4;break;case 8:r=J4;break;default:r=dw}t=r.bind(null,e,t,n),r=void 0,!ST||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function dS(n,e,t,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var a=i.tag;if(a===3||a===4){var o=i.stateNode.containerInfo;if(o===r)break;if(a===4)for(a=i.return;a!==null;){var l=a.tag;if((l===3||l===4)&&a.stateNode.containerInfo===r)return;a=a.return}for(;o!==null;){if(a=wh(o),a===null)return;if(l=a.tag,l===5||l===6||l===26||l===27){i=s=a;continue e}o=o.parentNode}}i=i.return}aP(function(){var u=s,c=RM(t),h=[];e:{var d=SP.get(n);if(d!==void 0){var f=C0,m=n;switch(n){case"keypress":if(py(t)===0)break e;case"keydown":case"keyup":f=vV;break;case"focusin":m="focus",f=Vb;break;case"focusout":m="blur",f=Vb;break;case"beforeblur":case"afterblur":f=Vb;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=t1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=oV;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=xV;break;case _P:case yP:case vP:f=cV;break;case bP:f=EV;break;case"scroll":case"scrollend":f=sV;break;case"wheel":f=wV;break;case"copy":case"cut":case"paste":f=dV;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=i1;break;case"toggle":case"beforetoggle":f=RV}var _=(e&4)!==0,g=!_&&(n==="scroll"||n==="scrollend"),p=_?d!==null?d+"Capture":null:d;_=[];for(var y=u,v;y!==null;){var b=y;if(v=b.stateNode,b=b.tag,b!==5&&b!==26&&b!==27||v===null||p===null||(b=hm(y,p),b!=null&&_.push(ym(y,b,v))),g)break;y=y.return}0<_.length&&(d=new f(d,m,null,t,c),h.push({event:d,listeners:_}))}}if(!(e&7)){e:{if(d=n==="mouseover"||n==="pointerover",f=n==="mouseout"||n==="pointerout",d&&t!==bT&&(m=t.relatedTarget||t.fromElement)&&(wh(m)||m[pf]))break e;if((f||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,f?(m=t.relatedTarget||t.toElement,f=u,m=m?wh(m):null,m!==null&&(g=ng(m),_=m.tag,m!==g||_!==5&&_!==27&&_!==6)&&(m=null)):(f=null,m=u),f!==m)){if(_=t1,b="onMouseLeave",p="onMouseEnter",y="mouse",(n==="pointerout"||n==="pointerover")&&(_=i1,b="onPointerLeave",p="onPointerEnter",y="pointer"),g=f==null?d:vp(f),v=m==null?d:vp(m),d=new _(b,y+"leave",f,t,c),d.target=g,d.relatedTarget=v,b=null,wh(c)===u&&(_=new _(p,y+"enter",m,t,c),_.target=v,_.relatedTarget=g,b=_),g=b,f&&m)t:{for(_=f,p=m,y=0,v=_;v;v=Bc(v))y++;for(v=0,b=p;b;b=Bc(b))v++;for(;0<y-v;)_=Bc(_),y--;for(;0<v-y;)p=Bc(p),v--;for(;y--;){if(_===p||p!==null&&_===p.alternate)break t;_=Bc(_),p=Bc(p)}_=null}else _=null;f!==null&&Y1(h,d,f,_,!1),m!==null&&g!==null&&Y1(h,g,m,_,!0)}}e:{if(d=u?vp(u):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var S=o1;else if(a1(d))if(dP)S=FV;else{S=IV;var x=OV}else f=d.nodeName,!f||f.toLowerCase()!=="input"||d.type!=="checkbox"&&d.type!=="radio"?u&&AM(u.elementType)&&(S=o1):S=BV;if(S&&(S=S(n,u))){hP(h,S,t,c);break e}x&&x(n,d,u),n==="focusout"&&u&&d.type==="number"&&u.memoizedProps.value!=null&&vT(d,"number",d.value)}switch(x=u?vp(u):window,n){case"focusin":(a1(x)||x.contentEditable==="true")&&(Nh=x,xT=u,zp=null);break;case"focusout":zp=xT=Nh=null;break;case"mousedown":TT=!0;break;case"contextmenu":case"mouseup":case"dragend":TT=!1,d1(h,t,c);break;case"selectionchange":if(zV)break;case"keydown":case"keyup":d1(h,t,c)}var T;if(DM)e:{switch(n){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Rh?uP(n,t)&&(w="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(w="onCompositionStart");w&&(lP&&t.locale!=="ko"&&(Rh||w!=="onCompositionStart"?w==="onCompositionEnd"&&Rh&&(T=oP()):(Bl=c,NM="value"in Bl?Bl.value:Bl.textContent,Rh=!0)),x=yv(u,w),0<x.length&&(w=new n1(w,n,null,t,c),h.push({event:w,listeners:x}),T?w.data=T:(T=cP(t),T!==null&&(w.data=T)))),(T=CV?DV(n,t):LV(n,t))&&(w=yv(u,"onBeforeInput"),0<w.length&&(x=new n1("onBeforeInput","beforeinput",null,t,c),h.push({event:x,listeners:w}),x.data=T)),x4(h,n,u,t,c)}iO(h,e)})}function ym(n,e,t){return{instance:n,listener:e,currentTarget:t}}function yv(n,e){for(var t=e+"Capture",i=[];n!==null;){var r=n,s=r.stateNode;if(r=r.tag,r!==5&&r!==26&&r!==27||s===null||(r=hm(n,t),r!=null&&i.unshift(ym(n,r,s)),r=hm(n,e),r!=null&&i.push(ym(n,r,s))),n.tag===3)return i;n=n.return}return[]}function Bc(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function Y1(n,e,t,i,r){for(var s=e._reactName,a=[];t!==null&&t!==i;){var o=t,l=o.alternate,u=o.stateNode;if(o=o.tag,l!==null&&l===i)break;o!==5&&o!==26&&o!==27||u===null||(l=u,r?(u=hm(t,s),u!=null&&a.unshift(ym(t,u,l))):r||(u=hm(t,s),u!=null&&a.push(ym(t,u,l)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var w4=/\r\n?/g,A4=/\u0000|\uFFFD/g;function K1(n){return(typeof n=="string"?n:""+n).replace(w4,`
`).replace(A4,"")}function sO(n,e){return e=K1(e),K1(n)===e}function V0(){}function _n(n,e,t,i,r,s){switch(t){case"children":typeof i=="string"?e==="body"||e==="textarea"&&i===""||pd(n,i):(typeof i=="number"||typeof i=="bigint")&&e!=="body"&&pd(n,""+i);break;case"className":Kg(n,"class",i);break;case"tabIndex":Kg(n,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":Kg(n,t,i);break;case"style":sP(n,i,s);break;case"data":if(e!=="object"){Kg(n,"data",i);break}case"src":case"href":if(i===""&&(e!=="a"||t!=="href")){n.removeAttribute(t);break}if(i==null||typeof i=="function"||typeof i=="symbol"||typeof i=="boolean"){n.removeAttribute(t);break}i=dy(""+i),n.setAttribute(t,i);break;case"action":case"formAction":if(typeof i=="function"){n.setAttribute(t,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof s=="function"&&(t==="formAction"?(e!=="input"&&_n(n,e,"name",r.name,r,null),_n(n,e,"formEncType",r.formEncType,r,null),_n(n,e,"formMethod",r.formMethod,r,null),_n(n,e,"formTarget",r.formTarget,r,null)):(_n(n,e,"encType",r.encType,r,null),_n(n,e,"method",r.method,r,null),_n(n,e,"target",r.target,r,null)));if(i==null||typeof i=="symbol"||typeof i=="boolean"){n.removeAttribute(t);break}i=dy(""+i),n.setAttribute(t,i);break;case"onClick":i!=null&&(n.onclick=V0);break;case"onScroll":i!=null&&Ft("scroll",n);break;case"onScrollEnd":i!=null&&Ft("scrollend",n);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(ce(61));if(t=i.__html,t!=null){if(r.children!=null)throw Error(ce(60));n.innerHTML=t}}break;case"multiple":n.multiple=i&&typeof i!="function"&&typeof i!="symbol";break;case"muted":n.muted=i&&typeof i!="function"&&typeof i!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(i==null||typeof i=="function"||typeof i=="boolean"||typeof i=="symbol"){n.removeAttribute("xlink:href");break}t=dy(""+i),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":i!=null&&typeof i!="function"&&typeof i!="symbol"?n.setAttribute(t,""+i):n.removeAttribute(t);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&typeof i!="function"&&typeof i!="symbol"?n.setAttribute(t,""):n.removeAttribute(t);break;case"capture":case"download":i===!0?n.setAttribute(t,""):i!==!1&&i!=null&&typeof i!="function"&&typeof i!="symbol"?n.setAttribute(t,i):n.removeAttribute(t);break;case"cols":case"rows":case"size":case"span":i!=null&&typeof i!="function"&&typeof i!="symbol"&&!isNaN(i)&&1<=i?n.setAttribute(t,i):n.removeAttribute(t);break;case"rowSpan":case"start":i==null||typeof i=="function"||typeof i=="symbol"||isNaN(i)?n.removeAttribute(t):n.setAttribute(t,i);break;case"popover":Ft("beforetoggle",n),Ft("toggle",n),hy(n,"popover",i);break;case"xlinkActuate":oo(n,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":oo(n,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":oo(n,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":oo(n,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":oo(n,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":oo(n,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":oo(n,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":oo(n,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":oo(n,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":hy(n,"is",i);break;case"innerText":case"textContent":break;default:(!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(t=iV.get(t)||t,hy(n,t,i))}}function XT(n,e,t,i,r,s){switch(t){case"style":sP(n,i,s);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(ce(61));if(t=i.__html,t!=null){if(r.children!=null)throw Error(ce(60));n.innerHTML=t}}break;case"children":typeof i=="string"?pd(n,i):(typeof i=="number"||typeof i=="bigint")&&pd(n,""+i);break;case"onScroll":i!=null&&Ft("scroll",n);break;case"onScrollEnd":i!=null&&Ft("scrollend",n);break;case"onClick":i!=null&&(n.onclick=V0);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!JL.hasOwnProperty(t))e:{if(t[0]==="o"&&t[1]==="n"&&(r=t.endsWith("Capture"),e=t.slice(2,r?t.length-7:void 0),s=n[Gr]||null,s=s!=null?s[t]:null,typeof s=="function"&&n.removeEventListener(e,s,r),typeof i=="function")){typeof s!="function"&&s!==null&&(t in n?n[t]=null:n.hasAttribute(t)&&n.removeAttribute(t)),n.addEventListener(e,i,r);break e}t in n?n[t]=i:i===!0?n.setAttribute(t,""):hy(n,t,i)}}}function $i(n,e,t){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ft("error",n),Ft("load",n);var i=!1,r=!1,s;for(s in t)if(t.hasOwnProperty(s)){var a=t[s];if(a!=null)switch(s){case"src":i=!0;break;case"srcSet":r=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(ce(137,e));default:_n(n,e,s,a,t,null)}}r&&_n(n,e,"srcSet",t.srcSet,t,null),i&&_n(n,e,"src",t.src,t,null);return;case"input":Ft("invalid",n);var o=s=a=r=null,l=null,u=null;for(i in t)if(t.hasOwnProperty(i)){var c=t[i];if(c!=null)switch(i){case"name":r=c;break;case"type":a=c;break;case"checked":l=c;break;case"defaultChecked":u=c;break;case"value":s=c;break;case"defaultValue":o=c;break;case"children":case"dangerouslySetInnerHTML":if(c!=null)throw Error(ce(137,e));break;default:_n(n,e,i,c,t,null)}}nP(n,s,o,l,u,a,r,!1),Jy(n);return;case"select":Ft("invalid",n),i=a=s=null;for(r in t)if(t.hasOwnProperty(r)&&(o=t[r],o!=null))switch(r){case"value":s=o;break;case"defaultValue":a=o;break;case"multiple":i=o;default:_n(n,e,r,o,t,null)}e=s,t=a,n.multiple=!!i,e!=null?jh(n,!!i,e,!1):t!=null&&jh(n,!!i,t,!0);return;case"textarea":Ft("invalid",n),s=r=i=null;for(a in t)if(t.hasOwnProperty(a)&&(o=t[a],o!=null))switch(a){case"value":i=o;break;case"defaultValue":r=o;break;case"children":s=o;break;case"dangerouslySetInnerHTML":if(o!=null)throw Error(ce(91));break;default:_n(n,e,a,o,t,null)}rP(n,i,r,s),Jy(n);return;case"option":for(l in t)if(t.hasOwnProperty(l)&&(i=t[l],i!=null))switch(l){case"selected":n.selected=i&&typeof i!="function"&&typeof i!="symbol";break;default:_n(n,e,l,i,t,null)}return;case"dialog":Ft("beforetoggle",n),Ft("toggle",n),Ft("cancel",n),Ft("close",n);break;case"iframe":case"object":Ft("load",n);break;case"video":case"audio":for(i=0;i<_m.length;i++)Ft(_m[i],n);break;case"image":Ft("error",n),Ft("load",n);break;case"details":Ft("toggle",n);break;case"embed":case"source":case"link":Ft("error",n),Ft("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in t)if(t.hasOwnProperty(u)&&(i=t[u],i!=null))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(ce(137,e));default:_n(n,e,u,i,t,null)}return;default:if(AM(e)){for(c in t)t.hasOwnProperty(c)&&(i=t[c],i!==void 0&&XT(n,e,c,i,t,void 0));return}}for(o in t)t.hasOwnProperty(o)&&(i=t[o],i!=null&&_n(n,e,o,i,t,null))}function R4(n,e,t,i){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,s=null,a=null,o=null,l=null,u=null,c=null;for(f in t){var h=t[f];if(t.hasOwnProperty(f)&&h!=null)switch(f){case"checked":break;case"value":break;case"defaultValue":l=h;default:i.hasOwnProperty(f)||_n(n,e,f,null,i,h)}}for(var d in i){var f=i[d];if(h=t[d],i.hasOwnProperty(d)&&(f!=null||h!=null))switch(d){case"type":s=f;break;case"name":r=f;break;case"checked":u=f;break;case"defaultChecked":c=f;break;case"value":a=f;break;case"defaultValue":o=f;break;case"children":case"dangerouslySetInnerHTML":if(f!=null)throw Error(ce(137,e));break;default:f!==h&&_n(n,e,d,f,i,h)}}yT(n,a,o,l,u,c,s,r);return;case"select":f=a=o=d=null;for(s in t)if(l=t[s],t.hasOwnProperty(s)&&l!=null)switch(s){case"value":break;case"multiple":f=l;default:i.hasOwnProperty(s)||_n(n,e,s,null,i,l)}for(r in i)if(s=i[r],l=t[r],i.hasOwnProperty(r)&&(s!=null||l!=null))switch(r){case"value":d=s;break;case"defaultValue":o=s;break;case"multiple":a=s;default:s!==l&&_n(n,e,r,s,i,l)}e=o,t=a,i=f,d!=null?jh(n,!!t,d,!1):!!i!=!!t&&(e!=null?jh(n,!!t,e,!0):jh(n,!!t,t?[]:"",!1));return;case"textarea":f=d=null;for(o in t)if(r=t[o],t.hasOwnProperty(o)&&r!=null&&!i.hasOwnProperty(o))switch(o){case"value":break;case"children":break;default:_n(n,e,o,null,i,r)}for(a in i)if(r=i[a],s=t[a],i.hasOwnProperty(a)&&(r!=null||s!=null))switch(a){case"value":d=r;break;case"defaultValue":f=r;break;case"children":break;case"dangerouslySetInnerHTML":if(r!=null)throw Error(ce(91));break;default:r!==s&&_n(n,e,a,r,i,s)}iP(n,d,f);return;case"option":for(var m in t)if(d=t[m],t.hasOwnProperty(m)&&d!=null&&!i.hasOwnProperty(m))switch(m){case"selected":n.selected=!1;break;default:_n(n,e,m,null,i,d)}for(l in i)if(d=i[l],f=t[l],i.hasOwnProperty(l)&&d!==f&&(d!=null||f!=null))switch(l){case"selected":n.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:_n(n,e,l,d,i,f)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var _ in t)d=t[_],t.hasOwnProperty(_)&&d!=null&&!i.hasOwnProperty(_)&&_n(n,e,_,null,i,d);for(u in i)if(d=i[u],f=t[u],i.hasOwnProperty(u)&&d!==f&&(d!=null||f!=null))switch(u){case"children":case"dangerouslySetInnerHTML":if(d!=null)throw Error(ce(137,e));break;default:_n(n,e,u,d,i,f)}return;default:if(AM(e)){for(var g in t)d=t[g],t.hasOwnProperty(g)&&d!==void 0&&!i.hasOwnProperty(g)&&XT(n,e,g,void 0,i,d);for(c in i)d=i[c],f=t[c],!i.hasOwnProperty(c)||d===f||d===void 0&&f===void 0||XT(n,e,c,d,i,f);return}}for(var p in t)d=t[p],t.hasOwnProperty(p)&&d!=null&&!i.hasOwnProperty(p)&&_n(n,e,p,null,i,d);for(h in i)d=i[h],f=t[h],!i.hasOwnProperty(h)||d===f||d==null&&f==null||_n(n,e,h,d,i,f)}var YT=null,KT=null;function vv(n){return n.nodeType===9?n:n.ownerDocument}function Q1(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function aO(n,e){if(n===0)switch(e){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&e==="foreignObject"?0:n}function QT(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.children=="bigint"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var fS=null;function N4(){var n=window.event;return n&&n.type==="popstate"?n===fS?!1:(fS=n,!0):(fS=null,!1)}var oO=typeof setTimeout=="function"?setTimeout:void 0,C4=typeof clearTimeout=="function"?clearTimeout:void 0,Z1=typeof Promise=="function"?Promise:void 0,D4=typeof queueMicrotask=="function"?queueMicrotask:typeof Z1<"u"?function(n){return Z1.resolve(null).then(n).catch(L4)}:oO;function L4(n){setTimeout(function(){throw n})}function fu(n){return n==="head"}function J1(n,e){var t=e,i=0,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(0<i&&8>i){t=i;var a=n.ownerDocument;if(t&1&&Qp(a.documentElement),t&2&&Qp(a.body),t&4)for(t=a.head,Qp(t),a=t.firstChild;a;){var o=a.nextSibling,l=a.nodeName;a[ag]||l==="SCRIPT"||l==="STYLE"||l==="LINK"&&a.rel.toLowerCase()==="stylesheet"||t.removeChild(a),a=o}}if(r===0){n.removeChild(s),Tm(e);return}r--}else t==="$"||t==="$?"||t==="$!"?r++:i=t.charCodeAt(0)-48;else i=0;t=s}while(t);Tm(e)}function ZT(n){var e=n.firstChild;for(e&&e.nodeType===10&&(e=e.nextSibling);e;){var t=e;switch(e=e.nextSibling,t.nodeName){case"HTML":case"HEAD":case"BODY":ZT(t),wM(t);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(t.rel.toLowerCase()==="stylesheet")continue}n.removeChild(t)}}function P4(n,e,t,i){for(;n.nodeType===1;){var r=t;if(n.nodeName.toLowerCase()!==e.toLowerCase()){if(!i&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(i){if(!n[ag])switch(e){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(s=n.getAttribute("rel"),s==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(s!==r.rel||n.getAttribute("href")!==(r.href==null||r.href===""?null:r.href)||n.getAttribute("crossorigin")!==(r.crossOrigin==null?null:r.crossOrigin)||n.getAttribute("title")!==(r.title==null?null:r.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(s=n.getAttribute("src"),(s!==(r.src==null?null:r.src)||n.getAttribute("type")!==(r.type==null?null:r.type)||n.getAttribute("crossorigin")!==(r.crossOrigin==null?null:r.crossOrigin))&&s&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(e==="input"&&n.type==="hidden"){var s=r.name==null?null:""+r.name;if(r.type==="hidden"&&n.getAttribute("name")===s)return n}else return n;if(n=ca(n.nextSibling),n===null)break}return null}function U4(n,e,t){if(e==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!t||(n=ca(n.nextSibling),n===null))return null;return n}function JT(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState==="complete"}function O4(n,e){var t=n.ownerDocument;if(n.data!=="$?"||t.readyState==="complete")e();else{var i=function(){e(),t.removeEventListener("DOMContentLoaded",i)};t.addEventListener("DOMContentLoaded",i),n._reactRetry=i}}function ca(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?"||e==="F!"||e==="F")break;if(e==="/$")return null}}return n}var eE=null;function eN(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}function lO(n,e,t){switch(e=vv(t),n){case"html":if(n=e.documentElement,!n)throw Error(ce(452));return n;case"head":if(n=e.head,!n)throw Error(ce(453));return n;case"body":if(n=e.body,!n)throw Error(ce(454));return n;default:throw Error(ce(451))}}function Qp(n){for(var e=n.attributes;e.length;)n.removeAttributeNode(e[0]);wM(n)}var Hs=new Map,tN=new Set;function bv(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var il=tn.d;tn.d={f:I4,r:B4,D:F4,C:k4,L:z4,m:G4,X:H4,S:V4,M:$4};function I4(){var n=il.f(),e=k0();return n||e}function B4(n){var e=mf(n);e!==null&&e.tag===5&&e.type==="form"?tU(e):il.r(n)}var yf=typeof document>"u"?null:document;function uO(n,e,t){var i=yf;if(i&&typeof e=="string"&&e){var r=Os(e);r='link[rel="'+n+'"][href="'+r+'"]',typeof t=="string"&&(r+='[crossorigin="'+t+'"]'),tN.has(r)||(tN.add(r),n={rel:n,crossOrigin:t,href:e},i.querySelector(r)===null&&(e=i.createElement("link"),$i(e,"link",n),Ui(e),i.head.appendChild(e)))}}function F4(n){il.D(n),uO("dns-prefetch",n,null)}function k4(n,e){il.C(n,e),uO("preconnect",n,e)}function z4(n,e,t){il.L(n,e,t);var i=yf;if(i&&n&&e){var r='link[rel="preload"][as="'+Os(e)+'"]';e==="image"&&t&&t.imageSrcSet?(r+='[imagesrcset="'+Os(t.imageSrcSet)+'"]',typeof t.imageSizes=="string"&&(r+='[imagesizes="'+Os(t.imageSizes)+'"]')):r+='[href="'+Os(n)+'"]';var s=r;switch(e){case"style":s=xd(n);break;case"script":s=vf(n)}Hs.has(s)||(n=Fn({rel:"preload",href:e==="image"&&t&&t.imageSrcSet?void 0:n,as:e},t),Hs.set(s,n),i.querySelector(r)!==null||e==="style"&&i.querySelector(gg(s))||e==="script"&&i.querySelector(_g(s))||(e=i.createElement("link"),$i(e,"link",n),Ui(e),i.head.appendChild(e)))}}function G4(n,e){il.m(n,e);var t=yf;if(t&&n){var i=e&&typeof e.as=="string"?e.as:"script",r='link[rel="modulepreload"][as="'+Os(i)+'"][href="'+Os(n)+'"]',s=r;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":s=vf(n)}if(!Hs.has(s)&&(n=Fn({rel:"modulepreload",href:n},e),Hs.set(s,n),t.querySelector(r)===null)){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(t.querySelector(_g(s)))return}i=t.createElement("link"),$i(i,"link",n),Ui(i),t.head.appendChild(i)}}}function V4(n,e,t){il.S(n,e,t);var i=yf;if(i&&n){var r=Wh(i).hoistableStyles,s=xd(n);e=e||"default";var a=r.get(s);if(!a){var o={loading:0,preload:null};if(a=i.querySelector(gg(s)))o.loading=5;else{n=Fn({rel:"stylesheet",href:n,"data-precedence":e},t),(t=Hs.get(s))&&uw(n,t);var l=a=i.createElement("link");Ui(l),$i(l,"link",n),l._p=new Promise(function(u,c){l.onload=u,l.onerror=c}),l.addEventListener("load",function(){o.loading|=1}),l.addEventListener("error",function(){o.loading|=2}),o.loading|=4,Sy(a,e,i)}a={type:"stylesheet",instance:a,count:1,state:o},r.set(s,a)}}}function H4(n,e){il.X(n,e);var t=yf;if(t&&n){var i=Wh(t).hoistableScripts,r=vf(n),s=i.get(r);s||(s=t.querySelector(_g(r)),s||(n=Fn({src:n,async:!0},e),(e=Hs.get(r))&&cw(n,e),s=t.createElement("script"),Ui(s),$i(s,"link",n),t.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},i.set(r,s))}}function $4(n,e){il.M(n,e);var t=yf;if(t&&n){var i=Wh(t).hoistableScripts,r=vf(n),s=i.get(r);s||(s=t.querySelector(_g(r)),s||(n=Fn({src:n,async:!0,type:"module"},e),(e=Hs.get(r))&&cw(n,e),s=t.createElement("script"),Ui(s),$i(s,"link",n),t.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},i.set(r,s))}}function nN(n,e,t,i){var r=(r=zl.current)?bv(r):null;if(!r)throw Error(ce(446));switch(n){case"meta":case"title":return null;case"style":return typeof t.precedence=="string"&&typeof t.href=="string"?(e=xd(t.href),t=Wh(r).hoistableStyles,i=t.get(e),i||(i={type:"style",instance:null,count:0,state:null},t.set(e,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if(t.rel==="stylesheet"&&typeof t.href=="string"&&typeof t.precedence=="string"){n=xd(t.href);var s=Wh(r).hoistableStyles,a=s.get(n);if(a||(r=r.ownerDocument||r,a={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},s.set(n,a),(s=r.querySelector(gg(n)))&&!s._p&&(a.instance=s,a.state.loading=5),Hs.has(n)||(t={rel:"preload",as:"style",href:t.href,crossOrigin:t.crossOrigin,integrity:t.integrity,media:t.media,hrefLang:t.hrefLang,referrerPolicy:t.referrerPolicy},Hs.set(n,t),s||W4(r,n,t,a.state))),e&&i===null)throw Error(ce(528,""));return a}if(e&&i!==null)throw Error(ce(529,""));return null;case"script":return e=t.async,t=t.src,typeof t=="string"&&e&&typeof e!="function"&&typeof e!="symbol"?(e=vf(t),t=Wh(r).hoistableScripts,i=t.get(e),i||(i={type:"script",instance:null,count:0,state:null},t.set(e,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(ce(444,n))}}function xd(n){return'href="'+Os(n)+'"'}function gg(n){return'link[rel="stylesheet"]['+n+"]"}function cO(n){return Fn({},n,{"data-precedence":n.precedence,precedence:null})}function W4(n,e,t,i){n.querySelector('link[rel="preload"][as="style"]['+e+"]")?i.loading=1:(e=n.createElement("link"),i.preload=e,e.addEventListener("load",function(){return i.loading|=1}),e.addEventListener("error",function(){return i.loading|=2}),$i(e,"link",t),Ui(e),n.head.appendChild(e))}function vf(n){return'[src="'+Os(n)+'"]'}function _g(n){return"script[async]"+n}function iN(n,e,t){if(e.count++,e.instance===null)switch(e.type){case"style":var i=n.querySelector('style[data-href~="'+Os(t.href)+'"]');if(i)return e.instance=i,Ui(i),i;var r=Fn({},t,{"data-href":t.href,"data-precedence":t.precedence,href:null,precedence:null});return i=(n.ownerDocument||n).createElement("style"),Ui(i),$i(i,"style",r),Sy(i,t.precedence,n),e.instance=i;case"stylesheet":r=xd(t.href);var s=n.querySelector(gg(r));if(s)return e.state.loading|=4,e.instance=s,Ui(s),s;i=cO(t),(r=Hs.get(r))&&uw(i,r),s=(n.ownerDocument||n).createElement("link"),Ui(s);var a=s;return a._p=new Promise(function(o,l){a.onload=o,a.onerror=l}),$i(s,"link",i),e.state.loading|=4,Sy(s,t.precedence,n),e.instance=s;case"script":return s=vf(t.src),(r=n.querySelector(_g(s)))?(e.instance=r,Ui(r),r):(i=t,(r=Hs.get(s))&&(i=Fn({},t),cw(i,r)),n=n.ownerDocument||n,r=n.createElement("script"),Ui(r),$i(r,"link",i),n.head.appendChild(r),e.instance=r);case"void":return null;default:throw Error(ce(443,e.type))}else e.type==="stylesheet"&&!(e.state.loading&4)&&(i=e.instance,e.state.loading|=4,Sy(i,t.precedence,n));return e.instance}function Sy(n,e,t){for(var i=t.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),r=i.length?i[i.length-1]:null,s=r,a=0;a<i.length;a++){var o=i[a];if(o.dataset.precedence===e)s=o;else if(s!==r)break}s?s.parentNode.insertBefore(n,s.nextSibling):(e=t.nodeType===9?t.head:t,e.insertBefore(n,e.firstChild))}function uw(n,e){n.crossOrigin==null&&(n.crossOrigin=e.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=e.referrerPolicy),n.title==null&&(n.title=e.title)}function cw(n,e){n.crossOrigin==null&&(n.crossOrigin=e.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=e.referrerPolicy),n.integrity==null&&(n.integrity=e.integrity)}var xy=null;function rN(n,e,t){if(xy===null){var i=new Map,r=xy=new Map;r.set(t,i)}else r=xy,i=r.get(t),i||(i=new Map,r.set(t,i));if(i.has(n))return i;for(i.set(n,null),t=t.getElementsByTagName(n),r=0;r<t.length;r++){var s=t[r];if(!(s[ag]||s[er]||n==="link"&&s.getAttribute("rel")==="stylesheet")&&s.namespaceURI!=="http://www.w3.org/2000/svg"){var a=s.getAttribute(e)||"";a=n+a;var o=i.get(a);o?o.push(s):i.set(a,[s])}}return i}function sN(n,e,t){n=n.ownerDocument||n,n.head.insertBefore(t,e==="title"?n.querySelector("head > title"):null)}function j4(n,e,t){if(t===1||e.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof e.precedence!="string"||typeof e.href!="string"||e.href==="")break;return!0;case"link":if(typeof e.rel!="string"||typeof e.href!="string"||e.href===""||e.onLoad||e.onError)break;switch(e.rel){case"stylesheet":return n=e.disabled,typeof e.precedence=="string"&&n==null;default:return!0}case"script":if(e.async&&typeof e.async!="function"&&typeof e.async!="symbol"&&!e.onLoad&&!e.onError&&e.src&&typeof e.src=="string")return!0}return!1}function hO(n){return!(n.type==="stylesheet"&&!(n.state.loading&3))}var vm=null;function q4(){}function X4(n,e,t){if(vm===null)throw Error(ce(475));var i=vm;if(e.type==="stylesheet"&&(typeof t.media!="string"||matchMedia(t.media).matches!==!1)&&!(e.state.loading&4)){if(e.instance===null){var r=xd(t.href),s=n.querySelector(gg(r));if(s){n=s._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(i.count++,i=Sv.bind(i),n.then(i,i)),e.state.loading|=4,e.instance=s,Ui(s);return}s=n.ownerDocument||n,t=cO(t),(r=Hs.get(r))&&uw(t,r),s=s.createElement("link"),Ui(s);var a=s;a._p=new Promise(function(o,l){a.onload=o,a.onerror=l}),$i(s,"link",t),e.instance=s}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(e,n),(n=e.state.preload)&&!(e.state.loading&3)&&(i.count++,e=Sv.bind(i),n.addEventListener("load",e),n.addEventListener("error",e))}}function Y4(){if(vm===null)throw Error(ce(475));var n=vm;return n.stylesheets&&n.count===0&&tE(n,n.stylesheets),0<n.count?function(e){var t=setTimeout(function(){if(n.stylesheets&&tE(n,n.stylesheets),n.unsuspend){var i=n.unsuspend;n.unsuspend=null,i()}},6e4);return n.unsuspend=e,function(){n.unsuspend=null,clearTimeout(t)}}:null}function Sv(){if(this.count--,this.count===0){if(this.stylesheets)tE(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var xv=null;function tE(n,e){n.stylesheets=null,n.unsuspend!==null&&(n.count++,xv=new Map,e.forEach(K4,n),xv=null,Sv.call(n))}function K4(n,e){if(!(e.state.loading&4)){var t=xv.get(n);if(t)var i=t.get(null);else{t=new Map,xv.set(n,t);for(var r=n.querySelectorAll("link[data-precedence],style[data-precedence]"),s=0;s<r.length;s++){var a=r[s];(a.nodeName==="LINK"||a.getAttribute("media")!=="not all")&&(t.set(a.dataset.precedence,a),i=a)}i&&t.set(null,i)}r=e.instance,a=r.getAttribute("data-precedence"),s=t.get(a)||i,s===i&&t.set(null,r),t.set(a,r),this.count++,i=Sv.bind(this),r.addEventListener("load",i),r.addEventListener("error",i),s?s.parentNode.insertBefore(r,s.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(r,n.firstChild)),e.state.loading|=4}}var bm={$$typeof:Po,Provider:null,Consumer:null,_currentValue:Zu,_currentValue2:Zu,_threadCount:0};function Q4(n,e,t,i,r,s,a,o){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ob(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ob(0),this.hiddenUpdates=Ob(null),this.identifierPrefix=i,this.onUncaughtError=r,this.onCaughtError=s,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=o,this.incompleteTransitions=new Map}function dO(n,e,t,i,r,s,a,o,l,u,c,h){return n=new Q4(n,e,t,a,o,l,u,h),e=1,s===!0&&(e|=24),s=us(3,null,null,e),n.current=s,s.stateNode=n,e=FM(),e.refCount++,n.pooledCache=e,e.refCount++,s.memoizedState={element:i,isDehydrated:t,cache:e},zM(s),n}function fO(n){return n?(n=Lh,n):Lh}function pO(n,e,t,i,r,s){r=fO(r),i.context===null?i.context=r:i.pendingContext=r,i=Gl(e),i.payload={element:t},s=s===void 0?null:s,s!==null&&(i.callback=s),t=Vl(n,i,e),t!==null&&(fs(t,n,e),Hp(t,n,e))}function aN(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function hw(n,e){aN(n,e),(n=n.alternate)&&aN(n,e)}function mO(n){if(n.tag===13){var e=gf(n,67108864);e!==null&&fs(e,n,67108864),hw(n,67108864)}}var Tv=!0;function Z4(n,e,t,i){var r=gt.T;gt.T=null;var s=tn.p;try{tn.p=2,dw(n,e,t,i)}finally{tn.p=s,gt.T=r}}function J4(n,e,t,i){var r=gt.T;gt.T=null;var s=tn.p;try{tn.p=8,dw(n,e,t,i)}finally{tn.p=s,gt.T=r}}function dw(n,e,t,i){if(Tv){var r=nE(i);if(r===null)dS(n,e,i,Ev,t),oN(n,i);else if(tH(r,n,e,t,i))i.stopPropagation();else if(oN(n,i),e&4&&-1<eH.indexOf(n)){for(;r!==null;){var s=mf(r);if(s!==null)switch(s.tag){case 3:if(s=s.stateNode,s.current.memoizedState.isDehydrated){var a=Bu(s.pendingLanes);if(a!==0){var o=s;for(o.pendingLanes|=2,o.entangledLanes|=2;a;){var l=1<<31-hs(a);o.entanglements[1]|=l,a&=~l}no(s),!(pn&6)&&(pv=Ha()+500,mg(0))}}break;case 13:o=gf(s,2),o!==null&&fs(o,s,2),k0(),hw(s,2)}if(s=nE(i),s===null&&dS(n,e,i,Ev,t),s===r)break;r=s}r!==null&&i.stopPropagation()}else dS(n,e,i,null,t)}}function nE(n){return n=RM(n),fw(n)}var Ev=null;function fw(n){if(Ev=null,n=wh(n),n!==null){var e=ng(n);if(e===null)n=null;else{var t=e.tag;if(t===13){if(n=zL(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null)}}return Ev=n,null}function gO(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(kG()){case $L:return 2;case WL:return 8;case Zy:case zG:return 32;case jL:return 268435456;default:return 32}default:return 32}}var iE=!1,Wl=null,jl=null,ql=null,Sm=new Map,xm=new Map,Pl=[],eH="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function oN(n,e){switch(n){case"focusin":case"focusout":Wl=null;break;case"dragenter":case"dragleave":jl=null;break;case"mouseover":case"mouseout":ql=null;break;case"pointerover":case"pointerout":Sm.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":xm.delete(e.pointerId)}}function Hf(n,e,t,i,r,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=mf(e),e!==null&&mO(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function tH(n,e,t,i,r){switch(e){case"focusin":return Wl=Hf(Wl,n,e,t,i,r),!0;case"dragenter":return jl=Hf(jl,n,e,t,i,r),!0;case"mouseover":return ql=Hf(ql,n,e,t,i,r),!0;case"pointerover":var s=r.pointerId;return Sm.set(s,Hf(Sm.get(s)||null,n,e,t,i,r)),!0;case"gotpointercapture":return s=r.pointerId,xm.set(s,Hf(xm.get(s)||null,n,e,t,i,r)),!0}return!1}function _O(n){var e=wh(n.target);if(e!==null){var t=ng(e);if(t!==null){if(e=t.tag,e===13){if(e=zL(t),e!==null){n.blockedOn=e,XG(n.priority,function(){if(t.tag===13){var i=ds();i=EM(i);var r=gf(t,i);r!==null&&fs(r,t,i),hw(t,i)}});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Ty(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=nE(n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);bT=i,t.target.dispatchEvent(i),bT=null}else return e=mf(t),e!==null&&mO(e),n.blockedOn=t,!1;e.shift()}return!0}function lN(n,e,t){Ty(n)&&t.delete(e)}function nH(){iE=!1,Wl!==null&&Ty(Wl)&&(Wl=null),jl!==null&&Ty(jl)&&(jl=null),ql!==null&&Ty(ql)&&(ql=null),Sm.forEach(lN),xm.forEach(lN)}function r_(n,e){n.blockedOn===e&&(n.blockedOn=null,iE||(iE=!0,Ai.unstable_scheduleCallback(Ai.unstable_NormalPriority,nH)))}var s_=null;function uN(n){s_!==n&&(s_=n,Ai.unstable_scheduleCallback(Ai.unstable_NormalPriority,function(){s_===n&&(s_=null);for(var e=0;e<n.length;e+=3){var t=n[e],i=n[e+1],r=n[e+2];if(typeof i!="function"){if(fw(i||t)===null)continue;break}var s=mf(t);s!==null&&(n.splice(e,3),e-=3,IT(s,{pending:!0,data:r,method:t.method,action:i},i,r))}}))}function Tm(n){function e(l){return r_(l,n)}Wl!==null&&r_(Wl,n),jl!==null&&r_(jl,n),ql!==null&&r_(ql,n),Sm.forEach(e),xm.forEach(e);for(var t=0;t<Pl.length;t++){var i=Pl[t];i.blockedOn===n&&(i.blockedOn=null)}for(;0<Pl.length&&(t=Pl[0],t.blockedOn===null);)_O(t),t.blockedOn===null&&Pl.shift();if(t=(n.ownerDocument||n).$$reactFormReplay,t!=null)for(i=0;i<t.length;i+=3){var r=t[i],s=t[i+1],a=r[Gr]||null;if(typeof s=="function")a||uN(t);else if(a){var o=null;if(s&&s.hasAttribute("formAction")){if(r=s,a=s[Gr]||null)o=a.formAction;else if(fw(r)!==null)continue}else o=a.action;typeof o=="function"?t[i+1]=o:(t.splice(i,3),i-=3),uN(t)}}}function pw(n){this._internalRoot=n}H0.prototype.render=pw.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(ce(409));var t=e.current,i=ds();pO(t,i,n,e,null,null)};H0.prototype.unmount=pw.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;pO(n.current,2,null,n,null,null),k0(),e[pf]=null}};function H0(n){this._internalRoot=n}H0.prototype.unstable_scheduleHydration=function(n){if(n){var e=QL();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Pl.length&&e!==0&&e<Pl[t].priority;t++);Pl.splice(t,0,n),t===0&&_O(n)}};var cN=FL.version;if(cN!=="19.1.1")throw Error(ce(527,cN,"19.1.1"));tn.findDOMNode=function(n){var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(ce(188)):(n=Object.keys(n).join(","),Error(ce(268,n)));return n=LG(e),n=n!==null?GL(n):null,n=n===null?null:n.stateNode,n};var iH={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:gt,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var a_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!a_.isDisabled&&a_.supportsFiber)try{ig=a_.inject(iH),cs=a_}catch{}}A0.createRoot=function(n,e){if(!kL(n))throw Error(ce(299));var t=!1,i="",r=dU,s=fU,a=pU,o=null;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onUncaughtError!==void 0&&(r=e.onUncaughtError),e.onCaughtError!==void 0&&(s=e.onCaughtError),e.onRecoverableError!==void 0&&(a=e.onRecoverableError),e.unstable_transitionCallbacks!==void 0&&(o=e.unstable_transitionCallbacks)),e=dO(n,1,!1,null,null,t,i,r,s,a,o,null),n[pf]=e.current,lw(n),new pw(e)};A0.hydrateRoot=function(n,e,t){if(!kL(n))throw Error(ce(299));var i=!1,r="",s=dU,a=fU,o=pU,l=null,u=null;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onUncaughtError!==void 0&&(s=t.onUncaughtError),t.onCaughtError!==void 0&&(a=t.onCaughtError),t.onRecoverableError!==void 0&&(o=t.onRecoverableError),t.unstable_transitionCallbacks!==void 0&&(l=t.unstable_transitionCallbacks),t.formState!==void 0&&(u=t.formState)),e=dO(n,1,!0,e,t??null,i,r,s,a,o,l,u),e.context=fO(null),t=e.current,i=ds(),i=EM(i),r=Gl(i),r.callback=null,Vl(t,r,i),t=i,e.current.lanes=t,sg(e,t),no(e),n[pf]=e.current,lw(n),new H0(e)};A0.version="19.1.1";function yO(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(yO)}catch(n){console.error(n)}}yO(),LL.exports=A0;var rH=LL.exports;const sH=tg(rH);/**
 * react-router v7.8.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var hN="popstate";function aH(n={}){function e(i,r){let{pathname:s,search:a,hash:o}=i.location;return rE("",{pathname:s,search:a,hash:o},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(i,r){return typeof r=="string"?r:Em(r)}return lH(e,t,null,n)}function Zn(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Wa(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function oH(){return Math.random().toString(36).substring(2,10)}function dN(n,e){return{usr:n.state,key:n.key,idx:e}}function rE(n,e,t=null,i){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?bf(e):e,state:t,key:e&&e.key||i||oH()}}function Em({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function bf(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substring(i),n=n.substring(0,i)),n&&(e.pathname=n)}return e}function lH(n,e,t,i={}){let{window:r=document.defaultView,v5Compat:s=!1}=i,a=r.history,o="POP",l=null,u=c();u==null&&(u=0,a.replaceState({...a.state,idx:u},""));function c(){return(a.state||{idx:null}).idx}function h(){o="POP";let g=c(),p=g==null?null:g-u;u=g,l&&l({action:o,location:_.location,delta:p})}function d(g,p){o="PUSH";let y=rE(_.location,g,p);u=c()+1;let v=dN(y,u),b=_.createHref(y);try{a.pushState(v,"",b)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;r.location.assign(b)}s&&l&&l({action:o,location:_.location,delta:1})}function f(g,p){o="REPLACE";let y=rE(_.location,g,p);u=c();let v=dN(y,u),b=_.createHref(y);a.replaceState(v,"",b),s&&l&&l({action:o,location:_.location,delta:0})}function m(g){return uH(g)}let _={get action(){return o},get location(){return n(r,a)},listen(g){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(hN,h),l=g,()=>{r.removeEventListener(hN,h),l=null}},createHref(g){return e(r,g)},createURL:m,encodeLocation(g){let p=m(g);return{pathname:p.pathname,search:p.search,hash:p.hash}},push:d,replace:f,go(g){return a.go(g)}};return _}function uH(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Zn(t,"No window.location.(origin|href) available to create URL");let i=typeof n=="string"?n:Em(n);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=t+i),new URL(i,t)}function vO(n,e,t="/"){return cH(n,e,t,!1)}function cH(n,e,t,i){let r=typeof e=="string"?bf(e):e,s=el(r.pathname||"/",t);if(s==null)return null;let a=bO(n);hH(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let u=xH(s);o=bH(a[l],u,i)}return o}function bO(n,e=[],t=[],i=""){let r=(s,a,o)=>{let l={relativePath:o===void 0?s.path||"":o,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};l.relativePath.startsWith("/")&&(Zn(l.relativePath.startsWith(i),`Absolute route path "${l.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(i.length));let u=$o([i,l.relativePath]),c=t.concat(l);s.children&&s.children.length>0&&(Zn(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${u}".`),bO(s.children,e,c,u)),!(s.path==null&&!s.index)&&e.push({path:u,score:yH(u,s.index),routesMeta:c})};return n.forEach((s,a)=>{var o;if(s.path===""||!((o=s.path)!=null&&o.includes("?")))r(s,a);else for(let l of SO(s.path))r(s,a,l)}),e}function SO(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,r=t.endsWith("?"),s=t.replace(/\?$/,"");if(i.length===0)return r?[s,""]:[s];let a=SO(i.join("/")),o=[];return o.push(...a.map(l=>l===""?s:[s,l].join("/"))),r&&o.push(...a),o.map(l=>n.startsWith("/")&&l===""?"/":l)}function hH(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:vH(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}var dH=/^:[\w-]+$/,fH=3,pH=2,mH=1,gH=10,_H=-2,fN=n=>n==="*";function yH(n,e){let t=n.split("/"),i=t.length;return t.some(fN)&&(i+=_H),e&&(i+=pH),t.filter(r=>!fN(r)).reduce((r,s)=>r+(dH.test(s)?fH:s===""?mH:gH),i)}function vH(n,e){return n.length===e.length&&n.slice(0,-1).every((i,r)=>i===e[r])?n[n.length-1]-e[e.length-1]:0}function bH(n,e,t=!1){let{routesMeta:i}=n,r={},s="/",a=[];for(let o=0;o<i.length;++o){let l=i[o],u=o===i.length-1,c=s==="/"?e:e.slice(s.length)||"/",h=Mv({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),d=l.route;if(!h&&u&&t&&!i[i.length-1].route.index&&(h=Mv({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},c)),!h)return null;Object.assign(r,h.params),a.push({params:r,pathname:$o([s,h.pathname]),pathnameBase:wH($o([s,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(s=$o([s,h.pathnameBase]))}return a}function Mv(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=SH(n.path,n.caseSensitive,n.end),r=e.match(t);if(!r)return null;let s=r[0],a=s.replace(/(.)\/+$/,"$1"),o=r.slice(1);return{params:i.reduce((u,{paramName:c,isOptional:h},d)=>{if(c==="*"){let m=o[d]||"";a=s.slice(0,s.length-m.length).replace(/(.)\/+$/,"$1")}const f=o[d];return h&&!f?u[c]=void 0:u[c]=(f||"").replace(/%2F/g,"/"),u},{}),pathname:s,pathnameBase:a,pattern:n}}function SH(n,e=!1,t=!0){Wa(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let i=[],r="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(i.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(i.push({paramName:"*"}),r+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":n!==""&&n!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function xH(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Wa(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function el(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}function TH(n,e="/"){let{pathname:t,search:i="",hash:r=""}=typeof n=="string"?bf(n):n;return{pathname:t?t.startsWith("/")?t:EH(t,e):e,search:AH(i),hash:RH(r)}}function EH(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function pS(n,e,t,i){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function MH(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function xO(n){let e=MH(n);return e.map((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)}function TO(n,e,t,i=!1){let r;typeof n=="string"?r=bf(n):(r={...n},Zn(!r.pathname||!r.pathname.includes("?"),pS("?","pathname","search",r)),Zn(!r.pathname||!r.pathname.includes("#"),pS("#","pathname","hash",r)),Zn(!r.search||!r.search.includes("#"),pS("#","search","hash",r)));let s=n===""||r.pathname==="",a=s?"/":r.pathname,o;if(a==null)o=t;else{let h=e.length-1;if(!i&&a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),h-=1;r.pathname=d.join("/")}o=h>=0?e[h]:"/"}let l=TH(r,o),u=a&&a!=="/"&&a.endsWith("/"),c=(s||a===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}var $o=n=>n.join("/").replace(/\/\/+/g,"/"),wH=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),AH=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,RH=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function NH(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var EO=["POST","PUT","PATCH","DELETE"];new Set(EO);var CH=["GET",...EO];new Set(CH);var Sf=ne.createContext(null);Sf.displayName="DataRouter";var $0=ne.createContext(null);$0.displayName="DataRouterState";ne.createContext(!1);var MO=ne.createContext({isTransitioning:!1});MO.displayName="ViewTransition";var DH=ne.createContext(new Map);DH.displayName="Fetchers";var LH=ne.createContext(null);LH.displayName="Await";var io=ne.createContext(null);io.displayName="Navigation";var yg=ne.createContext(null);yg.displayName="Location";var rl=ne.createContext({outlet:null,matches:[],isDataRoute:!1});rl.displayName="Route";var mw=ne.createContext(null);mw.displayName="RouteError";function PH(n,{relative:e}={}){Zn(vg(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:i}=ne.useContext(io),{hash:r,pathname:s,search:a}=bg(n,{relative:e}),o=s;return t!=="/"&&(o=s==="/"?t:$o([t,s])),i.createHref({pathname:o,search:a,hash:r})}function vg(){return ne.useContext(yg)!=null}function Rc(){return Zn(vg(),"useLocation() may be used only in the context of a <Router> component."),ne.useContext(yg).location}var wO="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function AO(n){ne.useContext(io).static||ne.useLayoutEffect(n)}function UH(){let{isDataRoute:n}=ne.useContext(rl);return n?qH():OH()}function OH(){Zn(vg(),"useNavigate() may be used only in the context of a <Router> component.");let n=ne.useContext(Sf),{basename:e,navigator:t}=ne.useContext(io),{matches:i}=ne.useContext(rl),{pathname:r}=Rc(),s=JSON.stringify(xO(i)),a=ne.useRef(!1);return AO(()=>{a.current=!0}),ne.useCallback((l,u={})=>{if(Wa(a.current,wO),!a.current)return;if(typeof l=="number"){t.go(l);return}let c=TO(l,JSON.parse(s),r,u.relative==="path");n==null&&e!=="/"&&(c.pathname=c.pathname==="/"?e:$o([e,c.pathname])),(u.replace?t.replace:t.push)(c,u.state,u)},[e,t,s,r,n])}ne.createContext(null);function bg(n,{relative:e}={}){let{matches:t}=ne.useContext(rl),{pathname:i}=Rc(),r=JSON.stringify(xO(t));return ne.useMemo(()=>TO(n,JSON.parse(r),i,e==="path"),[n,r,i,e])}function IH(n,e){return RO(n,e)}function RO(n,e,t,i){var p;Zn(vg(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=ne.useContext(io),{matches:s}=ne.useContext(rl),a=s[s.length-1],o=a?a.params:{},l=a?a.pathname:"/",u=a?a.pathnameBase:"/",c=a&&a.route;{let y=c&&c.path||"";NO(l,!c||y.endsWith("*")||y.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${y}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${y}"> to <Route path="${y==="/"?"*":`${y}/*`}">.`)}let h=Rc(),d;if(e){let y=typeof e=="string"?bf(e):e;Zn(u==="/"||((p=y.pathname)==null?void 0:p.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${y.pathname}" was given in the \`location\` prop.`),d=y}else d=h;let f=d.pathname||"/",m=f;if(u!=="/"){let y=u.replace(/^\//,"").split("/");m="/"+f.replace(/^\//,"").split("/").slice(y.length).join("/")}let _=vO(n,{pathname:m});Wa(c||_!=null,`No routes matched location "${d.pathname}${d.search}${d.hash}" `),Wa(_==null||_[_.length-1].route.element!==void 0||_[_.length-1].route.Component!==void 0||_[_.length-1].route.lazy!==void 0,`Matched leaf route at location "${d.pathname}${d.search}${d.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let g=GH(_&&_.map(y=>Object.assign({},y,{params:Object.assign({},o,y.params),pathname:$o([u,r.encodeLocation?r.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?u:$o([u,r.encodeLocation?r.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),s,t,i);return e&&g?ne.createElement(yg.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...d},navigationType:"POP"}},g):g}function BH(){let n=jH(),e=NH(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:i},s={padding:"2px 4px",backgroundColor:i},a=null;return console.error("Error handled by React Router default ErrorBoundary:",n),a=ne.createElement(ne.Fragment,null,ne.createElement("p",null,"💿 Hey developer 👋"),ne.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ne.createElement("code",{style:s},"ErrorBoundary")," or"," ",ne.createElement("code",{style:s},"errorElement")," prop on your route.")),ne.createElement(ne.Fragment,null,ne.createElement("h2",null,"Unexpected Application Error!"),ne.createElement("h3",{style:{fontStyle:"italic"}},e),t?ne.createElement("pre",{style:r},t):null,a)}var FH=ne.createElement(BH,null),kH=class extends ne.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){console.error("React Router caught the following error during render",n,e)}render(){return this.state.error!==void 0?ne.createElement(rl.Provider,{value:this.props.routeContext},ne.createElement(mw.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function zH({routeContext:n,match:e,children:t}){let i=ne.useContext(Sf);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),ne.createElement(rl.Provider,{value:n},t)}function GH(n,e=[],t=null,i=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let r=n,s=t==null?void 0:t.errors;if(s!=null){let l=r.findIndex(u=>u.route.id&&(s==null?void 0:s[u.route.id])!==void 0);Zn(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),r=r.slice(0,Math.min(r.length,l+1))}let a=!1,o=-1;if(t)for(let l=0;l<r.length;l++){let u=r[l];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(o=l),u.route.id){let{loaderData:c,errors:h}=t,d=u.route.loader&&!c.hasOwnProperty(u.route.id)&&(!h||h[u.route.id]===void 0);if(u.route.lazy||d){a=!0,o>=0?r=r.slice(0,o+1):r=[r[0]];break}}}return r.reduceRight((l,u,c)=>{let h,d=!1,f=null,m=null;t&&(h=s&&u.route.id?s[u.route.id]:void 0,f=u.route.errorElement||FH,a&&(o<0&&c===0?(NO("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),d=!0,m=null):o===c&&(d=!0,m=u.route.hydrateFallbackElement||null)));let _=e.concat(r.slice(0,c+1)),g=()=>{let p;return h?p=f:d?p=m:u.route.Component?p=ne.createElement(u.route.Component,null):u.route.element?p=u.route.element:p=l,ne.createElement(zH,{match:u,routeContext:{outlet:l,matches:_,isDataRoute:t!=null},children:p})};return t&&(u.route.ErrorBoundary||u.route.errorElement||c===0)?ne.createElement(kH,{location:t.location,revalidation:t.revalidation,component:f,error:h,children:g(),routeContext:{outlet:null,matches:_,isDataRoute:!0}}):g()},null)}function gw(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function VH(n){let e=ne.useContext(Sf);return Zn(e,gw(n)),e}function HH(n){let e=ne.useContext($0);return Zn(e,gw(n)),e}function $H(n){let e=ne.useContext(rl);return Zn(e,gw(n)),e}function _w(n){let e=$H(n),t=e.matches[e.matches.length-1];return Zn(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function WH(){return _w("useRouteId")}function jH(){var i;let n=ne.useContext(mw),e=HH("useRouteError"),t=_w("useRouteError");return n!==void 0?n:(i=e.errors)==null?void 0:i[t]}function qH(){let{router:n}=VH("useNavigate"),e=_w("useNavigate"),t=ne.useRef(!1);return AO(()=>{t.current=!0}),ne.useCallback(async(r,s={})=>{Wa(t.current,wO),t.current&&(typeof r=="number"?n.navigate(r):await n.navigate(r,{fromRouteId:e,...s}))},[n,e])}var pN={};function NO(n,e,t){!e&&!pN[n]&&(pN[n]=!0,Wa(!1,t))}ne.memo(XH);function XH({routes:n,future:e,state:t}){return RO(n,void 0,t,e)}function sE(n){Zn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function YH({basename:n="/",children:e=null,location:t,navigationType:i="POP",navigator:r,static:s=!1}){Zn(!vg(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=n.replace(/^\/*/,"/"),o=ne.useMemo(()=>({basename:a,navigator:r,static:s,future:{}}),[a,r,s]);typeof t=="string"&&(t=bf(t));let{pathname:l="/",search:u="",hash:c="",state:h=null,key:d="default"}=t,f=ne.useMemo(()=>{let m=el(l,a);return m==null?null:{location:{pathname:m,search:u,hash:c,state:h,key:d},navigationType:i}},[a,l,u,c,h,d,i]);return Wa(f!=null,`<Router basename="${a}"> is not able to match the URL "${l}${u}${c}" because it does not start with the basename, so the <Router> won't render anything.`),f==null?null:ne.createElement(io.Provider,{value:o},ne.createElement(yg.Provider,{children:e,value:f}))}function KH({children:n,location:e}){return IH(aE(n),e)}function aE(n,e=[]){let t=[];return ne.Children.forEach(n,(i,r)=>{if(!ne.isValidElement(i))return;let s=[...e,r];if(i.type===ne.Fragment){t.push.apply(t,aE(i.props.children,s));return}Zn(i.type===sE,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Zn(!i.props.index||!i.props.children,"An index route cannot have child routes.");let a={id:i.props.id||s.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(a.children=aE(i.props.children,s)),t.push(a)}),t}var Ey="get",My="application/x-www-form-urlencoded";function W0(n){return n!=null&&typeof n.tagName=="string"}function QH(n){return W0(n)&&n.tagName.toLowerCase()==="button"}function ZH(n){return W0(n)&&n.tagName.toLowerCase()==="form"}function JH(n){return W0(n)&&n.tagName.toLowerCase()==="input"}function e6(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function t6(n,e){return n.button===0&&(!e||e==="_self")&&!e6(n)}var o_=null;function n6(){if(o_===null)try{new FormData(document.createElement("form"),0),o_=!1}catch{o_=!0}return o_}var i6=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function mS(n){return n!=null&&!i6.has(n)?(Wa(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${My}"`),null):n}function r6(n,e){let t,i,r,s,a;if(ZH(n)){let o=n.getAttribute("action");i=o?el(o,e):null,t=n.getAttribute("method")||Ey,r=mS(n.getAttribute("enctype"))||My,s=new FormData(n)}else if(QH(n)||JH(n)&&(n.type==="submit"||n.type==="image")){let o=n.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=n.getAttribute("formaction")||o.getAttribute("action");if(i=l?el(l,e):null,t=n.getAttribute("formmethod")||o.getAttribute("method")||Ey,r=mS(n.getAttribute("formenctype"))||mS(o.getAttribute("enctype"))||My,s=new FormData(o,n),!n6()){let{name:u,type:c,value:h}=n;if(c==="image"){let d=u?`${u}.`:"";s.append(`${d}x`,"0"),s.append(`${d}y`,"0")}else u&&s.append(u,h)}}else{if(W0(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Ey,i=null,r=My,a=n}return s&&r==="text/plain"&&(a=s,s=void 0),{action:i,method:t.toLowerCase(),encType:r,formData:s,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function yw(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function s6(n,e,t){let i=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return i.pathname==="/"?i.pathname=`_root.${t}`:e&&el(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${t}`,i}async function a6(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function o6(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function l6(n,e,t){let i=await Promise.all(n.map(async r=>{let s=e.routes[r.route.id];if(s){let a=await a6(s,t);return a.links?a.links():[]}return[]}));return d6(i.flat(1).filter(o6).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function mN(n,e,t,i,r,s){let a=(l,u)=>t[u]?l.route.id!==t[u].route.id:!0,o=(l,u)=>{var c;return t[u].pathname!==l.pathname||((c=t[u].route.path)==null?void 0:c.endsWith("*"))&&t[u].params["*"]!==l.params["*"]};return s==="assets"?e.filter((l,u)=>a(l,u)||o(l,u)):s==="data"?e.filter((l,u)=>{var h;let c=i.routes[l.route.id];if(!c||!c.hasLoader)return!1;if(a(l,u)||o(l,u))return!0;if(l.route.shouldRevalidate){let d=l.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:((h=t[0])==null?void 0:h.params)||{},nextUrl:new URL(n,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof d=="boolean")return d}return!0}):[]}function u6(n,e,{includeHydrateFallback:t}={}){return c6(n.map(i=>{let r=e.routes[i.route.id];if(!r)return[];let s=[r.module];return r.clientActionModule&&(s=s.concat(r.clientActionModule)),r.clientLoaderModule&&(s=s.concat(r.clientLoaderModule)),t&&r.hydrateFallbackModule&&(s=s.concat(r.hydrateFallbackModule)),r.imports&&(s=s.concat(r.imports)),s}).flat(1))}function c6(n){return[...new Set(n)]}function h6(n){let e={},t=Object.keys(n).sort();for(let i of t)e[i]=n[i];return e}function d6(n,e){let t=new Set;return new Set(e),n.reduce((i,r)=>{let s=JSON.stringify(h6(r));return t.has(s)||(t.add(s),i.push({key:s,link:r})),i},[])}function CO(){let n=ne.useContext(Sf);return yw(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function f6(){let n=ne.useContext($0);return yw(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var vw=ne.createContext(void 0);vw.displayName="FrameworkContext";function DO(){let n=ne.useContext(vw);return yw(n,"You must render this element inside a <HydratedRouter> element"),n}function p6(n,e){let t=ne.useContext(vw),[i,r]=ne.useState(!1),[s,a]=ne.useState(!1),{onFocus:o,onBlur:l,onMouseEnter:u,onMouseLeave:c,onTouchStart:h}=e,d=ne.useRef(null);ne.useEffect(()=>{if(n==="render"&&a(!0),n==="viewport"){let _=p=>{p.forEach(y=>{a(y.isIntersecting)})},g=new IntersectionObserver(_,{threshold:.5});return d.current&&g.observe(d.current),()=>{g.disconnect()}}},[n]),ne.useEffect(()=>{if(i){let _=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(_)}}},[i]);let f=()=>{r(!0)},m=()=>{r(!1),a(!1)};return t?n!=="intent"?[s,d,{}]:[s,d,{onFocus:$f(o,f),onBlur:$f(l,m),onMouseEnter:$f(u,f),onMouseLeave:$f(c,m),onTouchStart:$f(h,f)}]:[!1,d,{}]}function $f(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function m6({page:n,...e}){let{router:t}=CO(),i=ne.useMemo(()=>vO(t.routes,n,t.basename),[t.routes,n,t.basename]);return i?ne.createElement(_6,{page:n,matches:i,...e}):null}function g6(n){let{manifest:e,routeModules:t}=DO(),[i,r]=ne.useState([]);return ne.useEffect(()=>{let s=!1;return l6(n,e,t).then(a=>{s||r(a)}),()=>{s=!0}},[n,e,t]),i}function _6({page:n,matches:e,...t}){let i=Rc(),{manifest:r,routeModules:s}=DO(),{basename:a}=CO(),{loaderData:o,matches:l}=f6(),u=ne.useMemo(()=>mN(n,e,l,r,i,"data"),[n,e,l,r,i]),c=ne.useMemo(()=>mN(n,e,l,r,i,"assets"),[n,e,l,r,i]),h=ne.useMemo(()=>{if(n===i.pathname+i.search+i.hash)return[];let m=new Set,_=!1;if(e.forEach(p=>{var v;let y=r.routes[p.route.id];!y||!y.hasLoader||(!u.some(b=>b.route.id===p.route.id)&&p.route.id in o&&((v=s[p.route.id])!=null&&v.shouldRevalidate)||y.hasClientLoader?_=!0:m.add(p.route.id))}),m.size===0)return[];let g=s6(n,a,"data");return _&&m.size>0&&g.searchParams.set("_routes",e.filter(p=>m.has(p.route.id)).map(p=>p.route.id).join(",")),[g.pathname+g.search]},[a,o,i,r,u,e,n,s]),d=ne.useMemo(()=>u6(c,r),[c,r]),f=g6(c);return ne.createElement(ne.Fragment,null,h.map(m=>ne.createElement("link",{key:m,rel:"prefetch",as:"fetch",href:m,...t})),d.map(m=>ne.createElement("link",{key:m,rel:"modulepreload",href:m,...t})),f.map(({key:m,link:_})=>ne.createElement("link",{key:m,nonce:t.nonce,..._})))}function y6(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var LO=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{LO&&(window.__reactRouterVersion="7.8.0")}catch{}function v6({basename:n,children:e,window:t}){let i=ne.useRef();i.current==null&&(i.current=aH({window:t,v5Compat:!0}));let r=i.current,[s,a]=ne.useState({action:r.action,location:r.location}),o=ne.useCallback(l=>{ne.startTransition(()=>a(l))},[a]);return ne.useLayoutEffect(()=>r.listen(o),[r,o]),ne.createElement(YH,{basename:n,children:e,location:s.location,navigationType:s.action,navigator:r})}var PO=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,bw=ne.forwardRef(function({onClick:e,discover:t="render",prefetch:i="none",relative:r,reloadDocument:s,replace:a,state:o,target:l,to:u,preventScrollReset:c,viewTransition:h,...d},f){let{basename:m}=ne.useContext(io),_=typeof u=="string"&&PO.test(u),g,p=!1;if(typeof u=="string"&&_&&(g=u,LO))try{let E=new URL(window.location.href),M=u.startsWith("//")?new URL(E.protocol+u):new URL(u),N=el(M.pathname,m);M.origin===E.origin&&N!=null?u=N+M.search+M.hash:p=!0}catch{Wa(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let y=PH(u,{relative:r}),[v,b,S]=p6(i,d),x=x6(u,{replace:a,state:o,target:l,preventScrollReset:c,relative:r,viewTransition:h});function T(E){e&&e(E),E.defaultPrevented||x(E)}let w=ne.createElement("a",{...d,...S,href:g||y,onClick:p||s?e:T,ref:y6(f,b),target:l,"data-discover":!_&&t==="render"?"true":void 0});return v&&!_?ne.createElement(ne.Fragment,null,w,ne.createElement(m6,{page:y})):w});bw.displayName="Link";var UO=ne.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:i="",end:r=!1,style:s,to:a,viewTransition:o,children:l,...u},c){let h=bg(a,{relative:u.relative}),d=Rc(),f=ne.useContext($0),{navigator:m,basename:_}=ne.useContext(io),g=f!=null&&A6(h)&&o===!0,p=m.encodeLocation?m.encodeLocation(h).pathname:h.pathname,y=d.pathname,v=f&&f.navigation&&f.navigation.location?f.navigation.location.pathname:null;t||(y=y.toLowerCase(),v=v?v.toLowerCase():null,p=p.toLowerCase()),v&&_&&(v=el(v,_)||v);const b=p!=="/"&&p.endsWith("/")?p.length-1:p.length;let S=y===p||!r&&y.startsWith(p)&&y.charAt(b)==="/",x=v!=null&&(v===p||!r&&v.startsWith(p)&&v.charAt(p.length)==="/"),T={isActive:S,isPending:x,isTransitioning:g},w=S?e:void 0,E;typeof i=="function"?E=i(T):E=[i,S?"active":null,x?"pending":null,g?"transitioning":null].filter(Boolean).join(" ");let M=typeof s=="function"?s(T):s;return ne.createElement(bw,{...u,"aria-current":w,className:E,ref:c,style:M,to:a,viewTransition:o},typeof l=="function"?l(T):l)});UO.displayName="NavLink";var b6=ne.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:i,replace:r,state:s,method:a=Ey,action:o,onSubmit:l,relative:u,preventScrollReset:c,viewTransition:h,...d},f)=>{let m=M6(),_=w6(o,{relative:u}),g=a.toLowerCase()==="get"?"get":"post",p=typeof o=="string"&&PO.test(o),y=v=>{if(l&&l(v),v.defaultPrevented)return;v.preventDefault();let b=v.nativeEvent.submitter,S=(b==null?void 0:b.getAttribute("formmethod"))||a;m(b||v.currentTarget,{fetcherKey:e,method:S,navigate:t,replace:r,state:s,relative:u,preventScrollReset:c,viewTransition:h})};return ne.createElement("form",{ref:f,method:g,action:_,onSubmit:i?l:y,...d,"data-discover":!p&&n==="render"?"true":void 0})});b6.displayName="Form";function S6(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function OO(n){let e=ne.useContext(Sf);return Zn(e,S6(n)),e}function x6(n,{target:e,replace:t,state:i,preventScrollReset:r,relative:s,viewTransition:a}={}){let o=UH(),l=Rc(),u=bg(n,{relative:s});return ne.useCallback(c=>{if(t6(c,e)){c.preventDefault();let h=t!==void 0?t:Em(l)===Em(u);o(n,{replace:h,state:i,preventScrollReset:r,relative:s,viewTransition:a})}},[l,o,u,t,i,e,n,r,s,a])}var T6=0,E6=()=>`__${String(++T6)}__`;function M6(){let{router:n}=OO("useSubmit"),{basename:e}=ne.useContext(io),t=WH();return ne.useCallback(async(i,r={})=>{let{action:s,method:a,encType:o,formData:l,body:u}=r6(i,e);if(r.navigate===!1){let c=r.fetcherKey||E6();await n.fetch(c,t,r.action||s,{preventScrollReset:r.preventScrollReset,formData:l,body:u,formMethod:r.method||a,formEncType:r.encType||o,flushSync:r.flushSync})}else await n.navigate(r.action||s,{preventScrollReset:r.preventScrollReset,formData:l,body:u,formMethod:r.method||a,formEncType:r.encType||o,replace:r.replace,state:r.state,fromRouteId:t,flushSync:r.flushSync,viewTransition:r.viewTransition})},[n,e,t])}function w6(n,{relative:e}={}){let{basename:t}=ne.useContext(io),i=ne.useContext(rl);Zn(i,"useFormAction must be used inside a RouteContext");let[r]=i.matches.slice(-1),s={...bg(n||".",{relative:e})},a=Rc();if(n==null){s.search=a.search;let o=new URLSearchParams(s.search),l=o.getAll("index");if(l.some(c=>c==="")){o.delete("index"),l.filter(h=>h).forEach(h=>o.append("index",h));let c=o.toString();s.search=c?`?${c}`:""}}return(!n||n===".")&&r.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(s.pathname=s.pathname==="/"?t:$o([t,s.pathname])),Em(s)}function A6(n,{relative:e}={}){let t=ne.useContext(MO);Zn(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=OO("useViewTransitionState"),r=bg(n,{relative:e});if(!t.isTransitioning)return!1;let s=el(t.currentLocation.pathname,i)||t.currentLocation.pathname,a=el(t.nextLocation.pathname,i)||t.nextLocation.pathname;return Mv(r.pathname,a)!=null||Mv(r.pathname,s)!=null}function R6(){return Tt.jsxs(Tt.Fragment,{children:[Tt.jsx("a",{href:"#main",className:`sr-only focus:not-sr-only absolute left-2 top-2 z-[100]
                   rounded-md bg-black text-white px-3 py-1 text-sm
                   focus:outline-none focus:ring-2 focus:ring-brand/40`,children:"Skip to content"}),Tt.jsx("header",{className:"sticky top-0 z-40 backdrop-blur bg-white/70 dark:bg-slate-900/80 border-b border-black/5 dark:border-white/10",children:Tt.jsxs("div",{className:"container mx-auto px-4 h-14 flex items-center justify-between",children:[Tt.jsxs(bw,{to:"/",className:"flex items-center gap-2 font-bold tracking-tight",children:[Tt.jsx("span",{className:"inline-flex h-7 w-7 items-center justify-center rounded-lg bg-brand text-white text-xs shadow-soft",children:"JC"}),Tt.jsx("span",{className:"hidden sm:inline",children:"Jacob Curtis"})]}),Tt.jsxs("nav",{className:"flex items-center gap-2",children:[Tt.jsx(gN,{to:"/",children:"Blog"}),Tt.jsx(gN,{to:"/career",children:"Career"})]})]})})]})}function gN({to:n,children:e}){return Tt.jsx(UO,{to:n,end:!0,className:({isActive:t})=>["inline-flex items-center h-9 rounded-full px-3 text-sm transition","border border-black/10 dark:border-white/10","hover:bg-black/5 dark:hover:bg-white/5 focus:outline-none focus:ring-2 focus:ring-brand/40",t?"bg-black/5 dark:bg-white/5 font-semibold":"text-slate-700 dark:text-slate-200"].join(" "),children:e})}function N6(){return Tt.jsx("footer",{className:"border-t border-black/5 dark:border-white/10",children:Tt.jsx("div",{className:"container mx-auto px-4 py-8 flex flex-col sm:flex-row items-center justify-between gap-4 text-sm text-muted",children:Tt.jsxs("p",{className:"order-2 sm:order-1",children:["© ",new Date().getFullYear()," Jacob Curtis"]})})})}function C6({children:n}){return Tt.jsxs("div",{className:"min-h-dvh flex flex-col",children:[Tt.jsx(R6,{}),Tt.jsx("main",{className:"flex-1 container mx-auto px-4 py-10",children:n}),Tt.jsx(N6,{})]})}function D6(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(i=s.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}function L6(n,e,t){return e=z6(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function _N(n,e){return O6(n)||D6(n,e)||IO(n,e)||F6()}function P6(n){return U6(n)||I6(n)||IO(n)||B6()}function U6(n){if(Array.isArray(n))return oE(n)}function O6(n){if(Array.isArray(n))return n}function I6(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function IO(n,e){if(n){if(typeof n=="string")return oE(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return oE(n,e)}}function oE(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=n[t];return i}function B6(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function F6(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function k6(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function z6(n){var e=k6(n,"string");return typeof e=="symbol"?e:String(e)}var G6=function(e,t){var i=new Set(t);return Object.assign.apply(Object,[{}].concat(P6(Object.entries(e).filter(function(r){var s=_N(r,1),a=s[0];return!i.has(a)}).map(function(r){var s=_N(r,2),a=s[0],o=s[1];return L6({},a,o)}))))};function lE(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function V6(n){if(Array.isArray(n))return n}function H6(n){if(Array.isArray(n))return lE(n)}function $6(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function W6(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(i=s.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}function j6(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function q6(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function X6(n,e){return V6(n)||W6(n,e)||BO(n,e)||j6()}function yN(n){return H6(n)||$6(n)||BO(n)||q6()}function BO(n,e){if(n){if(typeof n=="string")return lE(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?lE(n,e):void 0}}function Y6(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.wrapperElementType,i=t===void 0?"div":t,r=e.nodeMapper,s=r===void 0?function(c){return c}:r,a=e.methodNames,o=a===void 0?[]:a,l=e.initPropNames,u=l===void 0?[]:l;return ne.forwardRef(function(c,h){var d=ne.useRef(),f=ne.useMemo(function(){var g=Object.fromEntries(u.filter(function(p){return c.hasOwnProperty(p)}).map(function(p){return[p,c[p]]}));return n(g)},[]);vN(function(){f(s(d.current))},ne.useLayoutEffect),vN(function(){return f._destructor instanceof Function?f._destructor:void 0});var m=ne.useCallback(function(g){for(var p=arguments.length,y=new Array(p>1?p-1:0),v=1;v<p;v++)y[v-1]=arguments[v];return f[g]instanceof Function?f[g].apply(f,y):void 0},[f]),_=ne.useRef({});return Object.keys(G6(c,[].concat(yN(o),yN(u)))).filter(function(g){return _.current[g]!==c[g]}).forEach(function(g){return m(g,c[g])}),_.current=c,ne.useImperativeHandle(h,function(){return Object.fromEntries(o.map(function(g){return[g,function(){for(var p=arguments.length,y=new Array(p),v=0;v<p;v++)y[v]=arguments[v];return m.apply(void 0,[g].concat(y))}]}))},[m]),DL.createElement(i,{ref:d})})}function vN(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ne.useEffect,t=ne.useRef(),i=ne.useRef(!1),r=ne.useRef(!1),s=ne.useState(0),a=X6(s,2);a[0];var o=a[1];i.current&&(r.current=!0),e(function(){return i.current||(t.current=n(),i.current=!0),o(function(l){return l+1}),function(){r.current&&t.current&&t.current()}},[])}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const xf="180",Hi={ROTATE:0,DOLLY:1,PAN:2},Fo={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},FO=0,uE=1,kO=2,K6=0,Sw=1,Q6=2,os=3,ps=0,bn=1,Qi=2,kr=0,ms=1,Td=2,Ed=3,Md=4,Jh=5,Zi=100,xw=101,Tw=102,zO=103,GO=104,To=200,Ew=201,Mw=202,ww=203,Mm=204,wm=205,Aw=206,Rw=207,Nw=208,Cw=209,Dw=210,Z6=211,J6=212,e8=213,t8=214,Am=0,Rm=1,Nm=2,iu=3,Cm=4,Dm=5,Lm=6,Pm=7,Sg=0,VO=1,HO=2,zr=0,$O=1,WO=2,jO=3,qO=4,n8=5,XO=6,YO=7,Lw=300,ja=301,qa=302,wd=303,Ad=304,pc=306,mc=1e3,Ia=1001,gc=1002,Ln=1003,Pw=1004,ko=1005,wi=1006,ed=1007,Ir=1008,Kn=1009,sc=1010,ac=1011,la=1012,Oi=1013,wn=1014,li=1015,Fi=1016,j0=1017,q0=1018,gs=1020,X0=35902,Y0=35899,Uw=1021,xg=1022,ii=1023,_s=1026,ys=1027,Tg=1028,Tf=1029,zo=1030,Ef=1031,i8=1032,Mf=1033,Xl=33776,Yl=33777,Kl=33778,Ql=33779,Um=35840,Om=35841,Im=35842,Bm=35843,Rd=36196,Nd=37492,Cd=37496,Dd=37808,Ld=37809,Pd=37810,Ud=37811,Od=37812,Id=37813,Bd=37814,Fd=37815,kd=37816,zd=37817,Gd=37818,Vd=37819,Hd=37820,$d=37821,Wd=36492,cE=36494,hE=36495,jd=36283,qd=36284,Xd=36285,Yd=36286,r8=3200,s8=3201,tl=0,KO=1,Or="",hr="srgb",_c="srgb-linear",Kd="linear",Re="srgb",a8=0,zu=7680,o8=7681,l8=7682,u8=7683,c8=34055,h8=34056,d8=5386,f8=512,p8=513,m8=514,g8=515,_8=516,y8=517,v8=518,dE=519,Ow=512,K0=513,Iw=514,Q0=515,Bw=516,Fw=517,kw=518,zw=519,wv=35044,Ih=35048,bN="300 es",br=2e3,ru=2001,Bh={COMPUTE:"compute",RENDER:"render"};class sl{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return i===void 0?!1:i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners;if(i===void 0)return;const r=i[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const i=t[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,a=r.length;s<a;s++)r[s].call(this,e);e.target=null}}}const qi=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let SN=1234567;const Zp=Math.PI/180,yc=180/Math.PI;function Wo(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(qi[n&255]+qi[n>>8&255]+qi[n>>16&255]+qi[n>>24&255]+"-"+qi[e&255]+qi[e>>8&255]+"-"+qi[e>>16&15|64]+qi[e>>24&255]+"-"+qi[t&63|128]+qi[t>>8&255]+"-"+qi[t>>16&255]+qi[t>>24&255]+qi[i&255]+qi[i>>8&255]+qi[i>>16&255]+qi[i>>24&255]).toLowerCase()}function Mt(n,e,t){return Math.max(e,Math.min(t,n))}function Gw(n,e){return(n%e+e)%e}function b8(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)}function S8(n,e,t){return n!==e?(t-n)/(e-n):0}function Jp(n,e,t){return(1-t)*n+t*e}function x8(n,e,t,i){return Jp(n,e,1-Math.exp(-t*i))}function T8(n,e=1){return e-Math.abs(Gw(n,e*2)-e)}function E8(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function M8(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function w8(n,e){return n+Math.floor(Math.random()*(e-n+1))}function A8(n,e){return n+Math.random()*(e-n)}function R8(n){return n*(.5-Math.random())}function N8(n){n!==void 0&&(SN=n);let e=SN+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function C8(n){return n*Zp}function D8(n){return n*yc}function L8(n){return(n&n-1)===0&&n!==0}function P8(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function U8(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function O8(n,e,t,i,r){const s=Math.cos,a=Math.sin,o=s(t/2),l=a(t/2),u=s((e+i)/2),c=a((e+i)/2),h=s((e-i)/2),d=a((e-i)/2),f=s((i-e)/2),m=a((i-e)/2);switch(r){case"XYX":n.set(o*c,l*h,l*d,o*u);break;case"YZY":n.set(l*d,o*c,l*h,o*u);break;case"ZXZ":n.set(l*h,l*d,o*c,o*u);break;case"XZX":n.set(o*c,l*m,l*f,o*u);break;case"YXY":n.set(l*f,o*c,l*m,o*u);break;case"ZYZ":n.set(l*m,l*f,o*c,o*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function mr(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Et(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const Av={DEG2RAD:Zp,RAD2DEG:yc,generateUUID:Wo,clamp:Mt,euclideanModulo:Gw,mapLinear:b8,inverseLerp:S8,lerp:Jp,damp:x8,pingpong:T8,smoothstep:E8,smootherstep:M8,randInt:w8,randFloat:A8,randFloatSpread:R8,seededRandom:N8,degToRad:C8,radToDeg:D8,isPowerOfTwo:L8,ceilPowerOfTwo:P8,floorPowerOfTwo:U8,setQuaternionFromProperEuler:O8,normalize:Et,denormalize:mr};class fe{constructor(e=0,t=0){fe.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Mt(this.x,e.x,t.x),this.y=Mt(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Mt(this.x,e,t),this.y=Mt(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Mt(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Mt(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,a=this.y-e.y;return this.x=s*i-a*r+e.x,this.y=s*r+a*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class da{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,a,o){let l=i[r+0],u=i[r+1],c=i[r+2],h=i[r+3];const d=s[a+0],f=s[a+1],m=s[a+2],_=s[a+3];if(o===0){e[t+0]=l,e[t+1]=u,e[t+2]=c,e[t+3]=h;return}if(o===1){e[t+0]=d,e[t+1]=f,e[t+2]=m,e[t+3]=_;return}if(h!==_||l!==d||u!==f||c!==m){let g=1-o;const p=l*d+u*f+c*m+h*_,y=p>=0?1:-1,v=1-p*p;if(v>Number.EPSILON){const S=Math.sqrt(v),x=Math.atan2(S,p*y);g=Math.sin(g*x)/S,o=Math.sin(o*x)/S}const b=o*y;if(l=l*g+d*b,u=u*g+f*b,c=c*g+m*b,h=h*g+_*b,g===1-o){const S=1/Math.sqrt(l*l+u*u+c*c+h*h);l*=S,u*=S,c*=S,h*=S}}e[t]=l,e[t+1]=u,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,r,s,a){const o=i[r],l=i[r+1],u=i[r+2],c=i[r+3],h=s[a],d=s[a+1],f=s[a+2],m=s[a+3];return e[t]=o*m+c*h+l*f-u*d,e[t+1]=l*m+c*d+u*h-o*f,e[t+2]=u*m+c*f+o*d-l*h,e[t+3]=c*m-o*h-l*d-u*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,r=e._y,s=e._z,a=e._order,o=Math.cos,l=Math.sin,u=o(i/2),c=o(r/2),h=o(s/2),d=l(i/2),f=l(r/2),m=l(s/2);switch(a){case"XYZ":this._x=d*c*h+u*f*m,this._y=u*f*h-d*c*m,this._z=u*c*m+d*f*h,this._w=u*c*h-d*f*m;break;case"YXZ":this._x=d*c*h+u*f*m,this._y=u*f*h-d*c*m,this._z=u*c*m-d*f*h,this._w=u*c*h+d*f*m;break;case"ZXY":this._x=d*c*h-u*f*m,this._y=u*f*h+d*c*m,this._z=u*c*m+d*f*h,this._w=u*c*h-d*f*m;break;case"ZYX":this._x=d*c*h-u*f*m,this._y=u*f*h+d*c*m,this._z=u*c*m-d*f*h,this._w=u*c*h+d*f*m;break;case"YZX":this._x=d*c*h+u*f*m,this._y=u*f*h+d*c*m,this._z=u*c*m-d*f*h,this._w=u*c*h-d*f*m;break;case"XZY":this._x=d*c*h-u*f*m,this._y=u*f*h-d*c*m,this._z=u*c*m+d*f*h,this._w=u*c*h+d*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],a=t[1],o=t[5],l=t[9],u=t[2],c=t[6],h=t[10],d=i+o+h;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(c-l)*f,this._y=(s-u)*f,this._z=(a-r)*f}else if(i>o&&i>h){const f=2*Math.sqrt(1+i-o-h);this._w=(c-l)/f,this._x=.25*f,this._y=(r+a)/f,this._z=(s+u)/f}else if(o>h){const f=2*Math.sqrt(1+o-i-h);this._w=(s-u)/f,this._x=(r+a)/f,this._y=.25*f,this._z=(l+c)/f}else{const f=2*Math.sqrt(1+h-i-o);this._w=(a-r)/f,this._x=(s+u)/f,this._y=(l+c)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<1e-8?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Mt(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,a=e._w,o=t._x,l=t._y,u=t._z,c=t._w;return this._x=i*c+a*o+r*u-s*l,this._y=r*c+a*l+s*o-i*u,this._z=s*c+a*u+i*l-r*o,this._w=a*c-i*o-r*l-s*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,r=this._y,s=this._z,a=this._w;let o=a*e._w+i*e._x+r*e._y+s*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=i,this._y=r,this._z=s,this;const l=1-o*o;if(l<=Number.EPSILON){const f=1-t;return this._w=f*a+t*this._w,this._x=f*i+t*this._x,this._y=f*r+t*this._y,this._z=f*s+t*this._z,this.normalize(),this}const u=Math.sqrt(l),c=Math.atan2(u,o),h=Math.sin((1-t)*c)/u,d=Math.sin(t*c)/u;return this._w=a*h+this._w*d,this._x=i*h+this._x*d,this._y=r*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class D{constructor(e=0,t=0,i=0){D.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(xN.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(xN.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,a=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*a,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*a,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*a,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,a=e.y,o=e.z,l=e.w,u=2*(a*r-o*i),c=2*(o*t-s*r),h=2*(s*i-a*t);return this.x=t+l*u+a*h-o*c,this.y=i+l*c+o*u-s*h,this.z=r+l*h+s*c-a*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Mt(this.x,e.x,t.x),this.y=Mt(this.y,e.y,t.y),this.z=Mt(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Mt(this.x,e,t),this.y=Mt(this.y,e,t),this.z=Mt(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Mt(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,a=t.x,o=t.y,l=t.z;return this.x=r*l-s*o,this.y=s*a-i*l,this.z=i*o-r*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return gS.copy(this).projectOnVector(e),this.sub(gS)}reflect(e){return this.sub(gS.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Mt(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const gS=new D,xN=new da;class vt{constructor(e,t,i,r,s,a,o,l,u){vt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,a,o,l,u)}set(e,t,i,r,s,a,o,l,u){const c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=s,c[5]=l,c[6]=i,c[7]=a,c[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,a=i[0],o=i[3],l=i[6],u=i[1],c=i[4],h=i[7],d=i[2],f=i[5],m=i[8],_=r[0],g=r[3],p=r[6],y=r[1],v=r[4],b=r[7],S=r[2],x=r[5],T=r[8];return s[0]=a*_+o*y+l*S,s[3]=a*g+o*v+l*x,s[6]=a*p+o*b+l*T,s[1]=u*_+c*y+h*S,s[4]=u*g+c*v+h*x,s[7]=u*p+c*b+h*T,s[2]=d*_+f*y+m*S,s[5]=d*g+f*v+m*x,s[8]=d*p+f*b+m*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7],c=e[8];return t*a*c-t*o*u-i*s*c+i*o*l+r*s*u-r*a*l}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7],c=e[8],h=c*a-o*u,d=o*l-c*s,f=u*s-a*l,m=t*h+i*d+r*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/m;return e[0]=h*_,e[1]=(r*u-c*i)*_,e[2]=(o*i-r*a)*_,e[3]=d*_,e[4]=(c*t-r*l)*_,e[5]=(r*s-o*t)*_,e[6]=f*_,e[7]=(i*l-u*t)*_,e[8]=(a*t-i*s)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,a,o){const l=Math.cos(s),u=Math.sin(s);return this.set(i*l,i*u,-i*(l*a+u*o)+a+e,-r*u,r*l,-r*(-u*a+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(_S.makeScale(e,t)),this}rotate(e){return this.premultiply(_S.makeRotation(-e)),this}translate(e,t){return this.premultiply(_S.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const _S=new vt;function Vw(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function Fm(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function QO(){const n=Fm("canvas");return n.style.display="block",n}const TN={};function vs(n){n in TN||(TN[n]=!0,console.warn(n))}function I8(n,e,t){return new Promise(function(i,r){function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:r();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:i()}}setTimeout(s,t)})}const EN=new vt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),MN=new vt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function B8(){const n={enabled:!0,workingColorSpace:_c,spaces:{},convert:function(r,s,a){return this.enabled===!1||s===a||!s||!a||(this.spaces[s].transfer===Re&&(r.r=jo(r.r),r.g=jo(r.g),r.b=jo(r.b)),this.spaces[s].primaries!==this.spaces[a].primaries&&(r.applyMatrix3(this.spaces[s].toXYZ),r.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===Re&&(r.r=td(r.r),r.g=td(r.g),r.b=td(r.b))),r},workingToColorSpace:function(r,s){return this.convert(r,this.workingColorSpace,s)},colorSpaceToWorking:function(r,s){return this.convert(r,s,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===Or?Kd:this.spaces[r].transfer},getToneMappingMode:function(r){return this.spaces[r].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(r,s=this.workingColorSpace){return r.fromArray(this.spaces[s].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,s,a){return r.copy(this.spaces[s].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(r,s){return vs("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),n.workingToColorSpace(r,s)},toWorkingColorSpace:function(r,s){return vs("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),n.colorSpaceToWorking(r,s)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],i=[.3127,.329];return n.define({[_c]:{primaries:e,whitePoint:i,transfer:Kd,toXYZ:EN,fromXYZ:MN,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:hr},outputColorSpaceConfig:{drawingBufferColorSpace:hr}},[hr]:{primaries:e,whitePoint:i,transfer:Re,toXYZ:EN,fromXYZ:MN,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:hr}}}),n}const Ze=B8();function jo(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function td(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Fc;class F8{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{Fc===void 0&&(Fc=Fm("canvas")),Fc.width=e.width,Fc.height=e.height;const r=Fc.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),i=Fc}return i.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Fm("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let a=0;a<s.length;a++)s[a]=jo(s[a]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(jo(t[i]/255)*255):t[i]=jo(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let k8=0;class Hw{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:k8++}),this.uuid=Wo(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let a=0,o=r.length;a<o;a++)r[a].isDataTexture?s.push(yS(r[a].image)):s.push(yS(r[a]))}else s=yS(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function yS(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?F8.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let z8=0;const vS=new D;class _i extends sl{constructor(e=_i.DEFAULT_IMAGE,t=_i.DEFAULT_MAPPING,i=Ia,r=Ia,s=wi,a=Ir,o=ii,l=Kn,u=_i.DEFAULT_ANISOTROPY,c=Or){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:z8++}),this.uuid=Wo(),this.name="",this.source=new Hw(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=a,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=l,this.offset=new fe(0,0),this.repeat=new fe(1,1),this.center=new fe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new vt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(vS).x}get height(){return this.source.getSize(vS).y}get depth(){return this.source.getSize(vS).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Texture.setValues(): property '${t}' does not exist.`);continue}r&&i&&r.isVector2&&i.isVector2||r&&i&&r.isVector3&&i.isVector3||r&&i&&r.isMatrix3&&i.isMatrix3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Lw)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case mc:e.x=e.x-Math.floor(e.x);break;case Ia:e.x=e.x<0?0:1;break;case gc:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case mc:e.y=e.y-Math.floor(e.y);break;case Ia:e.y=e.y<0?0:1;break;case gc:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}_i.DEFAULT_IMAGE=null;_i.DEFAULT_MAPPING=Lw;_i.DEFAULT_ANISOTROPY=1;class Je{constructor(e=0,t=0,i=0,r=1){Je.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*r+a[12]*s,this.y=a[1]*t+a[5]*i+a[9]*r+a[13]*s,this.z=a[2]*t+a[6]*i+a[10]*r+a[14]*s,this.w=a[3]*t+a[7]*i+a[11]*r+a[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const l=e.elements,u=l[0],c=l[4],h=l[8],d=l[1],f=l[5],m=l[9],_=l[2],g=l[6],p=l[10];if(Math.abs(c-d)<.01&&Math.abs(h-_)<.01&&Math.abs(m-g)<.01){if(Math.abs(c+d)<.1&&Math.abs(h+_)<.1&&Math.abs(m+g)<.1&&Math.abs(u+f+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const v=(u+1)/2,b=(f+1)/2,S=(p+1)/2,x=(c+d)/4,T=(h+_)/4,w=(m+g)/4;return v>b&&v>S?v<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(v),r=x/i,s=T/i):b>S?b<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(b),i=x/r,s=w/r):S<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(S),i=T/s,r=w/s),this.set(i,r,s,t),this}let y=Math.sqrt((g-m)*(g-m)+(h-_)*(h-_)+(d-c)*(d-c));return Math.abs(y)<.001&&(y=1),this.x=(g-m)/y,this.y=(h-_)/y,this.z=(d-c)/y,this.w=Math.acos((u+f+p-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Mt(this.x,e.x,t.x),this.y=Mt(this.y,e.y,t.y),this.z=Mt(this.z,e.z,t.z),this.w=Mt(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Mt(this.x,e,t),this.y=Mt(this.y,e,t),this.z=Mt(this.z,e,t),this.w=Mt(this.w,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Mt(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Nc extends sl{constructor(e=1,t=1,i={}){super(),i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:wi,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},i),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=i.depth,this.scissor=new Je(0,0,e,t),this.scissorTest=!1,this.viewport=new Je(0,0,e,t);const r={width:e,height:t,depth:i.depth},s=new _i(r);this.textures=[];const a=i.count;for(let o=0;o<a;o++)this.textures[o]=s.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(i),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=i.depthTexture,this.samples=i.samples,this.multiview=i.multiview}_setTextureOptions(e={}){const t={minFilter:wi,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let i=0;i<this.textures.length;i++)this.textures[i].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=i,this.textures[r].isArrayTexture=this.textures[r].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,i=e.textures.length;t<i;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const r=Object.assign({},e.textures[t].image);this.textures[t].source=new Hw(r)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class su extends Nc{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class $w extends _i{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Ln,this.minFilter=Ln,this.wrapR=Ia,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class G8 extends _i{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Ln,this.minFilter=Ln,this.wrapR=Ia,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Cc{constructor(e=new D(1/0,1/0,1/0),t=new D(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Xs.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Xs.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Xs.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const s=i.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,Xs):Xs.fromBufferAttribute(s,a),Xs.applyMatrix4(e.matrixWorld),this.expandByPoint(Xs);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),l_.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),l_.copy(i.boundingBox)),l_.applyMatrix4(e.matrixWorld),this.union(l_)}const r=e.children;for(let s=0,a=r.length;s<a;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Xs),Xs.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Wf),u_.subVectors(this.max,Wf),kc.subVectors(e.a,Wf),zc.subVectors(e.b,Wf),Gc.subVectors(e.c,Wf),fl.subVectors(zc,kc),pl.subVectors(Gc,zc),Mu.subVectors(kc,Gc);let t=[0,-fl.z,fl.y,0,-pl.z,pl.y,0,-Mu.z,Mu.y,fl.z,0,-fl.x,pl.z,0,-pl.x,Mu.z,0,-Mu.x,-fl.y,fl.x,0,-pl.y,pl.x,0,-Mu.y,Mu.x,0];return!bS(t,kc,zc,Gc,u_)||(t=[1,0,0,0,1,0,0,0,1],!bS(t,kc,zc,Gc,u_))?!1:(c_.crossVectors(fl,pl),t=[c_.x,c_.y,c_.z],bS(t,kc,zc,Gc,u_))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Xs).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Xs).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(co[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),co[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),co[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),co[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),co[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),co[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),co[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),co[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(co),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const co=[new D,new D,new D,new D,new D,new D,new D,new D],Xs=new D,l_=new Cc,kc=new D,zc=new D,Gc=new D,fl=new D,pl=new D,Mu=new D,Wf=new D,u_=new D,c_=new D,wu=new D;function bS(n,e,t,i,r){for(let s=0,a=n.length-3;s<=a;s+=3){wu.fromArray(n,s);const o=r.x*Math.abs(wu.x)+r.y*Math.abs(wu.y)+r.z*Math.abs(wu.z),l=e.dot(wu),u=t.dot(wu),c=i.dot(wu);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>o)return!1}return!0}const V8=new Cc,jf=new D,SS=new D;class Eg{constructor(e=new D,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):V8.setFromPoints(e).getCenter(i);let r=0;for(let s=0,a=e.length;s<a;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;jf.subVectors(e,this.center);const t=jf.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(jf,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(SS.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(jf.copy(e.center).add(SS)),this.expandByPoint(jf.copy(e.center).sub(SS))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const ho=new D,xS=new D,h_=new D,ml=new D,TS=new D,d_=new D,ES=new D;class Z0{constructor(e=new D,t=new D(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ho)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ho.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ho.copy(this.origin).addScaledVector(this.direction,t),ho.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){xS.copy(e).add(t).multiplyScalar(.5),h_.copy(t).sub(e).normalize(),ml.copy(this.origin).sub(xS);const s=e.distanceTo(t)*.5,a=-this.direction.dot(h_),o=ml.dot(this.direction),l=-ml.dot(h_),u=ml.lengthSq(),c=Math.abs(1-a*a);let h,d,f,m;if(c>0)if(h=a*l-o,d=a*o-l,m=s*c,h>=0)if(d>=-m)if(d<=m){const _=1/c;h*=_,d*=_,f=h*(h+a*d+2*o)+d*(a*h+d+2*l)+u}else d=s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*l)+u;else d=-s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*l)+u;else d<=-m?(h=Math.max(0,-(-a*s+o)),d=h>0?-s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+u):d<=m?(h=0,d=Math.min(Math.max(-s,-l),s),f=d*(d+2*l)+u):(h=Math.max(0,-(a*s+o)),d=h>0?s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+u);else d=a>0?-s:s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*l)+u;return i&&i.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(xS).addScaledVector(h_,d),f}intersectSphere(e,t){ho.subVectors(e.center,this.origin);const i=ho.dot(this.direction),r=ho.dot(ho)-i*i,s=e.radius*e.radius;if(r>s)return null;const a=Math.sqrt(s-r),o=i-a,l=i+a;return l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,a,o,l;const u=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,d=this.origin;return u>=0?(i=(e.min.x-d.x)*u,r=(e.max.x-d.x)*u):(i=(e.max.x-d.x)*u,r=(e.min.x-d.x)*u),c>=0?(s=(e.min.y-d.y)*c,a=(e.max.y-d.y)*c):(s=(e.max.y-d.y)*c,a=(e.min.y-d.y)*c),i>a||s>r||((s>i||isNaN(i))&&(i=s),(a<r||isNaN(r))&&(r=a),h>=0?(o=(e.min.z-d.z)*h,l=(e.max.z-d.z)*h):(o=(e.max.z-d.z)*h,l=(e.min.z-d.z)*h),i>l||o>r)||((o>i||i!==i)&&(i=o),(l<r||r!==r)&&(r=l),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,ho)!==null}intersectTriangle(e,t,i,r,s){TS.subVectors(t,e),d_.subVectors(i,e),ES.crossVectors(TS,d_);let a=this.direction.dot(ES),o;if(a>0){if(r)return null;o=1}else if(a<0)o=-1,a=-a;else return null;ml.subVectors(this.origin,e);const l=o*this.direction.dot(d_.crossVectors(ml,d_));if(l<0)return null;const u=o*this.direction.dot(TS.cross(ml));if(u<0||l+u>a)return null;const c=-o*ml.dot(ES);return c<0?null:this.at(c/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class zt{constructor(e,t,i,r,s,a,o,l,u,c,h,d,f,m,_,g){zt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,a,o,l,u,c,h,d,f,m,_,g)}set(e,t,i,r,s,a,o,l,u,c,h,d,f,m,_,g){const p=this.elements;return p[0]=e,p[4]=t,p[8]=i,p[12]=r,p[1]=s,p[5]=a,p[9]=o,p[13]=l,p[2]=u,p[6]=c,p[10]=h,p[14]=d,p[3]=f,p[7]=m,p[11]=_,p[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new zt().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/Vc.setFromMatrixColumn(e,0).length(),s=1/Vc.setFromMatrixColumn(e,1).length(),a=1/Vc.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*a,t[9]=i[9]*a,t[10]=i[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,a=Math.cos(i),o=Math.sin(i),l=Math.cos(r),u=Math.sin(r),c=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const d=a*c,f=a*h,m=o*c,_=o*h;t[0]=l*c,t[4]=-l*h,t[8]=u,t[1]=f+m*u,t[5]=d-_*u,t[9]=-o*l,t[2]=_-d*u,t[6]=m+f*u,t[10]=a*l}else if(e.order==="YXZ"){const d=l*c,f=l*h,m=u*c,_=u*h;t[0]=d+_*o,t[4]=m*o-f,t[8]=a*u,t[1]=a*h,t[5]=a*c,t[9]=-o,t[2]=f*o-m,t[6]=_+d*o,t[10]=a*l}else if(e.order==="ZXY"){const d=l*c,f=l*h,m=u*c,_=u*h;t[0]=d-_*o,t[4]=-a*h,t[8]=m+f*o,t[1]=f+m*o,t[5]=a*c,t[9]=_-d*o,t[2]=-a*u,t[6]=o,t[10]=a*l}else if(e.order==="ZYX"){const d=a*c,f=a*h,m=o*c,_=o*h;t[0]=l*c,t[4]=m*u-f,t[8]=d*u+_,t[1]=l*h,t[5]=_*u+d,t[9]=f*u-m,t[2]=-u,t[6]=o*l,t[10]=a*l}else if(e.order==="YZX"){const d=a*l,f=a*u,m=o*l,_=o*u;t[0]=l*c,t[4]=_-d*h,t[8]=m*h+f,t[1]=h,t[5]=a*c,t[9]=-o*c,t[2]=-u*c,t[6]=f*h+m,t[10]=d-_*h}else if(e.order==="XZY"){const d=a*l,f=a*u,m=o*l,_=o*u;t[0]=l*c,t[4]=-h,t[8]=u*c,t[1]=d*h+_,t[5]=a*c,t[9]=f*h-m,t[2]=m*h-f,t[6]=o*c,t[10]=_*h+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(H8,e,$8)}lookAt(e,t,i){const r=this.elements;return Jr.subVectors(e,t),Jr.lengthSq()===0&&(Jr.z=1),Jr.normalize(),gl.crossVectors(i,Jr),gl.lengthSq()===0&&(Math.abs(i.z)===1?Jr.x+=1e-4:Jr.z+=1e-4,Jr.normalize(),gl.crossVectors(i,Jr)),gl.normalize(),f_.crossVectors(Jr,gl),r[0]=gl.x,r[4]=f_.x,r[8]=Jr.x,r[1]=gl.y,r[5]=f_.y,r[9]=Jr.y,r[2]=gl.z,r[6]=f_.z,r[10]=Jr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,a=i[0],o=i[4],l=i[8],u=i[12],c=i[1],h=i[5],d=i[9],f=i[13],m=i[2],_=i[6],g=i[10],p=i[14],y=i[3],v=i[7],b=i[11],S=i[15],x=r[0],T=r[4],w=r[8],E=r[12],M=r[1],N=r[5],U=r[9],k=r[13],P=r[2],O=r[6],C=r[10],q=r[14],z=r[3],re=r[7],X=r[11],oe=r[15];return s[0]=a*x+o*M+l*P+u*z,s[4]=a*T+o*N+l*O+u*re,s[8]=a*w+o*U+l*C+u*X,s[12]=a*E+o*k+l*q+u*oe,s[1]=c*x+h*M+d*P+f*z,s[5]=c*T+h*N+d*O+f*re,s[9]=c*w+h*U+d*C+f*X,s[13]=c*E+h*k+d*q+f*oe,s[2]=m*x+_*M+g*P+p*z,s[6]=m*T+_*N+g*O+p*re,s[10]=m*w+_*U+g*C+p*X,s[14]=m*E+_*k+g*q+p*oe,s[3]=y*x+v*M+b*P+S*z,s[7]=y*T+v*N+b*O+S*re,s[11]=y*w+v*U+b*C+S*X,s[15]=y*E+v*k+b*q+S*oe,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],a=e[1],o=e[5],l=e[9],u=e[13],c=e[2],h=e[6],d=e[10],f=e[14],m=e[3],_=e[7],g=e[11],p=e[15];return m*(+s*l*h-r*u*h-s*o*d+i*u*d+r*o*f-i*l*f)+_*(+t*l*f-t*u*d+s*a*d-r*a*f+r*u*c-s*l*c)+g*(+t*u*h-t*o*f-s*a*h+i*a*f+s*o*c-i*u*c)+p*(-r*o*c-t*l*h+t*o*d+r*a*h-i*a*d+i*l*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],m=e[12],_=e[13],g=e[14],p=e[15],y=h*g*u-_*d*u+_*l*f-o*g*f-h*l*p+o*d*p,v=m*d*u-c*g*u-m*l*f+a*g*f+c*l*p-a*d*p,b=c*_*u-m*h*u+m*o*f-a*_*f-c*o*p+a*h*p,S=m*h*l-c*_*l-m*o*d+a*_*d+c*o*g-a*h*g,x=t*y+i*v+r*b+s*S;if(x===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/x;return e[0]=y*T,e[1]=(_*d*s-h*g*s-_*r*f+i*g*f+h*r*p-i*d*p)*T,e[2]=(o*g*s-_*l*s+_*r*u-i*g*u-o*r*p+i*l*p)*T,e[3]=(h*l*s-o*d*s-h*r*u+i*d*u+o*r*f-i*l*f)*T,e[4]=v*T,e[5]=(c*g*s-m*d*s+m*r*f-t*g*f-c*r*p+t*d*p)*T,e[6]=(m*l*s-a*g*s-m*r*u+t*g*u+a*r*p-t*l*p)*T,e[7]=(a*d*s-c*l*s+c*r*u-t*d*u-a*r*f+t*l*f)*T,e[8]=b*T,e[9]=(m*h*s-c*_*s-m*i*f+t*_*f+c*i*p-t*h*p)*T,e[10]=(a*_*s-m*o*s+m*i*u-t*_*u-a*i*p+t*o*p)*T,e[11]=(c*o*s-a*h*s-c*i*u+t*h*u+a*i*f-t*o*f)*T,e[12]=S*T,e[13]=(c*_*r-m*h*r+m*i*d-t*_*d-c*i*g+t*h*g)*T,e[14]=(m*o*r-a*_*r-m*i*l+t*_*l+a*i*g-t*o*g)*T,e[15]=(a*h*r-c*o*r+c*i*l-t*h*l-a*i*d+t*o*d)*T,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,a=e.x,o=e.y,l=e.z,u=s*a,c=s*o;return this.set(u*a+i,u*o-r*l,u*l+r*o,0,u*o+r*l,c*o+i,c*l-r*a,0,u*l-r*o,c*l+r*a,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,a){return this.set(1,i,s,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,a=t._y,o=t._z,l=t._w,u=s+s,c=a+a,h=o+o,d=s*u,f=s*c,m=s*h,_=a*c,g=a*h,p=o*h,y=l*u,v=l*c,b=l*h,S=i.x,x=i.y,T=i.z;return r[0]=(1-(_+p))*S,r[1]=(f+b)*S,r[2]=(m-v)*S,r[3]=0,r[4]=(f-b)*x,r[5]=(1-(d+p))*x,r[6]=(g+y)*x,r[7]=0,r[8]=(m+v)*T,r[9]=(g-y)*T,r[10]=(1-(d+_))*T,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=Vc.set(r[0],r[1],r[2]).length();const a=Vc.set(r[4],r[5],r[6]).length(),o=Vc.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],Ys.copy(this);const u=1/s,c=1/a,h=1/o;return Ys.elements[0]*=u,Ys.elements[1]*=u,Ys.elements[2]*=u,Ys.elements[4]*=c,Ys.elements[5]*=c,Ys.elements[6]*=c,Ys.elements[8]*=h,Ys.elements[9]*=h,Ys.elements[10]*=h,t.setFromRotationMatrix(Ys),i.x=s,i.y=a,i.z=o,this}makePerspective(e,t,i,r,s,a,o=br,l=!1){const u=this.elements,c=2*s/(t-e),h=2*s/(i-r),d=(t+e)/(t-e),f=(i+r)/(i-r);let m,_;if(l)m=s/(a-s),_=a*s/(a-s);else if(o===br)m=-(a+s)/(a-s),_=-2*a*s/(a-s);else if(o===ru)m=-a/(a-s),_=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return u[0]=c,u[4]=0,u[8]=d,u[12]=0,u[1]=0,u[5]=h,u[9]=f,u[13]=0,u[2]=0,u[6]=0,u[10]=m,u[14]=_,u[3]=0,u[7]=0,u[11]=-1,u[15]=0,this}makeOrthographic(e,t,i,r,s,a,o=br,l=!1){const u=this.elements,c=2/(t-e),h=2/(i-r),d=-(t+e)/(t-e),f=-(i+r)/(i-r);let m,_;if(l)m=1/(a-s),_=a/(a-s);else if(o===br)m=-2/(a-s),_=-(a+s)/(a-s);else if(o===ru)m=-1/(a-s),_=-s/(a-s);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return u[0]=c,u[4]=0,u[8]=0,u[12]=d,u[1]=0,u[5]=h,u[9]=0,u[13]=f,u[2]=0,u[6]=0,u[10]=m,u[14]=_,u[3]=0,u[7]=0,u[11]=0,u[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Vc=new D,Ys=new zt,H8=new D(0,0,0),$8=new D(1,1,1),gl=new D,f_=new D,Jr=new D,wN=new zt,AN=new da;class Vr{constructor(e=0,t=0,i=0,r=Vr.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,s=r[0],a=r[4],o=r[8],l=r[1],u=r[5],c=r[9],h=r[2],d=r[6],f=r[10];switch(t){case"XYZ":this._y=Math.asin(Mt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Mt(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Mt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Mt(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(Mt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-Mt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,u),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-c,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return wN.makeRotationFromQuaternion(e),this.setFromRotationMatrix(wN,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return AN.setFromEuler(this),this.setFromQuaternion(AN,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Vr.DEFAULT_ORDER="XYZ";class Ww{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let W8=0;const RN=new D,Hc=new da,fo=new zt,p_=new D,qf=new D,j8=new D,q8=new da,NN=new D(1,0,0),CN=new D(0,1,0),DN=new D(0,0,1),LN={type:"added"},X8={type:"removed"},$c={type:"childadded",child:null},MS={type:"childremoved",child:null};class yi extends sl{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:W8++}),this.uuid=Wo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=yi.DEFAULT_UP.clone();const e=new D,t=new Vr,i=new da,r=new D(1,1,1);function s(){i.setFromEuler(t,!1)}function a(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new zt},normalMatrix:{value:new vt}}),this.matrix=new zt,this.matrixWorld=new zt,this.matrixAutoUpdate=yi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=yi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Ww,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Hc.setFromAxisAngle(e,t),this.quaternion.multiply(Hc),this}rotateOnWorldAxis(e,t){return Hc.setFromAxisAngle(e,t),this.quaternion.premultiply(Hc),this}rotateX(e){return this.rotateOnAxis(NN,e)}rotateY(e){return this.rotateOnAxis(CN,e)}rotateZ(e){return this.rotateOnAxis(DN,e)}translateOnAxis(e,t){return RN.copy(e).applyQuaternion(this.quaternion),this.position.add(RN.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(NN,e)}translateY(e){return this.translateOnAxis(CN,e)}translateZ(e){return this.translateOnAxis(DN,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(fo.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?p_.copy(e):p_.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),qf.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?fo.lookAt(qf,p_,this.up):fo.lookAt(p_,qf,this.up),this.quaternion.setFromRotationMatrix(fo),r&&(fo.extractRotation(r.matrixWorld),Hc.setFromRotationMatrix(fo),this.quaternion.premultiply(Hc.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(LN),$c.child=e,this.dispatchEvent($c),$c.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(X8),MS.child=e,this.dispatchEvent(MS),MS.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),fo.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),fo.multiply(e.parent.matrixWorld)),e.applyMatrix4(fo),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(LN),$c.child=e,this.dispatchEvent($c),$c.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const a=this.children[i].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qf,e,j8),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qf,q8,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(o=>({...o})),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(r.boundingBox=this.boundingBox.toJSON()));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let u=0,c=l.length;u<c;u++){const h=l[u];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,u=this.material.length;l<u;l++)o.push(s(e.materials,this.material[l]));r.material=o}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];r.animations.push(s(e.animations,l))}}if(t){const o=a(e.geometries),l=a(e.materials),u=a(e.textures),c=a(e.images),h=a(e.shapes),d=a(e.skeletons),f=a(e.animations),m=a(e.nodes);o.length>0&&(i.geometries=o),l.length>0&&(i.materials=l),u.length>0&&(i.textures=u),c.length>0&&(i.images=c),h.length>0&&(i.shapes=h),d.length>0&&(i.skeletons=d),f.length>0&&(i.animations=f),m.length>0&&(i.nodes=m)}return i.object=r,i;function a(o){const l=[];for(const u in o){const c=o[u];delete c.metadata,l.push(c)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}yi.DEFAULT_UP=new D(0,1,0);yi.DEFAULT_MATRIX_AUTO_UPDATE=!0;yi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ks=new D,po=new D,wS=new D,mo=new D,Wc=new D,jc=new D,PN=new D,AS=new D,RS=new D,NS=new D,CS=new Je,DS=new Je,LS=new Je;class sa{constructor(e=new D,t=new D,i=new D){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),Ks.subVectors(e,t),r.cross(Ks);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){Ks.subVectors(r,t),po.subVectors(i,t),wS.subVectors(e,t);const a=Ks.dot(Ks),o=Ks.dot(po),l=Ks.dot(wS),u=po.dot(po),c=po.dot(wS),h=a*u-o*o;if(h===0)return s.set(0,0,0),null;const d=1/h,f=(u*l-o*c)*d,m=(a*c-o*l)*d;return s.set(1-f-m,m,f)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,mo)===null?!1:mo.x>=0&&mo.y>=0&&mo.x+mo.y<=1}static getInterpolation(e,t,i,r,s,a,o,l){return this.getBarycoord(e,t,i,r,mo)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,mo.x),l.addScaledVector(a,mo.y),l.addScaledVector(o,mo.z),l)}static getInterpolatedAttribute(e,t,i,r,s,a){return CS.setScalar(0),DS.setScalar(0),LS.setScalar(0),CS.fromBufferAttribute(e,t),DS.fromBufferAttribute(e,i),LS.fromBufferAttribute(e,r),a.setScalar(0),a.addScaledVector(CS,s.x),a.addScaledVector(DS,s.y),a.addScaledVector(LS,s.z),a}static isFrontFacing(e,t,i,r){return Ks.subVectors(i,t),po.subVectors(e,t),Ks.cross(po).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ks.subVectors(this.c,this.b),po.subVectors(this.a,this.b),Ks.cross(po).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return sa.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return sa.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,r,s){return sa.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return sa.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return sa.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let a,o;Wc.subVectors(r,i),jc.subVectors(s,i),AS.subVectors(e,i);const l=Wc.dot(AS),u=jc.dot(AS);if(l<=0&&u<=0)return t.copy(i);RS.subVectors(e,r);const c=Wc.dot(RS),h=jc.dot(RS);if(c>=0&&h<=c)return t.copy(r);const d=l*h-c*u;if(d<=0&&l>=0&&c<=0)return a=l/(l-c),t.copy(i).addScaledVector(Wc,a);NS.subVectors(e,s);const f=Wc.dot(NS),m=jc.dot(NS);if(m>=0&&f<=m)return t.copy(s);const _=f*u-l*m;if(_<=0&&u>=0&&m<=0)return o=u/(u-m),t.copy(i).addScaledVector(jc,o);const g=c*m-f*h;if(g<=0&&h-c>=0&&f-m>=0)return PN.subVectors(s,r),o=(h-c)/(h-c+(f-m)),t.copy(r).addScaledVector(PN,o);const p=1/(g+_+d);return a=_*p,o=d*p,t.copy(i).addScaledVector(Wc,a).addScaledVector(jc,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const ZO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_l={h:0,s:0,l:0},m_={h:0,s:0,l:0};function PS(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class Ve{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=hr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ze.colorSpaceToWorking(this,t),this}setRGB(e,t,i,r=Ze.workingColorSpace){return this.r=e,this.g=t,this.b=i,Ze.colorSpaceToWorking(this,r),this}setHSL(e,t,i,r=Ze.workingColorSpace){if(e=Gw(e,1),t=Mt(t,0,1),i=Mt(i,0,1),t===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,a=2*i-s;this.r=PS(a,s,e+1/3),this.g=PS(a,s,e),this.b=PS(a,s,e-1/3)}return Ze.colorSpaceToWorking(this,r),this}setStyle(e,t=hr){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=r[1],o=r[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=hr){const i=ZO[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=jo(e.r),this.g=jo(e.g),this.b=jo(e.b),this}copyLinearToSRGB(e){return this.r=td(e.r),this.g=td(e.g),this.b=td(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=hr){return Ze.workingToColorSpace(Xi.copy(this),e),Math.round(Mt(Xi.r*255,0,255))*65536+Math.round(Mt(Xi.g*255,0,255))*256+Math.round(Mt(Xi.b*255,0,255))}getHexString(e=hr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ze.workingColorSpace){Ze.workingToColorSpace(Xi.copy(this),t);const i=Xi.r,r=Xi.g,s=Xi.b,a=Math.max(i,r,s),o=Math.min(i,r,s);let l,u;const c=(o+a)/2;if(o===a)l=0,u=0;else{const h=a-o;switch(u=c<=.5?h/(a+o):h/(2-a-o),a){case i:l=(r-s)/h+(r<s?6:0);break;case r:l=(s-i)/h+2;break;case s:l=(i-r)/h+4;break}l/=6}return e.h=l,e.s=u,e.l=c,e}getRGB(e,t=Ze.workingColorSpace){return Ze.workingToColorSpace(Xi.copy(this),t),e.r=Xi.r,e.g=Xi.g,e.b=Xi.b,e}getStyle(e=hr){Ze.workingToColorSpace(Xi.copy(this),e);const t=Xi.r,i=Xi.g,r=Xi.b;return e!==hr?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,t,i){return this.getHSL(_l),this.setHSL(_l.h+e,_l.s+t,_l.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(_l),e.getHSL(m_);const i=Jp(_l.h,m_.h,t),r=Jp(_l.s,m_.s,t),s=Jp(_l.l,m_.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Xi=new Ve;Ve.NAMES=ZO;let Y8=0;class ir extends sl{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Y8++}),this.uuid=Wo(),this.name="",this.type="Material",this.blending=ms,this.side=ps,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Mm,this.blendDst=wm,this.blendEquation=Zi,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ve(0,0,0),this.blendAlpha=0,this.depthFunc=iu,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=dE,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=zu,this.stencilZFail=zu,this.stencilZPass=zu,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(i.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(i.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==ms&&(i.blending=this.blending),this.side!==ps&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==Mm&&(i.blendSrc=this.blendSrc),this.blendDst!==wm&&(i.blendDst=this.blendDst),this.blendEquation!==Zi&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==iu&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==dE&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==zu&&(i.stencilFail=this.stencilFail),this.stencilZFail!==zu&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==zu&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(t){const s=r(e.textures),a=r(e.images);s.length>0&&(i.textures=s),a.length>0&&(i.images=a)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Da extends ir{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ve(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Vr,this.combine=Sg,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Ao=K8();function K8(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const u=l-127;u<-27?(i[l]=0,i[l|256]=32768,r[l]=24,r[l|256]=24):u<-14?(i[l]=1024>>-u-14,i[l|256]=1024>>-u-14|32768,r[l]=-u-1,r[l|256]=-u-1):u<=15?(i[l]=u+15<<10,i[l|256]=u+15<<10|32768,r[l]=13,r[l|256]=13):u<128?(i[l]=31744,i[l|256]=64512,r[l]=24,r[l|256]=24):(i[l]=31744,i[l|256]=64512,r[l]=13,r[l|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let u=l<<13,c=0;for(;!(u&8388608);)u<<=1,c-=8388608;u&=-8388609,c+=947912704,s[l]=u|c}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}function es(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=Mt(n,-65504,65504),Ao.floatView[0]=n;const e=Ao.uint32View[0],t=e>>23&511;return Ao.baseTable[t]+((e&8388607)>>Ao.shiftTable[t])}function g_(n){const e=n>>10;return Ao.uint32View[0]=Ao.mantissaTable[Ao.offsetTable[e]+(n&1023)]+Ao.exponentTable[e],Ao.floatView[0]}const di=new D,__=new fe;let Q8=0;class Wi{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Q8++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=wv,this.updateRanges=[],this.gpuType=li,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)__.fromBufferAttribute(this,t),__.applyMatrix3(e),this.setXY(t,__.x,__.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)di.fromBufferAttribute(this,t),di.applyMatrix3(e),this.setXYZ(t,di.x,di.y,di.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)di.fromBufferAttribute(this,t),di.applyMatrix4(e),this.setXYZ(t,di.x,di.y,di.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)di.fromBufferAttribute(this,t),di.applyNormalMatrix(e),this.setXYZ(t,di.x,di.y,di.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)di.fromBufferAttribute(this,t),di.transformDirection(e),this.setXYZ(t,di.x,di.y,di.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=mr(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Et(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=mr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Et(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=mr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Et(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=mr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Et(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=mr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Et(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Et(t,this.array),i=Et(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Et(t,this.array),i=Et(i,this.array),r=Et(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=Et(t,this.array),i=Et(i,this.array),r=Et(r,this.array),s=Et(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==wv&&(e.usage=this.usage),e}}class jw extends Wi{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class qw extends Wi{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class JO extends Wi{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=g_(this.array[e*this.itemSize]);return this.normalized&&(t=mr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Et(t,this.array)),this.array[e*this.itemSize]=es(t),this}getY(e){let t=g_(this.array[e*this.itemSize+1]);return this.normalized&&(t=mr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Et(t,this.array)),this.array[e*this.itemSize+1]=es(t),this}getZ(e){let t=g_(this.array[e*this.itemSize+2]);return this.normalized&&(t=mr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Et(t,this.array)),this.array[e*this.itemSize+2]=es(t),this}getW(e){let t=g_(this.array[e*this.itemSize+3]);return this.normalized&&(t=mr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Et(t,this.array)),this.array[e*this.itemSize+3]=es(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Et(t,this.array),i=Et(i,this.array)),this.array[e+0]=es(t),this.array[e+1]=es(i),this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Et(t,this.array),i=Et(i,this.array),r=Et(r,this.array)),this.array[e+0]=es(t),this.array[e+1]=es(i),this.array[e+2]=es(r),this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=Et(t,this.array),i=Et(i,this.array),r=Et(r,this.array),s=Et(s,this.array)),this.array[e+0]=es(t),this.array[e+1]=es(i),this.array[e+2]=es(r),this.array[e+3]=es(s),this}}class hi extends Wi{constructor(e,t,i){super(new Float32Array(e),t,i)}}let Z8=0;const Ms=new zt,US=new yi,qc=new D,ts=new Cc,Xf=new Cc,Li=new D;class Er extends sl{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Z8++}),this.uuid=Wo(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Vw(e)?qw:jw)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new vt().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ms.makeRotationFromQuaternion(e),this.applyMatrix4(Ms),this}rotateX(e){return Ms.makeRotationX(e),this.applyMatrix4(Ms),this}rotateY(e){return Ms.makeRotationY(e),this.applyMatrix4(Ms),this}rotateZ(e){return Ms.makeRotationZ(e),this.applyMatrix4(Ms),this}translate(e,t,i){return Ms.makeTranslation(e,t,i),this.applyMatrix4(Ms),this}scale(e,t,i){return Ms.makeScale(e,t,i),this.applyMatrix4(Ms),this}lookAt(e){return US.lookAt(e),US.updateMatrix(),this.applyMatrix4(US.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(qc).negate(),this.translate(qc.x,qc.y,qc.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const i=[];for(let r=0,s=e.length;r<s;r++){const a=e[r];i.push(a.x,a.y,a.z||0)}this.setAttribute("position",new hi(i,3))}else{const i=Math.min(e.length,t.count);for(let r=0;r<i;r++){const s=e[r];t.setXYZ(r,s.x,s.y,s.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Cc);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new D(-1/0,-1/0,-1/0),new D(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const s=t[i];ts.setFromBufferAttribute(s),this.morphTargetsRelative?(Li.addVectors(this.boundingBox.min,ts.min),this.boundingBox.expandByPoint(Li),Li.addVectors(this.boundingBox.max,ts.max),this.boundingBox.expandByPoint(Li)):(this.boundingBox.expandByPoint(ts.min),this.boundingBox.expandByPoint(ts.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Eg);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new D,1/0);return}if(e){const i=this.boundingSphere.center;if(ts.setFromBufferAttribute(e),t)for(let s=0,a=t.length;s<a;s++){const o=t[s];Xf.setFromBufferAttribute(o),this.morphTargetsRelative?(Li.addVectors(ts.min,Xf.min),ts.expandByPoint(Li),Li.addVectors(ts.max,Xf.max),ts.expandByPoint(Li)):(ts.expandByPoint(Xf.min),ts.expandByPoint(Xf.max))}ts.getCenter(i);let r=0;for(let s=0,a=e.count;s<a;s++)Li.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(Li));if(t)for(let s=0,a=t.length;s<a;s++){const o=t[s],l=this.morphTargetsRelative;for(let u=0,c=o.count;u<c;u++)Li.fromBufferAttribute(o,u),l&&(qc.fromBufferAttribute(e,u),Li.add(qc)),r=Math.max(r,i.distanceToSquared(Li))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,r=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Wi(new Float32Array(4*i.count),4));const a=this.getAttribute("tangent"),o=[],l=[];for(let w=0;w<i.count;w++)o[w]=new D,l[w]=new D;const u=new D,c=new D,h=new D,d=new fe,f=new fe,m=new fe,_=new D,g=new D;function p(w,E,M){u.fromBufferAttribute(i,w),c.fromBufferAttribute(i,E),h.fromBufferAttribute(i,M),d.fromBufferAttribute(s,w),f.fromBufferAttribute(s,E),m.fromBufferAttribute(s,M),c.sub(u),h.sub(u),f.sub(d),m.sub(d);const N=1/(f.x*m.y-m.x*f.y);isFinite(N)&&(_.copy(c).multiplyScalar(m.y).addScaledVector(h,-f.y).multiplyScalar(N),g.copy(h).multiplyScalar(f.x).addScaledVector(c,-m.x).multiplyScalar(N),o[w].add(_),o[E].add(_),o[M].add(_),l[w].add(g),l[E].add(g),l[M].add(g))}let y=this.groups;y.length===0&&(y=[{start:0,count:e.count}]);for(let w=0,E=y.length;w<E;++w){const M=y[w],N=M.start,U=M.count;for(let k=N,P=N+U;k<P;k+=3)p(e.getX(k+0),e.getX(k+1),e.getX(k+2))}const v=new D,b=new D,S=new D,x=new D;function T(w){S.fromBufferAttribute(r,w),x.copy(S);const E=o[w];v.copy(E),v.sub(S.multiplyScalar(S.dot(E))).normalize(),b.crossVectors(x,E);const N=b.dot(l[w])<0?-1:1;a.setXYZW(w,v.x,v.y,v.z,N)}for(let w=0,E=y.length;w<E;++w){const M=y[w],N=M.start,U=M.count;for(let k=N,P=N+U;k<P;k+=3)T(e.getX(k+0)),T(e.getX(k+1)),T(e.getX(k+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Wi(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let d=0,f=i.count;d<f;d++)i.setXYZ(d,0,0,0);const r=new D,s=new D,a=new D,o=new D,l=new D,u=new D,c=new D,h=new D;if(e)for(let d=0,f=e.count;d<f;d+=3){const m=e.getX(d+0),_=e.getX(d+1),g=e.getX(d+2);r.fromBufferAttribute(t,m),s.fromBufferAttribute(t,_),a.fromBufferAttribute(t,g),c.subVectors(a,s),h.subVectors(r,s),c.cross(h),o.fromBufferAttribute(i,m),l.fromBufferAttribute(i,_),u.fromBufferAttribute(i,g),o.add(c),l.add(c),u.add(c),i.setXYZ(m,o.x,o.y,o.z),i.setXYZ(_,l.x,l.y,l.z),i.setXYZ(g,u.x,u.y,u.z)}else for(let d=0,f=t.count;d<f;d+=3)r.fromBufferAttribute(t,d+0),s.fromBufferAttribute(t,d+1),a.fromBufferAttribute(t,d+2),c.subVectors(a,s),h.subVectors(r,s),c.cross(h),i.setXYZ(d+0,c.x,c.y,c.z),i.setXYZ(d+1,c.x,c.y,c.z),i.setXYZ(d+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Li.fromBufferAttribute(e,t),Li.normalize(),e.setXYZ(t,Li.x,Li.y,Li.z)}toNonIndexed(){function e(o,l){const u=o.array,c=o.itemSize,h=o.normalized,d=new u.constructor(l.length*c);let f=0,m=0;for(let _=0,g=l.length;_<g;_++){o.isInterleavedBufferAttribute?f=l[_]*o.data.stride+o.offset:f=l[_]*c;for(let p=0;p<c;p++)d[m++]=u[f++]}return new Wi(d,c,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Er,i=this.index.array,r=this.attributes;for(const o in r){const l=r[o],u=e(l,i);t.setAttribute(o,u)}const s=this.morphAttributes;for(const o in s){const l=[],u=s[o];for(let c=0,h=u.length;c<h;c++){const d=u[c],f=e(d,i);l.push(f)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const u=a[o];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const u in l)l[u]!==void 0&&(e[u]=l[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const u=i[l];e.data.attributes[l]=u.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const u=this.morphAttributes[l],c=[];for(let h=0,d=u.length;h<d;h++){const f=u[h];c.push(f.toJSON(e.data))}c.length>0&&(r[l]=c,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere=o.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone());const r=e.attributes;for(const u in r){const c=r[u];this.setAttribute(u,c.clone(t))}const s=e.morphAttributes;for(const u in s){const c=[],h=s[u];for(let d=0,f=h.length;d<f;d++)c.push(h[d].clone(t));this.morphAttributes[u]=c}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let u=0,c=a.length;u<c;u++){const h=a[u];this.addGroup(h.start,h.count,h.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const UN=new zt,Au=new Z0,y_=new Eg,ON=new D,v_=new D,b_=new D,S_=new D,OS=new D,x_=new D,IN=new D,T_=new D;class mi extends yi{constructor(e=new Er,t=new Da){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const o=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(e,t){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,a=i.morphTargetsRelative;t.fromBufferAttribute(r,e);const o=this.morphTargetInfluences;if(s&&o){x_.set(0,0,0);for(let l=0,u=s.length;l<u;l++){const c=o[l],h=s[l];c!==0&&(OS.fromBufferAttribute(h,e),a?x_.addScaledVector(OS,c):x_.addScaledVector(OS.sub(t),c))}t.add(x_)}return t}raycast(e,t){const i=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),y_.copy(i.boundingSphere),y_.applyMatrix4(s),Au.copy(e.ray).recast(e.near),!(y_.containsPoint(Au.origin)===!1&&(Au.intersectSphere(y_,ON)===null||Au.origin.distanceToSquared(ON)>(e.far-e.near)**2))&&(UN.copy(s).invert(),Au.copy(e.ray).applyMatrix4(UN),!(i.boundingBox!==null&&Au.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,Au)))}_computeIntersections(e,t,i){let r;const s=this.geometry,a=this.material,o=s.index,l=s.attributes.position,u=s.attributes.uv,c=s.attributes.uv1,h=s.attributes.normal,d=s.groups,f=s.drawRange;if(o!==null)if(Array.isArray(a))for(let m=0,_=d.length;m<_;m++){const g=d[m],p=a[g.materialIndex],y=Math.max(g.start,f.start),v=Math.min(o.count,Math.min(g.start+g.count,f.start+f.count));for(let b=y,S=v;b<S;b+=3){const x=o.getX(b),T=o.getX(b+1),w=o.getX(b+2);r=E_(this,p,e,i,u,c,h,x,T,w),r&&(r.faceIndex=Math.floor(b/3),r.face.materialIndex=g.materialIndex,t.push(r))}}else{const m=Math.max(0,f.start),_=Math.min(o.count,f.start+f.count);for(let g=m,p=_;g<p;g+=3){const y=o.getX(g),v=o.getX(g+1),b=o.getX(g+2);r=E_(this,a,e,i,u,c,h,y,v,b),r&&(r.faceIndex=Math.floor(g/3),t.push(r))}}else if(l!==void 0)if(Array.isArray(a))for(let m=0,_=d.length;m<_;m++){const g=d[m],p=a[g.materialIndex],y=Math.max(g.start,f.start),v=Math.min(l.count,Math.min(g.start+g.count,f.start+f.count));for(let b=y,S=v;b<S;b+=3){const x=b,T=b+1,w=b+2;r=E_(this,p,e,i,u,c,h,x,T,w),r&&(r.faceIndex=Math.floor(b/3),r.face.materialIndex=g.materialIndex,t.push(r))}}else{const m=Math.max(0,f.start),_=Math.min(l.count,f.start+f.count);for(let g=m,p=_;g<p;g+=3){const y=g,v=g+1,b=g+2;r=E_(this,a,e,i,u,c,h,y,v,b),r&&(r.faceIndex=Math.floor(g/3),t.push(r))}}}}function J8(n,e,t,i,r,s,a,o){let l;if(e.side===bn?l=i.intersectTriangle(a,s,r,!0,o):l=i.intersectTriangle(r,s,a,e.side===ps,o),l===null)return null;T_.copy(o),T_.applyMatrix4(n.matrixWorld);const u=t.ray.origin.distanceTo(T_);return u<t.near||u>t.far?null:{distance:u,point:T_.clone(),object:n}}function E_(n,e,t,i,r,s,a,o,l,u){n.getVertexPosition(o,v_),n.getVertexPosition(l,b_),n.getVertexPosition(u,S_);const c=J8(n,e,t,i,v_,b_,S_,IN);if(c){const h=new D;sa.getBarycoord(IN,v_,b_,S_,h),r&&(c.uv=sa.getInterpolatedAttribute(r,o,l,u,h,new fe)),s&&(c.uv1=sa.getInterpolatedAttribute(s,o,l,u,h,new fe)),a&&(c.normal=sa.getInterpolatedAttribute(a,o,l,u,h,new D),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));const d={a:o,b:l,c:u,normal:new D,materialIndex:0};sa.getNormal(v_,b_,S_,d.normal),c.face=d,c.barycoord=h}return c}class Dc extends Er{constructor(e=1,t=1,i=1,r=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:a};const o=this;r=Math.floor(r),s=Math.floor(s),a=Math.floor(a);const l=[],u=[],c=[],h=[];let d=0,f=0;m("z","y","x",-1,-1,i,t,e,a,s,0),m("z","y","x",1,-1,i,t,-e,a,s,1),m("x","z","y",1,1,e,i,t,r,a,2),m("x","z","y",1,-1,e,i,-t,r,a,3),m("x","y","z",1,-1,e,t,i,r,s,4),m("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new hi(u,3)),this.setAttribute("normal",new hi(c,3)),this.setAttribute("uv",new hi(h,2));function m(_,g,p,y,v,b,S,x,T,w,E){const M=b/T,N=S/w,U=b/2,k=S/2,P=x/2,O=T+1,C=w+1;let q=0,z=0;const re=new D;for(let X=0;X<C;X++){const oe=X*N-k;for(let be=0;be<O;be++){const Oe=be*M-U;re[_]=Oe*y,re[g]=oe*v,re[p]=P,u.push(re.x,re.y,re.z),re[_]=0,re[g]=0,re[p]=x>0?1:-1,c.push(re.x,re.y,re.z),h.push(be/T),h.push(1-X/w),q+=1}}for(let X=0;X<w;X++)for(let oe=0;oe<T;oe++){const be=d+oe+O*X,Oe=d+oe+O*(X+1),st=d+(oe+1)+O*(X+1),ie=d+(oe+1)+O*X;l.push(be,Oe,ie),l.push(Oe,st,ie),z+=6}o.addGroup(f,z,E),f+=z,d+=q}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Dc(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Qd(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function lr(n){const e={};for(let t=0;t<n.length;t++){const i=Qd(n[t]);for(const r in i)e[r]=i[r]}return e}function e5(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function eI(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Ze.workingColorSpace}const tI={clone:Qd,merge:lr};var t5=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,n5=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Xa extends ir{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=t5,this.fragmentShader=n5,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Qd(e.uniforms),this.uniformsGroups=e5(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const a=this.uniforms[r].value;a&&a.isTexture?t.uniforms[r]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[r]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[r]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[r]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[r]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[r]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[r]={type:"m4",value:a.toArray()}:t.uniforms[r]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class Xw extends yi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new zt,this.projectionMatrix=new zt,this.projectionMatrixInverse=new zt,this.coordinateSystem=br,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const yl=new D,BN=new fe,FN=new fe;class Ii extends Xw{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=yc*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Zp*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return yc*2*Math.atan(Math.tan(Zp*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){yl.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(yl.x,yl.y).multiplyScalar(-e/yl.z),yl.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(yl.x,yl.y).multiplyScalar(-e/yl.z)}getViewSize(e,t){return this.getViewBounds(e,BN,FN),t.subVectors(FN,BN)}setViewOffset(e,t,i,r,s,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Zp*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,u=a.fullHeight;s+=a.offsetX*r/l,t-=a.offsetY*i/u,r*=a.width/l,i*=a.height/u}const o=this.filmOffset;o!==0&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Xc=-90,Yc=1;class nI extends yi{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Ii(Xc,Yc,e,t);r.layers=this.layers,this.add(r);const s=new Ii(Xc,Yc,e,t);s.layers=this.layers,this.add(s);const a=new Ii(Xc,Yc,e,t);a.layers=this.layers,this.add(a);const o=new Ii(Xc,Yc,e,t);o.layers=this.layers,this.add(o);const l=new Ii(Xc,Yc,e,t);l.layers=this.layers,this.add(l);const u=new Ii(Xc,Yc,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,s,a,o,l]=t;for(const u of t)this.remove(u);if(e===br)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===ru)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,l,u,c]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),m=e.xr.enabled;e.xr.enabled=!1;const _=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(t,s),e.setRenderTarget(i,1,r),e.render(t,a),e.setRenderTarget(i,2,r),e.render(t,o),e.setRenderTarget(i,3,r),e.render(t,l),e.setRenderTarget(i,4,r),e.render(t,u),i.texture.generateMipmaps=_,e.setRenderTarget(i,5,r),e.render(t,c),e.setRenderTarget(h,d,f),e.xr.enabled=m,i.texture.needsPMREMUpdate=!0}}class Mg extends _i{constructor(e=[],t=ja,i,r,s,a,o,l,u,c){super(e,t,i,r,s,a,o,l,u,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class iI extends su{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new Mg(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Dc(5,5,5),s=new Xa({name:"CubemapFromEquirect",uniforms:Qd(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:bn,blending:kr});s.uniforms.tEquirect.value=t;const a=new mi(r,s),o=t.minFilter;return t.minFilter===Ir&&(t.minFilter=wi),new nI(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,i=!0,r=!0){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,i,r);e.setRenderTarget(s)}}let Fh=class extends yi{constructor(){super(),this.isGroup=!0,this.type="Group"}};const i5={type:"move"};class wy{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Fh,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Fh,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new D,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new D),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Fh,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new D,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new D),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,a=null;const o=this._targetRay,l=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){a=!0;for(const _ of e.hand.values()){const g=t.getJointPose(_,i),p=this._getHandJoint(u,_);g!==null&&(p.matrix.fromArray(g.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.matrixWorldNeedsUpdate=!0,p.jointRadius=g.radius),p.visible=g!==null}const c=u.joints["index-finger-tip"],h=u.joints["thumb-tip"],d=c.position.distanceTo(h.position),f=.02,m=.005;u.inputState.pinching&&d>f+m?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&d<=f-m&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(i5)))}return o!==null&&(o.visible=r!==null),l!==null&&(l.visible=s!==null),u!==null&&(u.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new Fh;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class J0 extends yi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Vr,this.environmentIntensity=1,this.environmentRotation=new Vr,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class rI{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=wv,this.updateRanges=[],this.version=0,this.uuid=Wo()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Wo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Wo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const or=new D;class Yw{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)or.fromBufferAttribute(this,t),or.applyMatrix4(e),this.setXYZ(t,or.x,or.y,or.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)or.fromBufferAttribute(this,t),or.applyNormalMatrix(e),this.setXYZ(t,or.x,or.y,or.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)or.fromBufferAttribute(this,t),or.transformDirection(e),this.setXYZ(t,or.x,or.y,or.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=mr(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Et(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=Et(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Et(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Et(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Et(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=mr(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=mr(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=mr(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=mr(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Et(t,this.array),i=Et(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Et(t,this.array),i=Et(i,this.array),r=Et(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Et(t,this.array),i=Et(i,this.array),r=Et(r,this.array),s=Et(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new Wi(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Yw(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class r5 extends ir{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ve(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class s5 extends _i{constructor(e=null,t=1,i=1,r,s,a,o,l,u=Ln,c=Ln,h,d){super(null,a,o,l,u,c,r,s,h,d),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class a5 extends Wi{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const IS=new D,o5=new D,l5=new vt;class ia{constructor(e=new D(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=IS.subVectors(i,t).cross(o5.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(IS),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||l5.getNormalMatrix(e),r=this.coplanarPoint(IS).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Ru=new Eg,u5=new fe(.5,.5),M_=new D;class wg{constructor(e=new ia,t=new ia,i=new ia,r=new ia,s=new ia,a=new ia){this.planes=[e,t,i,r,s,a]}set(e,t,i,r,s,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(r),o[4].copy(s),o[5].copy(a),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=br,i=!1){const r=this.planes,s=e.elements,a=s[0],o=s[1],l=s[2],u=s[3],c=s[4],h=s[5],d=s[6],f=s[7],m=s[8],_=s[9],g=s[10],p=s[11],y=s[12],v=s[13],b=s[14],S=s[15];if(r[0].setComponents(u-a,f-c,p-m,S-y).normalize(),r[1].setComponents(u+a,f+c,p+m,S+y).normalize(),r[2].setComponents(u+o,f+h,p+_,S+v).normalize(),r[3].setComponents(u-o,f-h,p-_,S-v).normalize(),i)r[4].setComponents(l,d,g,b).normalize(),r[5].setComponents(u-l,f-d,p-g,S-b).normalize();else if(r[4].setComponents(u-l,f-d,p-g,S-b).normalize(),t===br)r[5].setComponents(u+l,f+d,p+g,S+b).normalize();else if(t===ru)r[5].setComponents(l,d,g,b).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Ru.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Ru.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Ru)}intersectsSprite(e){Ru.center.set(0,0,0);const t=u5.distanceTo(e.center);return Ru.radius=.7071067811865476+t,Ru.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ru)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(M_.x=r.normal.x>0?e.max.x:e.min.x,M_.y=r.normal.y>0?e.max.y:e.min.y,M_.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(M_)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const ya=new zt,va=new wg;class Kw{constructor(){this.coordinateSystem=br}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(ya.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),va.setFromProjectionMatrix(ya,r.coordinateSystem,r.reversedDepth),va.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(ya.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),va.setFromProjectionMatrix(ya,r.coordinateSystem,r.reversedDepth),va.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(ya.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),va.setFromProjectionMatrix(ya,r.coordinateSystem,r.reversedDepth),va.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(ya.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),va.setFromProjectionMatrix(ya,r.coordinateSystem,r.reversedDepth),va.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(ya.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),va.setFromProjectionMatrix(ya,r.coordinateSystem,r.reversedDepth),va.containsPoint(e))return!0}return!1}clone(){return new Kw}}class eb extends ir{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ve(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Rv=new D,Nv=new D,kN=new zt,Yf=new Z0,w_=new Eg,BS=new D,zN=new D;class c5 extends yi{constructor(e=new Er,t=new eb){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)Rv.fromBufferAttribute(t,r-1),Nv.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=Rv.distanceTo(Nv);e.setAttribute("lineDistance",new hi(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),w_.copy(i.boundingSphere),w_.applyMatrix4(r),w_.radius+=s,e.ray.intersectsSphere(w_)===!1)return;kN.copy(r).invert(),Yf.copy(e.ray).applyMatrix4(kN);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,u=this.isLineSegments?2:1,c=i.index,d=i.attributes.position;if(c!==null){const f=Math.max(0,a.start),m=Math.min(c.count,a.start+a.count);for(let _=f,g=m-1;_<g;_+=u){const p=c.getX(_),y=c.getX(_+1),v=A_(this,e,Yf,l,p,y,_);v&&t.push(v)}if(this.isLineLoop){const _=c.getX(m-1),g=c.getX(f),p=A_(this,e,Yf,l,_,g,m-1);p&&t.push(p)}}else{const f=Math.max(0,a.start),m=Math.min(d.count,a.start+a.count);for(let _=f,g=m-1;_<g;_+=u){const p=A_(this,e,Yf,l,_,_+1,_);p&&t.push(p)}if(this.isLineLoop){const _=A_(this,e,Yf,l,m-1,f,m-1);_&&t.push(_)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const o=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function A_(n,e,t,i,r,s,a){const o=n.geometry.attributes.position;if(Rv.fromBufferAttribute(o,r),Nv.fromBufferAttribute(o,s),t.distanceSqToSegment(Rv,Nv,BS,zN)>i)return;BS.applyMatrix4(n.matrixWorld);const u=e.ray.origin.distanceTo(BS);if(!(u<e.near||u>e.far))return{distance:u,point:zN.clone().applyMatrix4(n.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:n}}class h5 extends ir{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ve(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class d5 extends _i{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Ln,this.minFilter=Ln,this.generateMipmaps=!1,this.needsUpdate=!0}}class ks extends _i{constructor(e,t,i=wn,r,s,a,o=Ln,l=Ln,u,c=_s,h=1){if(c!==_s&&c!==ys)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const d={width:e,height:t,depth:h};super(d,r,s,a,o,l,c,i,u),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Hw(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class sI extends _i{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class Ag extends Er{constructor(e=1,t=1,i=1,r=32,s=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};const u=this;r=Math.floor(r),s=Math.floor(s);const c=[],h=[],d=[],f=[];let m=0;const _=[],g=i/2;let p=0;y(),a===!1&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new hi(h,3)),this.setAttribute("normal",new hi(d,3)),this.setAttribute("uv",new hi(f,2));function y(){const b=new D,S=new D;let x=0;const T=(t-e)/i;for(let w=0;w<=s;w++){const E=[],M=w/s,N=M*(t-e)+e;for(let U=0;U<=r;U++){const k=U/r,P=k*l+o,O=Math.sin(P),C=Math.cos(P);S.x=N*O,S.y=-M*i+g,S.z=N*C,h.push(S.x,S.y,S.z),b.set(O,T,C).normalize(),d.push(b.x,b.y,b.z),f.push(k,1-M),E.push(m++)}_.push(E)}for(let w=0;w<r;w++)for(let E=0;E<s;E++){const M=_[E][w],N=_[E+1][w],U=_[E+1][w+1],k=_[E][w+1];(e>0||E!==0)&&(c.push(M,N,k),x+=3),(t>0||E!==s-1)&&(c.push(N,U,k),x+=3)}u.addGroup(p,x,0),p+=x}function v(b){const S=m,x=new fe,T=new D;let w=0;const E=b===!0?e:t,M=b===!0?1:-1;for(let U=1;U<=r;U++)h.push(0,g*M,0),d.push(0,M,0),f.push(.5,.5),m++;const N=m;for(let U=0;U<=r;U++){const P=U/r*l+o,O=Math.cos(P),C=Math.sin(P);T.x=E*C,T.y=g*M,T.z=E*O,h.push(T.x,T.y,T.z),d.push(0,M,0),x.x=O*.5+.5,x.y=C*.5*M+.5,f.push(x.x,x.y),m++}for(let U=0;U<r;U++){const k=S+U,P=N+U;b===!0?c.push(P,P+1,k):c.push(P+1,P,k),w+=3}u.addGroup(p,w,b===!0?1:2),p+=w}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ag(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Qw extends Ag{constructor(e=1,t=1,i=32,r=1,s=!1,a=0,o=Math.PI*2){super(0,e,t,i,r,s,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(e){return new Qw(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class al{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),s=0;t.push(0);for(let a=1;a<=e;a++)i=this.getPoint(a/e),s+=i.distanceTo(r),t.push(s),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const i=this.getLengths();let r=0;const s=i.length;let a;t?a=t:a=e*i[s-1];let o=0,l=s-1,u;for(;o<=l;)if(r=Math.floor(o+(l-o)/2),u=i[r]-a,u<0)o=r+1;else if(u>0)l=r-1;else{l=r;break}if(r=l,i[r]===a)return r/(s-1);const c=i[r],d=i[r+1]-c,f=(a-c)/d;return(r+f)/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const a=this.getPoint(r),o=this.getPoint(s),l=t||(a.isVector2?new fe:new D);return l.copy(o).sub(a).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t=!1){const i=new D,r=[],s=[],a=[],o=new D,l=new zt;for(let f=0;f<=e;f++){const m=f/e;r[f]=this.getTangentAt(m,new D)}s[0]=new D,a[0]=new D;let u=Number.MAX_VALUE;const c=Math.abs(r[0].x),h=Math.abs(r[0].y),d=Math.abs(r[0].z);c<=u&&(u=c,i.set(1,0,0)),h<=u&&(u=h,i.set(0,1,0)),d<=u&&i.set(0,0,1),o.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],o),a[0].crossVectors(r[0],s[0]);for(let f=1;f<=e;f++){if(s[f]=s[f-1].clone(),a[f]=a[f-1].clone(),o.crossVectors(r[f-1],r[f]),o.length()>Number.EPSILON){o.normalize();const m=Math.acos(Mt(r[f-1].dot(r[f]),-1,1));s[f].applyMatrix4(l.makeRotationAxis(o,m))}a[f].crossVectors(r[f],s[f])}if(t===!0){let f=Math.acos(Mt(s[0].dot(s[e]),-1,1));f/=e,r[0].dot(o.crossVectors(s[0],s[e]))>0&&(f=-f);for(let m=1;m<=e;m++)s[m].applyMatrix4(l.makeRotationAxis(r[m],f*m)),a[m].crossVectors(r[m],s[m])}return{tangents:r,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class aI extends al{constructor(e=0,t=0,i=1,r=1,s=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(e,t=new fe){const i=t,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(a?s=0:s=r),this.aClockwise===!0&&!a&&(s===r?s=-r:s=s-r);const o=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const c=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,f=u-this.aY;l=d*c-f*h+this.aX,u=d*h+f*c+this.aY}return i.set(l,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class f5 extends aI{constructor(e,t,i,r,s,a){super(e,t,i,i,r,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function Zw(){let n=0,e=0,t=0,i=0;function r(s,a,o,l){n=s,e=o,t=-3*s+3*a-2*o-l,i=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,u){r(a,o,u*(o-s),u*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,u,c,h){let d=(a-s)/u-(o-s)/(u+c)+(o-a)/c,f=(o-a)/c-(l-a)/(c+h)+(l-o)/h;d*=c,f*=c,r(a,o,d,f)},calc:function(s){const a=s*s,o=a*s;return n+e*s+t*a+i*o}}}const R_=new D,FS=new Zw,kS=new Zw,zS=new Zw;class p5 extends al{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new D){const i=t,r=this.points,s=r.length,a=(s-(this.closed?0:1))*e;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:l===0&&o===s-1&&(o=s-2,l=1);let u,c;this.closed||o>0?u=r[(o-1)%s]:(R_.subVectors(r[0],r[1]).add(r[0]),u=R_);const h=r[o%s],d=r[(o+1)%s];if(this.closed||o+2<s?c=r[(o+2)%s]:(R_.subVectors(r[s-1],r[s-2]).add(r[s-1]),c=R_),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let m=Math.pow(u.distanceToSquared(h),f),_=Math.pow(h.distanceToSquared(d),f),g=Math.pow(d.distanceToSquared(c),f);_<1e-4&&(_=1),m<1e-4&&(m=_),g<1e-4&&(g=_),FS.initNonuniformCatmullRom(u.x,h.x,d.x,c.x,m,_,g),kS.initNonuniformCatmullRom(u.y,h.y,d.y,c.y,m,_,g),zS.initNonuniformCatmullRom(u.z,h.z,d.z,c.z,m,_,g)}else this.curveType==="catmullrom"&&(FS.initCatmullRom(u.x,h.x,d.x,c.x,this.tension),kS.initCatmullRom(u.y,h.y,d.y,c.y,this.tension),zS.initCatmullRom(u.z,h.z,d.z,c.z,this.tension));return i.set(FS.calc(l),kS.calc(l),zS.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new D().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function GN(n,e,t,i,r){const s=(i-e)*.5,a=(r-t)*.5,o=n*n,l=n*o;return(2*t-2*i+s+a)*l+(-3*t+3*i-2*s-a)*o+s*n+t}function m5(n,e){const t=1-n;return t*t*e}function g5(n,e){return 2*(1-n)*n*e}function _5(n,e){return n*n*e}function em(n,e,t,i){return m5(n,e)+g5(n,t)+_5(n,i)}function y5(n,e){const t=1-n;return t*t*t*e}function v5(n,e){const t=1-n;return 3*t*t*n*e}function b5(n,e){return 3*(1-n)*n*n*e}function S5(n,e){return n*n*n*e}function tm(n,e,t,i,r){return y5(n,e)+v5(n,t)+b5(n,i)+S5(n,r)}class x5 extends al{constructor(e=new fe,t=new fe,i=new fe,r=new fe){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new fe){const i=t,r=this.v0,s=this.v1,a=this.v2,o=this.v3;return i.set(tm(e,r.x,s.x,a.x,o.x),tm(e,r.y,s.y,a.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class oI extends al{constructor(e=new D,t=new D,i=new D,r=new D){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new D){const i=t,r=this.v0,s=this.v1,a=this.v2,o=this.v3;return i.set(tm(e,r.x,s.x,a.x,o.x),tm(e,r.y,s.y,a.y,o.y),tm(e,r.z,s.z,a.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class T5 extends al{constructor(e=new fe,t=new fe){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new fe){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new fe){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class E5 extends al{constructor(e=new D,t=new D){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new D){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new D){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class M5 extends al{constructor(e=new fe,t=new fe,i=new fe){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new fe){const i=t,r=this.v0,s=this.v1,a=this.v2;return i.set(em(e,r.x,s.x,a.x),em(e,r.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Jw extends al{constructor(e=new D,t=new D,i=new D){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new D){const i=t,r=this.v0,s=this.v1,a=this.v2;return i.set(em(e,r.x,s.x,a.x),em(e,r.y,s.y,a.y),em(e,r.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class w5 extends al{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new fe){const i=t,r=this.points,s=(r.length-1)*e,a=Math.floor(s),o=s-a,l=r[a===0?a:a-1],u=r[a],c=r[a>r.length-2?r.length-1:a+1],h=r[a>r.length-3?r.length-1:a+2];return i.set(GN(o,l.x,u.x,c.x,h.x),GN(o,l.y,u.y,c.y,h.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new fe().fromArray(r))}return this}}var A5=Object.freeze({__proto__:null,ArcCurve:f5,CatmullRomCurve3:p5,CubicBezierCurve:x5,CubicBezierCurve3:oI,EllipseCurve:aI,LineCurve:T5,LineCurve3:E5,QuadraticBezierCurve:M5,QuadraticBezierCurve3:Jw,SplineCurve:w5});class Rg extends Er{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,a=t/2,o=Math.floor(i),l=Math.floor(r),u=o+1,c=l+1,h=e/o,d=t/l,f=[],m=[],_=[],g=[];for(let p=0;p<c;p++){const y=p*d-a;for(let v=0;v<u;v++){const b=v*h-s;m.push(b,-y,0),_.push(0,0,1),g.push(v/o),g.push(1-p/l)}}for(let p=0;p<l;p++)for(let y=0;y<o;y++){const v=y+u*p,b=y+u*(p+1),S=y+1+u*(p+1),x=y+1+u*p;f.push(v,b,x),f.push(b,S,x)}this.setIndex(f),this.setAttribute("position",new hi(m,3)),this.setAttribute("normal",new hi(_,3)),this.setAttribute("uv",new hi(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Rg(e.width,e.height,e.widthSegments,e.heightSegments)}}class Ng extends Er{constructor(e=1,t=32,i=16,r=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:s,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(a+o,Math.PI);let u=0;const c=[],h=new D,d=new D,f=[],m=[],_=[],g=[];for(let p=0;p<=i;p++){const y=[],v=p/i;let b=0;p===0&&a===0?b=.5/t:p===i&&l===Math.PI&&(b=-.5/t);for(let S=0;S<=t;S++){const x=S/t;h.x=-e*Math.cos(r+x*s)*Math.sin(a+v*o),h.y=e*Math.cos(a+v*o),h.z=e*Math.sin(r+x*s)*Math.sin(a+v*o),m.push(h.x,h.y,h.z),d.copy(h).normalize(),_.push(d.x,d.y,d.z),g.push(x+b,1-v),y.push(u++)}c.push(y)}for(let p=0;p<i;p++)for(let y=0;y<t;y++){const v=c[p][y+1],b=c[p][y],S=c[p+1][y],x=c[p+1][y+1];(p!==0||a>0)&&f.push(v,b,x),(p!==i-1||l<Math.PI)&&f.push(b,S,x)}this.setIndex(f),this.setAttribute("position",new hi(m,3)),this.setAttribute("normal",new hi(_,3)),this.setAttribute("uv",new hi(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ng(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class eA extends Er{constructor(e=new Jw(new D(-1,-1,0),new D(-1,1,0),new D(1,1,0)),t=64,i=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:s};const a=e.computeFrenetFrames(t,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new D,l=new D,u=new fe;let c=new D;const h=[],d=[],f=[],m=[];_(),this.setIndex(m),this.setAttribute("position",new hi(h,3)),this.setAttribute("normal",new hi(d,3)),this.setAttribute("uv",new hi(f,2));function _(){for(let v=0;v<t;v++)g(v);g(s===!1?t:0),y(),p()}function g(v){c=e.getPointAt(v/t,c);const b=a.normals[v],S=a.binormals[v];for(let x=0;x<=r;x++){const T=x/r*Math.PI*2,w=Math.sin(T),E=-Math.cos(T);l.x=E*b.x+w*S.x,l.y=E*b.y+w*S.y,l.z=E*b.z+w*S.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=c.x+i*l.x,o.y=c.y+i*l.y,o.z=c.z+i*l.z,h.push(o.x,o.y,o.z)}}function p(){for(let v=1;v<=t;v++)for(let b=1;b<=r;b++){const S=(r+1)*(v-1)+(b-1),x=(r+1)*v+(b-1),T=(r+1)*v+b,w=(r+1)*(v-1)+b;m.push(S,x,w),m.push(x,T,w)}}function y(){for(let v=0;v<=t;v++)for(let b=0;b<=r;b++)u.x=v/t,u.y=b/r,f.push(u.x,u.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new eA(new A5[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class R5 extends ir{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ve(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class lI extends ir{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Ve(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ve(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tl,this.normalScale=new fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Vr,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class N5 extends lI{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new fe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Mt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ve(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ve(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ve(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class C5 extends ir{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ve(16777215),this.specular=new Ve(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ve(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tl,this.normalScale=new fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Vr,this.combine=Sg,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class D5 extends ir{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ve(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ve(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tl,this.normalScale=new fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class L5 extends ir{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tl,this.normalScale=new fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class uI extends ir{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ve(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ve(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tl,this.normalScale=new fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Vr,this.combine=Sg,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class P5 extends ir{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=r8,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class U5 extends ir{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class O5 extends ir{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ve(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tl,this.normalScale=new fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class I5 extends eb{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}const GS={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class B5{constructor(e,t,i){const r=this;let s=!1,a=0,o=0,l;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.abortController=new AbortController,this.itemStart=function(c){o++,s===!1&&r.onStart!==void 0&&r.onStart(c,a,o),s=!0},this.itemEnd=function(c){a++,r.onProgress!==void 0&&r.onProgress(c,a,o),a===o&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(c){r.onError!==void 0&&r.onError(c)},this.resolveURL=function(c){return l?l(c):c},this.setURLModifier=function(c){return l=c,this},this.addHandler=function(c,h){return u.push(c,h),this},this.removeHandler=function(c){const h=u.indexOf(c);return h!==-1&&u.splice(h,2),this},this.getHandler=function(c){for(let h=0,d=u.length;h<d;h+=2){const f=u[h],m=u[h+1];if(f.global&&(f.lastIndex=0),f.test(c))return m}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const F5=new B5;class tA{constructor(e){this.manager=e!==void 0?e:F5,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}tA.DEFAULT_MATERIAL_NAME="__DEFAULT";const Kc=new WeakMap;class k5 extends tA{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=GS.get(`image:${e}`);if(a!==void 0){if(a.complete===!0)s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0);else{let h=Kc.get(a);h===void 0&&(h=[],Kc.set(a,h)),h.push({onLoad:t,onError:r})}return a}const o=Fm("img");function l(){c(),t&&t(this);const h=Kc.get(this)||[];for(let d=0;d<h.length;d++){const f=h[d];f.onLoad&&f.onLoad(this)}Kc.delete(this),s.manager.itemEnd(e)}function u(h){c(),r&&r(h),GS.remove(`image:${e}`);const d=Kc.get(this)||[];for(let f=0;f<d.length;f++){const m=d[f];m.onError&&m.onError(h)}Kc.delete(this),s.manager.itemError(e),s.manager.itemEnd(e)}function c(){o.removeEventListener("load",l,!1),o.removeEventListener("error",u,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),GS.add(`image:${e}`,o),s.manager.itemStart(e),o.src=e,o}}class z5 extends tA{constructor(e){super(e)}load(e,t,i,r){const s=new _i,a=new k5(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){s.image=o,s.needsUpdate=!0,t!==void 0&&t(s)},i,r),s}}class Lc extends yi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ve(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class G5 extends Lc{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(yi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ve(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const VS=new zt,VN=new D,HN=new D;class nA{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new fe(512,512),this.mapType=Kn,this.map=null,this.mapPass=null,this.matrix=new zt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new wg,this._frameExtents=new fe(1,1),this._viewportCount=1,this._viewports=[new Je(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;VN.setFromMatrixPosition(e.matrixWorld),t.position.copy(VN),HN.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(HN),t.updateMatrixWorld(),VS.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(VS,t.coordinateSystem,t.reversedDepth),t.reversedDepth?i.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(VS)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class V5 extends nA{constructor(){super(new Ii(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,i=yc*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height*this.aspect,s=e.distance||t.far;(i!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class iA extends Lc{constructor(e,t,i=0,r=Math.PI/3,s=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(yi.DEFAULT_UP),this.updateMatrix(),this.target=new yi,this.distance=i,this.angle=r,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new V5}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const $N=new zt,Kf=new D,HS=new D;class H5 extends nA{constructor(){super(new Ii(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new fe(4,2),this._viewportCount=6,this._viewports=[new Je(2,1,1,1),new Je(0,1,1,1),new Je(3,1,1,1),new Je(1,1,1,1),new Je(3,0,1,1),new Je(1,0,1,1)],this._cubeDirections=[new D(1,0,0),new D(-1,0,0),new D(0,0,1),new D(0,0,-1),new D(0,1,0),new D(0,-1,0)],this._cubeUps=[new D(0,1,0),new D(0,1,0),new D(0,1,0),new D(0,1,0),new D(0,0,1),new D(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Kf.setFromMatrixPosition(e.matrixWorld),i.position.copy(Kf),HS.copy(i.position),HS.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(HS),i.updateMatrixWorld(),r.makeTranslation(-Kf.x,-Kf.y,-Kf.z),$N.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix($N,i.coordinateSystem,i.reversedDepth)}}class $5 extends Lc{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new H5}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Cg extends Xw{constructor(e=-1,t=1,i=1,r=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,a=i+e,o=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=u*this.view.offsetX,a=s+u*this.view.width,o-=c*this.view.offsetY,l=o-c*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class W5 extends nA{constructor(){super(new Cg(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class cI extends Lc{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(yi.DEFAULT_UP),this.updateMatrix(),this.target=new yi,this.shadow=new W5}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class hI extends Lc{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class j5 extends Lc{constructor(e,t,i=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class q5{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new D)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,r=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*r),t.addScaledVector(a[2],.488603*s),t.addScaledVector(a[3],.488603*i),t.addScaledVector(a[4],1.092548*(i*r)),t.addScaledVector(a[5],1.092548*(r*s)),t.addScaledVector(a[6],.315392*(3*s*s-1)),t.addScaledVector(a[7],1.092548*(i*s)),t.addScaledVector(a[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){const i=e.x,r=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],2*.511664*r),t.addScaledVector(a[2],2*.511664*s),t.addScaledVector(a[3],2*.511664*i),t.addScaledVector(a[4],2*.429043*i*r),t.addScaledVector(a[5],2*.429043*r*s),t.addScaledVector(a[6],.743125*s*s-.247708),t.addScaledVector(a[7],2*.429043*i*s),t.addScaledVector(a[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const i=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*i*s,t[8]=.546274*(i*i-r*r)}}class X5 extends Lc{constructor(e=new q5,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class dI extends Ii{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class fI{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}class Y5 extends rI{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}const WN=new zt;class pI{constructor(e,t,i=0,r=1/0){this.ray=new Z0(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new Ww,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return WN.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(WN),this}intersectObject(e,t=!0,i=[]){return fE(e,this,i,t),i.sort(jN),i}intersectObjects(e,t=!0,i=[]){for(let r=0,s=e.length;r<s;r++)fE(e[r],this,i,t);return i.sort(jN),i}}function jN(n,e){return n.distance-e.distance}function fE(n,e,t,i){let r=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(r=!1),r===!0&&i===!0){const s=n.children;for(let a=0,o=s.length;a<o;a++)fE(s[a],e,t,!0)}}class qN{constructor(e=1,t=0,i=0){this.radius=e,this.phi=t,this.theta=i}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Mt(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Mt(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class tb{constructor(e,t,i,r){tb.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,i,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let i=0;i<4;i++)this.elements[i]=e[i+t];return this}set(e,t,i,r){const s=this.elements;return s[0]=e,s[2]=t,s[1]=i,s[3]=r,this}}class nb extends sl{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function pE(n,e,t,i){const r=K5(i);switch(t){case Uw:return n*e;case Tg:return n*e/r.components*r.byteLength;case Tf:return n*e/r.components*r.byteLength;case zo:return n*e*2/r.components*r.byteLength;case Ef:return n*e*2/r.components*r.byteLength;case xg:return n*e*3/r.components*r.byteLength;case ii:return n*e*4/r.components*r.byteLength;case Mf:return n*e*4/r.components*r.byteLength;case Xl:case Yl:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Kl:case Ql:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Om:case Bm:return Math.max(n,16)*Math.max(e,8)/4;case Um:case Im:return Math.max(n,8)*Math.max(e,8)/2;case Rd:case Nd:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Cd:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Dd:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Ld:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case Pd:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case Ud:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case Od:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case Id:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case Bd:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case Fd:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case kd:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case zd:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case Gd:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case Vd:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case Hd:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case $d:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case Wd:case cE:case hE:return Math.ceil(n/4)*Math.ceil(e/4)*16;case jd:case qd:return Math.ceil(n/4)*Math.ceil(e/4)*8;case Xd:case Yd:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function K5(n){switch(n){case Kn:case sc:return{byteLength:1,components:1};case la:case ac:case Fi:return{byteLength:2,components:1};case j0:case q0:return{byteLength:2,components:4};case wn:case Oi:case li:return{byteLength:4,components:1};case X0:case Y0:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:xf}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=xf);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function mI(){let n=null,e=!1,t=null,i=null;function r(s,a){t(s,a),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function Q5(n){const e=new WeakMap;function t(o,l){const u=o.array,c=o.usage,h=u.byteLength,d=n.createBuffer();n.bindBuffer(l,d),n.bufferData(l,u,c),o.onUploadCallback();let f;if(u instanceof Float32Array)f=n.FLOAT;else if(typeof Float16Array<"u"&&u instanceof Float16Array)f=n.HALF_FLOAT;else if(u instanceof Uint16Array)o.isFloat16BufferAttribute?f=n.HALF_FLOAT:f=n.UNSIGNED_SHORT;else if(u instanceof Int16Array)f=n.SHORT;else if(u instanceof Uint32Array)f=n.UNSIGNED_INT;else if(u instanceof Int32Array)f=n.INT;else if(u instanceof Int8Array)f=n.BYTE;else if(u instanceof Uint8Array)f=n.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)f=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:d,type:f,bytesPerElement:u.BYTES_PER_ELEMENT,version:o.version,size:h}}function i(o,l,u){const c=l.array,h=l.updateRanges;if(n.bindBuffer(u,o),h.length===0)n.bufferSubData(u,0,c);else{h.sort((f,m)=>f.start-m.start);let d=0;for(let f=1;f<h.length;f++){const m=h[d],_=h[f];_.start<=m.start+m.count+1?m.count=Math.max(m.count,_.start+_.count-m.start):(++d,h[d]=_)}h.length=d+1;for(let f=0,m=h.length;f<m;f++){const _=h[f];n.bufferSubData(u,_.start*c.BYTES_PER_ELEMENT,c,_.start,_.count)}l.clearUpdateRanges()}l.onUploadCallback()}function r(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function s(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=e.get(o);l&&(n.deleteBuffer(l.buffer),e.delete(o))}function a(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const c=e.get(o);(!c||c.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const u=e.get(o);if(u===void 0)e.set(o,t(o,l));else if(u.version<o.version){if(u.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(u.buffer,o,l),u.version=o.version}}return{get:r,remove:s,update:a}}var Z5=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,J5=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,e$=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,t$=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,n$=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,i$=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,r$=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,s$=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,a$=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,o$=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,l$=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,u$=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,c$=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,h$=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,d$=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,f$=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,p$=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,m$=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,g$=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,_$=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,y$=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,v$=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,b$=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,S$=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,x$=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,T$=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,E$=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,M$=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,w$=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,A$=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,R$="gl_FragColor = linearToOutputTexel( gl_FragColor );",N$=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,C$=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,D$=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,L$=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,P$=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,U$=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,O$=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,I$=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,B$=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,F$=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,k$=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,z$=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,G$=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,V$=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,H$=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,$$=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,W$=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,j$=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,q$=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,X$=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Y$=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,K$=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Q$=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Z$=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,J$=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,eW=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,tW=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,nW=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,iW=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,rW=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,sW=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,aW=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,oW=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,lW=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,uW=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,cW=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,hW=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,dW=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,fW=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,pW=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,mW=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,gW=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,_W=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,yW=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,vW=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,bW=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,SW=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,xW=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,TW=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,EW=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,MW=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,wW=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,AW=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,RW=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,NW=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,CW=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,DW=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,LW=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,PW=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		float depth = unpackRGBAToDepth( texture2D( depths, uv ) );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			return step( depth, compare );
		#else
			return step( compare, depth );
		#endif
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow( sampler2D shadow, vec2 uv, float compare ) {
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			float hard_shadow = step( distribution.x, compare );
		#else
			float hard_shadow = step( compare, distribution.x );
		#endif
		if ( hard_shadow != 1.0 ) {
			float distance = compare - distribution.x;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,UW=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,OW=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,IW=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,BW=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,FW=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,kW=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,zW=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,GW=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,VW=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,HW=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,$W=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,WW=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,jW=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,qW=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,XW=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,YW=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,KW=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const QW=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,ZW=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,JW=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,ej=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,tj=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,nj=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ij=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,rj=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,sj=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,aj=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,oj=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,lj=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,uj=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,cj=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,hj=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,dj=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fj=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,pj=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mj=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,gj=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_j=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,yj=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,vj=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,bj=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Sj=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,xj=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Tj=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Ej=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Mj=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,wj=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Aj=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Rj=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Nj=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Cj=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Dt={alphahash_fragment:Z5,alphahash_pars_fragment:J5,alphamap_fragment:e$,alphamap_pars_fragment:t$,alphatest_fragment:n$,alphatest_pars_fragment:i$,aomap_fragment:r$,aomap_pars_fragment:s$,batching_pars_vertex:a$,batching_vertex:o$,begin_vertex:l$,beginnormal_vertex:u$,bsdfs:c$,iridescence_fragment:h$,bumpmap_pars_fragment:d$,clipping_planes_fragment:f$,clipping_planes_pars_fragment:p$,clipping_planes_pars_vertex:m$,clipping_planes_vertex:g$,color_fragment:_$,color_pars_fragment:y$,color_pars_vertex:v$,color_vertex:b$,common:S$,cube_uv_reflection_fragment:x$,defaultnormal_vertex:T$,displacementmap_pars_vertex:E$,displacementmap_vertex:M$,emissivemap_fragment:w$,emissivemap_pars_fragment:A$,colorspace_fragment:R$,colorspace_pars_fragment:N$,envmap_fragment:C$,envmap_common_pars_fragment:D$,envmap_pars_fragment:L$,envmap_pars_vertex:P$,envmap_physical_pars_fragment:$$,envmap_vertex:U$,fog_vertex:O$,fog_pars_vertex:I$,fog_fragment:B$,fog_pars_fragment:F$,gradientmap_pars_fragment:k$,lightmap_pars_fragment:z$,lights_lambert_fragment:G$,lights_lambert_pars_fragment:V$,lights_pars_begin:H$,lights_toon_fragment:W$,lights_toon_pars_fragment:j$,lights_phong_fragment:q$,lights_phong_pars_fragment:X$,lights_physical_fragment:Y$,lights_physical_pars_fragment:K$,lights_fragment_begin:Q$,lights_fragment_maps:Z$,lights_fragment_end:J$,logdepthbuf_fragment:eW,logdepthbuf_pars_fragment:tW,logdepthbuf_pars_vertex:nW,logdepthbuf_vertex:iW,map_fragment:rW,map_pars_fragment:sW,map_particle_fragment:aW,map_particle_pars_fragment:oW,metalnessmap_fragment:lW,metalnessmap_pars_fragment:uW,morphinstance_vertex:cW,morphcolor_vertex:hW,morphnormal_vertex:dW,morphtarget_pars_vertex:fW,morphtarget_vertex:pW,normal_fragment_begin:mW,normal_fragment_maps:gW,normal_pars_fragment:_W,normal_pars_vertex:yW,normal_vertex:vW,normalmap_pars_fragment:bW,clearcoat_normal_fragment_begin:SW,clearcoat_normal_fragment_maps:xW,clearcoat_pars_fragment:TW,iridescence_pars_fragment:EW,opaque_fragment:MW,packing:wW,premultiplied_alpha_fragment:AW,project_vertex:RW,dithering_fragment:NW,dithering_pars_fragment:CW,roughnessmap_fragment:DW,roughnessmap_pars_fragment:LW,shadowmap_pars_fragment:PW,shadowmap_pars_vertex:UW,shadowmap_vertex:OW,shadowmask_pars_fragment:IW,skinbase_vertex:BW,skinning_pars_vertex:FW,skinning_vertex:kW,skinnormal_vertex:zW,specularmap_fragment:GW,specularmap_pars_fragment:VW,tonemapping_fragment:HW,tonemapping_pars_fragment:$W,transmission_fragment:WW,transmission_pars_fragment:jW,uv_pars_fragment:qW,uv_pars_vertex:XW,uv_vertex:YW,worldpos_vertex:KW,background_vert:QW,background_frag:ZW,backgroundCube_vert:JW,backgroundCube_frag:ej,cube_vert:tj,cube_frag:nj,depth_vert:ij,depth_frag:rj,distanceRGBA_vert:sj,distanceRGBA_frag:aj,equirect_vert:oj,equirect_frag:lj,linedashed_vert:uj,linedashed_frag:cj,meshbasic_vert:hj,meshbasic_frag:dj,meshlambert_vert:fj,meshlambert_frag:pj,meshmatcap_vert:mj,meshmatcap_frag:gj,meshnormal_vert:_j,meshnormal_frag:yj,meshphong_vert:vj,meshphong_frag:bj,meshphysical_vert:Sj,meshphysical_frag:xj,meshtoon_vert:Tj,meshtoon_frag:Ej,points_vert:Mj,points_frag:wj,shadow_vert:Aj,shadow_frag:Rj,sprite_vert:Nj,sprite_frag:Cj},we={common:{diffuse:{value:new Ve(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new vt},alphaMap:{value:null},alphaMapTransform:{value:new vt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new vt}},envmap:{envMap:{value:null},envMapRotation:{value:new vt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new vt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new vt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new vt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new vt},normalScale:{value:new fe(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new vt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new vt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new vt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new vt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ve(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ve(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new vt},alphaTest:{value:0},uvTransform:{value:new vt}},sprite:{diffuse:{value:new Ve(16777215)},opacity:{value:1},center:{value:new fe(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new vt},alphaMap:{value:null},alphaMapTransform:{value:new vt},alphaTest:{value:0}}},Na={basic:{uniforms:lr([we.common,we.specularmap,we.envmap,we.aomap,we.lightmap,we.fog]),vertexShader:Dt.meshbasic_vert,fragmentShader:Dt.meshbasic_frag},lambert:{uniforms:lr([we.common,we.specularmap,we.envmap,we.aomap,we.lightmap,we.emissivemap,we.bumpmap,we.normalmap,we.displacementmap,we.fog,we.lights,{emissive:{value:new Ve(0)}}]),vertexShader:Dt.meshlambert_vert,fragmentShader:Dt.meshlambert_frag},phong:{uniforms:lr([we.common,we.specularmap,we.envmap,we.aomap,we.lightmap,we.emissivemap,we.bumpmap,we.normalmap,we.displacementmap,we.fog,we.lights,{emissive:{value:new Ve(0)},specular:{value:new Ve(1118481)},shininess:{value:30}}]),vertexShader:Dt.meshphong_vert,fragmentShader:Dt.meshphong_frag},standard:{uniforms:lr([we.common,we.envmap,we.aomap,we.lightmap,we.emissivemap,we.bumpmap,we.normalmap,we.displacementmap,we.roughnessmap,we.metalnessmap,we.fog,we.lights,{emissive:{value:new Ve(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Dt.meshphysical_vert,fragmentShader:Dt.meshphysical_frag},toon:{uniforms:lr([we.common,we.aomap,we.lightmap,we.emissivemap,we.bumpmap,we.normalmap,we.displacementmap,we.gradientmap,we.fog,we.lights,{emissive:{value:new Ve(0)}}]),vertexShader:Dt.meshtoon_vert,fragmentShader:Dt.meshtoon_frag},matcap:{uniforms:lr([we.common,we.bumpmap,we.normalmap,we.displacementmap,we.fog,{matcap:{value:null}}]),vertexShader:Dt.meshmatcap_vert,fragmentShader:Dt.meshmatcap_frag},points:{uniforms:lr([we.points,we.fog]),vertexShader:Dt.points_vert,fragmentShader:Dt.points_frag},dashed:{uniforms:lr([we.common,we.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Dt.linedashed_vert,fragmentShader:Dt.linedashed_frag},depth:{uniforms:lr([we.common,we.displacementmap]),vertexShader:Dt.depth_vert,fragmentShader:Dt.depth_frag},normal:{uniforms:lr([we.common,we.bumpmap,we.normalmap,we.displacementmap,{opacity:{value:1}}]),vertexShader:Dt.meshnormal_vert,fragmentShader:Dt.meshnormal_frag},sprite:{uniforms:lr([we.sprite,we.fog]),vertexShader:Dt.sprite_vert,fragmentShader:Dt.sprite_frag},background:{uniforms:{uvTransform:{value:new vt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Dt.background_vert,fragmentShader:Dt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new vt}},vertexShader:Dt.backgroundCube_vert,fragmentShader:Dt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Dt.cube_vert,fragmentShader:Dt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Dt.equirect_vert,fragmentShader:Dt.equirect_frag},distanceRGBA:{uniforms:lr([we.common,we.displacementmap,{referencePosition:{value:new D},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Dt.distanceRGBA_vert,fragmentShader:Dt.distanceRGBA_frag},shadow:{uniforms:lr([we.lights,we.fog,{color:{value:new Ve(0)},opacity:{value:1}}]),vertexShader:Dt.shadow_vert,fragmentShader:Dt.shadow_frag}};Na.physical={uniforms:lr([Na.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new vt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new vt},clearcoatNormalScale:{value:new fe(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new vt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new vt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new vt},sheen:{value:0},sheenColor:{value:new Ve(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new vt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new vt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new vt},transmissionSamplerSize:{value:new fe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new vt},attenuationDistance:{value:0},attenuationColor:{value:new Ve(0)},specularColor:{value:new Ve(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new vt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new vt},anisotropyVector:{value:new fe},anisotropyMap:{value:null},anisotropyMapTransform:{value:new vt}}]),vertexShader:Dt.meshphysical_vert,fragmentShader:Dt.meshphysical_frag};const N_={r:0,b:0,g:0},Nu=new Vr,Dj=new zt;function Lj(n,e,t,i,r,s,a){const o=new Ve(0);let l=s===!0?0:1,u,c,h=null,d=0,f=null;function m(v){let b=v.isScene===!0?v.background:null;return b&&b.isTexture&&(b=(v.backgroundBlurriness>0?t:e).get(b)),b}function _(v){let b=!1;const S=m(v);S===null?p(o,l):S&&S.isColor&&(p(S,1),b=!0);const x=n.xr.getEnvironmentBlendMode();x==="additive"?i.buffers.color.setClear(0,0,0,1,a):x==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,a),(n.autoClear||b)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function g(v,b){const S=m(b);S&&(S.isCubeTexture||S.mapping===pc)?(c===void 0&&(c=new mi(new Dc(1,1,1),new Xa({name:"BackgroundCubeMaterial",uniforms:Qd(Na.backgroundCube.uniforms),vertexShader:Na.backgroundCube.vertexShader,fragmentShader:Na.backgroundCube.fragmentShader,side:bn,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(x,T,w){this.matrixWorld.copyPosition(w.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),Nu.copy(b.backgroundRotation),Nu.x*=-1,Nu.y*=-1,Nu.z*=-1,S.isCubeTexture&&S.isRenderTargetTexture===!1&&(Nu.y*=-1,Nu.z*=-1),c.material.uniforms.envMap.value=S,c.material.uniforms.flipEnvMap.value=S.isCubeTexture&&S.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=b.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=b.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(Dj.makeRotationFromEuler(Nu)),c.material.toneMapped=Ze.getTransfer(S.colorSpace)!==Re,(h!==S||d!==S.version||f!==n.toneMapping)&&(c.material.needsUpdate=!0,h=S,d=S.version,f=n.toneMapping),c.layers.enableAll(),v.unshift(c,c.geometry,c.material,0,0,null)):S&&S.isTexture&&(u===void 0&&(u=new mi(new Rg(2,2),new Xa({name:"BackgroundMaterial",uniforms:Qd(Na.background.uniforms),vertexShader:Na.background.vertexShader,fragmentShader:Na.background.fragmentShader,side:ps,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(u)),u.material.uniforms.t2D.value=S,u.material.uniforms.backgroundIntensity.value=b.backgroundIntensity,u.material.toneMapped=Ze.getTransfer(S.colorSpace)!==Re,S.matrixAutoUpdate===!0&&S.updateMatrix(),u.material.uniforms.uvTransform.value.copy(S.matrix),(h!==S||d!==S.version||f!==n.toneMapping)&&(u.material.needsUpdate=!0,h=S,d=S.version,f=n.toneMapping),u.layers.enableAll(),v.unshift(u,u.geometry,u.material,0,0,null))}function p(v,b){v.getRGB(N_,eI(n)),i.buffers.color.setClear(N_.r,N_.g,N_.b,b,a)}function y(){c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0),u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0)}return{getClearColor:function(){return o},setClearColor:function(v,b=1){o.set(v),l=b,p(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(v){l=v,p(o,l)},render:_,addToRenderList:g,dispose:y}}function Pj(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},r=d(null);let s=r,a=!1;function o(M,N,U,k,P){let O=!1;const C=h(k,U,N);s!==C&&(s=C,u(s.object)),O=f(M,k,U,P),O&&m(M,k,U,P),P!==null&&e.update(P,n.ELEMENT_ARRAY_BUFFER),(O||a)&&(a=!1,b(M,N,U,k),P!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(P).buffer))}function l(){return n.createVertexArray()}function u(M){return n.bindVertexArray(M)}function c(M){return n.deleteVertexArray(M)}function h(M,N,U){const k=U.wireframe===!0;let P=i[M.id];P===void 0&&(P={},i[M.id]=P);let O=P[N.id];O===void 0&&(O={},P[N.id]=O);let C=O[k];return C===void 0&&(C=d(l()),O[k]=C),C}function d(M){const N=[],U=[],k=[];for(let P=0;P<t;P++)N[P]=0,U[P]=0,k[P]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:N,enabledAttributes:U,attributeDivisors:k,object:M,attributes:{},index:null}}function f(M,N,U,k){const P=s.attributes,O=N.attributes;let C=0;const q=U.getAttributes();for(const z in q)if(q[z].location>=0){const X=P[z];let oe=O[z];if(oe===void 0&&(z==="instanceMatrix"&&M.instanceMatrix&&(oe=M.instanceMatrix),z==="instanceColor"&&M.instanceColor&&(oe=M.instanceColor)),X===void 0||X.attribute!==oe||oe&&X.data!==oe.data)return!0;C++}return s.attributesNum!==C||s.index!==k}function m(M,N,U,k){const P={},O=N.attributes;let C=0;const q=U.getAttributes();for(const z in q)if(q[z].location>=0){let X=O[z];X===void 0&&(z==="instanceMatrix"&&M.instanceMatrix&&(X=M.instanceMatrix),z==="instanceColor"&&M.instanceColor&&(X=M.instanceColor));const oe={};oe.attribute=X,X&&X.data&&(oe.data=X.data),P[z]=oe,C++}s.attributes=P,s.attributesNum=C,s.index=k}function _(){const M=s.newAttributes;for(let N=0,U=M.length;N<U;N++)M[N]=0}function g(M){p(M,0)}function p(M,N){const U=s.newAttributes,k=s.enabledAttributes,P=s.attributeDivisors;U[M]=1,k[M]===0&&(n.enableVertexAttribArray(M),k[M]=1),P[M]!==N&&(n.vertexAttribDivisor(M,N),P[M]=N)}function y(){const M=s.newAttributes,N=s.enabledAttributes;for(let U=0,k=N.length;U<k;U++)N[U]!==M[U]&&(n.disableVertexAttribArray(U),N[U]=0)}function v(M,N,U,k,P,O,C){C===!0?n.vertexAttribIPointer(M,N,U,P,O):n.vertexAttribPointer(M,N,U,k,P,O)}function b(M,N,U,k){_();const P=k.attributes,O=U.getAttributes(),C=N.defaultAttributeValues;for(const q in O){const z=O[q];if(z.location>=0){let re=P[q];if(re===void 0&&(q==="instanceMatrix"&&M.instanceMatrix&&(re=M.instanceMatrix),q==="instanceColor"&&M.instanceColor&&(re=M.instanceColor)),re!==void 0){const X=re.normalized,oe=re.itemSize,be=e.get(re);if(be===void 0)continue;const Oe=be.buffer,st=be.type,ie=be.bytesPerElement,W=st===n.INT||st===n.UNSIGNED_INT||re.gpuType===Oi;if(re.isInterleavedBufferAttribute){const K=re.data,_e=K.stride,Pe=re.offset;if(K.isInstancedInterleavedBuffer){for(let Me=0;Me<z.locationSize;Me++)p(z.location+Me,K.meshPerAttribute);M.isInstancedMesh!==!0&&k._maxInstanceCount===void 0&&(k._maxInstanceCount=K.meshPerAttribute*K.count)}else for(let Me=0;Me<z.locationSize;Me++)g(z.location+Me);n.bindBuffer(n.ARRAY_BUFFER,Oe);for(let Me=0;Me<z.locationSize;Me++)v(z.location+Me,oe/z.locationSize,st,X,_e*ie,(Pe+oe/z.locationSize*Me)*ie,W)}else{if(re.isInstancedBufferAttribute){for(let K=0;K<z.locationSize;K++)p(z.location+K,re.meshPerAttribute);M.isInstancedMesh!==!0&&k._maxInstanceCount===void 0&&(k._maxInstanceCount=re.meshPerAttribute*re.count)}else for(let K=0;K<z.locationSize;K++)g(z.location+K);n.bindBuffer(n.ARRAY_BUFFER,Oe);for(let K=0;K<z.locationSize;K++)v(z.location+K,oe/z.locationSize,st,X,oe*ie,oe/z.locationSize*K*ie,W)}}else if(C!==void 0){const X=C[q];if(X!==void 0)switch(X.length){case 2:n.vertexAttrib2fv(z.location,X);break;case 3:n.vertexAttrib3fv(z.location,X);break;case 4:n.vertexAttrib4fv(z.location,X);break;default:n.vertexAttrib1fv(z.location,X)}}}}y()}function S(){w();for(const M in i){const N=i[M];for(const U in N){const k=N[U];for(const P in k)c(k[P].object),delete k[P];delete N[U]}delete i[M]}}function x(M){if(i[M.id]===void 0)return;const N=i[M.id];for(const U in N){const k=N[U];for(const P in k)c(k[P].object),delete k[P];delete N[U]}delete i[M.id]}function T(M){for(const N in i){const U=i[N];if(U[M.id]===void 0)continue;const k=U[M.id];for(const P in k)c(k[P].object),delete k[P];delete U[M.id]}}function w(){E(),a=!0,s!==r&&(s=r,u(s.object))}function E(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:o,reset:w,resetDefaultState:E,dispose:S,releaseStatesOfGeometry:x,releaseStatesOfProgram:T,initAttributes:_,enableAttribute:g,disableUnusedAttributes:y}}function Uj(n,e,t){let i;function r(u){i=u}function s(u,c){n.drawArrays(i,u,c),t.update(c,i,1)}function a(u,c,h){h!==0&&(n.drawArraysInstanced(i,u,c,h),t.update(c,i,h))}function o(u,c,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,u,0,c,0,h);let f=0;for(let m=0;m<h;m++)f+=c[m];t.update(f,i,1)}function l(u,c,h,d){if(h===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let m=0;m<u.length;m++)a(u[m],c[m],d[m]);else{f.multiDrawArraysInstancedWEBGL(i,u,0,c,0,d,0,h);let m=0;for(let _=0;_<h;_++)m+=c[_]*d[_];t.update(m,i,1)}}this.setMode=r,this.render=s,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function Oj(n,e,t,i){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const T=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function a(T){return!(T!==ii&&i.convert(T)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(T){const w=T===Fi&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(T!==Kn&&i.convert(T)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&T!==li&&!w)}function l(T){if(T==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";T="mediump"}return T==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=t.precision!==void 0?t.precision:"highp";const c=l(u);c!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",c,"instead."),u=c);const h=t.logarithmicDepthBuffer===!0,d=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),f=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),m=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_=n.getParameter(n.MAX_TEXTURE_SIZE),g=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),p=n.getParameter(n.MAX_VERTEX_ATTRIBS),y=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),v=n.getParameter(n.MAX_VARYING_VECTORS),b=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),S=m>0,x=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:a,textureTypeReadable:o,precision:u,logarithmicDepthBuffer:h,reversedDepthBuffer:d,maxTextures:f,maxVertexTextures:m,maxTextureSize:_,maxCubemapSize:g,maxAttributes:p,maxVertexUniforms:y,maxVaryings:v,maxFragmentUniforms:b,vertexTextures:S,maxSamples:x}}function Ij(n){const e=this;let t=null,i=0,r=!1,s=!1;const a=new ia,o=new vt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const f=h.length!==0||d||i!==0||r;return r=d,i=h.length,f},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){t=c(h,d,0)},this.setState=function(h,d,f){const m=h.clippingPlanes,_=h.clipIntersection,g=h.clipShadows,p=n.get(h);if(!r||m===null||m.length===0||s&&!g)s?c(null):u();else{const y=s?0:i,v=y*4;let b=p.clippingState||null;l.value=b,b=c(m,d,v,f);for(let S=0;S!==v;++S)b[S]=t[S];p.clippingState=b,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=y}};function u(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function c(h,d,f,m){const _=h!==null?h.length:0;let g=null;if(_!==0){if(g=l.value,m!==!0||g===null){const p=f+_*4,y=d.matrixWorldInverse;o.getNormalMatrix(y),(g===null||g.length<p)&&(g=new Float32Array(p));for(let v=0,b=f;v!==_;++v,b+=4)a.copy(h[v]).applyMatrix4(y,o),a.normal.toArray(g,b),g[b+3]=a.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,g}}function Bj(n){let e=new WeakMap;function t(a,o){return o===wd?a.mapping=ja:o===Ad&&(a.mapping=qa),a}function i(a){if(a&&a.isTexture){const o=a.mapping;if(o===wd||o===Ad)if(e.has(a)){const l=e.get(a).texture;return t(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const u=new iI(l.height);return u.fromEquirectangularTexture(n,a),e.set(a,u),a.addEventListener("dispose",r),t(u.texture,a.mapping)}else return null}}return a}function r(a){const o=a.target;o.removeEventListener("dispose",r);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}const kh=4,XN=[.125,.215,.35,.446,.526,.582],Wu=20,$S=new Cg,YN=new Ve;let WS=null,jS=0,qS=0,XS=!1;const Gu=(1+Math.sqrt(5))/2,Qc=1/Gu,KN=[new D(-Gu,Qc,0),new D(Gu,Qc,0),new D(-Qc,0,Gu),new D(Qc,0,Gu),new D(0,Gu,-Qc),new D(0,Gu,Qc),new D(-1,1,-1),new D(1,1,-1),new D(-1,1,1),new D(1,1,1)],Fj=new D;let QN=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100,s={}){const{size:a=256,position:o=Fj}=s;WS=this._renderer.getRenderTarget(),jS=this._renderer.getActiveCubeFace(),qS=this._renderer.getActiveMipmapLevel(),XS=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,i,r,l,o),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=eC(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=JN(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(WS,jS,qS),this._renderer.xr.enabled=XS,e.scissorTest=!1,C_(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ja||e.mapping===qa?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),WS=this._renderer.getRenderTarget(),jS=this._renderer.getActiveCubeFace(),qS=this._renderer.getActiveMipmapLevel(),XS=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:wi,minFilter:wi,generateMipmaps:!1,type:Fi,format:ii,colorSpace:_c,depthBuffer:!1},r=ZN(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=ZN(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=kj(s)),this._blurMaterial=zj(s,e,t)}return r}_compileMaterial(e){const t=new mi(this._lodPlanes[0],e);this._renderer.compile(t,$S)}_sceneToCubeUV(e,t,i,r,s){const l=new Ii(90,1,t,i),u=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,f=h.toneMapping;h.getClearColor(YN),h.toneMapping=zr,h.autoClear=!1,h.state.buffers.depth.getReversed()&&(h.setRenderTarget(r),h.clearDepth(),h.setRenderTarget(null));const _=new Da({name:"PMREM.Background",side:bn,depthWrite:!1,depthTest:!1}),g=new mi(new Dc,_);let p=!1;const y=e.background;y?y.isColor&&(_.color.copy(y),e.background=null,p=!0):(_.color.copy(YN),p=!0);for(let v=0;v<6;v++){const b=v%3;b===0?(l.up.set(0,u[v],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x+c[v],s.y,s.z)):b===1?(l.up.set(0,0,u[v]),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y+c[v],s.z)):(l.up.set(0,u[v],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y,s.z+c[v]));const S=this._cubeSize;C_(r,b*S,v>2?S:0,S,S),h.setRenderTarget(r),p&&h.render(g,l),h.render(e,l)}g.geometry.dispose(),g.material.dispose(),h.toneMapping=f,h.autoClear=d,e.background=y}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===ja||e.mapping===qa;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=eC()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=JN());const s=r?this._cubemapMaterial:this._equirectMaterial,a=new mi(this._lodPlanes[0],s),o=s.uniforms;o.envMap.value=e;const l=this._cubeSize;C_(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(a,$S)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=KN[(r-s-1)%KN.length];this._blur(e,s-1,s,a,o)}t.autoClear=i}_blur(e,t,i,r,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,r,"latitudinal",s),this._halfBlur(a,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,a,o){const l=this._renderer,u=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,h=new mi(this._lodPlanes[r],u),d=u.uniforms,f=this._sizeLods[i]-1,m=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*Wu-1),_=s/m,g=isFinite(s)?1+Math.floor(c*_):Wu;g>Wu&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${Wu}`);const p=[];let y=0;for(let T=0;T<Wu;++T){const w=T/_,E=Math.exp(-w*w/2);p.push(E),T===0?y+=E:T<g&&(y+=2*E)}for(let T=0;T<p.length;T++)p[T]=p[T]/y;d.envMap.value=e.texture,d.samples.value=g,d.weights.value=p,d.latitudinal.value=a==="latitudinal",o&&(d.poleAxis.value=o);const{_lodMax:v}=this;d.dTheta.value=m,d.mipInt.value=v-i;const b=this._sizeLods[r],S=3*b*(r>v-kh?r-v+kh:0),x=4*(this._cubeSize-b);C_(t,S,x,3*b,2*b),l.setRenderTarget(t),l.render(h,$S)}};function kj(n){const e=[],t=[],i=[];let r=n;const s=n-kh+1+XN.length;for(let a=0;a<s;a++){const o=Math.pow(2,r);t.push(o);let l=1/o;a>n-kh?l=XN[a-n+kh-1]:a===0&&(l=0),i.push(l);const u=1/(o-2),c=-u,h=1+u,d=[c,c,h,c,h,h,c,c,h,h,c,h],f=6,m=6,_=3,g=2,p=1,y=new Float32Array(_*m*f),v=new Float32Array(g*m*f),b=new Float32Array(p*m*f);for(let x=0;x<f;x++){const T=x%3*2/3-1,w=x>2?0:-1,E=[T,w,0,T+2/3,w,0,T+2/3,w+1,0,T,w,0,T+2/3,w+1,0,T,w+1,0];y.set(E,_*m*x),v.set(d,g*m*x);const M=[x,x,x,x,x,x];b.set(M,p*m*x)}const S=new Er;S.setAttribute("position",new Wi(y,_)),S.setAttribute("uv",new Wi(v,g)),S.setAttribute("faceIndex",new Wi(b,p)),e.push(S),r>kh&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function ZN(n,e,t){const i=new su(n,e,t);return i.texture.mapping=pc,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function C_(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function zj(n,e,t){const i=new Float32Array(Wu),r=new D(0,1,0);return new Xa({name:"SphericalGaussianBlur",defines:{n:Wu,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:rA(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:kr,depthTest:!1,depthWrite:!1})}function JN(){return new Xa({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:rA(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:kr,depthTest:!1,depthWrite:!1})}function eC(){return new Xa({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:rA(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:kr,depthTest:!1,depthWrite:!1})}function rA(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Gj(n){let e=new WeakMap,t=null;function i(o){if(o&&o.isTexture){const l=o.mapping,u=l===wd||l===Ad,c=l===ja||l===qa;if(u||c){let h=e.get(o);const d=h!==void 0?h.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==d)return t===null&&(t=new QN(n)),h=u?t.fromEquirectangular(o,h):t.fromCubemap(o,h),h.texture.pmremVersion=o.pmremVersion,e.set(o,h),h.texture;if(h!==void 0)return h.texture;{const f=o.image;return u&&f&&f.height>0||c&&f&&r(f)?(t===null&&(t=new QN(n)),h=u?t.fromEquirectangular(o):t.fromCubemap(o),h.texture.pmremVersion=o.pmremVersion,e.set(o,h),o.addEventListener("dispose",s),h.texture):null}}}return o}function r(o){let l=0;const u=6;for(let c=0;c<u;c++)o[c]!==void 0&&l++;return l===u}function s(o){const l=o.target;l.removeEventListener("dispose",s);const u=e.get(l);u!==void 0&&(e.delete(l),u.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:a}}function Vj(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const r=t(i);return r===null&&vs("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function Hj(n,e,t,i){const r={},s=new WeakMap;function a(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const m in d.attributes)e.remove(d.attributes[m]);d.removeEventListener("dispose",a),delete r[d.id];const f=s.get(d);f&&(e.remove(f),s.delete(d)),i.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function o(h,d){return r[d.id]===!0||(d.addEventListener("dispose",a),r[d.id]=!0,t.memory.geometries++),d}function l(h){const d=h.attributes;for(const f in d)e.update(d[f],n.ARRAY_BUFFER)}function u(h){const d=[],f=h.index,m=h.attributes.position;let _=0;if(f!==null){const y=f.array;_=f.version;for(let v=0,b=y.length;v<b;v+=3){const S=y[v+0],x=y[v+1],T=y[v+2];d.push(S,x,x,T,T,S)}}else if(m!==void 0){const y=m.array;_=m.version;for(let v=0,b=y.length/3-1;v<b;v+=3){const S=v+0,x=v+1,T=v+2;d.push(S,x,x,T,T,S)}}else return;const g=new(Vw(d)?qw:jw)(d,1);g.version=_;const p=s.get(h);p&&e.remove(p),s.set(h,g)}function c(h){const d=s.get(h);if(d){const f=h.index;f!==null&&d.version<f.version&&u(h)}else u(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:c}}function $j(n,e,t){let i;function r(d){i=d}let s,a;function o(d){s=d.type,a=d.bytesPerElement}function l(d,f){n.drawElements(i,f,s,d*a),t.update(f,i,1)}function u(d,f,m){m!==0&&(n.drawElementsInstanced(i,f,s,d*a,m),t.update(f,i,m))}function c(d,f,m){if(m===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,f,0,s,d,0,m);let g=0;for(let p=0;p<m;p++)g+=f[p];t.update(g,i,1)}function h(d,f,m,_){if(m===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let p=0;p<d.length;p++)u(d[p]/a,f[p],_[p]);else{g.multiDrawElementsInstancedWEBGL(i,f,0,s,d,0,_,0,m);let p=0;for(let y=0;y<m;y++)p+=f[y]*_[y];t.update(p,i,1)}}this.setMode=r,this.setIndex=o,this.render=l,this.renderInstances=u,this.renderMultiDraw=c,this.renderMultiDrawInstances=h}function Wj(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,a,o){switch(t.calls++,a){case n.TRIANGLES:t.triangles+=o*(s/3);break;case n.LINES:t.lines+=o*(s/2);break;case n.LINE_STRIP:t.lines+=o*(s-1);break;case n.LINE_LOOP:t.lines+=o*s;break;case n.POINTS:t.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}function jj(n,e,t){const i=new WeakMap,r=new Je;function s(a,o,l){const u=a.morphTargetInfluences,c=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,h=c!==void 0?c.length:0;let d=i.get(o);if(d===void 0||d.count!==h){let E=function(){T.dispose(),i.delete(o),o.removeEventListener("dispose",E)};d!==void 0&&d.texture.dispose();const f=o.morphAttributes.position!==void 0,m=o.morphAttributes.normal!==void 0,_=o.morphAttributes.color!==void 0,g=o.morphAttributes.position||[],p=o.morphAttributes.normal||[],y=o.morphAttributes.color||[];let v=0;f===!0&&(v=1),m===!0&&(v=2),_===!0&&(v=3);let b=o.attributes.position.count*v,S=1;b>e.maxTextureSize&&(S=Math.ceil(b/e.maxTextureSize),b=e.maxTextureSize);const x=new Float32Array(b*S*4*h),T=new $w(x,b,S,h);T.type=li,T.needsUpdate=!0;const w=v*4;for(let M=0;M<h;M++){const N=g[M],U=p[M],k=y[M],P=b*S*4*M;for(let O=0;O<N.count;O++){const C=O*w;f===!0&&(r.fromBufferAttribute(N,O),x[P+C+0]=r.x,x[P+C+1]=r.y,x[P+C+2]=r.z,x[P+C+3]=0),m===!0&&(r.fromBufferAttribute(U,O),x[P+C+4]=r.x,x[P+C+5]=r.y,x[P+C+6]=r.z,x[P+C+7]=0),_===!0&&(r.fromBufferAttribute(k,O),x[P+C+8]=r.x,x[P+C+9]=r.y,x[P+C+10]=r.z,x[P+C+11]=k.itemSize===4?r.w:1)}}d={count:h,texture:T,size:new fe(b,S)},i.set(o,d),o.addEventListener("dispose",E)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",a.morphTexture,t);else{let f=0;for(let _=0;_<u.length;_++)f+=u[_];const m=o.morphTargetsRelative?1:1-f;l.getUniforms().setValue(n,"morphTargetBaseInfluence",m),l.getUniforms().setValue(n,"morphTargetInfluences",u)}l.getUniforms().setValue(n,"morphTargetsTexture",d.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",d.size)}return{update:s}}function qj(n,e,t,i){let r=new WeakMap;function s(l){const u=i.render.frame,c=l.geometry,h=e.get(l,c);if(r.get(h)!==u&&(e.update(h),r.set(h,u)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),r.get(l)!==u&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),r.set(l,u))),l.isSkinnedMesh){const d=l.skeleton;r.get(d)!==u&&(d.update(),r.set(d,u))}return h}function a(){r=new WeakMap}function o(l){const u=l.target;u.removeEventListener("dispose",o),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:s,dispose:a}}const gI=new _i,tC=new ks(1,1),_I=new $w,yI=new G8,vI=new Mg,nC=[],iC=[],rC=new Float32Array(16),sC=new Float32Array(9),aC=new Float32Array(4);function wf(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=nC[r];if(s===void 0&&(s=new Float32Array(r),nC[r]=s),e!==0){i.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=t,n[a].toArray(s,o)}return s}function Ri(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Ni(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function ib(n,e){let t=iC[e];t===void 0&&(t=new Int32Array(e),iC[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function Xj(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function Yj(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ri(t,e))return;n.uniform2fv(this.addr,e),Ni(t,e)}}function Kj(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Ri(t,e))return;n.uniform3fv(this.addr,e),Ni(t,e)}}function Qj(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ri(t,e))return;n.uniform4fv(this.addr,e),Ni(t,e)}}function Zj(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Ri(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Ni(t,e)}else{if(Ri(t,i))return;aC.set(i),n.uniformMatrix2fv(this.addr,!1,aC),Ni(t,i)}}function Jj(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Ri(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Ni(t,e)}else{if(Ri(t,i))return;sC.set(i),n.uniformMatrix3fv(this.addr,!1,sC),Ni(t,i)}}function e9(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Ri(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Ni(t,e)}else{if(Ri(t,i))return;rC.set(i),n.uniformMatrix4fv(this.addr,!1,rC),Ni(t,i)}}function t9(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function n9(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ri(t,e))return;n.uniform2iv(this.addr,e),Ni(t,e)}}function i9(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ri(t,e))return;n.uniform3iv(this.addr,e),Ni(t,e)}}function r9(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ri(t,e))return;n.uniform4iv(this.addr,e),Ni(t,e)}}function s9(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function a9(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ri(t,e))return;n.uniform2uiv(this.addr,e),Ni(t,e)}}function o9(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ri(t,e))return;n.uniform3uiv(this.addr,e),Ni(t,e)}}function l9(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ri(t,e))return;n.uniform4uiv(this.addr,e),Ni(t,e)}}function u9(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r);let s;this.type===n.SAMPLER_2D_SHADOW?(tC.compareFunction=Q0,s=tC):s=gI,t.setTexture2D(e||s,r)}function c9(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||yI,r)}function h9(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||vI,r)}function d9(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||_I,r)}function f9(n){switch(n){case 5126:return Xj;case 35664:return Yj;case 35665:return Kj;case 35666:return Qj;case 35674:return Zj;case 35675:return Jj;case 35676:return e9;case 5124:case 35670:return t9;case 35667:case 35671:return n9;case 35668:case 35672:return i9;case 35669:case 35673:return r9;case 5125:return s9;case 36294:return a9;case 36295:return o9;case 36296:return l9;case 35678:case 36198:case 36298:case 36306:case 35682:return u9;case 35679:case 36299:case 36307:return c9;case 35680:case 36300:case 36308:case 36293:return h9;case 36289:case 36303:case 36311:case 36292:return d9}}function p9(n,e){n.uniform1fv(this.addr,e)}function m9(n,e){const t=wf(e,this.size,2);n.uniform2fv(this.addr,t)}function g9(n,e){const t=wf(e,this.size,3);n.uniform3fv(this.addr,t)}function _9(n,e){const t=wf(e,this.size,4);n.uniform4fv(this.addr,t)}function y9(n,e){const t=wf(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function v9(n,e){const t=wf(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function b9(n,e){const t=wf(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function S9(n,e){n.uniform1iv(this.addr,e)}function x9(n,e){n.uniform2iv(this.addr,e)}function T9(n,e){n.uniform3iv(this.addr,e)}function E9(n,e){n.uniform4iv(this.addr,e)}function M9(n,e){n.uniform1uiv(this.addr,e)}function w9(n,e){n.uniform2uiv(this.addr,e)}function A9(n,e){n.uniform3uiv(this.addr,e)}function R9(n,e){n.uniform4uiv(this.addr,e)}function N9(n,e,t){const i=this.cache,r=e.length,s=ib(t,r);Ri(i,s)||(n.uniform1iv(this.addr,s),Ni(i,s));for(let a=0;a!==r;++a)t.setTexture2D(e[a]||gI,s[a])}function C9(n,e,t){const i=this.cache,r=e.length,s=ib(t,r);Ri(i,s)||(n.uniform1iv(this.addr,s),Ni(i,s));for(let a=0;a!==r;++a)t.setTexture3D(e[a]||yI,s[a])}function D9(n,e,t){const i=this.cache,r=e.length,s=ib(t,r);Ri(i,s)||(n.uniform1iv(this.addr,s),Ni(i,s));for(let a=0;a!==r;++a)t.setTextureCube(e[a]||vI,s[a])}function L9(n,e,t){const i=this.cache,r=e.length,s=ib(t,r);Ri(i,s)||(n.uniform1iv(this.addr,s),Ni(i,s));for(let a=0;a!==r;++a)t.setTexture2DArray(e[a]||_I,s[a])}function P9(n){switch(n){case 5126:return p9;case 35664:return m9;case 35665:return g9;case 35666:return _9;case 35674:return y9;case 35675:return v9;case 35676:return b9;case 5124:case 35670:return S9;case 35667:case 35671:return x9;case 35668:case 35672:return T9;case 35669:case 35673:return E9;case 5125:return M9;case 36294:return w9;case 36295:return A9;case 36296:return R9;case 35678:case 36198:case 36298:case 36306:case 35682:return N9;case 35679:case 36299:case 36307:return C9;case 35680:case 36300:case 36308:case 36293:return D9;case 36289:case 36303:case 36311:case 36292:return L9}}class U9{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=f9(t.type)}}class O9{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=P9(t.type)}}class I9{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,a=r.length;s!==a;++s){const o=r[s];o.setValue(e,t[o.id],i)}}}const YS=/(\w+)(\])?(\[|\.)?/g;function oC(n,e){n.seq.push(e),n.map[e.id]=e}function B9(n,e,t){const i=n.name,r=i.length;for(YS.lastIndex=0;;){const s=YS.exec(i),a=YS.lastIndex;let o=s[1];const l=s[2]==="]",u=s[3];if(l&&(o=o|0),u===void 0||u==="["&&a+2===r){oC(t,u===void 0?new U9(o,n,e):new O9(o,n,e));break}else{let h=t.map[o];h===void 0&&(h=new I9(o),oC(t,h)),t=h}}}class Ay{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r),a=e.getUniformLocation(t,s.name);B9(s,a,this)}}setValue(e,t,i,r){const s=this.map[t];s!==void 0&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,a=t.length;s!==a;++s){const o=t[s],l=i[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const a=e[r];a.id in t&&i.push(a)}return i}}function lC(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const F9=37297;let k9=0;function z9(n,e){const t=n.split(`
`),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let a=r;a<s;a++){const o=a+1;i.push(`${o===e?">":" "} ${o}: ${t[a]}`)}return i.join(`
`)}const uC=new vt;function G9(n){Ze._getMatrix(uC,Ze.workingColorSpace,n);const e=`mat3( ${uC.elements.map(t=>t.toFixed(4))} )`;switch(Ze.getTransfer(n)){case Kd:return[e,"LinearTransferOETF"];case Re:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function cC(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),s=(n.getShaderInfoLog(e)||"").trim();if(i&&s==="")return"";const a=/ERROR: 0:(\d+)/.exec(s);if(a){const o=parseInt(a[1]);return t.toUpperCase()+`

`+s+`

`+z9(n.getShaderSource(e),o)}else return s}function V9(n,e){const t=G9(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function H9(n,e){let t;switch(e){case $O:t="Linear";break;case WO:t="Reinhard";break;case jO:t="Cineon";break;case qO:t="ACESFilmic";break;case XO:t="AgX";break;case YO:t="Neutral";break;case n8:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const D_=new D;function $9(){Ze.getLuminanceCoefficients(D_);const n=D_.x.toFixed(4),e=D_.y.toFixed(4),t=D_.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function W9(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Sp).join(`
`)}function j9(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function q9(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),a=s.name;let o=1;s.type===n.FLOAT_MAT2&&(o=2),s.type===n.FLOAT_MAT3&&(o=3),s.type===n.FLOAT_MAT4&&(o=4),t[a]={type:s.type,location:n.getAttribLocation(e,a),locationSize:o}}return t}function Sp(n){return n!==""}function hC(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function dC(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const X9=/^[ \t]*#include +<([\w\d./]+)>/gm;function mE(n){return n.replace(X9,K9)}const Y9=new Map;function K9(n,e){let t=Dt[e];if(t===void 0){const i=Y9.get(e);if(i!==void 0)t=Dt[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return mE(t)}const Q9=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function fC(n){return n.replace(Q9,Z9)}function Z9(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function pC(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function J9(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===Sw?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===Q6?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===os&&(e="SHADOWMAP_TYPE_VSM"),e}function eq(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case ja:case qa:e="ENVMAP_TYPE_CUBE";break;case pc:e="ENVMAP_TYPE_CUBE_UV";break}return e}function tq(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case qa:e="ENVMAP_MODE_REFRACTION";break}return e}function nq(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Sg:e="ENVMAP_BLENDING_MULTIPLY";break;case VO:e="ENVMAP_BLENDING_MIX";break;case HO:e="ENVMAP_BLENDING_ADD";break}return e}function iq(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function rq(n,e,t,i){const r=n.getContext(),s=t.defines;let a=t.vertexShader,o=t.fragmentShader;const l=J9(t),u=eq(t),c=tq(t),h=nq(t),d=iq(t),f=W9(t),m=j9(s),_=r.createProgram();let g,p,y=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m].filter(Sp).join(`
`),g.length>0&&(g+=`
`),p=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m].filter(Sp).join(`
`),p.length>0&&(p+=`
`)):(g=[pC(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Sp).join(`
`),p=[pC(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==zr?"#define TONE_MAPPING":"",t.toneMapping!==zr?Dt.tonemapping_pars_fragment:"",t.toneMapping!==zr?H9("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Dt.colorspace_pars_fragment,V9("linearToOutputTexel",t.outputColorSpace),$9(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Sp).join(`
`)),a=mE(a),a=hC(a,t),a=dC(a,t),o=mE(o),o=hC(o,t),o=dC(o,t),a=fC(a),o=fC(o),t.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,g=[f,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,p=["#define varying in",t.glslVersion===bN?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===bN?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+p);const v=y+g+a,b=y+p+o,S=lC(r,r.VERTEX_SHADER,v),x=lC(r,r.FRAGMENT_SHADER,b);r.attachShader(_,S),r.attachShader(_,x),t.index0AttributeName!==void 0?r.bindAttribLocation(_,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(_,0,"position"),r.linkProgram(_);function T(N){if(n.debug.checkShaderErrors){const U=r.getProgramInfoLog(_)||"",k=r.getShaderInfoLog(S)||"",P=r.getShaderInfoLog(x)||"",O=U.trim(),C=k.trim(),q=P.trim();let z=!0,re=!0;if(r.getProgramParameter(_,r.LINK_STATUS)===!1)if(z=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(r,_,S,x);else{const X=cC(r,S,"vertex"),oe=cC(r,x,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(_,r.VALIDATE_STATUS)+`

Material Name: `+N.name+`
Material Type: `+N.type+`

Program Info Log: `+O+`
`+X+`
`+oe)}else O!==""?console.warn("THREE.WebGLProgram: Program Info Log:",O):(C===""||q==="")&&(re=!1);re&&(N.diagnostics={runnable:z,programLog:O,vertexShader:{log:C,prefix:g},fragmentShader:{log:q,prefix:p}})}r.deleteShader(S),r.deleteShader(x),w=new Ay(r,_),E=q9(r,_)}let w;this.getUniforms=function(){return w===void 0&&T(this),w};let E;this.getAttributes=function(){return E===void 0&&T(this),E};let M=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return M===!1&&(M=r.getProgramParameter(_,F9)),M},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=k9++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=S,this.fragmentShader=x,this}let sq=0;class aq{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(i),a=this._getShaderCacheForMaterial(e);return a.has(r)===!1&&(a.add(r),r.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new oq(e),t.set(e,i)),i}}class oq{constructor(e){this.id=sq++,this.code=e,this.usedTimes=0}}function lq(n,e,t,i,r,s,a){const o=new Ww,l=new aq,u=new Set,c=[],h=r.logarithmicDepthBuffer,d=r.vertexTextures;let f=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(E){return u.add(E),E===0?"uv":`uv${E}`}function g(E,M,N,U,k){const P=U.fog,O=k.geometry,C=E.isMeshStandardMaterial?U.environment:null,q=(E.isMeshStandardMaterial?t:e).get(E.envMap||C),z=q&&q.mapping===pc?q.image.height:null,re=m[E.type];E.precision!==null&&(f=r.getMaxPrecision(E.precision),f!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",f,"instead."));const X=O.morphAttributes.position||O.morphAttributes.normal||O.morphAttributes.color,oe=X!==void 0?X.length:0;let be=0;O.morphAttributes.position!==void 0&&(be=1),O.morphAttributes.normal!==void 0&&(be=2),O.morphAttributes.color!==void 0&&(be=3);let Oe,st,ie,W;if(re){const rn=Na[re];Oe=rn.vertexShader,st=rn.fragmentShader}else Oe=E.vertexShader,st=E.fragmentShader,l.update(E),ie=l.getVertexShaderID(E),W=l.getFragmentShaderID(E);const K=n.getRenderTarget(),_e=n.state.buffers.depth.getReversed(),Pe=k.isInstancedMesh===!0,Me=k.isBatchedMesh===!0,We=!!E.map,Sn=!!E.matcap,I=!!q,jt=!!E.aoMap,pt=!!E.lightMap,Ye=!!E.bumpMap,Le=!!E.normalMap,nn=!!E.displacementMap,ze=!!E.emissiveMap,Ct=!!E.metalnessMap,Di=!!E.roughnessMap,si=E.anisotropy>0,L=E.clearcoat>0,A=E.dispersion>0,Y=E.iridescence>0,le=E.sheen>0,pe=E.transmission>0,se=si&&!!E.anisotropyMap,Xe=L&&!!E.clearcoatMap,Te=L&&!!E.clearcoatNormalMap,He=L&&!!E.clearcoatRoughnessMap,je=Y&&!!E.iridescenceMap,ye=Y&&!!E.iridescenceThicknessMap,Ce=le&&!!E.sheenColorMap,mt=le&&!!E.sheenRoughnessMap,qe=!!E.specularMap,Ae=!!E.specularColorMap,wt=!!E.specularIntensityMap,V=pe&&!!E.transmissionMap,ve=pe&&!!E.thicknessMap,Ee=!!E.gradientMap,Ie=!!E.alphaMap,me=E.alphaTest>0,he=!!E.alphaHash,Fe=!!E.extensions;let xt=zr;E.toneMapped&&(K===null||K.isXRRenderTarget===!0)&&(xt=n.toneMapping);const Nn={shaderID:re,shaderType:E.type,shaderName:E.name,vertexShader:Oe,fragmentShader:st,defines:E.defines,customVertexShaderID:ie,customFragmentShaderID:W,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:f,batching:Me,batchingColor:Me&&k._colorsTexture!==null,instancing:Pe,instancingColor:Pe&&k.instanceColor!==null,instancingMorph:Pe&&k.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:K===null?n.outputColorSpace:K.isXRRenderTarget===!0?K.texture.colorSpace:_c,alphaToCoverage:!!E.alphaToCoverage,map:We,matcap:Sn,envMap:I,envMapMode:I&&q.mapping,envMapCubeUVHeight:z,aoMap:jt,lightMap:pt,bumpMap:Ye,normalMap:Le,displacementMap:d&&nn,emissiveMap:ze,normalMapObjectSpace:Le&&E.normalMapType===KO,normalMapTangentSpace:Le&&E.normalMapType===tl,metalnessMap:Ct,roughnessMap:Di,anisotropy:si,anisotropyMap:se,clearcoat:L,clearcoatMap:Xe,clearcoatNormalMap:Te,clearcoatRoughnessMap:He,dispersion:A,iridescence:Y,iridescenceMap:je,iridescenceThicknessMap:ye,sheen:le,sheenColorMap:Ce,sheenRoughnessMap:mt,specularMap:qe,specularColorMap:Ae,specularIntensityMap:wt,transmission:pe,transmissionMap:V,thicknessMap:ve,gradientMap:Ee,opaque:E.transparent===!1&&E.blending===ms&&E.alphaToCoverage===!1,alphaMap:Ie,alphaTest:me,alphaHash:he,combine:E.combine,mapUv:We&&_(E.map.channel),aoMapUv:jt&&_(E.aoMap.channel),lightMapUv:pt&&_(E.lightMap.channel),bumpMapUv:Ye&&_(E.bumpMap.channel),normalMapUv:Le&&_(E.normalMap.channel),displacementMapUv:nn&&_(E.displacementMap.channel),emissiveMapUv:ze&&_(E.emissiveMap.channel),metalnessMapUv:Ct&&_(E.metalnessMap.channel),roughnessMapUv:Di&&_(E.roughnessMap.channel),anisotropyMapUv:se&&_(E.anisotropyMap.channel),clearcoatMapUv:Xe&&_(E.clearcoatMap.channel),clearcoatNormalMapUv:Te&&_(E.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:He&&_(E.clearcoatRoughnessMap.channel),iridescenceMapUv:je&&_(E.iridescenceMap.channel),iridescenceThicknessMapUv:ye&&_(E.iridescenceThicknessMap.channel),sheenColorMapUv:Ce&&_(E.sheenColorMap.channel),sheenRoughnessMapUv:mt&&_(E.sheenRoughnessMap.channel),specularMapUv:qe&&_(E.specularMap.channel),specularColorMapUv:Ae&&_(E.specularColorMap.channel),specularIntensityMapUv:wt&&_(E.specularIntensityMap.channel),transmissionMapUv:V&&_(E.transmissionMap.channel),thicknessMapUv:ve&&_(E.thicknessMap.channel),alphaMapUv:Ie&&_(E.alphaMap.channel),vertexTangents:!!O.attributes.tangent&&(Le||si),vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!O.attributes.color&&O.attributes.color.itemSize===4,pointsUvs:k.isPoints===!0&&!!O.attributes.uv&&(We||Ie),fog:!!P,useFog:E.fog===!0,fogExp2:!!P&&P.isFogExp2,flatShading:E.flatShading===!0&&E.wireframe===!1,sizeAttenuation:E.sizeAttenuation===!0,logarithmicDepthBuffer:h,reversedDepthBuffer:_e,skinning:k.isSkinnedMesh===!0,morphTargets:O.morphAttributes.position!==void 0,morphNormals:O.morphAttributes.normal!==void 0,morphColors:O.morphAttributes.color!==void 0,morphTargetsCount:oe,morphTextureStride:be,numDirLights:M.directional.length,numPointLights:M.point.length,numSpotLights:M.spot.length,numSpotLightMaps:M.spotLightMap.length,numRectAreaLights:M.rectArea.length,numHemiLights:M.hemi.length,numDirLightShadows:M.directionalShadowMap.length,numPointLightShadows:M.pointShadowMap.length,numSpotLightShadows:M.spotShadowMap.length,numSpotLightShadowsWithMaps:M.numSpotLightShadowsWithMaps,numLightProbes:M.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:E.dithering,shadowMapEnabled:n.shadowMap.enabled&&N.length>0,shadowMapType:n.shadowMap.type,toneMapping:xt,decodeVideoTexture:We&&E.map.isVideoTexture===!0&&Ze.getTransfer(E.map.colorSpace)===Re,decodeVideoTextureEmissive:ze&&E.emissiveMap.isVideoTexture===!0&&Ze.getTransfer(E.emissiveMap.colorSpace)===Re,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===Qi,flipSided:E.side===bn,useDepthPacking:E.depthPacking>=0,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionClipCullDistance:Fe&&E.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Fe&&E.extensions.multiDraw===!0||Me)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:E.customProgramCacheKey()};return Nn.vertexUv1s=u.has(1),Nn.vertexUv2s=u.has(2),Nn.vertexUv3s=u.has(3),u.clear(),Nn}function p(E){const M=[];if(E.shaderID?M.push(E.shaderID):(M.push(E.customVertexShaderID),M.push(E.customFragmentShaderID)),E.defines!==void 0)for(const N in E.defines)M.push(N),M.push(E.defines[N]);return E.isRawShaderMaterial===!1&&(y(M,E),v(M,E),M.push(n.outputColorSpace)),M.push(E.customProgramCacheKey),M.join()}function y(E,M){E.push(M.precision),E.push(M.outputColorSpace),E.push(M.envMapMode),E.push(M.envMapCubeUVHeight),E.push(M.mapUv),E.push(M.alphaMapUv),E.push(M.lightMapUv),E.push(M.aoMapUv),E.push(M.bumpMapUv),E.push(M.normalMapUv),E.push(M.displacementMapUv),E.push(M.emissiveMapUv),E.push(M.metalnessMapUv),E.push(M.roughnessMapUv),E.push(M.anisotropyMapUv),E.push(M.clearcoatMapUv),E.push(M.clearcoatNormalMapUv),E.push(M.clearcoatRoughnessMapUv),E.push(M.iridescenceMapUv),E.push(M.iridescenceThicknessMapUv),E.push(M.sheenColorMapUv),E.push(M.sheenRoughnessMapUv),E.push(M.specularMapUv),E.push(M.specularColorMapUv),E.push(M.specularIntensityMapUv),E.push(M.transmissionMapUv),E.push(M.thicknessMapUv),E.push(M.combine),E.push(M.fogExp2),E.push(M.sizeAttenuation),E.push(M.morphTargetsCount),E.push(M.morphAttributeCount),E.push(M.numDirLights),E.push(M.numPointLights),E.push(M.numSpotLights),E.push(M.numSpotLightMaps),E.push(M.numHemiLights),E.push(M.numRectAreaLights),E.push(M.numDirLightShadows),E.push(M.numPointLightShadows),E.push(M.numSpotLightShadows),E.push(M.numSpotLightShadowsWithMaps),E.push(M.numLightProbes),E.push(M.shadowMapType),E.push(M.toneMapping),E.push(M.numClippingPlanes),E.push(M.numClipIntersection),E.push(M.depthPacking)}function v(E,M){o.disableAll(),M.supportsVertexTextures&&o.enable(0),M.instancing&&o.enable(1),M.instancingColor&&o.enable(2),M.instancingMorph&&o.enable(3),M.matcap&&o.enable(4),M.envMap&&o.enable(5),M.normalMapObjectSpace&&o.enable(6),M.normalMapTangentSpace&&o.enable(7),M.clearcoat&&o.enable(8),M.iridescence&&o.enable(9),M.alphaTest&&o.enable(10),M.vertexColors&&o.enable(11),M.vertexAlphas&&o.enable(12),M.vertexUv1s&&o.enable(13),M.vertexUv2s&&o.enable(14),M.vertexUv3s&&o.enable(15),M.vertexTangents&&o.enable(16),M.anisotropy&&o.enable(17),M.alphaHash&&o.enable(18),M.batching&&o.enable(19),M.dispersion&&o.enable(20),M.batchingColor&&o.enable(21),M.gradientMap&&o.enable(22),E.push(o.mask),o.disableAll(),M.fog&&o.enable(0),M.useFog&&o.enable(1),M.flatShading&&o.enable(2),M.logarithmicDepthBuffer&&o.enable(3),M.reversedDepthBuffer&&o.enable(4),M.skinning&&o.enable(5),M.morphTargets&&o.enable(6),M.morphNormals&&o.enable(7),M.morphColors&&o.enable(8),M.premultipliedAlpha&&o.enable(9),M.shadowMapEnabled&&o.enable(10),M.doubleSided&&o.enable(11),M.flipSided&&o.enable(12),M.useDepthPacking&&o.enable(13),M.dithering&&o.enable(14),M.transmission&&o.enable(15),M.sheen&&o.enable(16),M.opaque&&o.enable(17),M.pointsUvs&&o.enable(18),M.decodeVideoTexture&&o.enable(19),M.decodeVideoTextureEmissive&&o.enable(20),M.alphaToCoverage&&o.enable(21),E.push(o.mask)}function b(E){const M=m[E.type];let N;if(M){const U=Na[M];N=tI.clone(U.uniforms)}else N=E.uniforms;return N}function S(E,M){let N;for(let U=0,k=c.length;U<k;U++){const P=c[U];if(P.cacheKey===M){N=P,++N.usedTimes;break}}return N===void 0&&(N=new rq(n,M,E,s),c.push(N)),N}function x(E){if(--E.usedTimes===0){const M=c.indexOf(E);c[M]=c[c.length-1],c.pop(),E.destroy()}}function T(E){l.remove(E)}function w(){l.dispose()}return{getParameters:g,getProgramCacheKey:p,getUniforms:b,acquireProgram:S,releaseProgram:x,releaseShaderCache:T,programs:c,dispose:w}}function uq(){let n=new WeakMap;function e(a){return n.has(a)}function t(a){let o=n.get(a);return o===void 0&&(o={},n.set(a,o)),o}function i(a){n.delete(a)}function r(a,o,l){n.get(a)[o]=l}function s(){n=new WeakMap}return{has:e,get:t,remove:i,update:r,dispose:s}}function cq(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function mC(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function gC(){const n=[];let e=0;const t=[],i=[],r=[];function s(){e=0,t.length=0,i.length=0,r.length=0}function a(h,d,f,m,_,g){let p=n[e];return p===void 0?(p={id:h.id,object:h,geometry:d,material:f,groupOrder:m,renderOrder:h.renderOrder,z:_,group:g},n[e]=p):(p.id=h.id,p.object=h,p.geometry=d,p.material=f,p.groupOrder=m,p.renderOrder=h.renderOrder,p.z=_,p.group=g),e++,p}function o(h,d,f,m,_,g){const p=a(h,d,f,m,_,g);f.transmission>0?i.push(p):f.transparent===!0?r.push(p):t.push(p)}function l(h,d,f,m,_,g){const p=a(h,d,f,m,_,g);f.transmission>0?i.unshift(p):f.transparent===!0?r.unshift(p):t.unshift(p)}function u(h,d){t.length>1&&t.sort(h||cq),i.length>1&&i.sort(d||mC),r.length>1&&r.sort(d||mC)}function c(){for(let h=e,d=n.length;h<d;h++){const f=n[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:t,transmissive:i,transparent:r,init:s,push:o,unshift:l,finish:c,sort:u}}function hq(){let n=new WeakMap;function e(i,r){const s=n.get(i);let a;return s===void 0?(a=new gC,n.set(i,[a])):r>=s.length?(a=new gC,s.push(a)):a=s[r],a}function t(){n=new WeakMap}return{get:e,dispose:t}}function dq(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new D,color:new Ve};break;case"SpotLight":t={position:new D,direction:new D,color:new Ve,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new D,color:new Ve,distance:0,decay:0};break;case"HemisphereLight":t={direction:new D,skyColor:new Ve,groundColor:new Ve};break;case"RectAreaLight":t={color:new Ve,position:new D,halfWidth:new D,halfHeight:new D};break}return n[e.id]=t,t}}}function fq(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new fe};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new fe};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new fe,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let pq=0;function mq(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function gq(n){const e=new dq,t=fq(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)i.probe.push(new D);const r=new D,s=new zt,a=new zt;function o(u){let c=0,h=0,d=0;for(let E=0;E<9;E++)i.probe[E].set(0,0,0);let f=0,m=0,_=0,g=0,p=0,y=0,v=0,b=0,S=0,x=0,T=0;u.sort(mq);for(let E=0,M=u.length;E<M;E++){const N=u[E],U=N.color,k=N.intensity,P=N.distance,O=N.shadow&&N.shadow.map?N.shadow.map.texture:null;if(N.isAmbientLight)c+=U.r*k,h+=U.g*k,d+=U.b*k;else if(N.isLightProbe){for(let C=0;C<9;C++)i.probe[C].addScaledVector(N.sh.coefficients[C],k);T++}else if(N.isDirectionalLight){const C=e.get(N);if(C.color.copy(N.color).multiplyScalar(N.intensity),N.castShadow){const q=N.shadow,z=t.get(N);z.shadowIntensity=q.intensity,z.shadowBias=q.bias,z.shadowNormalBias=q.normalBias,z.shadowRadius=q.radius,z.shadowMapSize=q.mapSize,i.directionalShadow[f]=z,i.directionalShadowMap[f]=O,i.directionalShadowMatrix[f]=N.shadow.matrix,y++}i.directional[f]=C,f++}else if(N.isSpotLight){const C=e.get(N);C.position.setFromMatrixPosition(N.matrixWorld),C.color.copy(U).multiplyScalar(k),C.distance=P,C.coneCos=Math.cos(N.angle),C.penumbraCos=Math.cos(N.angle*(1-N.penumbra)),C.decay=N.decay,i.spot[_]=C;const q=N.shadow;if(N.map&&(i.spotLightMap[S]=N.map,S++,q.updateMatrices(N),N.castShadow&&x++),i.spotLightMatrix[_]=q.matrix,N.castShadow){const z=t.get(N);z.shadowIntensity=q.intensity,z.shadowBias=q.bias,z.shadowNormalBias=q.normalBias,z.shadowRadius=q.radius,z.shadowMapSize=q.mapSize,i.spotShadow[_]=z,i.spotShadowMap[_]=O,b++}_++}else if(N.isRectAreaLight){const C=e.get(N);C.color.copy(U).multiplyScalar(k),C.halfWidth.set(N.width*.5,0,0),C.halfHeight.set(0,N.height*.5,0),i.rectArea[g]=C,g++}else if(N.isPointLight){const C=e.get(N);if(C.color.copy(N.color).multiplyScalar(N.intensity),C.distance=N.distance,C.decay=N.decay,N.castShadow){const q=N.shadow,z=t.get(N);z.shadowIntensity=q.intensity,z.shadowBias=q.bias,z.shadowNormalBias=q.normalBias,z.shadowRadius=q.radius,z.shadowMapSize=q.mapSize,z.shadowCameraNear=q.camera.near,z.shadowCameraFar=q.camera.far,i.pointShadow[m]=z,i.pointShadowMap[m]=O,i.pointShadowMatrix[m]=N.shadow.matrix,v++}i.point[m]=C,m++}else if(N.isHemisphereLight){const C=e.get(N);C.skyColor.copy(N.color).multiplyScalar(k),C.groundColor.copy(N.groundColor).multiplyScalar(k),i.hemi[p]=C,p++}}g>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=we.LTC_FLOAT_1,i.rectAreaLTC2=we.LTC_FLOAT_2):(i.rectAreaLTC1=we.LTC_HALF_1,i.rectAreaLTC2=we.LTC_HALF_2)),i.ambient[0]=c,i.ambient[1]=h,i.ambient[2]=d;const w=i.hash;(w.directionalLength!==f||w.pointLength!==m||w.spotLength!==_||w.rectAreaLength!==g||w.hemiLength!==p||w.numDirectionalShadows!==y||w.numPointShadows!==v||w.numSpotShadows!==b||w.numSpotMaps!==S||w.numLightProbes!==T)&&(i.directional.length=f,i.spot.length=_,i.rectArea.length=g,i.point.length=m,i.hemi.length=p,i.directionalShadow.length=y,i.directionalShadowMap.length=y,i.pointShadow.length=v,i.pointShadowMap.length=v,i.spotShadow.length=b,i.spotShadowMap.length=b,i.directionalShadowMatrix.length=y,i.pointShadowMatrix.length=v,i.spotLightMatrix.length=b+S-x,i.spotLightMap.length=S,i.numSpotLightShadowsWithMaps=x,i.numLightProbes=T,w.directionalLength=f,w.pointLength=m,w.spotLength=_,w.rectAreaLength=g,w.hemiLength=p,w.numDirectionalShadows=y,w.numPointShadows=v,w.numSpotShadows=b,w.numSpotMaps=S,w.numLightProbes=T,i.version=pq++)}function l(u,c){let h=0,d=0,f=0,m=0,_=0;const g=c.matrixWorldInverse;for(let p=0,y=u.length;p<y;p++){const v=u[p];if(v.isDirectionalLight){const b=i.directional[h];b.direction.setFromMatrixPosition(v.matrixWorld),r.setFromMatrixPosition(v.target.matrixWorld),b.direction.sub(r),b.direction.transformDirection(g),h++}else if(v.isSpotLight){const b=i.spot[f];b.position.setFromMatrixPosition(v.matrixWorld),b.position.applyMatrix4(g),b.direction.setFromMatrixPosition(v.matrixWorld),r.setFromMatrixPosition(v.target.matrixWorld),b.direction.sub(r),b.direction.transformDirection(g),f++}else if(v.isRectAreaLight){const b=i.rectArea[m];b.position.setFromMatrixPosition(v.matrixWorld),b.position.applyMatrix4(g),a.identity(),s.copy(v.matrixWorld),s.premultiply(g),a.extractRotation(s),b.halfWidth.set(v.width*.5,0,0),b.halfHeight.set(0,v.height*.5,0),b.halfWidth.applyMatrix4(a),b.halfHeight.applyMatrix4(a),m++}else if(v.isPointLight){const b=i.point[d];b.position.setFromMatrixPosition(v.matrixWorld),b.position.applyMatrix4(g),d++}else if(v.isHemisphereLight){const b=i.hemi[_];b.direction.setFromMatrixPosition(v.matrixWorld),b.direction.transformDirection(g),_++}}}return{setup:o,setupView:l,state:i}}function _C(n){const e=new gq(n),t=[],i=[];function r(c){u.camera=c,t.length=0,i.length=0}function s(c){t.push(c)}function a(c){i.push(c)}function o(){e.setup(t)}function l(c){e.setupView(t,c)}const u={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:u,setupLights:o,setupLightsView:l,pushLight:s,pushShadow:a}}function _q(n){let e=new WeakMap;function t(r,s=0){const a=e.get(r);let o;return a===void 0?(o=new _C(n),e.set(r,[o])):s>=a.length?(o=new _C(n),a.push(o)):o=a[s],o}function i(){e=new WeakMap}return{get:t,dispose:i}}const yq=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,vq=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function bq(n,e,t){let i=new wg;const r=new fe,s=new fe,a=new Je,o=new P5({depthPacking:s8}),l=new U5,u={},c=t.maxTextureSize,h={[ps]:bn,[bn]:ps,[Qi]:Qi},d=new Xa({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new fe},radius:{value:4}},vertexShader:yq,fragmentShader:vq}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const m=new Er;m.setAttribute("position",new Wi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new mi(m,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Sw;let p=this.type;this.render=function(x,T,w){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||x.length===0)return;const E=n.getRenderTarget(),M=n.getActiveCubeFace(),N=n.getActiveMipmapLevel(),U=n.state;U.setBlending(kr),U.buffers.depth.getReversed()===!0?U.buffers.color.setClear(0,0,0,0):U.buffers.color.setClear(1,1,1,1),U.buffers.depth.setTest(!0),U.setScissorTest(!1);const k=p!==os&&this.type===os,P=p===os&&this.type!==os;for(let O=0,C=x.length;O<C;O++){const q=x[O],z=q.shadow;if(z===void 0){console.warn("THREE.WebGLShadowMap:",q,"has no shadow.");continue}if(z.autoUpdate===!1&&z.needsUpdate===!1)continue;r.copy(z.mapSize);const re=z.getFrameExtents();if(r.multiply(re),s.copy(z.mapSize),(r.x>c||r.y>c)&&(r.x>c&&(s.x=Math.floor(c/re.x),r.x=s.x*re.x,z.mapSize.x=s.x),r.y>c&&(s.y=Math.floor(c/re.y),r.y=s.y*re.y,z.mapSize.y=s.y)),z.map===null||k===!0||P===!0){const oe=this.type!==os?{minFilter:Ln,magFilter:Ln}:{};z.map!==null&&z.map.dispose(),z.map=new su(r.x,r.y,oe),z.map.texture.name=q.name+".shadowMap",z.camera.updateProjectionMatrix()}n.setRenderTarget(z.map),n.clear();const X=z.getViewportCount();for(let oe=0;oe<X;oe++){const be=z.getViewport(oe);a.set(s.x*be.x,s.y*be.y,s.x*be.z,s.y*be.w),U.viewport(a),z.updateMatrices(q,oe),i=z.getFrustum(),b(T,w,z.camera,q,this.type)}z.isPointLightShadow!==!0&&this.type===os&&y(z,w),z.needsUpdate=!1}p=this.type,g.needsUpdate=!1,n.setRenderTarget(E,M,N)};function y(x,T){const w=e.update(_);d.defines.VSM_SAMPLES!==x.blurSamples&&(d.defines.VSM_SAMPLES=x.blurSamples,f.defines.VSM_SAMPLES=x.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),x.mapPass===null&&(x.mapPass=new su(r.x,r.y)),d.uniforms.shadow_pass.value=x.map.texture,d.uniforms.resolution.value=x.mapSize,d.uniforms.radius.value=x.radius,n.setRenderTarget(x.mapPass),n.clear(),n.renderBufferDirect(T,null,w,d,_,null),f.uniforms.shadow_pass.value=x.mapPass.texture,f.uniforms.resolution.value=x.mapSize,f.uniforms.radius.value=x.radius,n.setRenderTarget(x.map),n.clear(),n.renderBufferDirect(T,null,w,f,_,null)}function v(x,T,w,E){let M=null;const N=w.isPointLight===!0?x.customDistanceMaterial:x.customDepthMaterial;if(N!==void 0)M=N;else if(M=w.isPointLight===!0?l:o,n.localClippingEnabled&&T.clipShadows===!0&&Array.isArray(T.clippingPlanes)&&T.clippingPlanes.length!==0||T.displacementMap&&T.displacementScale!==0||T.alphaMap&&T.alphaTest>0||T.map&&T.alphaTest>0||T.alphaToCoverage===!0){const U=M.uuid,k=T.uuid;let P=u[U];P===void 0&&(P={},u[U]=P);let O=P[k];O===void 0&&(O=M.clone(),P[k]=O,T.addEventListener("dispose",S)),M=O}if(M.visible=T.visible,M.wireframe=T.wireframe,E===os?M.side=T.shadowSide!==null?T.shadowSide:T.side:M.side=T.shadowSide!==null?T.shadowSide:h[T.side],M.alphaMap=T.alphaMap,M.alphaTest=T.alphaToCoverage===!0?.5:T.alphaTest,M.map=T.map,M.clipShadows=T.clipShadows,M.clippingPlanes=T.clippingPlanes,M.clipIntersection=T.clipIntersection,M.displacementMap=T.displacementMap,M.displacementScale=T.displacementScale,M.displacementBias=T.displacementBias,M.wireframeLinewidth=T.wireframeLinewidth,M.linewidth=T.linewidth,w.isPointLight===!0&&M.isMeshDistanceMaterial===!0){const U=n.properties.get(M);U.light=w}return M}function b(x,T,w,E,M){if(x.visible===!1)return;if(x.layers.test(T.layers)&&(x.isMesh||x.isLine||x.isPoints)&&(x.castShadow||x.receiveShadow&&M===os)&&(!x.frustumCulled||i.intersectsObject(x))){x.modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,x.matrixWorld);const k=e.update(x),P=x.material;if(Array.isArray(P)){const O=k.groups;for(let C=0,q=O.length;C<q;C++){const z=O[C],re=P[z.materialIndex];if(re&&re.visible){const X=v(x,re,E,M);x.onBeforeShadow(n,x,T,w,k,X,z),n.renderBufferDirect(w,null,k,X,x,z),x.onAfterShadow(n,x,T,w,k,X,z)}}}else if(P.visible){const O=v(x,P,E,M);x.onBeforeShadow(n,x,T,w,k,O,null),n.renderBufferDirect(w,null,k,O,x,null),x.onAfterShadow(n,x,T,w,k,O,null)}}const U=x.children;for(let k=0,P=U.length;k<P;k++)b(U[k],T,w,E,M)}function S(x){x.target.removeEventListener("dispose",S);for(const w in u){const E=u[w],M=x.target.uuid;M in E&&(E[M].dispose(),delete E[M])}}}const Sq={[Am]:Rm,[Nm]:Lm,[Cm]:Pm,[iu]:Dm,[Rm]:Am,[Lm]:Nm,[Pm]:Cm,[Dm]:iu};function xq(n,e){function t(){let V=!1;const ve=new Je;let Ee=null;const Ie=new Je(0,0,0,0);return{setMask:function(me){Ee!==me&&!V&&(n.colorMask(me,me,me,me),Ee=me)},setLocked:function(me){V=me},setClear:function(me,he,Fe,xt,Nn){Nn===!0&&(me*=xt,he*=xt,Fe*=xt),ve.set(me,he,Fe,xt),Ie.equals(ve)===!1&&(n.clearColor(me,he,Fe,xt),Ie.copy(ve))},reset:function(){V=!1,Ee=null,Ie.set(-1,0,0,0)}}}function i(){let V=!1,ve=!1,Ee=null,Ie=null,me=null;return{setReversed:function(he){if(ve!==he){const Fe=e.get("EXT_clip_control");he?Fe.clipControlEXT(Fe.LOWER_LEFT_EXT,Fe.ZERO_TO_ONE_EXT):Fe.clipControlEXT(Fe.LOWER_LEFT_EXT,Fe.NEGATIVE_ONE_TO_ONE_EXT),ve=he;const xt=me;me=null,this.setClear(xt)}},getReversed:function(){return ve},setTest:function(he){he?K(n.DEPTH_TEST):_e(n.DEPTH_TEST)},setMask:function(he){Ee!==he&&!V&&(n.depthMask(he),Ee=he)},setFunc:function(he){if(ve&&(he=Sq[he]),Ie!==he){switch(he){case Am:n.depthFunc(n.NEVER);break;case Rm:n.depthFunc(n.ALWAYS);break;case Nm:n.depthFunc(n.LESS);break;case iu:n.depthFunc(n.LEQUAL);break;case Cm:n.depthFunc(n.EQUAL);break;case Dm:n.depthFunc(n.GEQUAL);break;case Lm:n.depthFunc(n.GREATER);break;case Pm:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}Ie=he}},setLocked:function(he){V=he},setClear:function(he){me!==he&&(ve&&(he=1-he),n.clearDepth(he),me=he)},reset:function(){V=!1,Ee=null,Ie=null,me=null,ve=!1}}}function r(){let V=!1,ve=null,Ee=null,Ie=null,me=null,he=null,Fe=null,xt=null,Nn=null;return{setTest:function(rn){V||(rn?K(n.STENCIL_TEST):_e(n.STENCIL_TEST))},setMask:function(rn){ve!==rn&&!V&&(n.stencilMask(rn),ve=rn)},setFunc:function(rn,ao,ga){(Ee!==rn||Ie!==ao||me!==ga)&&(n.stencilFunc(rn,ao,ga),Ee=rn,Ie=ao,me=ga)},setOp:function(rn,ao,ga){(he!==rn||Fe!==ao||xt!==ga)&&(n.stencilOp(rn,ao,ga),he=rn,Fe=ao,xt=ga)},setLocked:function(rn){V=rn},setClear:function(rn){Nn!==rn&&(n.clearStencil(rn),Nn=rn)},reset:function(){V=!1,ve=null,Ee=null,Ie=null,me=null,he=null,Fe=null,xt=null,Nn=null}}}const s=new t,a=new i,o=new r,l=new WeakMap,u=new WeakMap;let c={},h={},d=new WeakMap,f=[],m=null,_=!1,g=null,p=null,y=null,v=null,b=null,S=null,x=null,T=new Ve(0,0,0),w=0,E=!1,M=null,N=null,U=null,k=null,P=null;const O=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let C=!1,q=0;const z=n.getParameter(n.VERSION);z.indexOf("WebGL")!==-1?(q=parseFloat(/^WebGL (\d)/.exec(z)[1]),C=q>=1):z.indexOf("OpenGL ES")!==-1&&(q=parseFloat(/^OpenGL ES (\d)/.exec(z)[1]),C=q>=2);let re=null,X={};const oe=n.getParameter(n.SCISSOR_BOX),be=n.getParameter(n.VIEWPORT),Oe=new Je().fromArray(oe),st=new Je().fromArray(be);function ie(V,ve,Ee,Ie){const me=new Uint8Array(4),he=n.createTexture();n.bindTexture(V,he),n.texParameteri(V,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(V,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Fe=0;Fe<Ee;Fe++)V===n.TEXTURE_3D||V===n.TEXTURE_2D_ARRAY?n.texImage3D(ve,0,n.RGBA,1,1,Ie,0,n.RGBA,n.UNSIGNED_BYTE,me):n.texImage2D(ve+Fe,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,me);return he}const W={};W[n.TEXTURE_2D]=ie(n.TEXTURE_2D,n.TEXTURE_2D,1),W[n.TEXTURE_CUBE_MAP]=ie(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),W[n.TEXTURE_2D_ARRAY]=ie(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),W[n.TEXTURE_3D]=ie(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),K(n.DEPTH_TEST),a.setFunc(iu),Ye(!1),Le(uE),K(n.CULL_FACE),jt(kr);function K(V){c[V]!==!0&&(n.enable(V),c[V]=!0)}function _e(V){c[V]!==!1&&(n.disable(V),c[V]=!1)}function Pe(V,ve){return h[V]!==ve?(n.bindFramebuffer(V,ve),h[V]=ve,V===n.DRAW_FRAMEBUFFER&&(h[n.FRAMEBUFFER]=ve),V===n.FRAMEBUFFER&&(h[n.DRAW_FRAMEBUFFER]=ve),!0):!1}function Me(V,ve){let Ee=f,Ie=!1;if(V){Ee=d.get(ve),Ee===void 0&&(Ee=[],d.set(ve,Ee));const me=V.textures;if(Ee.length!==me.length||Ee[0]!==n.COLOR_ATTACHMENT0){for(let he=0,Fe=me.length;he<Fe;he++)Ee[he]=n.COLOR_ATTACHMENT0+he;Ee.length=me.length,Ie=!0}}else Ee[0]!==n.BACK&&(Ee[0]=n.BACK,Ie=!0);Ie&&n.drawBuffers(Ee)}function We(V){return m!==V?(n.useProgram(V),m=V,!0):!1}const Sn={[Zi]:n.FUNC_ADD,[xw]:n.FUNC_SUBTRACT,[Tw]:n.FUNC_REVERSE_SUBTRACT};Sn[zO]=n.MIN,Sn[GO]=n.MAX;const I={[To]:n.ZERO,[Ew]:n.ONE,[Mw]:n.SRC_COLOR,[Mm]:n.SRC_ALPHA,[Dw]:n.SRC_ALPHA_SATURATE,[Nw]:n.DST_COLOR,[Aw]:n.DST_ALPHA,[ww]:n.ONE_MINUS_SRC_COLOR,[wm]:n.ONE_MINUS_SRC_ALPHA,[Cw]:n.ONE_MINUS_DST_COLOR,[Rw]:n.ONE_MINUS_DST_ALPHA,[Z6]:n.CONSTANT_COLOR,[J6]:n.ONE_MINUS_CONSTANT_COLOR,[e8]:n.CONSTANT_ALPHA,[t8]:n.ONE_MINUS_CONSTANT_ALPHA};function jt(V,ve,Ee,Ie,me,he,Fe,xt,Nn,rn){if(V===kr){_===!0&&(_e(n.BLEND),_=!1);return}if(_===!1&&(K(n.BLEND),_=!0),V!==Jh){if(V!==g||rn!==E){if((p!==Zi||b!==Zi)&&(n.blendEquation(n.FUNC_ADD),p=Zi,b=Zi),rn)switch(V){case ms:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Td:n.blendFunc(n.ONE,n.ONE);break;case Ed:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case Md:n.blendFuncSeparate(n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",V);break}else switch(V){case ms:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Td:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE,n.ONE,n.ONE);break;case Ed:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Md:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",V);break}y=null,v=null,S=null,x=null,T.set(0,0,0),w=0,g=V,E=rn}return}me=me||ve,he=he||Ee,Fe=Fe||Ie,(ve!==p||me!==b)&&(n.blendEquationSeparate(Sn[ve],Sn[me]),p=ve,b=me),(Ee!==y||Ie!==v||he!==S||Fe!==x)&&(n.blendFuncSeparate(I[Ee],I[Ie],I[he],I[Fe]),y=Ee,v=Ie,S=he,x=Fe),(xt.equals(T)===!1||Nn!==w)&&(n.blendColor(xt.r,xt.g,xt.b,Nn),T.copy(xt),w=Nn),g=V,E=!1}function pt(V,ve){V.side===Qi?_e(n.CULL_FACE):K(n.CULL_FACE);let Ee=V.side===bn;ve&&(Ee=!Ee),Ye(Ee),V.blending===ms&&V.transparent===!1?jt(kr):jt(V.blending,V.blendEquation,V.blendSrc,V.blendDst,V.blendEquationAlpha,V.blendSrcAlpha,V.blendDstAlpha,V.blendColor,V.blendAlpha,V.premultipliedAlpha),a.setFunc(V.depthFunc),a.setTest(V.depthTest),a.setMask(V.depthWrite),s.setMask(V.colorWrite);const Ie=V.stencilWrite;o.setTest(Ie),Ie&&(o.setMask(V.stencilWriteMask),o.setFunc(V.stencilFunc,V.stencilRef,V.stencilFuncMask),o.setOp(V.stencilFail,V.stencilZFail,V.stencilZPass)),ze(V.polygonOffset,V.polygonOffsetFactor,V.polygonOffsetUnits),V.alphaToCoverage===!0?K(n.SAMPLE_ALPHA_TO_COVERAGE):_e(n.SAMPLE_ALPHA_TO_COVERAGE)}function Ye(V){M!==V&&(V?n.frontFace(n.CW):n.frontFace(n.CCW),M=V)}function Le(V){V!==FO?(K(n.CULL_FACE),V!==N&&(V===uE?n.cullFace(n.BACK):V===kO?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):_e(n.CULL_FACE),N=V}function nn(V){V!==U&&(C&&n.lineWidth(V),U=V)}function ze(V,ve,Ee){V?(K(n.POLYGON_OFFSET_FILL),(k!==ve||P!==Ee)&&(n.polygonOffset(ve,Ee),k=ve,P=Ee)):_e(n.POLYGON_OFFSET_FILL)}function Ct(V){V?K(n.SCISSOR_TEST):_e(n.SCISSOR_TEST)}function Di(V){V===void 0&&(V=n.TEXTURE0+O-1),re!==V&&(n.activeTexture(V),re=V)}function si(V,ve,Ee){Ee===void 0&&(re===null?Ee=n.TEXTURE0+O-1:Ee=re);let Ie=X[Ee];Ie===void 0&&(Ie={type:void 0,texture:void 0},X[Ee]=Ie),(Ie.type!==V||Ie.texture!==ve)&&(re!==Ee&&(n.activeTexture(Ee),re=Ee),n.bindTexture(V,ve||W[V]),Ie.type=V,Ie.texture=ve)}function L(){const V=X[re];V!==void 0&&V.type!==void 0&&(n.bindTexture(V.type,null),V.type=void 0,V.texture=void 0)}function A(){try{n.compressedTexImage2D(...arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function Y(){try{n.compressedTexImage3D(...arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function le(){try{n.texSubImage2D(...arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function pe(){try{n.texSubImage3D(...arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function se(){try{n.compressedTexSubImage2D(...arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function Xe(){try{n.compressedTexSubImage3D(...arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function Te(){try{n.texStorage2D(...arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function He(){try{n.texStorage3D(...arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function je(){try{n.texImage2D(...arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function ye(){try{n.texImage3D(...arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function Ce(V){Oe.equals(V)===!1&&(n.scissor(V.x,V.y,V.z,V.w),Oe.copy(V))}function mt(V){st.equals(V)===!1&&(n.viewport(V.x,V.y,V.z,V.w),st.copy(V))}function qe(V,ve){let Ee=u.get(ve);Ee===void 0&&(Ee=new WeakMap,u.set(ve,Ee));let Ie=Ee.get(V);Ie===void 0&&(Ie=n.getUniformBlockIndex(ve,V.name),Ee.set(V,Ie))}function Ae(V,ve){const Ie=u.get(ve).get(V);l.get(ve)!==Ie&&(n.uniformBlockBinding(ve,Ie,V.__bindingPointIndex),l.set(ve,Ie))}function wt(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),a.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),c={},re=null,X={},h={},d=new WeakMap,f=[],m=null,_=!1,g=null,p=null,y=null,v=null,b=null,S=null,x=null,T=new Ve(0,0,0),w=0,E=!1,M=null,N=null,U=null,k=null,P=null,Oe.set(0,0,n.canvas.width,n.canvas.height),st.set(0,0,n.canvas.width,n.canvas.height),s.reset(),a.reset(),o.reset()}return{buffers:{color:s,depth:a,stencil:o},enable:K,disable:_e,bindFramebuffer:Pe,drawBuffers:Me,useProgram:We,setBlending:jt,setMaterial:pt,setFlipSided:Ye,setCullFace:Le,setLineWidth:nn,setPolygonOffset:ze,setScissorTest:Ct,activeTexture:Di,bindTexture:si,unbindTexture:L,compressedTexImage2D:A,compressedTexImage3D:Y,texImage2D:je,texImage3D:ye,updateUBOMapping:qe,uniformBlockBinding:Ae,texStorage2D:Te,texStorage3D:He,texSubImage2D:le,texSubImage3D:pe,compressedTexSubImage2D:se,compressedTexSubImage3D:Xe,scissor:Ce,viewport:mt,reset:wt}}function Tq(n,e,t,i,r,s,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new fe,c=new WeakMap;let h;const d=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(L,A){return f?new OffscreenCanvas(L,A):Fm("canvas")}function _(L,A,Y){let le=1;const pe=si(L);if((pe.width>Y||pe.height>Y)&&(le=Y/Math.max(pe.width,pe.height)),le<1)if(typeof HTMLImageElement<"u"&&L instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&L instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&L instanceof ImageBitmap||typeof VideoFrame<"u"&&L instanceof VideoFrame){const se=Math.floor(le*pe.width),Xe=Math.floor(le*pe.height);h===void 0&&(h=m(se,Xe));const Te=A?m(se,Xe):h;return Te.width=se,Te.height=Xe,Te.getContext("2d").drawImage(L,0,0,se,Xe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+pe.width+"x"+pe.height+") to ("+se+"x"+Xe+")."),Te}else return"data"in L&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+pe.width+"x"+pe.height+")."),L;return L}function g(L){return L.generateMipmaps}function p(L){n.generateMipmap(L)}function y(L){return L.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:L.isWebGL3DRenderTarget?n.TEXTURE_3D:L.isWebGLArrayRenderTarget||L.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function v(L,A,Y,le,pe=!1){if(L!==null){if(n[L]!==void 0)return n[L];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+L+"'")}let se=A;if(A===n.RED&&(Y===n.FLOAT&&(se=n.R32F),Y===n.HALF_FLOAT&&(se=n.R16F),Y===n.UNSIGNED_BYTE&&(se=n.R8)),A===n.RED_INTEGER&&(Y===n.UNSIGNED_BYTE&&(se=n.R8UI),Y===n.UNSIGNED_SHORT&&(se=n.R16UI),Y===n.UNSIGNED_INT&&(se=n.R32UI),Y===n.BYTE&&(se=n.R8I),Y===n.SHORT&&(se=n.R16I),Y===n.INT&&(se=n.R32I)),A===n.RG&&(Y===n.FLOAT&&(se=n.RG32F),Y===n.HALF_FLOAT&&(se=n.RG16F),Y===n.UNSIGNED_BYTE&&(se=n.RG8)),A===n.RG_INTEGER&&(Y===n.UNSIGNED_BYTE&&(se=n.RG8UI),Y===n.UNSIGNED_SHORT&&(se=n.RG16UI),Y===n.UNSIGNED_INT&&(se=n.RG32UI),Y===n.BYTE&&(se=n.RG8I),Y===n.SHORT&&(se=n.RG16I),Y===n.INT&&(se=n.RG32I)),A===n.RGB_INTEGER&&(Y===n.UNSIGNED_BYTE&&(se=n.RGB8UI),Y===n.UNSIGNED_SHORT&&(se=n.RGB16UI),Y===n.UNSIGNED_INT&&(se=n.RGB32UI),Y===n.BYTE&&(se=n.RGB8I),Y===n.SHORT&&(se=n.RGB16I),Y===n.INT&&(se=n.RGB32I)),A===n.RGBA_INTEGER&&(Y===n.UNSIGNED_BYTE&&(se=n.RGBA8UI),Y===n.UNSIGNED_SHORT&&(se=n.RGBA16UI),Y===n.UNSIGNED_INT&&(se=n.RGBA32UI),Y===n.BYTE&&(se=n.RGBA8I),Y===n.SHORT&&(se=n.RGBA16I),Y===n.INT&&(se=n.RGBA32I)),A===n.RGB&&(Y===n.UNSIGNED_INT_5_9_9_9_REV&&(se=n.RGB9_E5),Y===n.UNSIGNED_INT_10F_11F_11F_REV&&(se=n.R11F_G11F_B10F)),A===n.RGBA){const Xe=pe?Kd:Ze.getTransfer(le);Y===n.FLOAT&&(se=n.RGBA32F),Y===n.HALF_FLOAT&&(se=n.RGBA16F),Y===n.UNSIGNED_BYTE&&(se=Xe===Re?n.SRGB8_ALPHA8:n.RGBA8),Y===n.UNSIGNED_SHORT_4_4_4_4&&(se=n.RGBA4),Y===n.UNSIGNED_SHORT_5_5_5_1&&(se=n.RGB5_A1)}return(se===n.R16F||se===n.R32F||se===n.RG16F||se===n.RG32F||se===n.RGBA16F||se===n.RGBA32F)&&e.get("EXT_color_buffer_float"),se}function b(L,A){let Y;return L?A===null||A===wn||A===gs?Y=n.DEPTH24_STENCIL8:A===li?Y=n.DEPTH32F_STENCIL8:A===la&&(Y=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):A===null||A===wn||A===gs?Y=n.DEPTH_COMPONENT24:A===li?Y=n.DEPTH_COMPONENT32F:A===la&&(Y=n.DEPTH_COMPONENT16),Y}function S(L,A){return g(L)===!0||L.isFramebufferTexture&&L.minFilter!==Ln&&L.minFilter!==wi?Math.log2(Math.max(A.width,A.height))+1:L.mipmaps!==void 0&&L.mipmaps.length>0?L.mipmaps.length:L.isCompressedTexture&&Array.isArray(L.image)?A.mipmaps.length:1}function x(L){const A=L.target;A.removeEventListener("dispose",x),w(A),A.isVideoTexture&&c.delete(A)}function T(L){const A=L.target;A.removeEventListener("dispose",T),M(A)}function w(L){const A=i.get(L);if(A.__webglInit===void 0)return;const Y=L.source,le=d.get(Y);if(le){const pe=le[A.__cacheKey];pe.usedTimes--,pe.usedTimes===0&&E(L),Object.keys(le).length===0&&d.delete(Y)}i.remove(L)}function E(L){const A=i.get(L);n.deleteTexture(A.__webglTexture);const Y=L.source,le=d.get(Y);delete le[A.__cacheKey],a.memory.textures--}function M(L){const A=i.get(L);if(L.depthTexture&&(L.depthTexture.dispose(),i.remove(L.depthTexture)),L.isWebGLCubeRenderTarget)for(let le=0;le<6;le++){if(Array.isArray(A.__webglFramebuffer[le]))for(let pe=0;pe<A.__webglFramebuffer[le].length;pe++)n.deleteFramebuffer(A.__webglFramebuffer[le][pe]);else n.deleteFramebuffer(A.__webglFramebuffer[le]);A.__webglDepthbuffer&&n.deleteRenderbuffer(A.__webglDepthbuffer[le])}else{if(Array.isArray(A.__webglFramebuffer))for(let le=0;le<A.__webglFramebuffer.length;le++)n.deleteFramebuffer(A.__webglFramebuffer[le]);else n.deleteFramebuffer(A.__webglFramebuffer);if(A.__webglDepthbuffer&&n.deleteRenderbuffer(A.__webglDepthbuffer),A.__webglMultisampledFramebuffer&&n.deleteFramebuffer(A.__webglMultisampledFramebuffer),A.__webglColorRenderbuffer)for(let le=0;le<A.__webglColorRenderbuffer.length;le++)A.__webglColorRenderbuffer[le]&&n.deleteRenderbuffer(A.__webglColorRenderbuffer[le]);A.__webglDepthRenderbuffer&&n.deleteRenderbuffer(A.__webglDepthRenderbuffer)}const Y=L.textures;for(let le=0,pe=Y.length;le<pe;le++){const se=i.get(Y[le]);se.__webglTexture&&(n.deleteTexture(se.__webglTexture),a.memory.textures--),i.remove(Y[le])}i.remove(L)}let N=0;function U(){N=0}function k(){const L=N;return L>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+L+" texture units while this GPU supports only "+r.maxTextures),N+=1,L}function P(L){const A=[];return A.push(L.wrapS),A.push(L.wrapT),A.push(L.wrapR||0),A.push(L.magFilter),A.push(L.minFilter),A.push(L.anisotropy),A.push(L.internalFormat),A.push(L.format),A.push(L.type),A.push(L.generateMipmaps),A.push(L.premultiplyAlpha),A.push(L.flipY),A.push(L.unpackAlignment),A.push(L.colorSpace),A.join()}function O(L,A){const Y=i.get(L);if(L.isVideoTexture&&Ct(L),L.isRenderTargetTexture===!1&&L.isExternalTexture!==!0&&L.version>0&&Y.__version!==L.version){const le=L.image;if(le===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(le.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{W(Y,L,A);return}}else L.isExternalTexture&&(Y.__webglTexture=L.sourceTexture?L.sourceTexture:null);t.bindTexture(n.TEXTURE_2D,Y.__webglTexture,n.TEXTURE0+A)}function C(L,A){const Y=i.get(L);if(L.isRenderTargetTexture===!1&&L.version>0&&Y.__version!==L.version){W(Y,L,A);return}t.bindTexture(n.TEXTURE_2D_ARRAY,Y.__webglTexture,n.TEXTURE0+A)}function q(L,A){const Y=i.get(L);if(L.isRenderTargetTexture===!1&&L.version>0&&Y.__version!==L.version){W(Y,L,A);return}t.bindTexture(n.TEXTURE_3D,Y.__webglTexture,n.TEXTURE0+A)}function z(L,A){const Y=i.get(L);if(L.version>0&&Y.__version!==L.version){K(Y,L,A);return}t.bindTexture(n.TEXTURE_CUBE_MAP,Y.__webglTexture,n.TEXTURE0+A)}const re={[mc]:n.REPEAT,[Ia]:n.CLAMP_TO_EDGE,[gc]:n.MIRRORED_REPEAT},X={[Ln]:n.NEAREST,[Pw]:n.NEAREST_MIPMAP_NEAREST,[ko]:n.NEAREST_MIPMAP_LINEAR,[wi]:n.LINEAR,[ed]:n.LINEAR_MIPMAP_NEAREST,[Ir]:n.LINEAR_MIPMAP_LINEAR},oe={[Ow]:n.NEVER,[zw]:n.ALWAYS,[K0]:n.LESS,[Q0]:n.LEQUAL,[Iw]:n.EQUAL,[kw]:n.GEQUAL,[Bw]:n.GREATER,[Fw]:n.NOTEQUAL};function be(L,A){if(A.type===li&&e.has("OES_texture_float_linear")===!1&&(A.magFilter===wi||A.magFilter===ed||A.magFilter===ko||A.magFilter===Ir||A.minFilter===wi||A.minFilter===ed||A.minFilter===ko||A.minFilter===Ir)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(L,n.TEXTURE_WRAP_S,re[A.wrapS]),n.texParameteri(L,n.TEXTURE_WRAP_T,re[A.wrapT]),(L===n.TEXTURE_3D||L===n.TEXTURE_2D_ARRAY)&&n.texParameteri(L,n.TEXTURE_WRAP_R,re[A.wrapR]),n.texParameteri(L,n.TEXTURE_MAG_FILTER,X[A.magFilter]),n.texParameteri(L,n.TEXTURE_MIN_FILTER,X[A.minFilter]),A.compareFunction&&(n.texParameteri(L,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(L,n.TEXTURE_COMPARE_FUNC,oe[A.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(A.magFilter===Ln||A.minFilter!==ko&&A.minFilter!==Ir||A.type===li&&e.has("OES_texture_float_linear")===!1)return;if(A.anisotropy>1||i.get(A).__currentAnisotropy){const Y=e.get("EXT_texture_filter_anisotropic");n.texParameterf(L,Y.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(A.anisotropy,r.getMaxAnisotropy())),i.get(A).__currentAnisotropy=A.anisotropy}}}function Oe(L,A){let Y=!1;L.__webglInit===void 0&&(L.__webglInit=!0,A.addEventListener("dispose",x));const le=A.source;let pe=d.get(le);pe===void 0&&(pe={},d.set(le,pe));const se=P(A);if(se!==L.__cacheKey){pe[se]===void 0&&(pe[se]={texture:n.createTexture(),usedTimes:0},a.memory.textures++,Y=!0),pe[se].usedTimes++;const Xe=pe[L.__cacheKey];Xe!==void 0&&(pe[L.__cacheKey].usedTimes--,Xe.usedTimes===0&&E(A)),L.__cacheKey=se,L.__webglTexture=pe[se].texture}return Y}function st(L,A,Y){return Math.floor(Math.floor(L/Y)/A)}function ie(L,A,Y,le){const se=L.updateRanges;if(se.length===0)t.texSubImage2D(n.TEXTURE_2D,0,0,0,A.width,A.height,Y,le,A.data);else{se.sort((ye,Ce)=>ye.start-Ce.start);let Xe=0;for(let ye=1;ye<se.length;ye++){const Ce=se[Xe],mt=se[ye],qe=Ce.start+Ce.count,Ae=st(mt.start,A.width,4),wt=st(Ce.start,A.width,4);mt.start<=qe+1&&Ae===wt&&st(mt.start+mt.count-1,A.width,4)===Ae?Ce.count=Math.max(Ce.count,mt.start+mt.count-Ce.start):(++Xe,se[Xe]=mt)}se.length=Xe+1;const Te=n.getParameter(n.UNPACK_ROW_LENGTH),He=n.getParameter(n.UNPACK_SKIP_PIXELS),je=n.getParameter(n.UNPACK_SKIP_ROWS);n.pixelStorei(n.UNPACK_ROW_LENGTH,A.width);for(let ye=0,Ce=se.length;ye<Ce;ye++){const mt=se[ye],qe=Math.floor(mt.start/4),Ae=Math.ceil(mt.count/4),wt=qe%A.width,V=Math.floor(qe/A.width),ve=Ae,Ee=1;n.pixelStorei(n.UNPACK_SKIP_PIXELS,wt),n.pixelStorei(n.UNPACK_SKIP_ROWS,V),t.texSubImage2D(n.TEXTURE_2D,0,wt,V,ve,Ee,Y,le,A.data)}L.clearUpdateRanges(),n.pixelStorei(n.UNPACK_ROW_LENGTH,Te),n.pixelStorei(n.UNPACK_SKIP_PIXELS,He),n.pixelStorei(n.UNPACK_SKIP_ROWS,je)}}function W(L,A,Y){let le=n.TEXTURE_2D;(A.isDataArrayTexture||A.isCompressedArrayTexture)&&(le=n.TEXTURE_2D_ARRAY),A.isData3DTexture&&(le=n.TEXTURE_3D);const pe=Oe(L,A),se=A.source;t.bindTexture(le,L.__webglTexture,n.TEXTURE0+Y);const Xe=i.get(se);if(se.version!==Xe.__version||pe===!0){t.activeTexture(n.TEXTURE0+Y);const Te=Ze.getPrimaries(Ze.workingColorSpace),He=A.colorSpace===Or?null:Ze.getPrimaries(A.colorSpace),je=A.colorSpace===Or||Te===He?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,A.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,A.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,A.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,je);let ye=_(A.image,!1,r.maxTextureSize);ye=Di(A,ye);const Ce=s.convert(A.format,A.colorSpace),mt=s.convert(A.type);let qe=v(A.internalFormat,Ce,mt,A.colorSpace,A.isVideoTexture);be(le,A);let Ae;const wt=A.mipmaps,V=A.isVideoTexture!==!0,ve=Xe.__version===void 0||pe===!0,Ee=se.dataReady,Ie=S(A,ye);if(A.isDepthTexture)qe=b(A.format===ys,A.type),ve&&(V?t.texStorage2D(n.TEXTURE_2D,1,qe,ye.width,ye.height):t.texImage2D(n.TEXTURE_2D,0,qe,ye.width,ye.height,0,Ce,mt,null));else if(A.isDataTexture)if(wt.length>0){V&&ve&&t.texStorage2D(n.TEXTURE_2D,Ie,qe,wt[0].width,wt[0].height);for(let me=0,he=wt.length;me<he;me++)Ae=wt[me],V?Ee&&t.texSubImage2D(n.TEXTURE_2D,me,0,0,Ae.width,Ae.height,Ce,mt,Ae.data):t.texImage2D(n.TEXTURE_2D,me,qe,Ae.width,Ae.height,0,Ce,mt,Ae.data);A.generateMipmaps=!1}else V?(ve&&t.texStorage2D(n.TEXTURE_2D,Ie,qe,ye.width,ye.height),Ee&&ie(A,ye,Ce,mt)):t.texImage2D(n.TEXTURE_2D,0,qe,ye.width,ye.height,0,Ce,mt,ye.data);else if(A.isCompressedTexture)if(A.isCompressedArrayTexture){V&&ve&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Ie,qe,wt[0].width,wt[0].height,ye.depth);for(let me=0,he=wt.length;me<he;me++)if(Ae=wt[me],A.format!==ii)if(Ce!==null)if(V){if(Ee)if(A.layerUpdates.size>0){const Fe=pE(Ae.width,Ae.height,A.format,A.type);for(const xt of A.layerUpdates){const Nn=Ae.data.subarray(xt*Fe/Ae.data.BYTES_PER_ELEMENT,(xt+1)*Fe/Ae.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,me,0,0,xt,Ae.width,Ae.height,1,Ce,Nn)}A.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,me,0,0,0,Ae.width,Ae.height,ye.depth,Ce,Ae.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,me,qe,Ae.width,Ae.height,ye.depth,0,Ae.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else V?Ee&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,me,0,0,0,Ae.width,Ae.height,ye.depth,Ce,mt,Ae.data):t.texImage3D(n.TEXTURE_2D_ARRAY,me,qe,Ae.width,Ae.height,ye.depth,0,Ce,mt,Ae.data)}else{V&&ve&&t.texStorage2D(n.TEXTURE_2D,Ie,qe,wt[0].width,wt[0].height);for(let me=0,he=wt.length;me<he;me++)Ae=wt[me],A.format!==ii?Ce!==null?V?Ee&&t.compressedTexSubImage2D(n.TEXTURE_2D,me,0,0,Ae.width,Ae.height,Ce,Ae.data):t.compressedTexImage2D(n.TEXTURE_2D,me,qe,Ae.width,Ae.height,0,Ae.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):V?Ee&&t.texSubImage2D(n.TEXTURE_2D,me,0,0,Ae.width,Ae.height,Ce,mt,Ae.data):t.texImage2D(n.TEXTURE_2D,me,qe,Ae.width,Ae.height,0,Ce,mt,Ae.data)}else if(A.isDataArrayTexture)if(V){if(ve&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Ie,qe,ye.width,ye.height,ye.depth),Ee)if(A.layerUpdates.size>0){const me=pE(ye.width,ye.height,A.format,A.type);for(const he of A.layerUpdates){const Fe=ye.data.subarray(he*me/ye.data.BYTES_PER_ELEMENT,(he+1)*me/ye.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,he,ye.width,ye.height,1,Ce,mt,Fe)}A.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,ye.width,ye.height,ye.depth,Ce,mt,ye.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,qe,ye.width,ye.height,ye.depth,0,Ce,mt,ye.data);else if(A.isData3DTexture)V?(ve&&t.texStorage3D(n.TEXTURE_3D,Ie,qe,ye.width,ye.height,ye.depth),Ee&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,ye.width,ye.height,ye.depth,Ce,mt,ye.data)):t.texImage3D(n.TEXTURE_3D,0,qe,ye.width,ye.height,ye.depth,0,Ce,mt,ye.data);else if(A.isFramebufferTexture){if(ve)if(V)t.texStorage2D(n.TEXTURE_2D,Ie,qe,ye.width,ye.height);else{let me=ye.width,he=ye.height;for(let Fe=0;Fe<Ie;Fe++)t.texImage2D(n.TEXTURE_2D,Fe,qe,me,he,0,Ce,mt,null),me>>=1,he>>=1}}else if(wt.length>0){if(V&&ve){const me=si(wt[0]);t.texStorage2D(n.TEXTURE_2D,Ie,qe,me.width,me.height)}for(let me=0,he=wt.length;me<he;me++)Ae=wt[me],V?Ee&&t.texSubImage2D(n.TEXTURE_2D,me,0,0,Ce,mt,Ae):t.texImage2D(n.TEXTURE_2D,me,qe,Ce,mt,Ae);A.generateMipmaps=!1}else if(V){if(ve){const me=si(ye);t.texStorage2D(n.TEXTURE_2D,Ie,qe,me.width,me.height)}Ee&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Ce,mt,ye)}else t.texImage2D(n.TEXTURE_2D,0,qe,Ce,mt,ye);g(A)&&p(le),Xe.__version=se.version,A.onUpdate&&A.onUpdate(A)}L.__version=A.version}function K(L,A,Y){if(A.image.length!==6)return;const le=Oe(L,A),pe=A.source;t.bindTexture(n.TEXTURE_CUBE_MAP,L.__webglTexture,n.TEXTURE0+Y);const se=i.get(pe);if(pe.version!==se.__version||le===!0){t.activeTexture(n.TEXTURE0+Y);const Xe=Ze.getPrimaries(Ze.workingColorSpace),Te=A.colorSpace===Or?null:Ze.getPrimaries(A.colorSpace),He=A.colorSpace===Or||Xe===Te?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,A.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,A.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,A.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,He);const je=A.isCompressedTexture||A.image[0].isCompressedTexture,ye=A.image[0]&&A.image[0].isDataTexture,Ce=[];for(let he=0;he<6;he++)!je&&!ye?Ce[he]=_(A.image[he],!0,r.maxCubemapSize):Ce[he]=ye?A.image[he].image:A.image[he],Ce[he]=Di(A,Ce[he]);const mt=Ce[0],qe=s.convert(A.format,A.colorSpace),Ae=s.convert(A.type),wt=v(A.internalFormat,qe,Ae,A.colorSpace),V=A.isVideoTexture!==!0,ve=se.__version===void 0||le===!0,Ee=pe.dataReady;let Ie=S(A,mt);be(n.TEXTURE_CUBE_MAP,A);let me;if(je){V&&ve&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Ie,wt,mt.width,mt.height);for(let he=0;he<6;he++){me=Ce[he].mipmaps;for(let Fe=0;Fe<me.length;Fe++){const xt=me[Fe];A.format!==ii?qe!==null?V?Ee&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+he,Fe,0,0,xt.width,xt.height,qe,xt.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+he,Fe,wt,xt.width,xt.height,0,xt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):V?Ee&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+he,Fe,0,0,xt.width,xt.height,qe,Ae,xt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+he,Fe,wt,xt.width,xt.height,0,qe,Ae,xt.data)}}}else{if(me=A.mipmaps,V&&ve){me.length>0&&Ie++;const he=si(Ce[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Ie,wt,he.width,he.height)}for(let he=0;he<6;he++)if(ye){V?Ee&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,0,0,Ce[he].width,Ce[he].height,qe,Ae,Ce[he].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,wt,Ce[he].width,Ce[he].height,0,qe,Ae,Ce[he].data);for(let Fe=0;Fe<me.length;Fe++){const Nn=me[Fe].image[he].image;V?Ee&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+he,Fe+1,0,0,Nn.width,Nn.height,qe,Ae,Nn.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+he,Fe+1,wt,Nn.width,Nn.height,0,qe,Ae,Nn.data)}}else{V?Ee&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,0,0,qe,Ae,Ce[he]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,wt,qe,Ae,Ce[he]);for(let Fe=0;Fe<me.length;Fe++){const xt=me[Fe];V?Ee&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+he,Fe+1,0,0,qe,Ae,xt.image[he]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+he,Fe+1,wt,qe,Ae,xt.image[he])}}}g(A)&&p(n.TEXTURE_CUBE_MAP),se.__version=pe.version,A.onUpdate&&A.onUpdate(A)}L.__version=A.version}function _e(L,A,Y,le,pe,se){const Xe=s.convert(Y.format,Y.colorSpace),Te=s.convert(Y.type),He=v(Y.internalFormat,Xe,Te,Y.colorSpace),je=i.get(A),ye=i.get(Y);if(ye.__renderTarget=A,!je.__hasExternalTextures){const Ce=Math.max(1,A.width>>se),mt=Math.max(1,A.height>>se);pe===n.TEXTURE_3D||pe===n.TEXTURE_2D_ARRAY?t.texImage3D(pe,se,He,Ce,mt,A.depth,0,Xe,Te,null):t.texImage2D(pe,se,He,Ce,mt,0,Xe,Te,null)}t.bindFramebuffer(n.FRAMEBUFFER,L),ze(A)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,le,pe,ye.__webglTexture,0,nn(A)):(pe===n.TEXTURE_2D||pe>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&pe<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,le,pe,ye.__webglTexture,se),t.bindFramebuffer(n.FRAMEBUFFER,null)}function Pe(L,A,Y){if(n.bindRenderbuffer(n.RENDERBUFFER,L),A.depthBuffer){const le=A.depthTexture,pe=le&&le.isDepthTexture?le.type:null,se=b(A.stencilBuffer,pe),Xe=A.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Te=nn(A);ze(A)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Te,se,A.width,A.height):Y?n.renderbufferStorageMultisample(n.RENDERBUFFER,Te,se,A.width,A.height):n.renderbufferStorage(n.RENDERBUFFER,se,A.width,A.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,Xe,n.RENDERBUFFER,L)}else{const le=A.textures;for(let pe=0;pe<le.length;pe++){const se=le[pe],Xe=s.convert(se.format,se.colorSpace),Te=s.convert(se.type),He=v(se.internalFormat,Xe,Te,se.colorSpace),je=nn(A);Y&&ze(A)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,je,He,A.width,A.height):ze(A)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,je,He,A.width,A.height):n.renderbufferStorage(n.RENDERBUFFER,He,A.width,A.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Me(L,A){if(A&&A.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,L),!(A.depthTexture&&A.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const le=i.get(A.depthTexture);le.__renderTarget=A,(!le.__webglTexture||A.depthTexture.image.width!==A.width||A.depthTexture.image.height!==A.height)&&(A.depthTexture.image.width=A.width,A.depthTexture.image.height=A.height,A.depthTexture.needsUpdate=!0),O(A.depthTexture,0);const pe=le.__webglTexture,se=nn(A);if(A.depthTexture.format===_s)ze(A)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,pe,0,se):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,pe,0);else if(A.depthTexture.format===ys)ze(A)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,pe,0,se):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,pe,0);else throw new Error("Unknown depthTexture format")}function We(L){const A=i.get(L),Y=L.isWebGLCubeRenderTarget===!0;if(A.__boundDepthTexture!==L.depthTexture){const le=L.depthTexture;if(A.__depthDisposeCallback&&A.__depthDisposeCallback(),le){const pe=()=>{delete A.__boundDepthTexture,delete A.__depthDisposeCallback,le.removeEventListener("dispose",pe)};le.addEventListener("dispose",pe),A.__depthDisposeCallback=pe}A.__boundDepthTexture=le}if(L.depthTexture&&!A.__autoAllocateDepthBuffer){if(Y)throw new Error("target.depthTexture not supported in Cube render targets");const le=L.texture.mipmaps;le&&le.length>0?Me(A.__webglFramebuffer[0],L):Me(A.__webglFramebuffer,L)}else if(Y){A.__webglDepthbuffer=[];for(let le=0;le<6;le++)if(t.bindFramebuffer(n.FRAMEBUFFER,A.__webglFramebuffer[le]),A.__webglDepthbuffer[le]===void 0)A.__webglDepthbuffer[le]=n.createRenderbuffer(),Pe(A.__webglDepthbuffer[le],L,!1);else{const pe=L.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,se=A.__webglDepthbuffer[le];n.bindRenderbuffer(n.RENDERBUFFER,se),n.framebufferRenderbuffer(n.FRAMEBUFFER,pe,n.RENDERBUFFER,se)}}else{const le=L.texture.mipmaps;if(le&&le.length>0?t.bindFramebuffer(n.FRAMEBUFFER,A.__webglFramebuffer[0]):t.bindFramebuffer(n.FRAMEBUFFER,A.__webglFramebuffer),A.__webglDepthbuffer===void 0)A.__webglDepthbuffer=n.createRenderbuffer(),Pe(A.__webglDepthbuffer,L,!1);else{const pe=L.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,se=A.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,se),n.framebufferRenderbuffer(n.FRAMEBUFFER,pe,n.RENDERBUFFER,se)}}t.bindFramebuffer(n.FRAMEBUFFER,null)}function Sn(L,A,Y){const le=i.get(L);A!==void 0&&_e(le.__webglFramebuffer,L,L.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),Y!==void 0&&We(L)}function I(L){const A=L.texture,Y=i.get(L),le=i.get(A);L.addEventListener("dispose",T);const pe=L.textures,se=L.isWebGLCubeRenderTarget===!0,Xe=pe.length>1;if(Xe||(le.__webglTexture===void 0&&(le.__webglTexture=n.createTexture()),le.__version=A.version,a.memory.textures++),se){Y.__webglFramebuffer=[];for(let Te=0;Te<6;Te++)if(A.mipmaps&&A.mipmaps.length>0){Y.__webglFramebuffer[Te]=[];for(let He=0;He<A.mipmaps.length;He++)Y.__webglFramebuffer[Te][He]=n.createFramebuffer()}else Y.__webglFramebuffer[Te]=n.createFramebuffer()}else{if(A.mipmaps&&A.mipmaps.length>0){Y.__webglFramebuffer=[];for(let Te=0;Te<A.mipmaps.length;Te++)Y.__webglFramebuffer[Te]=n.createFramebuffer()}else Y.__webglFramebuffer=n.createFramebuffer();if(Xe)for(let Te=0,He=pe.length;Te<He;Te++){const je=i.get(pe[Te]);je.__webglTexture===void 0&&(je.__webglTexture=n.createTexture(),a.memory.textures++)}if(L.samples>0&&ze(L)===!1){Y.__webglMultisampledFramebuffer=n.createFramebuffer(),Y.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,Y.__webglMultisampledFramebuffer);for(let Te=0;Te<pe.length;Te++){const He=pe[Te];Y.__webglColorRenderbuffer[Te]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,Y.__webglColorRenderbuffer[Te]);const je=s.convert(He.format,He.colorSpace),ye=s.convert(He.type),Ce=v(He.internalFormat,je,ye,He.colorSpace,L.isXRRenderTarget===!0),mt=nn(L);n.renderbufferStorageMultisample(n.RENDERBUFFER,mt,Ce,L.width,L.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Te,n.RENDERBUFFER,Y.__webglColorRenderbuffer[Te])}n.bindRenderbuffer(n.RENDERBUFFER,null),L.depthBuffer&&(Y.__webglDepthRenderbuffer=n.createRenderbuffer(),Pe(Y.__webglDepthRenderbuffer,L,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(se){t.bindTexture(n.TEXTURE_CUBE_MAP,le.__webglTexture),be(n.TEXTURE_CUBE_MAP,A);for(let Te=0;Te<6;Te++)if(A.mipmaps&&A.mipmaps.length>0)for(let He=0;He<A.mipmaps.length;He++)_e(Y.__webglFramebuffer[Te][He],L,A,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Te,He);else _e(Y.__webglFramebuffer[Te],L,A,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Te,0);g(A)&&p(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Xe){for(let Te=0,He=pe.length;Te<He;Te++){const je=pe[Te],ye=i.get(je);let Ce=n.TEXTURE_2D;(L.isWebGL3DRenderTarget||L.isWebGLArrayRenderTarget)&&(Ce=L.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(Ce,ye.__webglTexture),be(Ce,je),_e(Y.__webglFramebuffer,L,je,n.COLOR_ATTACHMENT0+Te,Ce,0),g(je)&&p(Ce)}t.unbindTexture()}else{let Te=n.TEXTURE_2D;if((L.isWebGL3DRenderTarget||L.isWebGLArrayRenderTarget)&&(Te=L.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(Te,le.__webglTexture),be(Te,A),A.mipmaps&&A.mipmaps.length>0)for(let He=0;He<A.mipmaps.length;He++)_e(Y.__webglFramebuffer[He],L,A,n.COLOR_ATTACHMENT0,Te,He);else _e(Y.__webglFramebuffer,L,A,n.COLOR_ATTACHMENT0,Te,0);g(A)&&p(Te),t.unbindTexture()}L.depthBuffer&&We(L)}function jt(L){const A=L.textures;for(let Y=0,le=A.length;Y<le;Y++){const pe=A[Y];if(g(pe)){const se=y(L),Xe=i.get(pe).__webglTexture;t.bindTexture(se,Xe),p(se),t.unbindTexture()}}}const pt=[],Ye=[];function Le(L){if(L.samples>0){if(ze(L)===!1){const A=L.textures,Y=L.width,le=L.height;let pe=n.COLOR_BUFFER_BIT;const se=L.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Xe=i.get(L),Te=A.length>1;if(Te)for(let je=0;je<A.length;je++)t.bindFramebuffer(n.FRAMEBUFFER,Xe.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+je,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Xe.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+je,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Xe.__webglMultisampledFramebuffer);const He=L.texture.mipmaps;He&&He.length>0?t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Xe.__webglFramebuffer[0]):t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Xe.__webglFramebuffer);for(let je=0;je<A.length;je++){if(L.resolveDepthBuffer&&(L.depthBuffer&&(pe|=n.DEPTH_BUFFER_BIT),L.stencilBuffer&&L.resolveStencilBuffer&&(pe|=n.STENCIL_BUFFER_BIT)),Te){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Xe.__webglColorRenderbuffer[je]);const ye=i.get(A[je]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,ye,0)}n.blitFramebuffer(0,0,Y,le,0,0,Y,le,pe,n.NEAREST),l===!0&&(pt.length=0,Ye.length=0,pt.push(n.COLOR_ATTACHMENT0+je),L.depthBuffer&&L.resolveDepthBuffer===!1&&(pt.push(se),Ye.push(se),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,Ye)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,pt))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Te)for(let je=0;je<A.length;je++){t.bindFramebuffer(n.FRAMEBUFFER,Xe.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+je,n.RENDERBUFFER,Xe.__webglColorRenderbuffer[je]);const ye=i.get(A[je]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Xe.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+je,n.TEXTURE_2D,ye,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Xe.__webglMultisampledFramebuffer)}else if(L.depthBuffer&&L.resolveDepthBuffer===!1&&l){const A=L.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[A])}}}function nn(L){return Math.min(r.maxSamples,L.samples)}function ze(L){const A=i.get(L);return L.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&A.__useRenderToTexture!==!1}function Ct(L){const A=a.render.frame;c.get(L)!==A&&(c.set(L,A),L.update())}function Di(L,A){const Y=L.colorSpace,le=L.format,pe=L.type;return L.isCompressedTexture===!0||L.isVideoTexture===!0||Y!==_c&&Y!==Or&&(Ze.getTransfer(Y)===Re?(le!==ii||pe!==Kn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Y)),A}function si(L){return typeof HTMLImageElement<"u"&&L instanceof HTMLImageElement?(u.width=L.naturalWidth||L.width,u.height=L.naturalHeight||L.height):typeof VideoFrame<"u"&&L instanceof VideoFrame?(u.width=L.displayWidth,u.height=L.displayHeight):(u.width=L.width,u.height=L.height),u}this.allocateTextureUnit=k,this.resetTextureUnits=U,this.setTexture2D=O,this.setTexture2DArray=C,this.setTexture3D=q,this.setTextureCube=z,this.rebindTextures=Sn,this.setupRenderTarget=I,this.updateRenderTargetMipmap=jt,this.updateMultisampleRenderTarget=Le,this.setupDepthRenderbuffer=We,this.setupFrameBufferTexture=_e,this.useMultisampledRTT=ze}function Eq(n,e){function t(i,r=Or){let s;const a=Ze.getTransfer(r);if(i===Kn)return n.UNSIGNED_BYTE;if(i===j0)return n.UNSIGNED_SHORT_4_4_4_4;if(i===q0)return n.UNSIGNED_SHORT_5_5_5_1;if(i===X0)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===Y0)return n.UNSIGNED_INT_10F_11F_11F_REV;if(i===sc)return n.BYTE;if(i===ac)return n.SHORT;if(i===la)return n.UNSIGNED_SHORT;if(i===Oi)return n.INT;if(i===wn)return n.UNSIGNED_INT;if(i===li)return n.FLOAT;if(i===Fi)return n.HALF_FLOAT;if(i===Uw)return n.ALPHA;if(i===xg)return n.RGB;if(i===ii)return n.RGBA;if(i===_s)return n.DEPTH_COMPONENT;if(i===ys)return n.DEPTH_STENCIL;if(i===Tg)return n.RED;if(i===Tf)return n.RED_INTEGER;if(i===zo)return n.RG;if(i===Ef)return n.RG_INTEGER;if(i===Mf)return n.RGBA_INTEGER;if(i===Xl||i===Yl||i===Kl||i===Ql)if(a===Re)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(i===Xl)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Yl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===Kl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Ql)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(i===Xl)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Yl)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Kl)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Ql)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===Um||i===Om||i===Im||i===Bm)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(i===Um)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===Om)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===Im)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Bm)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===Rd||i===Nd||i===Cd)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(i===Rd||i===Nd)return a===Re?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===Cd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===Dd||i===Ld||i===Pd||i===Ud||i===Od||i===Id||i===Bd||i===Fd||i===kd||i===zd||i===Gd||i===Vd||i===Hd||i===$d)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(i===Dd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===Ld)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===Pd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===Ud)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===Od)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===Id)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===Bd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===Fd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===kd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===zd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===Gd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===Vd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===Hd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===$d)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===Wd||i===cE||i===hE)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(i===Wd)return a===Re?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===cE)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===hE)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===jd||i===qd||i===Xd||i===Yd)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(i===jd)return s.COMPRESSED_RED_RGTC1_EXT;if(i===qd)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===Xd)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===Yd)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===gs?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}const Mq=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,wq=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Aq{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const i=new sI(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new Xa({vertexShader:Mq,fragmentShader:wq,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new mi(new Rg(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Rq extends sl{constructor(e,t){super();const i=this;let r=null,s=1,a=null,o="local-floor",l=1,u=null,c=null,h=null,d=null,f=null,m=null;const _=typeof XRWebGLBinding<"u",g=new Aq,p={},y=t.getContextAttributes();let v=null,b=null;const S=[],x=[],T=new fe;let w=null;const E=new Ii;E.viewport=new Je;const M=new Ii;M.viewport=new Je;const N=[E,M],U=new dI;let k=null,P=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(W){let K=S[W];return K===void 0&&(K=new wy,S[W]=K),K.getTargetRaySpace()},this.getControllerGrip=function(W){let K=S[W];return K===void 0&&(K=new wy,S[W]=K),K.getGripSpace()},this.getHand=function(W){let K=S[W];return K===void 0&&(K=new wy,S[W]=K),K.getHandSpace()};function O(W){const K=x.indexOf(W.inputSource);if(K===-1)return;const _e=S[K];_e!==void 0&&(_e.update(W.inputSource,W.frame,u||a),_e.dispatchEvent({type:W.type,data:W.inputSource}))}function C(){r.removeEventListener("select",O),r.removeEventListener("selectstart",O),r.removeEventListener("selectend",O),r.removeEventListener("squeeze",O),r.removeEventListener("squeezestart",O),r.removeEventListener("squeezeend",O),r.removeEventListener("end",C),r.removeEventListener("inputsourceschange",q);for(let W=0;W<S.length;W++){const K=x[W];K!==null&&(x[W]=null,S[W].disconnect(K))}k=null,P=null,g.reset();for(const W in p)delete p[W];e.setRenderTarget(v),f=null,d=null,h=null,r=null,b=null,ie.stop(),i.isPresenting=!1,e.setPixelRatio(w),e.setSize(T.width,T.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(W){s=W,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(W){o=W,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||a},this.setReferenceSpace=function(W){u=W},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return h===null&&_&&(h=new XRWebGLBinding(r,t)),h},this.getFrame=function(){return m},this.getSession=function(){return r},this.setSession=async function(W){if(r=W,r!==null){if(v=e.getRenderTarget(),r.addEventListener("select",O),r.addEventListener("selectstart",O),r.addEventListener("selectend",O),r.addEventListener("squeeze",O),r.addEventListener("squeezestart",O),r.addEventListener("squeezeend",O),r.addEventListener("end",C),r.addEventListener("inputsourceschange",q),y.xrCompatible!==!0&&await t.makeXRCompatible(),w=e.getPixelRatio(),e.getSize(T),_&&"createProjectionLayer"in XRWebGLBinding.prototype){let _e=null,Pe=null,Me=null;y.depth&&(Me=y.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,_e=y.stencil?ys:_s,Pe=y.stencil?gs:wn);const We={colorFormat:t.RGBA8,depthFormat:Me,scaleFactor:s};h=this.getBinding(),d=h.createProjectionLayer(We),r.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),b=new su(d.textureWidth,d.textureHeight,{format:ii,type:Kn,depthTexture:new ks(d.textureWidth,d.textureHeight,Pe,void 0,void 0,void 0,void 0,void 0,void 0,_e),stencilBuffer:y.stencil,colorSpace:e.outputColorSpace,samples:y.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1,resolveStencilBuffer:d.ignoreDepthValues===!1})}else{const _e={antialias:y.antialias,alpha:!0,depth:y.depth,stencil:y.stencil,framebufferScaleFactor:s};f=new XRWebGLLayer(r,t,_e),r.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),b=new su(f.framebufferWidth,f.framebufferHeight,{format:ii,type:Kn,colorSpace:e.outputColorSpace,stencilBuffer:y.stencil,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}b.isXRRenderTarget=!0,this.setFoveation(l),u=null,a=await r.requestReferenceSpace(o),ie.setContext(r),ie.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return g.getDepthTexture()};function q(W){for(let K=0;K<W.removed.length;K++){const _e=W.removed[K],Pe=x.indexOf(_e);Pe>=0&&(x[Pe]=null,S[Pe].disconnect(_e))}for(let K=0;K<W.added.length;K++){const _e=W.added[K];let Pe=x.indexOf(_e);if(Pe===-1){for(let We=0;We<S.length;We++)if(We>=x.length){x.push(_e),Pe=We;break}else if(x[We]===null){x[We]=_e,Pe=We;break}if(Pe===-1)break}const Me=S[Pe];Me&&Me.connect(_e)}}const z=new D,re=new D;function X(W,K,_e){z.setFromMatrixPosition(K.matrixWorld),re.setFromMatrixPosition(_e.matrixWorld);const Pe=z.distanceTo(re),Me=K.projectionMatrix.elements,We=_e.projectionMatrix.elements,Sn=Me[14]/(Me[10]-1),I=Me[14]/(Me[10]+1),jt=(Me[9]+1)/Me[5],pt=(Me[9]-1)/Me[5],Ye=(Me[8]-1)/Me[0],Le=(We[8]+1)/We[0],nn=Sn*Ye,ze=Sn*Le,Ct=Pe/(-Ye+Le),Di=Ct*-Ye;if(K.matrixWorld.decompose(W.position,W.quaternion,W.scale),W.translateX(Di),W.translateZ(Ct),W.matrixWorld.compose(W.position,W.quaternion,W.scale),W.matrixWorldInverse.copy(W.matrixWorld).invert(),Me[10]===-1)W.projectionMatrix.copy(K.projectionMatrix),W.projectionMatrixInverse.copy(K.projectionMatrixInverse);else{const si=Sn+Ct,L=I+Ct,A=nn-Di,Y=ze+(Pe-Di),le=jt*I/L*si,pe=pt*I/L*si;W.projectionMatrix.makePerspective(A,Y,le,pe,si,L),W.projectionMatrixInverse.copy(W.projectionMatrix).invert()}}function oe(W,K){K===null?W.matrixWorld.copy(W.matrix):W.matrixWorld.multiplyMatrices(K.matrixWorld,W.matrix),W.matrixWorldInverse.copy(W.matrixWorld).invert()}this.updateCamera=function(W){if(r===null)return;let K=W.near,_e=W.far;g.texture!==null&&(g.depthNear>0&&(K=g.depthNear),g.depthFar>0&&(_e=g.depthFar)),U.near=M.near=E.near=K,U.far=M.far=E.far=_e,(k!==U.near||P!==U.far)&&(r.updateRenderState({depthNear:U.near,depthFar:U.far}),k=U.near,P=U.far),U.layers.mask=W.layers.mask|6,E.layers.mask=U.layers.mask&3,M.layers.mask=U.layers.mask&5;const Pe=W.parent,Me=U.cameras;oe(U,Pe);for(let We=0;We<Me.length;We++)oe(Me[We],Pe);Me.length===2?X(U,E,M):U.projectionMatrix.copy(E.projectionMatrix),be(W,U,Pe)};function be(W,K,_e){_e===null?W.matrix.copy(K.matrixWorld):(W.matrix.copy(_e.matrixWorld),W.matrix.invert(),W.matrix.multiply(K.matrixWorld)),W.matrix.decompose(W.position,W.quaternion,W.scale),W.updateMatrixWorld(!0),W.projectionMatrix.copy(K.projectionMatrix),W.projectionMatrixInverse.copy(K.projectionMatrixInverse),W.isPerspectiveCamera&&(W.fov=yc*2*Math.atan(1/W.projectionMatrix.elements[5]),W.zoom=1)}this.getCamera=function(){return U},this.getFoveation=function(){if(!(d===null&&f===null))return l},this.setFoveation=function(W){l=W,d!==null&&(d.fixedFoveation=W),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=W)},this.hasDepthSensing=function(){return g.texture!==null},this.getDepthSensingMesh=function(){return g.getMesh(U)},this.getCameraTexture=function(W){return p[W]};let Oe=null;function st(W,K){if(c=K.getViewerPose(u||a),m=K,c!==null){const _e=c.views;f!==null&&(e.setRenderTargetFramebuffer(b,f.framebuffer),e.setRenderTarget(b));let Pe=!1;_e.length!==U.cameras.length&&(U.cameras.length=0,Pe=!0);for(let I=0;I<_e.length;I++){const jt=_e[I];let pt=null;if(f!==null)pt=f.getViewport(jt);else{const Le=h.getViewSubImage(d,jt);pt=Le.viewport,I===0&&(e.setRenderTargetTextures(b,Le.colorTexture,Le.depthStencilTexture),e.setRenderTarget(b))}let Ye=N[I];Ye===void 0&&(Ye=new Ii,Ye.layers.enable(I),Ye.viewport=new Je,N[I]=Ye),Ye.matrix.fromArray(jt.transform.matrix),Ye.matrix.decompose(Ye.position,Ye.quaternion,Ye.scale),Ye.projectionMatrix.fromArray(jt.projectionMatrix),Ye.projectionMatrixInverse.copy(Ye.projectionMatrix).invert(),Ye.viewport.set(pt.x,pt.y,pt.width,pt.height),I===0&&(U.matrix.copy(Ye.matrix),U.matrix.decompose(U.position,U.quaternion,U.scale)),Pe===!0&&U.cameras.push(Ye)}const Me=r.enabledFeatures;if(Me&&Me.includes("depth-sensing")&&r.depthUsage=="gpu-optimized"&&_){h=i.getBinding();const I=h.getDepthInformation(_e[0]);I&&I.isValid&&I.texture&&g.init(I,r.renderState)}if(Me&&Me.includes("camera-access")&&_){e.state.unbindTexture(),h=i.getBinding();for(let I=0;I<_e.length;I++){const jt=_e[I].camera;if(jt){let pt=p[jt];pt||(pt=new sI,p[jt]=pt);const Ye=h.getCameraImage(jt);pt.sourceTexture=Ye}}}}for(let _e=0;_e<S.length;_e++){const Pe=x[_e],Me=S[_e];Pe!==null&&Me!==void 0&&Me.update(Pe,K,u||a)}Oe&&Oe(W,K),K.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:K}),m=null}const ie=new mI;ie.setAnimationLoop(st),this.setAnimationLoop=function(W){Oe=W},this.dispose=function(){}}}const Cu=new Vr,Nq=new zt;function Cq(n,e){function t(g,p){g.matrixAutoUpdate===!0&&g.updateMatrix(),p.value.copy(g.matrix)}function i(g,p){p.color.getRGB(g.fogColor.value,eI(n)),p.isFog?(g.fogNear.value=p.near,g.fogFar.value=p.far):p.isFogExp2&&(g.fogDensity.value=p.density)}function r(g,p,y,v,b){p.isMeshBasicMaterial||p.isMeshLambertMaterial?s(g,p):p.isMeshToonMaterial?(s(g,p),h(g,p)):p.isMeshPhongMaterial?(s(g,p),c(g,p)):p.isMeshStandardMaterial?(s(g,p),d(g,p),p.isMeshPhysicalMaterial&&f(g,p,b)):p.isMeshMatcapMaterial?(s(g,p),m(g,p)):p.isMeshDepthMaterial?s(g,p):p.isMeshDistanceMaterial?(s(g,p),_(g,p)):p.isMeshNormalMaterial?s(g,p):p.isLineBasicMaterial?(a(g,p),p.isLineDashedMaterial&&o(g,p)):p.isPointsMaterial?l(g,p,y,v):p.isSpriteMaterial?u(g,p):p.isShadowMaterial?(g.color.value.copy(p.color),g.opacity.value=p.opacity):p.isShaderMaterial&&(p.uniformsNeedUpdate=!1)}function s(g,p){g.opacity.value=p.opacity,p.color&&g.diffuse.value.copy(p.color),p.emissive&&g.emissive.value.copy(p.emissive).multiplyScalar(p.emissiveIntensity),p.map&&(g.map.value=p.map,t(p.map,g.mapTransform)),p.alphaMap&&(g.alphaMap.value=p.alphaMap,t(p.alphaMap,g.alphaMapTransform)),p.bumpMap&&(g.bumpMap.value=p.bumpMap,t(p.bumpMap,g.bumpMapTransform),g.bumpScale.value=p.bumpScale,p.side===bn&&(g.bumpScale.value*=-1)),p.normalMap&&(g.normalMap.value=p.normalMap,t(p.normalMap,g.normalMapTransform),g.normalScale.value.copy(p.normalScale),p.side===bn&&g.normalScale.value.negate()),p.displacementMap&&(g.displacementMap.value=p.displacementMap,t(p.displacementMap,g.displacementMapTransform),g.displacementScale.value=p.displacementScale,g.displacementBias.value=p.displacementBias),p.emissiveMap&&(g.emissiveMap.value=p.emissiveMap,t(p.emissiveMap,g.emissiveMapTransform)),p.specularMap&&(g.specularMap.value=p.specularMap,t(p.specularMap,g.specularMapTransform)),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest);const y=e.get(p),v=y.envMap,b=y.envMapRotation;v&&(g.envMap.value=v,Cu.copy(b),Cu.x*=-1,Cu.y*=-1,Cu.z*=-1,v.isCubeTexture&&v.isRenderTargetTexture===!1&&(Cu.y*=-1,Cu.z*=-1),g.envMapRotation.value.setFromMatrix4(Nq.makeRotationFromEuler(Cu)),g.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=p.reflectivity,g.ior.value=p.ior,g.refractionRatio.value=p.refractionRatio),p.lightMap&&(g.lightMap.value=p.lightMap,g.lightMapIntensity.value=p.lightMapIntensity,t(p.lightMap,g.lightMapTransform)),p.aoMap&&(g.aoMap.value=p.aoMap,g.aoMapIntensity.value=p.aoMapIntensity,t(p.aoMap,g.aoMapTransform))}function a(g,p){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,p.map&&(g.map.value=p.map,t(p.map,g.mapTransform))}function o(g,p){g.dashSize.value=p.dashSize,g.totalSize.value=p.dashSize+p.gapSize,g.scale.value=p.scale}function l(g,p,y,v){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,g.size.value=p.size*y,g.scale.value=v*.5,p.map&&(g.map.value=p.map,t(p.map,g.uvTransform)),p.alphaMap&&(g.alphaMap.value=p.alphaMap,t(p.alphaMap,g.alphaMapTransform)),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest)}function u(g,p){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,g.rotation.value=p.rotation,p.map&&(g.map.value=p.map,t(p.map,g.mapTransform)),p.alphaMap&&(g.alphaMap.value=p.alphaMap,t(p.alphaMap,g.alphaMapTransform)),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest)}function c(g,p){g.specular.value.copy(p.specular),g.shininess.value=Math.max(p.shininess,1e-4)}function h(g,p){p.gradientMap&&(g.gradientMap.value=p.gradientMap)}function d(g,p){g.metalness.value=p.metalness,p.metalnessMap&&(g.metalnessMap.value=p.metalnessMap,t(p.metalnessMap,g.metalnessMapTransform)),g.roughness.value=p.roughness,p.roughnessMap&&(g.roughnessMap.value=p.roughnessMap,t(p.roughnessMap,g.roughnessMapTransform)),p.envMap&&(g.envMapIntensity.value=p.envMapIntensity)}function f(g,p,y){g.ior.value=p.ior,p.sheen>0&&(g.sheenColor.value.copy(p.sheenColor).multiplyScalar(p.sheen),g.sheenRoughness.value=p.sheenRoughness,p.sheenColorMap&&(g.sheenColorMap.value=p.sheenColorMap,t(p.sheenColorMap,g.sheenColorMapTransform)),p.sheenRoughnessMap&&(g.sheenRoughnessMap.value=p.sheenRoughnessMap,t(p.sheenRoughnessMap,g.sheenRoughnessMapTransform))),p.clearcoat>0&&(g.clearcoat.value=p.clearcoat,g.clearcoatRoughness.value=p.clearcoatRoughness,p.clearcoatMap&&(g.clearcoatMap.value=p.clearcoatMap,t(p.clearcoatMap,g.clearcoatMapTransform)),p.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=p.clearcoatRoughnessMap,t(p.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),p.clearcoatNormalMap&&(g.clearcoatNormalMap.value=p.clearcoatNormalMap,t(p.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(p.clearcoatNormalScale),p.side===bn&&g.clearcoatNormalScale.value.negate())),p.dispersion>0&&(g.dispersion.value=p.dispersion),p.iridescence>0&&(g.iridescence.value=p.iridescence,g.iridescenceIOR.value=p.iridescenceIOR,g.iridescenceThicknessMinimum.value=p.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=p.iridescenceThicknessRange[1],p.iridescenceMap&&(g.iridescenceMap.value=p.iridescenceMap,t(p.iridescenceMap,g.iridescenceMapTransform)),p.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=p.iridescenceThicknessMap,t(p.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),p.transmission>0&&(g.transmission.value=p.transmission,g.transmissionSamplerMap.value=y.texture,g.transmissionSamplerSize.value.set(y.width,y.height),p.transmissionMap&&(g.transmissionMap.value=p.transmissionMap,t(p.transmissionMap,g.transmissionMapTransform)),g.thickness.value=p.thickness,p.thicknessMap&&(g.thicknessMap.value=p.thicknessMap,t(p.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=p.attenuationDistance,g.attenuationColor.value.copy(p.attenuationColor)),p.anisotropy>0&&(g.anisotropyVector.value.set(p.anisotropy*Math.cos(p.anisotropyRotation),p.anisotropy*Math.sin(p.anisotropyRotation)),p.anisotropyMap&&(g.anisotropyMap.value=p.anisotropyMap,t(p.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=p.specularIntensity,g.specularColor.value.copy(p.specularColor),p.specularColorMap&&(g.specularColorMap.value=p.specularColorMap,t(p.specularColorMap,g.specularColorMapTransform)),p.specularIntensityMap&&(g.specularIntensityMap.value=p.specularIntensityMap,t(p.specularIntensityMap,g.specularIntensityMapTransform))}function m(g,p){p.matcap&&(g.matcap.value=p.matcap)}function _(g,p){const y=e.get(p).light;g.referencePosition.value.setFromMatrixPosition(y.matrixWorld),g.nearDistance.value=y.shadow.camera.near,g.farDistance.value=y.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function Dq(n,e,t,i){let r={},s={},a=[];const o=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(y,v){const b=v.program;i.uniformBlockBinding(y,b)}function u(y,v){let b=r[y.id];b===void 0&&(m(y),b=c(y),r[y.id]=b,y.addEventListener("dispose",g));const S=v.program;i.updateUBOMapping(y,S);const x=e.render.frame;s[y.id]!==x&&(d(y),s[y.id]=x)}function c(y){const v=h();y.__bindingPointIndex=v;const b=n.createBuffer(),S=y.__size,x=y.usage;return n.bindBuffer(n.UNIFORM_BUFFER,b),n.bufferData(n.UNIFORM_BUFFER,S,x),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,v,b),b}function h(){for(let y=0;y<o;y++)if(a.indexOf(y)===-1)return a.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(y){const v=r[y.id],b=y.uniforms,S=y.__cache;n.bindBuffer(n.UNIFORM_BUFFER,v);for(let x=0,T=b.length;x<T;x++){const w=Array.isArray(b[x])?b[x]:[b[x]];for(let E=0,M=w.length;E<M;E++){const N=w[E];if(f(N,x,E,S)===!0){const U=N.__offset,k=Array.isArray(N.value)?N.value:[N.value];let P=0;for(let O=0;O<k.length;O++){const C=k[O],q=_(C);typeof C=="number"||typeof C=="boolean"?(N.__data[0]=C,n.bufferSubData(n.UNIFORM_BUFFER,U+P,N.__data)):C.isMatrix3?(N.__data[0]=C.elements[0],N.__data[1]=C.elements[1],N.__data[2]=C.elements[2],N.__data[3]=0,N.__data[4]=C.elements[3],N.__data[5]=C.elements[4],N.__data[6]=C.elements[5],N.__data[7]=0,N.__data[8]=C.elements[6],N.__data[9]=C.elements[7],N.__data[10]=C.elements[8],N.__data[11]=0):(C.toArray(N.__data,P),P+=q.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,U,N.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function f(y,v,b,S){const x=y.value,T=v+"_"+b;if(S[T]===void 0)return typeof x=="number"||typeof x=="boolean"?S[T]=x:S[T]=x.clone(),!0;{const w=S[T];if(typeof x=="number"||typeof x=="boolean"){if(w!==x)return S[T]=x,!0}else if(w.equals(x)===!1)return w.copy(x),!0}return!1}function m(y){const v=y.uniforms;let b=0;const S=16;for(let T=0,w=v.length;T<w;T++){const E=Array.isArray(v[T])?v[T]:[v[T]];for(let M=0,N=E.length;M<N;M++){const U=E[M],k=Array.isArray(U.value)?U.value:[U.value];for(let P=0,O=k.length;P<O;P++){const C=k[P],q=_(C),z=b%S,re=z%q.boundary,X=z+re;b+=re,X!==0&&S-X<q.storage&&(b+=S-X),U.__data=new Float32Array(q.storage/Float32Array.BYTES_PER_ELEMENT),U.__offset=b,b+=q.storage}}}const x=b%S;return x>0&&(b+=S-x),y.__size=b,y.__cache={},this}function _(y){const v={boundary:0,storage:0};return typeof y=="number"||typeof y=="boolean"?(v.boundary=4,v.storage=4):y.isVector2?(v.boundary=8,v.storage=8):y.isVector3||y.isColor?(v.boundary=16,v.storage=12):y.isVector4?(v.boundary=16,v.storage=16):y.isMatrix3?(v.boundary=48,v.storage=48):y.isMatrix4?(v.boundary=64,v.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),v}function g(y){const v=y.target;v.removeEventListener("dispose",g);const b=a.indexOf(v.__bindingPointIndex);a.splice(b,1),n.deleteBuffer(r[v.id]),delete r[v.id],delete s[v.id]}function p(){for(const y in r)n.deleteBuffer(r[y]);a=[],r={},s={}}return{bind:l,update:u,dispose:p}}class Lq{constructor(e={}){const{canvas:t=QO(),context:i=null,depth:r=!0,stencil:s=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:u=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:h=!1,reversedDepthBuffer:d=!1}=e;this.isWebGLRenderer=!0;let f;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=i.getContextAttributes().alpha}else f=a;const m=new Uint32Array(4),_=new Int32Array(4);let g=null,p=null;const y=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=zr,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const b=this;let S=!1;this._outputColorSpace=hr;let x=0,T=0,w=null,E=-1,M=null;const N=new Je,U=new Je;let k=null;const P=new Ve(0);let O=0,C=t.width,q=t.height,z=1,re=null,X=null;const oe=new Je(0,0,C,q),be=new Je(0,0,C,q);let Oe=!1;const st=new wg;let ie=!1,W=!1;const K=new zt,_e=new D,Pe=new Je,Me={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let We=!1;function Sn(){return w===null?z:1}let I=i;function jt(R,$){return t.getContext(R,$)}try{const R={alpha:!0,depth:r,stencil:s,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${xf}`),t.addEventListener("webglcontextlost",Ee,!1),t.addEventListener("webglcontextrestored",Ie,!1),t.addEventListener("webglcontextcreationerror",me,!1),I===null){const $="webgl2";if(I=jt($,R),I===null)throw jt($)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(R){throw console.error("THREE.WebGLRenderer: "+R.message),R}let pt,Ye,Le,nn,ze,Ct,Di,si,L,A,Y,le,pe,se,Xe,Te,He,je,ye,Ce,mt,qe,Ae,wt;function V(){pt=new Vj(I),pt.init(),qe=new Eq(I,pt),Ye=new Oj(I,pt,e,qe),Le=new xq(I,pt),Ye.reversedDepthBuffer&&d&&Le.buffers.depth.setReversed(!0),nn=new Wj(I),ze=new uq,Ct=new Tq(I,pt,Le,ze,Ye,qe,nn),Di=new Bj(b),si=new Gj(b),L=new Q5(I),Ae=new Pj(I,L),A=new Hj(I,L,nn,Ae),Y=new qj(I,A,L,nn),ye=new jj(I,Ye,Ct),Te=new Ij(ze),le=new lq(b,Di,si,pt,Ye,Ae,Te),pe=new Cq(b,ze),se=new hq,Xe=new _q(pt),je=new Lj(b,Di,si,Le,Y,f,l),He=new bq(b,Y,Ye),wt=new Dq(I,nn,Ye,Le),Ce=new Uj(I,pt,nn),mt=new $j(I,pt,nn),nn.programs=le.programs,b.capabilities=Ye,b.extensions=pt,b.properties=ze,b.renderLists=se,b.shadowMap=He,b.state=Le,b.info=nn}V();const ve=new Rq(b,I);this.xr=ve,this.getContext=function(){return I},this.getContextAttributes=function(){return I.getContextAttributes()},this.forceContextLoss=function(){const R=pt.get("WEBGL_lose_context");R&&R.loseContext()},this.forceContextRestore=function(){const R=pt.get("WEBGL_lose_context");R&&R.restoreContext()},this.getPixelRatio=function(){return z},this.setPixelRatio=function(R){R!==void 0&&(z=R,this.setSize(C,q,!1))},this.getSize=function(R){return R.set(C,q)},this.setSize=function(R,$,Q=!0){if(ve.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}C=R,q=$,t.width=Math.floor(R*z),t.height=Math.floor($*z),Q===!0&&(t.style.width=R+"px",t.style.height=$+"px"),this.setViewport(0,0,R,$)},this.getDrawingBufferSize=function(R){return R.set(C*z,q*z).floor()},this.setDrawingBufferSize=function(R,$,Q){C=R,q=$,z=Q,t.width=Math.floor(R*Q),t.height=Math.floor($*Q),this.setViewport(0,0,R,$)},this.getCurrentViewport=function(R){return R.copy(N)},this.getViewport=function(R){return R.copy(oe)},this.setViewport=function(R,$,Q,Z){R.isVector4?oe.set(R.x,R.y,R.z,R.w):oe.set(R,$,Q,Z),Le.viewport(N.copy(oe).multiplyScalar(z).round())},this.getScissor=function(R){return R.copy(be)},this.setScissor=function(R,$,Q,Z){R.isVector4?be.set(R.x,R.y,R.z,R.w):be.set(R,$,Q,Z),Le.scissor(U.copy(be).multiplyScalar(z).round())},this.getScissorTest=function(){return Oe},this.setScissorTest=function(R){Le.setScissorTest(Oe=R)},this.setOpaqueSort=function(R){re=R},this.setTransparentSort=function(R){X=R},this.getClearColor=function(R){return R.copy(je.getClearColor())},this.setClearColor=function(){je.setClearColor(...arguments)},this.getClearAlpha=function(){return je.getClearAlpha()},this.setClearAlpha=function(){je.setClearAlpha(...arguments)},this.clear=function(R=!0,$=!0,Q=!0){let Z=0;if(R){let j=!1;if(w!==null){const ge=w.texture.format;j=ge===Mf||ge===Ef||ge===Tf}if(j){const ge=w.texture.type,Ne=ge===Kn||ge===wn||ge===la||ge===gs||ge===j0||ge===q0,Be=je.getClearColor(),Ue=je.getClearAlpha(),dt=Be.r,_t=Be.g,Qe=Be.b;Ne?(m[0]=dt,m[1]=_t,m[2]=Qe,m[3]=Ue,I.clearBufferuiv(I.COLOR,0,m)):(_[0]=dt,_[1]=_t,_[2]=Qe,_[3]=Ue,I.clearBufferiv(I.COLOR,0,_))}else Z|=I.COLOR_BUFFER_BIT}$&&(Z|=I.DEPTH_BUFFER_BIT),Q&&(Z|=I.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),I.clear(Z)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ee,!1),t.removeEventListener("webglcontextrestored",Ie,!1),t.removeEventListener("webglcontextcreationerror",me,!1),je.dispose(),se.dispose(),Xe.dispose(),ze.dispose(),Di.dispose(),si.dispose(),Y.dispose(),Ae.dispose(),wt.dispose(),le.dispose(),ve.dispose(),ve.removeEventListener("sessionstart",ga),ve.removeEventListener("sessionend",UR),xu.stop()};function Ee(R){R.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),S=!0}function Ie(){console.log("THREE.WebGLRenderer: Context Restored."),S=!1;const R=nn.autoReset,$=He.enabled,Q=He.autoUpdate,Z=He.needsUpdate,j=He.type;V(),nn.autoReset=R,He.enabled=$,He.autoUpdate=Q,He.needsUpdate=Z,He.type=j}function me(R){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",R.statusMessage)}function he(R){const $=R.target;$.removeEventListener("dispose",he),Fe($)}function Fe(R){xt(R),ze.remove(R)}function xt(R){const $=ze.get(R).programs;$!==void 0&&($.forEach(function(Q){le.releaseProgram(Q)}),R.isShaderMaterial&&le.releaseShaderCache(R))}this.renderBufferDirect=function(R,$,Q,Z,j,ge){$===null&&($=Me);const Ne=j.isMesh&&j.matrixWorld.determinant()<0,Be=iG(R,$,Q,Z,j);Le.setMaterial(Z,Ne);let Ue=Q.index,dt=1;if(Z.wireframe===!0){if(Ue=A.getWireframeAttribute(Q),Ue===void 0)return;dt=2}const _t=Q.drawRange,Qe=Q.attributes.position;let Gt=_t.start*dt,mn=(_t.start+_t.count)*dt;ge!==null&&(Gt=Math.max(Gt,ge.start*dt),mn=Math.min(mn,(ge.start+ge.count)*dt)),Ue!==null?(Gt=Math.max(Gt,0),mn=Math.min(mn,Ue.count)):Qe!=null&&(Gt=Math.max(Gt,0),mn=Math.min(mn,Qe.count));const ei=mn-Gt;if(ei<0||ei===1/0)return;Ae.setup(j,Z,Be,Q,Ue);let Un,xn=Ce;if(Ue!==null&&(Un=L.get(Ue),xn=mt,xn.setIndex(Un)),j.isMesh)Z.wireframe===!0?(Le.setLineWidth(Z.wireframeLinewidth*Sn()),xn.setMode(I.LINES)):xn.setMode(I.TRIANGLES);else if(j.isLine){let et=Z.linewidth;et===void 0&&(et=1),Le.setLineWidth(et*Sn()),j.isLineSegments?xn.setMode(I.LINES):j.isLineLoop?xn.setMode(I.LINE_LOOP):xn.setMode(I.LINE_STRIP)}else j.isPoints?xn.setMode(I.POINTS):j.isSprite&&xn.setMode(I.TRIANGLES);if(j.isBatchedMesh)if(j._multiDrawInstances!==null)vs("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),xn.renderMultiDrawInstances(j._multiDrawStarts,j._multiDrawCounts,j._multiDrawCount,j._multiDrawInstances);else if(pt.get("WEBGL_multi_draw"))xn.renderMultiDraw(j._multiDrawStarts,j._multiDrawCounts,j._multiDrawCount);else{const et=j._multiDrawStarts,jn=j._multiDrawCounts,Yt=j._multiDrawCount,Yr=Ue?L.get(Ue).bytesPerElement:1,Oc=ze.get(Z).currentProgram.getUniforms();for(let Kr=0;Kr<Yt;Kr++)Oc.setValue(I,"_gl_DrawID",Kr),xn.render(et[Kr]/Yr,jn[Kr])}else if(j.isInstancedMesh)xn.renderInstances(Gt,ei,j.count);else if(Q.isInstancedBufferGeometry){const et=Q._maxInstanceCount!==void 0?Q._maxInstanceCount:1/0,jn=Math.min(Q.instanceCount,et);xn.renderInstances(Gt,ei,jn)}else xn.render(Gt,ei)};function Nn(R,$,Q){R.transparent===!0&&R.side===Qi&&R.forceSinglePass===!1?(R.side=bn,R.needsUpdate=!0,Wg(R,$,Q),R.side=ps,R.needsUpdate=!0,Wg(R,$,Q),R.side=Qi):Wg(R,$,Q)}this.compile=function(R,$,Q=null){Q===null&&(Q=R),p=Xe.get(Q),p.init($),v.push(p),Q.traverseVisible(function(j){j.isLight&&j.layers.test($.layers)&&(p.pushLight(j),j.castShadow&&p.pushShadow(j))}),R!==Q&&R.traverseVisible(function(j){j.isLight&&j.layers.test($.layers)&&(p.pushLight(j),j.castShadow&&p.pushShadow(j))}),p.setupLights();const Z=new Set;return R.traverse(function(j){if(!(j.isMesh||j.isPoints||j.isLine||j.isSprite))return;const ge=j.material;if(ge)if(Array.isArray(ge))for(let Ne=0;Ne<ge.length;Ne++){const Be=ge[Ne];Nn(Be,Q,j),Z.add(Be)}else Nn(ge,Q,j),Z.add(ge)}),p=v.pop(),Z},this.compileAsync=function(R,$,Q=null){const Z=this.compile(R,$,Q);return new Promise(j=>{function ge(){if(Z.forEach(function(Ne){ze.get(Ne).currentProgram.isReady()&&Z.delete(Ne)}),Z.size===0){j(R);return}setTimeout(ge,10)}pt.get("KHR_parallel_shader_compile")!==null?ge():setTimeout(ge,10)})};let rn=null;function ao(R){rn&&rn(R)}function ga(){xu.stop()}function UR(){xu.start()}const xu=new mI;xu.setAnimationLoop(ao),typeof self<"u"&&xu.setContext(self),this.setAnimationLoop=function(R){rn=R,ve.setAnimationLoop(R),R===null?xu.stop():xu.start()},ve.addEventListener("sessionstart",ga),ve.addEventListener("sessionend",UR),this.render=function(R,$){if($!==void 0&&$.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(S===!0)return;if(R.matrixWorldAutoUpdate===!0&&R.updateMatrixWorld(),$.parent===null&&$.matrixWorldAutoUpdate===!0&&$.updateMatrixWorld(),ve.enabled===!0&&ve.isPresenting===!0&&(ve.cameraAutoUpdate===!0&&ve.updateCamera($),$=ve.getCamera()),R.isScene===!0&&R.onBeforeRender(b,R,$,w),p=Xe.get(R,v.length),p.init($),v.push(p),K.multiplyMatrices($.projectionMatrix,$.matrixWorldInverse),st.setFromProjectionMatrix(K,br,$.reversedDepth),W=this.localClippingEnabled,ie=Te.init(this.clippingPlanes,W),g=se.get(R,y.length),g.init(),y.push(g),ve.enabled===!0&&ve.isPresenting===!0){const ge=b.xr.getDepthSensingMesh();ge!==null&&Db(ge,$,-1/0,b.sortObjects)}Db(R,$,0,b.sortObjects),g.finish(),b.sortObjects===!0&&g.sort(re,X),We=ve.enabled===!1||ve.isPresenting===!1||ve.hasDepthSensing()===!1,We&&je.addToRenderList(g,R),this.info.render.frame++,ie===!0&&Te.beginShadows();const Q=p.state.shadowsArray;He.render(Q,R,$),ie===!0&&Te.endShadows(),this.info.autoReset===!0&&this.info.reset();const Z=g.opaque,j=g.transmissive;if(p.setupLights(),$.isArrayCamera){const ge=$.cameras;if(j.length>0)for(let Ne=0,Be=ge.length;Ne<Be;Ne++){const Ue=ge[Ne];IR(Z,j,R,Ue)}We&&je.render(R);for(let Ne=0,Be=ge.length;Ne<Be;Ne++){const Ue=ge[Ne];OR(g,R,Ue,Ue.viewport)}}else j.length>0&&IR(Z,j,R,$),We&&je.render(R),OR(g,R,$);w!==null&&T===0&&(Ct.updateMultisampleRenderTarget(w),Ct.updateRenderTargetMipmap(w)),R.isScene===!0&&R.onAfterRender(b,R,$),Ae.resetDefaultState(),E=-1,M=null,v.pop(),v.length>0?(p=v[v.length-1],ie===!0&&Te.setGlobalState(b.clippingPlanes,p.state.camera)):p=null,y.pop(),y.length>0?g=y[y.length-1]:g=null};function Db(R,$,Q,Z){if(R.visible===!1)return;if(R.layers.test($.layers)){if(R.isGroup)Q=R.renderOrder;else if(R.isLOD)R.autoUpdate===!0&&R.update($);else if(R.isLight)p.pushLight(R),R.castShadow&&p.pushShadow(R);else if(R.isSprite){if(!R.frustumCulled||st.intersectsSprite(R)){Z&&Pe.setFromMatrixPosition(R.matrixWorld).applyMatrix4(K);const Ne=Y.update(R),Be=R.material;Be.visible&&g.push(R,Ne,Be,Q,Pe.z,null)}}else if((R.isMesh||R.isLine||R.isPoints)&&(!R.frustumCulled||st.intersectsObject(R))){const Ne=Y.update(R),Be=R.material;if(Z&&(R.boundingSphere!==void 0?(R.boundingSphere===null&&R.computeBoundingSphere(),Pe.copy(R.boundingSphere.center)):(Ne.boundingSphere===null&&Ne.computeBoundingSphere(),Pe.copy(Ne.boundingSphere.center)),Pe.applyMatrix4(R.matrixWorld).applyMatrix4(K)),Array.isArray(Be)){const Ue=Ne.groups;for(let dt=0,_t=Ue.length;dt<_t;dt++){const Qe=Ue[dt],Gt=Be[Qe.materialIndex];Gt&&Gt.visible&&g.push(R,Ne,Gt,Q,Pe.z,Qe)}}else Be.visible&&g.push(R,Ne,Be,Q,Pe.z,null)}}const ge=R.children;for(let Ne=0,Be=ge.length;Ne<Be;Ne++)Db(ge[Ne],$,Q,Z)}function OR(R,$,Q,Z){const j=R.opaque,ge=R.transmissive,Ne=R.transparent;p.setupLightsView(Q),ie===!0&&Te.setGlobalState(b.clippingPlanes,Q),Z&&Le.viewport(N.copy(Z)),j.length>0&&$g(j,$,Q),ge.length>0&&$g(ge,$,Q),Ne.length>0&&$g(Ne,$,Q),Le.buffers.depth.setTest(!0),Le.buffers.depth.setMask(!0),Le.buffers.color.setMask(!0),Le.setPolygonOffset(!1)}function IR(R,$,Q,Z){if((Q.isScene===!0?Q.overrideMaterial:null)!==null)return;p.state.transmissionRenderTarget[Z.id]===void 0&&(p.state.transmissionRenderTarget[Z.id]=new su(1,1,{generateMipmaps:!0,type:pt.has("EXT_color_buffer_half_float")||pt.has("EXT_color_buffer_float")?Fi:Kn,minFilter:Ir,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Ze.workingColorSpace}));const ge=p.state.transmissionRenderTarget[Z.id],Ne=Z.viewport||N;ge.setSize(Ne.z*b.transmissionResolutionScale,Ne.w*b.transmissionResolutionScale);const Be=b.getRenderTarget(),Ue=b.getActiveCubeFace(),dt=b.getActiveMipmapLevel();b.setRenderTarget(ge),b.getClearColor(P),O=b.getClearAlpha(),O<1&&b.setClearColor(16777215,.5),b.clear(),We&&je.render(Q);const _t=b.toneMapping;b.toneMapping=zr;const Qe=Z.viewport;if(Z.viewport!==void 0&&(Z.viewport=void 0),p.setupLightsView(Z),ie===!0&&Te.setGlobalState(b.clippingPlanes,Z),$g(R,Q,Z),Ct.updateMultisampleRenderTarget(ge),Ct.updateRenderTargetMipmap(ge),pt.has("WEBGL_multisampled_render_to_texture")===!1){let Gt=!1;for(let mn=0,ei=$.length;mn<ei;mn++){const Un=$[mn],xn=Un.object,et=Un.geometry,jn=Un.material,Yt=Un.group;if(jn.side===Qi&&xn.layers.test(Z.layers)){const Yr=jn.side;jn.side=bn,jn.needsUpdate=!0,BR(xn,Q,Z,et,jn,Yt),jn.side=Yr,jn.needsUpdate=!0,Gt=!0}}Gt===!0&&(Ct.updateMultisampleRenderTarget(ge),Ct.updateRenderTargetMipmap(ge))}b.setRenderTarget(Be,Ue,dt),b.setClearColor(P,O),Qe!==void 0&&(Z.viewport=Qe),b.toneMapping=_t}function $g(R,$,Q){const Z=$.isScene===!0?$.overrideMaterial:null;for(let j=0,ge=R.length;j<ge;j++){const Ne=R[j],Be=Ne.object,Ue=Ne.geometry,dt=Ne.group;let _t=Ne.material;_t.allowOverride===!0&&Z!==null&&(_t=Z),Be.layers.test(Q.layers)&&BR(Be,$,Q,Ue,_t,dt)}}function BR(R,$,Q,Z,j,ge){R.onBeforeRender(b,$,Q,Z,j,ge),R.modelViewMatrix.multiplyMatrices(Q.matrixWorldInverse,R.matrixWorld),R.normalMatrix.getNormalMatrix(R.modelViewMatrix),j.onBeforeRender(b,$,Q,Z,R,ge),j.transparent===!0&&j.side===Qi&&j.forceSinglePass===!1?(j.side=bn,j.needsUpdate=!0,b.renderBufferDirect(Q,$,Z,j,R,ge),j.side=ps,j.needsUpdate=!0,b.renderBufferDirect(Q,$,Z,j,R,ge),j.side=Qi):b.renderBufferDirect(Q,$,Z,j,R,ge),R.onAfterRender(b,$,Q,Z,j,ge)}function Wg(R,$,Q){$.isScene!==!0&&($=Me);const Z=ze.get(R),j=p.state.lights,ge=p.state.shadowsArray,Ne=j.state.version,Be=le.getParameters(R,j.state,ge,$,Q),Ue=le.getProgramCacheKey(Be);let dt=Z.programs;Z.environment=R.isMeshStandardMaterial?$.environment:null,Z.fog=$.fog,Z.envMap=(R.isMeshStandardMaterial?si:Di).get(R.envMap||Z.environment),Z.envMapRotation=Z.environment!==null&&R.envMap===null?$.environmentRotation:R.envMapRotation,dt===void 0&&(R.addEventListener("dispose",he),dt=new Map,Z.programs=dt);let _t=dt.get(Ue);if(_t!==void 0){if(Z.currentProgram===_t&&Z.lightsStateVersion===Ne)return kR(R,Be),_t}else Be.uniforms=le.getUniforms(R),R.onBeforeCompile(Be,b),_t=le.acquireProgram(Be,Ue),dt.set(Ue,_t),Z.uniforms=Be.uniforms;const Qe=Z.uniforms;return(!R.isShaderMaterial&&!R.isRawShaderMaterial||R.clipping===!0)&&(Qe.clippingPlanes=Te.uniform),kR(R,Be),Z.needsLights=sG(R),Z.lightsStateVersion=Ne,Z.needsLights&&(Qe.ambientLightColor.value=j.state.ambient,Qe.lightProbe.value=j.state.probe,Qe.directionalLights.value=j.state.directional,Qe.directionalLightShadows.value=j.state.directionalShadow,Qe.spotLights.value=j.state.spot,Qe.spotLightShadows.value=j.state.spotShadow,Qe.rectAreaLights.value=j.state.rectArea,Qe.ltc_1.value=j.state.rectAreaLTC1,Qe.ltc_2.value=j.state.rectAreaLTC2,Qe.pointLights.value=j.state.point,Qe.pointLightShadows.value=j.state.pointShadow,Qe.hemisphereLights.value=j.state.hemi,Qe.directionalShadowMap.value=j.state.directionalShadowMap,Qe.directionalShadowMatrix.value=j.state.directionalShadowMatrix,Qe.spotShadowMap.value=j.state.spotShadowMap,Qe.spotLightMatrix.value=j.state.spotLightMatrix,Qe.spotLightMap.value=j.state.spotLightMap,Qe.pointShadowMap.value=j.state.pointShadowMap,Qe.pointShadowMatrix.value=j.state.pointShadowMatrix),Z.currentProgram=_t,Z.uniformsList=null,_t}function FR(R){if(R.uniformsList===null){const $=R.currentProgram.getUniforms();R.uniformsList=Ay.seqWithValue($.seq,R.uniforms)}return R.uniformsList}function kR(R,$){const Q=ze.get(R);Q.outputColorSpace=$.outputColorSpace,Q.batching=$.batching,Q.batchingColor=$.batchingColor,Q.instancing=$.instancing,Q.instancingColor=$.instancingColor,Q.instancingMorph=$.instancingMorph,Q.skinning=$.skinning,Q.morphTargets=$.morphTargets,Q.morphNormals=$.morphNormals,Q.morphColors=$.morphColors,Q.morphTargetsCount=$.morphTargetsCount,Q.numClippingPlanes=$.numClippingPlanes,Q.numIntersection=$.numClipIntersection,Q.vertexAlphas=$.vertexAlphas,Q.vertexTangents=$.vertexTangents,Q.toneMapping=$.toneMapping}function iG(R,$,Q,Z,j){$.isScene!==!0&&($=Me),Ct.resetTextureUnits();const ge=$.fog,Ne=Z.isMeshStandardMaterial?$.environment:null,Be=w===null?b.outputColorSpace:w.isXRRenderTarget===!0?w.texture.colorSpace:_c,Ue=(Z.isMeshStandardMaterial?si:Di).get(Z.envMap||Ne),dt=Z.vertexColors===!0&&!!Q.attributes.color&&Q.attributes.color.itemSize===4,_t=!!Q.attributes.tangent&&(!!Z.normalMap||Z.anisotropy>0),Qe=!!Q.morphAttributes.position,Gt=!!Q.morphAttributes.normal,mn=!!Q.morphAttributes.color;let ei=zr;Z.toneMapped&&(w===null||w.isXRRenderTarget===!0)&&(ei=b.toneMapping);const Un=Q.morphAttributes.position||Q.morphAttributes.normal||Q.morphAttributes.color,xn=Un!==void 0?Un.length:0,et=ze.get(Z),jn=p.state.lights;if(ie===!0&&(W===!0||R!==M)){const ar=R===M&&Z.id===E;Te.setState(Z,R,ar)}let Yt=!1;Z.version===et.__version?(et.needsLights&&et.lightsStateVersion!==jn.state.version||et.outputColorSpace!==Be||j.isBatchedMesh&&et.batching===!1||!j.isBatchedMesh&&et.batching===!0||j.isBatchedMesh&&et.batchingColor===!0&&j.colorTexture===null||j.isBatchedMesh&&et.batchingColor===!1&&j.colorTexture!==null||j.isInstancedMesh&&et.instancing===!1||!j.isInstancedMesh&&et.instancing===!0||j.isSkinnedMesh&&et.skinning===!1||!j.isSkinnedMesh&&et.skinning===!0||j.isInstancedMesh&&et.instancingColor===!0&&j.instanceColor===null||j.isInstancedMesh&&et.instancingColor===!1&&j.instanceColor!==null||j.isInstancedMesh&&et.instancingMorph===!0&&j.morphTexture===null||j.isInstancedMesh&&et.instancingMorph===!1&&j.morphTexture!==null||et.envMap!==Ue||Z.fog===!0&&et.fog!==ge||et.numClippingPlanes!==void 0&&(et.numClippingPlanes!==Te.numPlanes||et.numIntersection!==Te.numIntersection)||et.vertexAlphas!==dt||et.vertexTangents!==_t||et.morphTargets!==Qe||et.morphNormals!==Gt||et.morphColors!==mn||et.toneMapping!==ei||et.morphTargetsCount!==xn)&&(Yt=!0):(Yt=!0,et.__version=Z.version);let Yr=et.currentProgram;Yt===!0&&(Yr=Wg(Z,$,j));let Oc=!1,Kr=!1,Of=!1;const qn=Yr.getUniforms(),Ts=et.uniforms;if(Le.useProgram(Yr.program)&&(Oc=!0,Kr=!0,Of=!0),Z.id!==E&&(E=Z.id,Kr=!0),Oc||M!==R){Le.buffers.depth.getReversed()&&R.reversedDepth!==!0&&(R._reversedDepth=!0,R.updateProjectionMatrix()),qn.setValue(I,"projectionMatrix",R.projectionMatrix),qn.setValue(I,"viewMatrix",R.matrixWorldInverse);const Ar=qn.map.cameraPosition;Ar!==void 0&&Ar.setValue(I,_e.setFromMatrixPosition(R.matrixWorld)),Ye.logarithmicDepthBuffer&&qn.setValue(I,"logDepthBufFC",2/(Math.log(R.far+1)/Math.LN2)),(Z.isMeshPhongMaterial||Z.isMeshToonMaterial||Z.isMeshLambertMaterial||Z.isMeshBasicMaterial||Z.isMeshStandardMaterial||Z.isShaderMaterial)&&qn.setValue(I,"isOrthographic",R.isOrthographicCamera===!0),M!==R&&(M=R,Kr=!0,Of=!0)}if(j.isSkinnedMesh){qn.setOptional(I,j,"bindMatrix"),qn.setOptional(I,j,"bindMatrixInverse");const ar=j.skeleton;ar&&(ar.boneTexture===null&&ar.computeBoneTexture(),qn.setValue(I,"boneTexture",ar.boneTexture,Ct))}j.isBatchedMesh&&(qn.setOptional(I,j,"batchingTexture"),qn.setValue(I,"batchingTexture",j._matricesTexture,Ct),qn.setOptional(I,j,"batchingIdTexture"),qn.setValue(I,"batchingIdTexture",j._indirectTexture,Ct),qn.setOptional(I,j,"batchingColorTexture"),j._colorsTexture!==null&&qn.setValue(I,"batchingColorTexture",j._colorsTexture,Ct));const Es=Q.morphAttributes;if((Es.position!==void 0||Es.normal!==void 0||Es.color!==void 0)&&ye.update(j,Q,Yr),(Kr||et.receiveShadow!==j.receiveShadow)&&(et.receiveShadow=j.receiveShadow,qn.setValue(I,"receiveShadow",j.receiveShadow)),Z.isMeshGouraudMaterial&&Z.envMap!==null&&(Ts.envMap.value=Ue,Ts.flipEnvMap.value=Ue.isCubeTexture&&Ue.isRenderTargetTexture===!1?-1:1),Z.isMeshStandardMaterial&&Z.envMap===null&&$.environment!==null&&(Ts.envMapIntensity.value=$.environmentIntensity),Kr&&(qn.setValue(I,"toneMappingExposure",b.toneMappingExposure),et.needsLights&&rG(Ts,Of),ge&&Z.fog===!0&&pe.refreshFogUniforms(Ts,ge),pe.refreshMaterialUniforms(Ts,Z,z,q,p.state.transmissionRenderTarget[R.id]),Ay.upload(I,FR(et),Ts,Ct)),Z.isShaderMaterial&&Z.uniformsNeedUpdate===!0&&(Ay.upload(I,FR(et),Ts,Ct),Z.uniformsNeedUpdate=!1),Z.isSpriteMaterial&&qn.setValue(I,"center",j.center),qn.setValue(I,"modelViewMatrix",j.modelViewMatrix),qn.setValue(I,"normalMatrix",j.normalMatrix),qn.setValue(I,"modelMatrix",j.matrixWorld),Z.isShaderMaterial||Z.isRawShaderMaterial){const ar=Z.uniformsGroups;for(let Ar=0,Lb=ar.length;Ar<Lb;Ar++){const Tu=ar[Ar];wt.update(Tu,Yr),wt.bind(Tu,Yr)}}return Yr}function rG(R,$){R.ambientLightColor.needsUpdate=$,R.lightProbe.needsUpdate=$,R.directionalLights.needsUpdate=$,R.directionalLightShadows.needsUpdate=$,R.pointLights.needsUpdate=$,R.pointLightShadows.needsUpdate=$,R.spotLights.needsUpdate=$,R.spotLightShadows.needsUpdate=$,R.rectAreaLights.needsUpdate=$,R.hemisphereLights.needsUpdate=$}function sG(R){return R.isMeshLambertMaterial||R.isMeshToonMaterial||R.isMeshPhongMaterial||R.isMeshStandardMaterial||R.isShadowMaterial||R.isShaderMaterial&&R.lights===!0}this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return T},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(R,$,Q){const Z=ze.get(R);Z.__autoAllocateDepthBuffer=R.resolveDepthBuffer===!1,Z.__autoAllocateDepthBuffer===!1&&(Z.__useRenderToTexture=!1),ze.get(R.texture).__webglTexture=$,ze.get(R.depthTexture).__webglTexture=Z.__autoAllocateDepthBuffer?void 0:Q,Z.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(R,$){const Q=ze.get(R);Q.__webglFramebuffer=$,Q.__useDefaultFramebuffer=$===void 0};const aG=I.createFramebuffer();this.setRenderTarget=function(R,$=0,Q=0){w=R,x=$,T=Q;let Z=!0,j=null,ge=!1,Ne=!1;if(R){const Ue=ze.get(R);if(Ue.__useDefaultFramebuffer!==void 0)Le.bindFramebuffer(I.FRAMEBUFFER,null),Z=!1;else if(Ue.__webglFramebuffer===void 0)Ct.setupRenderTarget(R);else if(Ue.__hasExternalTextures)Ct.rebindTextures(R,ze.get(R.texture).__webglTexture,ze.get(R.depthTexture).__webglTexture);else if(R.depthBuffer){const Qe=R.depthTexture;if(Ue.__boundDepthTexture!==Qe){if(Qe!==null&&ze.has(Qe)&&(R.width!==Qe.image.width||R.height!==Qe.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Ct.setupDepthRenderbuffer(R)}}const dt=R.texture;(dt.isData3DTexture||dt.isDataArrayTexture||dt.isCompressedArrayTexture)&&(Ne=!0);const _t=ze.get(R).__webglFramebuffer;R.isWebGLCubeRenderTarget?(Array.isArray(_t[$])?j=_t[$][Q]:j=_t[$],ge=!0):R.samples>0&&Ct.useMultisampledRTT(R)===!1?j=ze.get(R).__webglMultisampledFramebuffer:Array.isArray(_t)?j=_t[Q]:j=_t,N.copy(R.viewport),U.copy(R.scissor),k=R.scissorTest}else N.copy(oe).multiplyScalar(z).floor(),U.copy(be).multiplyScalar(z).floor(),k=Oe;if(Q!==0&&(j=aG),Le.bindFramebuffer(I.FRAMEBUFFER,j)&&Z&&Le.drawBuffers(R,j),Le.viewport(N),Le.scissor(U),Le.setScissorTest(k),ge){const Ue=ze.get(R.texture);I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+$,Ue.__webglTexture,Q)}else if(Ne){const Ue=$;for(let dt=0;dt<R.textures.length;dt++){const _t=ze.get(R.textures[dt]);I.framebufferTextureLayer(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0+dt,_t.__webglTexture,Q,Ue)}}else if(R!==null&&Q!==0){const Ue=ze.get(R.texture);I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,Ue.__webglTexture,Q)}E=-1},this.readRenderTargetPixels=function(R,$,Q,Z,j,ge,Ne,Be=0){if(!(R&&R.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ue=ze.get(R).__webglFramebuffer;if(R.isWebGLCubeRenderTarget&&Ne!==void 0&&(Ue=Ue[Ne]),Ue){Le.bindFramebuffer(I.FRAMEBUFFER,Ue);try{const dt=R.textures[Be],_t=dt.format,Qe=dt.type;if(!Ye.textureFormatReadable(_t)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ye.textureTypeReadable(Qe)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}$>=0&&$<=R.width-Z&&Q>=0&&Q<=R.height-j&&(R.textures.length>1&&I.readBuffer(I.COLOR_ATTACHMENT0+Be),I.readPixels($,Q,Z,j,qe.convert(_t),qe.convert(Qe),ge))}finally{const dt=w!==null?ze.get(w).__webglFramebuffer:null;Le.bindFramebuffer(I.FRAMEBUFFER,dt)}}},this.readRenderTargetPixelsAsync=async function(R,$,Q,Z,j,ge,Ne,Be=0){if(!(R&&R.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ue=ze.get(R).__webglFramebuffer;if(R.isWebGLCubeRenderTarget&&Ne!==void 0&&(Ue=Ue[Ne]),Ue)if($>=0&&$<=R.width-Z&&Q>=0&&Q<=R.height-j){Le.bindFramebuffer(I.FRAMEBUFFER,Ue);const dt=R.textures[Be],_t=dt.format,Qe=dt.type;if(!Ye.textureFormatReadable(_t))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ye.textureTypeReadable(Qe))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Gt=I.createBuffer();I.bindBuffer(I.PIXEL_PACK_BUFFER,Gt),I.bufferData(I.PIXEL_PACK_BUFFER,ge.byteLength,I.STREAM_READ),R.textures.length>1&&I.readBuffer(I.COLOR_ATTACHMENT0+Be),I.readPixels($,Q,Z,j,qe.convert(_t),qe.convert(Qe),0);const mn=w!==null?ze.get(w).__webglFramebuffer:null;Le.bindFramebuffer(I.FRAMEBUFFER,mn);const ei=I.fenceSync(I.SYNC_GPU_COMMANDS_COMPLETE,0);return I.flush(),await I8(I,ei,4),I.bindBuffer(I.PIXEL_PACK_BUFFER,Gt),I.getBufferSubData(I.PIXEL_PACK_BUFFER,0,ge),I.deleteBuffer(Gt),I.deleteSync(ei),ge}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(R,$=null,Q=0){const Z=Math.pow(2,-Q),j=Math.floor(R.image.width*Z),ge=Math.floor(R.image.height*Z),Ne=$!==null?$.x:0,Be=$!==null?$.y:0;Ct.setTexture2D(R,0),I.copyTexSubImage2D(I.TEXTURE_2D,Q,0,0,Ne,Be,j,ge),Le.unbindTexture()};const oG=I.createFramebuffer(),lG=I.createFramebuffer();this.copyTextureToTexture=function(R,$,Q=null,Z=null,j=0,ge=null){ge===null&&(j!==0?(vs("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),ge=j,j=0):ge=0);let Ne,Be,Ue,dt,_t,Qe,Gt,mn,ei;const Un=R.isCompressedTexture?R.mipmaps[ge]:R.image;if(Q!==null)Ne=Q.max.x-Q.min.x,Be=Q.max.y-Q.min.y,Ue=Q.isBox3?Q.max.z-Q.min.z:1,dt=Q.min.x,_t=Q.min.y,Qe=Q.isBox3?Q.min.z:0;else{const Es=Math.pow(2,-j);Ne=Math.floor(Un.width*Es),Be=Math.floor(Un.height*Es),R.isDataArrayTexture?Ue=Un.depth:R.isData3DTexture?Ue=Math.floor(Un.depth*Es):Ue=1,dt=0,_t=0,Qe=0}Z!==null?(Gt=Z.x,mn=Z.y,ei=Z.z):(Gt=0,mn=0,ei=0);const xn=qe.convert($.format),et=qe.convert($.type);let jn;$.isData3DTexture?(Ct.setTexture3D($,0),jn=I.TEXTURE_3D):$.isDataArrayTexture||$.isCompressedArrayTexture?(Ct.setTexture2DArray($,0),jn=I.TEXTURE_2D_ARRAY):(Ct.setTexture2D($,0),jn=I.TEXTURE_2D),I.pixelStorei(I.UNPACK_FLIP_Y_WEBGL,$.flipY),I.pixelStorei(I.UNPACK_PREMULTIPLY_ALPHA_WEBGL,$.premultiplyAlpha),I.pixelStorei(I.UNPACK_ALIGNMENT,$.unpackAlignment);const Yt=I.getParameter(I.UNPACK_ROW_LENGTH),Yr=I.getParameter(I.UNPACK_IMAGE_HEIGHT),Oc=I.getParameter(I.UNPACK_SKIP_PIXELS),Kr=I.getParameter(I.UNPACK_SKIP_ROWS),Of=I.getParameter(I.UNPACK_SKIP_IMAGES);I.pixelStorei(I.UNPACK_ROW_LENGTH,Un.width),I.pixelStorei(I.UNPACK_IMAGE_HEIGHT,Un.height),I.pixelStorei(I.UNPACK_SKIP_PIXELS,dt),I.pixelStorei(I.UNPACK_SKIP_ROWS,_t),I.pixelStorei(I.UNPACK_SKIP_IMAGES,Qe);const qn=R.isDataArrayTexture||R.isData3DTexture,Ts=$.isDataArrayTexture||$.isData3DTexture;if(R.isDepthTexture){const Es=ze.get(R),ar=ze.get($),Ar=ze.get(Es.__renderTarget),Lb=ze.get(ar.__renderTarget);Le.bindFramebuffer(I.READ_FRAMEBUFFER,Ar.__webglFramebuffer),Le.bindFramebuffer(I.DRAW_FRAMEBUFFER,Lb.__webglFramebuffer);for(let Tu=0;Tu<Ue;Tu++)qn&&(I.framebufferTextureLayer(I.READ_FRAMEBUFFER,I.COLOR_ATTACHMENT0,ze.get(R).__webglTexture,j,Qe+Tu),I.framebufferTextureLayer(I.DRAW_FRAMEBUFFER,I.COLOR_ATTACHMENT0,ze.get($).__webglTexture,ge,ei+Tu)),I.blitFramebuffer(dt,_t,Ne,Be,Gt,mn,Ne,Be,I.DEPTH_BUFFER_BIT,I.NEAREST);Le.bindFramebuffer(I.READ_FRAMEBUFFER,null),Le.bindFramebuffer(I.DRAW_FRAMEBUFFER,null)}else if(j!==0||R.isRenderTargetTexture||ze.has(R)){const Es=ze.get(R),ar=ze.get($);Le.bindFramebuffer(I.READ_FRAMEBUFFER,oG),Le.bindFramebuffer(I.DRAW_FRAMEBUFFER,lG);for(let Ar=0;Ar<Ue;Ar++)qn?I.framebufferTextureLayer(I.READ_FRAMEBUFFER,I.COLOR_ATTACHMENT0,Es.__webglTexture,j,Qe+Ar):I.framebufferTexture2D(I.READ_FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,Es.__webglTexture,j),Ts?I.framebufferTextureLayer(I.DRAW_FRAMEBUFFER,I.COLOR_ATTACHMENT0,ar.__webglTexture,ge,ei+Ar):I.framebufferTexture2D(I.DRAW_FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,ar.__webglTexture,ge),j!==0?I.blitFramebuffer(dt,_t,Ne,Be,Gt,mn,Ne,Be,I.COLOR_BUFFER_BIT,I.NEAREST):Ts?I.copyTexSubImage3D(jn,ge,Gt,mn,ei+Ar,dt,_t,Ne,Be):I.copyTexSubImage2D(jn,ge,Gt,mn,dt,_t,Ne,Be);Le.bindFramebuffer(I.READ_FRAMEBUFFER,null),Le.bindFramebuffer(I.DRAW_FRAMEBUFFER,null)}else Ts?R.isDataTexture||R.isData3DTexture?I.texSubImage3D(jn,ge,Gt,mn,ei,Ne,Be,Ue,xn,et,Un.data):$.isCompressedArrayTexture?I.compressedTexSubImage3D(jn,ge,Gt,mn,ei,Ne,Be,Ue,xn,Un.data):I.texSubImage3D(jn,ge,Gt,mn,ei,Ne,Be,Ue,xn,et,Un):R.isDataTexture?I.texSubImage2D(I.TEXTURE_2D,ge,Gt,mn,Ne,Be,xn,et,Un.data):R.isCompressedTexture?I.compressedTexSubImage2D(I.TEXTURE_2D,ge,Gt,mn,Un.width,Un.height,xn,Un.data):I.texSubImage2D(I.TEXTURE_2D,ge,Gt,mn,Ne,Be,xn,et,Un);I.pixelStorei(I.UNPACK_ROW_LENGTH,Yt),I.pixelStorei(I.UNPACK_IMAGE_HEIGHT,Yr),I.pixelStorei(I.UNPACK_SKIP_PIXELS,Oc),I.pixelStorei(I.UNPACK_SKIP_ROWS,Kr),I.pixelStorei(I.UNPACK_SKIP_IMAGES,Of),ge===0&&$.generateMipmaps&&I.generateMipmap(jn),Le.unbindTexture()},this.initRenderTarget=function(R){ze.get(R).__webglFramebuffer===void 0&&Ct.setupRenderTarget(R)},this.initTexture=function(R){R.isCubeTexture?Ct.setTextureCube(R,0):R.isData3DTexture?Ct.setTexture3D(R,0):R.isDataArrayTexture||R.isCompressedArrayTexture?Ct.setTexture2DArray(R,0):Ct.setTexture2D(R,0),Le.unbindTexture()},this.resetState=function(){x=0,T=0,w=null,Le.reset(),Ae.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return br}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=Ze._getDrawingBufferColorSpace(e),t.unpackColorSpace=Ze._getUnpackColorSpace()}}const nd=new ia,Ro=new fe,bI=new D,KS=new fe,Ry=new fe,Cv=new D,gE=new D,SI=new zt,xI=new D,TI=new D;let Ki=null,Ea=null;const No=[],Zl={NONE:-1,PAN:0,ROTATE:1};class Pq extends nb{constructor(e,t,i=null){super(t,i),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new pI,this.mouseButtons={LEFT:Hi.PAN,MIDDLE:Hi.PAN,RIGHT:Hi.ROTATE},this.touches={ONE:Fo.PAN},this._onPointerMove=Uq.bind(this),this._onPointerDown=Oq.bind(this),this._onPointerCancel=Iq.bind(this),this._onContextMenu=Bq.bind(this),i!==null&&this.connect(i)}connect(e){super.connect(e),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const t=this.domElement.getBoundingClientRect();Ro.x=(e.clientX-t.left)/t.width*2-1,Ro.y=-(e.clientY-t.top)/t.height*2+1}_updateState(e){let t;if(e.pointerType==="touch")t=this.touches.ONE;else switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=null}switch(t){case Hi.PAN:case Fo.PAN:this.state=Zl.PAN;break;case Hi.ROTATE:case Fo.ROTATE:this.state=Zl.ROTATE;break;default:this.state=Zl.NONE}}}function Uq(n){const e=this.object,t=this.domElement,i=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(n),i.setFromCamera(Ro,e),Ki)this.state===Zl.PAN?i.ray.intersectPlane(nd,Cv)&&(Ki.position.copy(Cv.sub(bI).applyMatrix4(SI)),this.dispatchEvent({type:"drag",object:Ki})):this.state===Zl.ROTATE&&(KS.subVectors(Ro,Ry).multiplyScalar(this.rotateSpeed),Ki.rotateOnWorldAxis(xI,KS.x),Ki.rotateOnWorldAxis(TI.normalize(),-KS.y),this.dispatchEvent({type:"drag",object:Ki})),Ry.copy(Ro);else if(n.pointerType==="mouse"||n.pointerType==="pen")if(No.length=0,i.setFromCamera(Ro,e),i.intersectObjects(this.objects,this.recursive,No),No.length>0){const r=No[0].object;nd.setFromNormalAndCoplanarPoint(e.getWorldDirection(nd.normal),gE.setFromMatrixPosition(r.matrixWorld)),Ea!==r&&Ea!==null&&(this.dispatchEvent({type:"hoveroff",object:Ea}),t.style.cursor="auto",Ea=null),Ea!==r&&(this.dispatchEvent({type:"hoveron",object:r}),t.style.cursor="pointer",Ea=r)}else Ea!==null&&(this.dispatchEvent({type:"hoveroff",object:Ea}),t.style.cursor="auto",Ea=null);Ry.copy(Ro)}}function Oq(n){const e=this.object,t=this.domElement,i=this.raycaster;this.enabled!==!1&&(this._updatePointer(n),this._updateState(n),No.length=0,i.setFromCamera(Ro,e),i.intersectObjects(this.objects,this.recursive,No),No.length>0&&(this.transformGroup===!0?Ki=EI(No[0].object):Ki=No[0].object,nd.setFromNormalAndCoplanarPoint(e.getWorldDirection(nd.normal),gE.setFromMatrixPosition(Ki.matrixWorld)),i.ray.intersectPlane(nd,Cv)&&(this.state===Zl.PAN?(SI.copy(Ki.parent.matrixWorld).invert(),bI.copy(Cv).sub(gE.setFromMatrixPosition(Ki.matrixWorld)),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:Ki})):this.state===Zl.ROTATE&&(xI.set(0,1,0).applyQuaternion(e.quaternion).normalize(),TI.set(1,0,0).applyQuaternion(e.quaternion).normalize(),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:Ki})))),Ry.copy(Ro))}function Iq(){this.enabled!==!1&&(Ki&&(this.dispatchEvent({type:"dragend",object:Ki}),Ki=null),this.domElement.style.cursor=Ea?"pointer":"auto",this.state=Zl.NONE)}function Bq(n){this.enabled!==!1&&n.preventDefault()}function EI(n,e=null){return n.isGroup&&(e=n),n.parent===null?e:EI(n.parent,e)}function Fq(n,e,t){var i,r=1;n==null&&(n=0),e==null&&(e=0),t==null&&(t=0);function s(){var a,o=i.length,l,u=0,c=0,h=0;for(a=0;a<o;++a)l=i[a],u+=l.x||0,c+=l.y||0,h+=l.z||0;for(u=(u/o-n)*r,c=(c/o-e)*r,h=(h/o-t)*r,a=0;a<o;++a)l=i[a],u&&(l.x-=u),c&&(l.y-=c),h&&(l.z-=h)}return s.initialize=function(a){i=a},s.x=function(a){return arguments.length?(n=+a,s):n},s.y=function(a){return arguments.length?(e=+a,s):e},s.z=function(a){return arguments.length?(t=+a,s):t},s.strength=function(a){return arguments.length?(r=+a,s):r},s}function kq(n){const e=+this._x.call(null,n);return MI(this.cover(e),e,n)}function MI(n,e,t){if(isNaN(e))return n;var i,r=n._root,s={data:t},a=n._x0,o=n._x1,l,u,c,h,d;if(!r)return n._root=s,n;for(;r.length;)if((c=e>=(l=(a+o)/2))?a=l:o=l,i=r,!(r=r[h=+c]))return i[h]=s,n;if(u=+n._x.call(null,r.data),e===u)return s.next=r,i?i[h]=s:n._root=s,n;do i=i?i[h]=new Array(2):n._root=new Array(2),(c=e>=(l=(a+o)/2))?a=l:o=l;while((h=+c)==(d=+(u>=l)));return i[d]=r,i[h]=s,n}function zq(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e);let i=1/0,r=-1/0;for(let s=0,a;s<e;++s)isNaN(a=+this._x.call(null,n[s]))||(t[s]=a,a<i&&(i=a),a>r&&(r=a));if(i>r)return this;this.cover(i).cover(r);for(let s=0;s<e;++s)MI(this,t[s],n[s]);return this}function Gq(n){if(isNaN(n=+n))return this;var e=this._x0,t=this._x1;if(isNaN(e))t=(e=Math.floor(n))+1;else{for(var i=t-e||1,r=this._root,s,a;e>n||n>=t;)switch(a=+(n<e),s=new Array(2),s[a]=r,r=s,i*=2,a){case 0:t=e+i;break;case 1:e=t-i;break}this._root&&this._root.length&&(this._root=r)}return this._x0=e,this._x1=t,this}function Vq(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function Hq(n){return arguments.length?this.cover(+n[0][0]).cover(+n[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function qo(n,e,t){this.node=n,this.x0=e,this.x1=t}function $q(n,e){var t,i=this._x0,r,s,a=this._x1,o=[],l=this._root,u,c;for(l&&o.push(new qo(l,i,a)),e==null?e=1/0:(i=n-e,a=n+e);u=o.pop();)if(!(!(l=u.node)||(r=u.x0)>a||(s=u.x1)<i))if(l.length){var h=(r+s)/2;o.push(new qo(l[1],h,s),new qo(l[0],r,h)),(c=+(n>=h))&&(u=o[o.length-1],o[o.length-1]=o[o.length-1-c],o[o.length-1-c]=u)}else{var d=Math.abs(n-+this._x.call(null,l.data));d<e&&(e=d,i=n-d,a=n+d,t=l.data)}return t}function Wq(n){if(isNaN(l=+this._x.call(null,n)))return this;var e,t=this._root,i,r,s,a=this._x0,o=this._x1,l,u,c,h,d;if(!t)return this;if(t.length)for(;;){if((c=l>=(u=(a+o)/2))?a=u:o=u,e=t,!(t=t[h=+c]))return this;if(!t.length)break;e[h+1&1]&&(i=e,d=h)}for(;t.data!==n;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[h]=s:delete e[h],(t=e[0]||e[1])&&t===(e[1]||e[0])&&!t.length&&(i?i[d]=t:this._root=t),this):(this._root=s,this)}function jq(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function qq(){return this._root}function Xq(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function Yq(n){var e=[],t,i=this._root,r,s,a;for(i&&e.push(new qo(i,this._x0,this._x1));t=e.pop();)if(!n(i=t.node,s=t.x0,a=t.x1)&&i.length){var o=(s+a)/2;(r=i[1])&&e.push(new qo(r,o,a)),(r=i[0])&&e.push(new qo(r,s,o))}return this}function Kq(n){var e=[],t=[],i;for(this._root&&e.push(new qo(this._root,this._x0,this._x1));i=e.pop();){var r=i.node;if(r.length){var s,a=i.x0,o=i.x1,l=(a+o)/2;(s=r[0])&&e.push(new qo(s,a,l)),(s=r[1])&&e.push(new qo(s,l,o))}t.push(i)}for(;i=t.pop();)n(i.node,i.x0,i.x1);return this}function Qq(n){return n[0]}function Zq(n){return arguments.length?(this._x=n,this):this._x}function wI(n,e){var t=new sA(e??Qq,NaN,NaN);return n==null?t:t.addAll(n)}function sA(n,e,t){this._x=n,this._x0=e,this._x1=t,this._root=void 0}function yC(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Xr=wI.prototype=sA.prototype;Xr.copy=function(){var n=new sA(this._x,this._x0,this._x1),e=this._root,t,i;if(!e)return n;if(!e.length)return n._root=yC(e),n;for(t=[{source:e,target:n._root=new Array(2)}];e=t.pop();)for(var r=0;r<2;++r)(i=e.source[r])&&(i.length?t.push({source:i,target:e.target[r]=new Array(2)}):e.target[r]=yC(i));return n};Xr.add=kq;Xr.addAll=zq;Xr.cover=Gq;Xr.data=Vq;Xr.extent=Hq;Xr.find=$q;Xr.remove=Wq;Xr.removeAll=jq;Xr.root=qq;Xr.size=Xq;Xr.visit=Yq;Xr.visitAfter=Kq;Xr.x=Zq;function Jq(n){const e=+this._x.call(null,n),t=+this._y.call(null,n);return AI(this.cover(e,t),e,t,n)}function AI(n,e,t,i){if(isNaN(e)||isNaN(t))return n;var r,s=n._root,a={data:i},o=n._x0,l=n._y0,u=n._x1,c=n._y1,h,d,f,m,_,g,p,y;if(!s)return n._root=a,n;for(;s.length;)if((_=e>=(h=(o+u)/2))?o=h:u=h,(g=t>=(d=(l+c)/2))?l=d:c=d,r=s,!(s=s[p=g<<1|_]))return r[p]=a,n;if(f=+n._x.call(null,s.data),m=+n._y.call(null,s.data),e===f&&t===m)return a.next=s,r?r[p]=a:n._root=a,n;do r=r?r[p]=new Array(4):n._root=new Array(4),(_=e>=(h=(o+u)/2))?o=h:u=h,(g=t>=(d=(l+c)/2))?l=d:c=d;while((p=g<<1|_)===(y=(m>=d)<<1|f>=h));return r[y]=s,r[p]=a,n}function eX(n){var e,t,i=n.length,r,s,a=new Array(i),o=new Array(i),l=1/0,u=1/0,c=-1/0,h=-1/0;for(t=0;t<i;++t)isNaN(r=+this._x.call(null,e=n[t]))||isNaN(s=+this._y.call(null,e))||(a[t]=r,o[t]=s,r<l&&(l=r),r>c&&(c=r),s<u&&(u=s),s>h&&(h=s));if(l>c||u>h)return this;for(this.cover(l,u).cover(c,h),t=0;t<i;++t)AI(this,a[t],o[t],n[t]);return this}function tX(n,e){if(isNaN(n=+n)||isNaN(e=+e))return this;var t=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(t))r=(t=Math.floor(n))+1,s=(i=Math.floor(e))+1;else{for(var a=r-t||1,o=this._root,l,u;t>n||n>=r||i>e||e>=s;)switch(u=(e<i)<<1|n<t,l=new Array(4),l[u]=o,o=l,a*=2,u){case 0:r=t+a,s=i+a;break;case 1:t=r-a,s=i+a;break;case 2:r=t+a,i=s-a;break;case 3:t=r-a,i=s-a;break}this._root&&this._root.length&&(this._root=o)}return this._x0=t,this._y0=i,this._x1=r,this._y1=s,this}function nX(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function iX(n){return arguments.length?this.cover(+n[0][0],+n[0][1]).cover(+n[1][0],+n[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function gr(n,e,t,i,r){this.node=n,this.x0=e,this.y0=t,this.x1=i,this.y1=r}function rX(n,e,t){var i,r=this._x0,s=this._y0,a,o,l,u,c=this._x1,h=this._y1,d=[],f=this._root,m,_;for(f&&d.push(new gr(f,r,s,c,h)),t==null?t=1/0:(r=n-t,s=e-t,c=n+t,h=e+t,t*=t);m=d.pop();)if(!(!(f=m.node)||(a=m.x0)>c||(o=m.y0)>h||(l=m.x1)<r||(u=m.y1)<s))if(f.length){var g=(a+l)/2,p=(o+u)/2;d.push(new gr(f[3],g,p,l,u),new gr(f[2],a,p,g,u),new gr(f[1],g,o,l,p),new gr(f[0],a,o,g,p)),(_=(e>=p)<<1|n>=g)&&(m=d[d.length-1],d[d.length-1]=d[d.length-1-_],d[d.length-1-_]=m)}else{var y=n-+this._x.call(null,f.data),v=e-+this._y.call(null,f.data),b=y*y+v*v;if(b<t){var S=Math.sqrt(t=b);r=n-S,s=e-S,c=n+S,h=e+S,i=f.data}}return i}function sX(n){if(isNaN(c=+this._x.call(null,n))||isNaN(h=+this._y.call(null,n)))return this;var e,t=this._root,i,r,s,a=this._x0,o=this._y0,l=this._x1,u=this._y1,c,h,d,f,m,_,g,p;if(!t)return this;if(t.length)for(;;){if((m=c>=(d=(a+l)/2))?a=d:l=d,(_=h>=(f=(o+u)/2))?o=f:u=f,e=t,!(t=t[g=_<<1|m]))return this;if(!t.length)break;(e[g+1&3]||e[g+2&3]||e[g+3&3])&&(i=e,p=g)}for(;t.data!==n;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[g]=s:delete e[g],(t=e[0]||e[1]||e[2]||e[3])&&t===(e[3]||e[2]||e[1]||e[0])&&!t.length&&(i?i[p]=t:this._root=t),this):(this._root=s,this)}function aX(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function oX(){return this._root}function lX(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function uX(n){var e=[],t,i=this._root,r,s,a,o,l;for(i&&e.push(new gr(i,this._x0,this._y0,this._x1,this._y1));t=e.pop();)if(!n(i=t.node,s=t.x0,a=t.y0,o=t.x1,l=t.y1)&&i.length){var u=(s+o)/2,c=(a+l)/2;(r=i[3])&&e.push(new gr(r,u,c,o,l)),(r=i[2])&&e.push(new gr(r,s,c,u,l)),(r=i[1])&&e.push(new gr(r,u,a,o,c)),(r=i[0])&&e.push(new gr(r,s,a,u,c))}return this}function cX(n){var e=[],t=[],i;for(this._root&&e.push(new gr(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var r=i.node;if(r.length){var s,a=i.x0,o=i.y0,l=i.x1,u=i.y1,c=(a+l)/2,h=(o+u)/2;(s=r[0])&&e.push(new gr(s,a,o,c,h)),(s=r[1])&&e.push(new gr(s,c,o,l,h)),(s=r[2])&&e.push(new gr(s,a,h,c,u)),(s=r[3])&&e.push(new gr(s,c,h,l,u))}t.push(i)}for(;i=t.pop();)n(i.node,i.x0,i.y0,i.x1,i.y1);return this}function hX(n){return n[0]}function dX(n){return arguments.length?(this._x=n,this):this._x}function fX(n){return n[1]}function pX(n){return arguments.length?(this._y=n,this):this._y}function RI(n,e,t){var i=new aA(e??hX,t??fX,NaN,NaN,NaN,NaN);return n==null?i:i.addAll(n)}function aA(n,e,t,i,r,s){this._x=n,this._y=e,this._x0=t,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function vC(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Mr=RI.prototype=aA.prototype;Mr.copy=function(){var n=new aA(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,t,i;if(!e)return n;if(!e.length)return n._root=vC(e),n;for(t=[{source:e,target:n._root=new Array(4)}];e=t.pop();)for(var r=0;r<4;++r)(i=e.source[r])&&(i.length?t.push({source:i,target:e.target[r]=new Array(4)}):e.target[r]=vC(i));return n};Mr.add=Jq;Mr.addAll=eX;Mr.cover=tX;Mr.data=nX;Mr.extent=iX;Mr.find=rX;Mr.remove=sX;Mr.removeAll=aX;Mr.root=oX;Mr.size=lX;Mr.visit=uX;Mr.visitAfter=cX;Mr.x=dX;Mr.y=pX;function mX(n){const e=+this._x.call(null,n),t=+this._y.call(null,n),i=+this._z.call(null,n);return NI(this.cover(e,t,i),e,t,i,n)}function NI(n,e,t,i,r){if(isNaN(e)||isNaN(t)||isNaN(i))return n;var s,a=n._root,o={data:r},l=n._x0,u=n._y0,c=n._z0,h=n._x1,d=n._y1,f=n._z1,m,_,g,p,y,v,b,S,x,T,w;if(!a)return n._root=o,n;for(;a.length;)if((b=e>=(m=(l+h)/2))?l=m:h=m,(S=t>=(_=(u+d)/2))?u=_:d=_,(x=i>=(g=(c+f)/2))?c=g:f=g,s=a,!(a=a[T=x<<2|S<<1|b]))return s[T]=o,n;if(p=+n._x.call(null,a.data),y=+n._y.call(null,a.data),v=+n._z.call(null,a.data),e===p&&t===y&&i===v)return o.next=a,s?s[T]=o:n._root=o,n;do s=s?s[T]=new Array(8):n._root=new Array(8),(b=e>=(m=(l+h)/2))?l=m:h=m,(S=t>=(_=(u+d)/2))?u=_:d=_,(x=i>=(g=(c+f)/2))?c=g:f=g;while((T=x<<2|S<<1|b)===(w=(v>=g)<<2|(y>=_)<<1|p>=m));return s[w]=a,s[T]=o,n}function gX(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e),i=new Float64Array(e),r=new Float64Array(e);let s=1/0,a=1/0,o=1/0,l=-1/0,u=-1/0,c=-1/0;for(let h=0,d,f,m,_;h<e;++h)isNaN(f=+this._x.call(null,d=n[h]))||isNaN(m=+this._y.call(null,d))||isNaN(_=+this._z.call(null,d))||(t[h]=f,i[h]=m,r[h]=_,f<s&&(s=f),f>l&&(l=f),m<a&&(a=m),m>u&&(u=m),_<o&&(o=_),_>c&&(c=_));if(s>l||a>u||o>c)return this;this.cover(s,a,o).cover(l,u,c);for(let h=0;h<e;++h)NI(this,t[h],i[h],r[h],n[h]);return this}function _X(n,e,t){if(isNaN(n=+n)||isNaN(e=+e)||isNaN(t=+t))return this;var i=this._x0,r=this._y0,s=this._z0,a=this._x1,o=this._y1,l=this._z1;if(isNaN(i))a=(i=Math.floor(n))+1,o=(r=Math.floor(e))+1,l=(s=Math.floor(t))+1;else{for(var u=a-i||1,c=this._root,h,d;i>n||n>=a||r>e||e>=o||s>t||t>=l;)switch(d=(t<s)<<2|(e<r)<<1|n<i,h=new Array(8),h[d]=c,c=h,u*=2,d){case 0:a=i+u,o=r+u,l=s+u;break;case 1:i=a-u,o=r+u,l=s+u;break;case 2:a=i+u,r=o-u,l=s+u;break;case 3:i=a-u,r=o-u,l=s+u;break;case 4:a=i+u,o=r+u,s=l-u;break;case 5:i=a-u,o=r+u,s=l-u;break;case 6:a=i+u,r=o-u,s=l-u;break;case 7:i=a-u,r=o-u,s=l-u;break}this._root&&this._root.length&&(this._root=c)}return this._x0=i,this._y0=r,this._z0=s,this._x1=a,this._y1=o,this._z1=l,this}function yX(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function vX(n){return arguments.length?this.cover(+n[0][0],+n[0][1],+n[0][2]).cover(+n[1][0],+n[1][1],+n[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function En(n,e,t,i,r,s,a){this.node=n,this.x0=e,this.y0=t,this.z0=i,this.x1=r,this.y1=s,this.z1=a}function bX(n,e,t,i){var r,s=this._x0,a=this._y0,o=this._z0,l,u,c,h,d,f,m=this._x1,_=this._y1,g=this._z1,p=[],y=this._root,v,b;for(y&&p.push(new En(y,s,a,o,m,_,g)),i==null?i=1/0:(s=n-i,a=e-i,o=t-i,m=n+i,_=e+i,g=t+i,i*=i);v=p.pop();)if(!(!(y=v.node)||(l=v.x0)>m||(u=v.y0)>_||(c=v.z0)>g||(h=v.x1)<s||(d=v.y1)<a||(f=v.z1)<o))if(y.length){var S=(l+h)/2,x=(u+d)/2,T=(c+f)/2;p.push(new En(y[7],S,x,T,h,d,f),new En(y[6],l,x,T,S,d,f),new En(y[5],S,u,T,h,x,f),new En(y[4],l,u,T,S,x,f),new En(y[3],S,x,c,h,d,T),new En(y[2],l,x,c,S,d,T),new En(y[1],S,u,c,h,x,T),new En(y[0],l,u,c,S,x,T)),(b=(t>=T)<<2|(e>=x)<<1|n>=S)&&(v=p[p.length-1],p[p.length-1]=p[p.length-1-b],p[p.length-1-b]=v)}else{var w=n-+this._x.call(null,y.data),E=e-+this._y.call(null,y.data),M=t-+this._z.call(null,y.data),N=w*w+E*E+M*M;if(N<i){var U=Math.sqrt(i=N);s=n-U,a=e-U,o=t-U,m=n+U,_=e+U,g=t+U,r=y.data}}return r}const SX=(n,e,t,i,r,s)=>Math.sqrt((n-i)**2+(e-r)**2+(t-s)**2);function xX(n,e,t,i){const r=[],s=n-i,a=e-i,o=t-i,l=n+i,u=e+i,c=t+i;return this.visit((h,d,f,m,_,g,p)=>{if(!h.length)do{const y=h.data;SX(n,e,t,this._x(y),this._y(y),this._z(y))<=i&&r.push(y)}while(h=h.next);return d>l||f>u||m>c||_<s||g<a||p<o}),r}function TX(n){if(isNaN(d=+this._x.call(null,n))||isNaN(f=+this._y.call(null,n))||isNaN(m=+this._z.call(null,n)))return this;var e,t=this._root,i,r,s,a=this._x0,o=this._y0,l=this._z0,u=this._x1,c=this._y1,h=this._z1,d,f,m,_,g,p,y,v,b,S,x;if(!t)return this;if(t.length)for(;;){if((y=d>=(_=(a+u)/2))?a=_:u=_,(v=f>=(g=(o+c)/2))?o=g:c=g,(b=m>=(p=(l+h)/2))?l=p:h=p,e=t,!(t=t[S=b<<2|v<<1|y]))return this;if(!t.length)break;(e[S+1&7]||e[S+2&7]||e[S+3&7]||e[S+4&7]||e[S+5&7]||e[S+6&7]||e[S+7&7])&&(i=e,x=S)}for(;t.data!==n;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[S]=s:delete e[S],(t=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&t===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!t.length&&(i?i[x]=t:this._root=t),this):(this._root=s,this)}function EX(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function MX(){return this._root}function wX(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function AX(n){var e=[],t,i=this._root,r,s,a,o,l,u,c;for(i&&e.push(new En(i,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=e.pop();)if(!n(i=t.node,s=t.x0,a=t.y0,o=t.z0,l=t.x1,u=t.y1,c=t.z1)&&i.length){var h=(s+l)/2,d=(a+u)/2,f=(o+c)/2;(r=i[7])&&e.push(new En(r,h,d,f,l,u,c)),(r=i[6])&&e.push(new En(r,s,d,f,h,u,c)),(r=i[5])&&e.push(new En(r,h,a,f,l,d,c)),(r=i[4])&&e.push(new En(r,s,a,f,h,d,c)),(r=i[3])&&e.push(new En(r,h,d,o,l,u,f)),(r=i[2])&&e.push(new En(r,s,d,o,h,u,f)),(r=i[1])&&e.push(new En(r,h,a,o,l,d,f)),(r=i[0])&&e.push(new En(r,s,a,o,h,d,f))}return this}function RX(n){var e=[],t=[],i;for(this._root&&e.push(new En(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));i=e.pop();){var r=i.node;if(r.length){var s,a=i.x0,o=i.y0,l=i.z0,u=i.x1,c=i.y1,h=i.z1,d=(a+u)/2,f=(o+c)/2,m=(l+h)/2;(s=r[0])&&e.push(new En(s,a,o,l,d,f,m)),(s=r[1])&&e.push(new En(s,d,o,l,u,f,m)),(s=r[2])&&e.push(new En(s,a,f,l,d,c,m)),(s=r[3])&&e.push(new En(s,d,f,l,u,c,m)),(s=r[4])&&e.push(new En(s,a,o,m,d,f,h)),(s=r[5])&&e.push(new En(s,d,o,m,u,f,h)),(s=r[6])&&e.push(new En(s,a,f,m,d,c,h)),(s=r[7])&&e.push(new En(s,d,f,m,u,c,h))}t.push(i)}for(;i=t.pop();)n(i.node,i.x0,i.y0,i.z0,i.x1,i.y1,i.z1);return this}function NX(n){return n[0]}function CX(n){return arguments.length?(this._x=n,this):this._x}function DX(n){return n[1]}function LX(n){return arguments.length?(this._y=n,this):this._y}function PX(n){return n[2]}function UX(n){return arguments.length?(this._z=n,this):this._z}function CI(n,e,t,i){var r=new oA(e??NX,t??DX,i??PX,NaN,NaN,NaN,NaN,NaN,NaN);return n==null?r:r.addAll(n)}function oA(n,e,t,i,r,s,a,o,l){this._x=n,this._y=e,this._z=t,this._x0=i,this._y0=r,this._z0=s,this._x1=a,this._y1=o,this._z1=l,this._root=void 0}function bC(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var ji=CI.prototype=oA.prototype;ji.copy=function(){var n=new oA(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,t,i;if(!e)return n;if(!e.length)return n._root=bC(e),n;for(t=[{source:e,target:n._root=new Array(8)}];e=t.pop();)for(var r=0;r<8;++r)(i=e.source[r])&&(i.length?t.push({source:i,target:e.target[r]=new Array(8)}):e.target[r]=bC(i));return n};ji.add=mX;ji.addAll=gX;ji.cover=_X;ji.data=yX;ji.extent=vX;ji.find=bX;ji.findAllWithinRadius=xX;ji.remove=TX;ji.removeAll=EX;ji.root=MX;ji.size=wX;ji.visit=AX;ji.visitAfter=RX;ji.x=CX;ji.y=LX;ji.z=UX;function Go(n){return function(){return n}}function Eo(n){return(n()-.5)*1e-6}function OX(n){return n.index}function SC(n,e){var t=n.get(e);if(!t)throw new Error("node not found: "+e);return t}function IX(n){var e=OX,t=d,i,r=Go(30),s,a,o,l,u,c,h=1;n==null&&(n=[]);function d(p){return 1/Math.min(l[p.source.index],l[p.target.index])}function f(p){for(var y=0,v=n.length;y<h;++y)for(var b=0,S,x,T,w=0,E=0,M=0,N,U;b<v;++b)S=n[b],x=S.source,T=S.target,w=T.x+T.vx-x.x-x.vx||Eo(c),o>1&&(E=T.y+T.vy-x.y-x.vy||Eo(c)),o>2&&(M=T.z+T.vz-x.z-x.vz||Eo(c)),N=Math.sqrt(w*w+E*E+M*M),N=(N-s[b])/N*p*i[b],w*=N,E*=N,M*=N,T.vx-=w*(U=u[b]),o>1&&(T.vy-=E*U),o>2&&(T.vz-=M*U),x.vx+=w*(U=1-U),o>1&&(x.vy+=E*U),o>2&&(x.vz+=M*U)}function m(){if(a){var p,y=a.length,v=n.length,b=new Map(a.map((x,T)=>[e(x,T,a),x])),S;for(p=0,l=new Array(y);p<v;++p)S=n[p],S.index=p,typeof S.source!="object"&&(S.source=SC(b,S.source)),typeof S.target!="object"&&(S.target=SC(b,S.target)),l[S.source.index]=(l[S.source.index]||0)+1,l[S.target.index]=(l[S.target.index]||0)+1;for(p=0,u=new Array(v);p<v;++p)S=n[p],u[p]=l[S.source.index]/(l[S.source.index]+l[S.target.index]);i=new Array(v),_(),s=new Array(v),g()}}function _(){if(a)for(var p=0,y=n.length;p<y;++p)i[p]=+t(n[p],p,n)}function g(){if(a)for(var p=0,y=n.length;p<y;++p)s[p]=+r(n[p],p,n)}return f.initialize=function(p,...y){a=p,c=y.find(v=>typeof v=="function")||Math.random,o=y.find(v=>[1,2,3].includes(v))||2,m()},f.links=function(p){return arguments.length?(n=p,m(),f):n},f.id=function(p){return arguments.length?(e=p,f):e},f.iterations=function(p){return arguments.length?(h=+p,f):h},f.strength=function(p){return arguments.length?(t=typeof p=="function"?p:Go(+p),_(),f):t},f.distance=function(p){return arguments.length?(r=typeof p=="function"?p:Go(+p),g(),f):r},f}var BX={value:()=>{}};function DI(){for(var n=0,e=arguments.length,t={},i;n<e;++n){if(!(i=arguments[n]+"")||i in t||/[\s.]/.test(i))throw new Error("illegal type: "+i);t[i]=[]}return new Ny(t)}function Ny(n){this._=n}function FX(n,e){return n.trim().split(/^|\s+/).map(function(t){var i="",r=t.indexOf(".");if(r>=0&&(i=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:i}})}Ny.prototype=DI.prototype={constructor:Ny,on:function(n,e){var t=this._,i=FX(n+"",t),r,s=-1,a=i.length;if(arguments.length<2){for(;++s<a;)if((r=(n=i[s]).type)&&(r=kX(t[r],n.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<a;)if(r=(n=i[s]).type)t[r]=xC(t[r],n.name,e);else if(e==null)for(r in t)t[r]=xC(t[r],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new Ny(n)},call:function(n,e){if((r=arguments.length-2)>0)for(var t=new Array(r),i=0,r,s;i<r;++i)t[i]=arguments[i+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(s=this._[n],i=0,r=s.length;i<r;++i)s[i].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var i=this._[n],r=0,s=i.length;r<s;++r)i[r].value.apply(e,t)}};function kX(n,e){for(var t=0,i=n.length,r;t<i;++t)if((r=n[t]).name===e)return r.value}function xC(n,e,t){for(var i=0,r=n.length;i<r;++i)if(n[i].name===e){n[i]=BX,n=n.slice(0,i).concat(n.slice(i+1));break}return t!=null&&n.push({name:e,value:t}),n}var Zd=0,xp=0,Qf=0,LI=1e3,Dv,Tp,Lv=0,vc=0,rb=0,km=typeof performance=="object"&&performance.now?performance:Date,PI=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function UI(){return vc||(PI(zX),vc=km.now()+rb)}function zX(){vc=0}function _E(){this._call=this._time=this._next=null}_E.prototype=OI.prototype={constructor:_E,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?UI():+t)+(e==null?0:+e),!this._next&&Tp!==this&&(Tp?Tp._next=this:Dv=this,Tp=this),this._call=n,this._time=t,yE()},stop:function(){this._call&&(this._call=null,this._time=1/0,yE())}};function OI(n,e,t){var i=new _E;return i.restart(n,e,t),i}function GX(){UI(),++Zd;for(var n=Dv,e;n;)(e=vc-n._time)>=0&&n._call.call(void 0,e),n=n._next;--Zd}function TC(){vc=(Lv=km.now())+rb,Zd=xp=0;try{GX()}finally{Zd=0,HX(),vc=0}}function VX(){var n=km.now(),e=n-Lv;e>LI&&(rb-=e,Lv=n)}function HX(){for(var n,e=Dv,t,i=1/0;e;)e._call?(i>e._time&&(i=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:Dv=t);Tp=n,yE(i)}function yE(n){if(!Zd){xp&&(xp=clearTimeout(xp));var e=n-vc;e>24?(n<1/0&&(xp=setTimeout(TC,n-km.now()-rb)),Qf&&(Qf=clearInterval(Qf))):(Qf||(Lv=km.now(),Qf=setInterval(VX,LI)),Zd=1,PI(TC))}}const $X=1664525,WX=1013904223,EC=4294967296;function jX(){let n=1;return()=>(n=($X*n+WX)%EC)/EC}var MC=3;function QS(n){return n.x}function wC(n){return n.y}function qX(n){return n.z}var XX=10,YX=Math.PI*(3-Math.sqrt(5)),KX=Math.PI*20/(9+Math.sqrt(221));function QX(n,e){e=e||2;var t=Math.min(MC,Math.max(1,Math.round(e))),i,r=1,s=.001,a=1-Math.pow(s,1/300),o=0,l=.6,u=new Map,c=OI(f),h=DI("tick","end"),d=jX();n==null&&(n=[]);function f(){m(),h.call("tick",i),r<s&&(c.stop(),h.call("end",i))}function m(p){var y,v=n.length,b;p===void 0&&(p=1);for(var S=0;S<p;++S)for(r+=(o-r)*a,u.forEach(function(x){x(r)}),y=0;y<v;++y)b=n[y],b.fx==null?b.x+=b.vx*=l:(b.x=b.fx,b.vx=0),t>1&&(b.fy==null?b.y+=b.vy*=l:(b.y=b.fy,b.vy=0)),t>2&&(b.fz==null?b.z+=b.vz*=l:(b.z=b.fz,b.vz=0));return i}function _(){for(var p=0,y=n.length,v;p<y;++p){if(v=n[p],v.index=p,v.fx!=null&&(v.x=v.fx),v.fy!=null&&(v.y=v.fy),v.fz!=null&&(v.z=v.fz),isNaN(v.x)||t>1&&isNaN(v.y)||t>2&&isNaN(v.z)){var b=XX*(t>2?Math.cbrt(.5+p):t>1?Math.sqrt(.5+p):p),S=p*YX,x=p*KX;t===1?v.x=b:t===2?(v.x=b*Math.cos(S),v.y=b*Math.sin(S)):(v.x=b*Math.sin(S)*Math.cos(x),v.y=b*Math.cos(S),v.z=b*Math.sin(S)*Math.sin(x))}(isNaN(v.vx)||t>1&&isNaN(v.vy)||t>2&&isNaN(v.vz))&&(v.vx=0,t>1&&(v.vy=0),t>2&&(v.vz=0))}}function g(p){return p.initialize&&p.initialize(n,d,t),p}return _(),i={tick:m,restart:function(){return c.restart(f),i},stop:function(){return c.stop(),i},numDimensions:function(p){return arguments.length?(t=Math.min(MC,Math.max(1,Math.round(p))),u.forEach(g),i):t},nodes:function(p){return arguments.length?(n=p,_(),u.forEach(g),i):n},alpha:function(p){return arguments.length?(r=+p,i):r},alphaMin:function(p){return arguments.length?(s=+p,i):s},alphaDecay:function(p){return arguments.length?(a=+p,i):+a},alphaTarget:function(p){return arguments.length?(o=+p,i):o},velocityDecay:function(p){return arguments.length?(l=1-p,i):1-l},randomSource:function(p){return arguments.length?(d=p,u.forEach(g),i):d},force:function(p,y){return arguments.length>1?(y==null?u.delete(p):u.set(p,g(y)),i):u.get(p)},find:function(){var p=Array.prototype.slice.call(arguments),y=p.shift()||0,v=(t>1?p.shift():null)||0,b=(t>2?p.shift():null)||0,S=p.shift()||1/0,x=0,T=n.length,w,E,M,N,U,k;for(S*=S,x=0;x<T;++x)U=n[x],w=y-U.x,E=v-(U.y||0),M=b-(U.z||0),N=w*w+E*E+M*M,N<S&&(k=U,S=N);return k},on:function(p,y){return arguments.length>1?(h.on(p,y),i):h.on(p)}}}function ZX(){var n,e,t,i,r,s=Go(-30),a,o=1,l=1/0,u=.81;function c(m){var _,g=n.length,p=(e===1?wI(n,QS):e===2?RI(n,QS,wC):e===3?CI(n,QS,wC,qX):null).visitAfter(d);for(r=m,_=0;_<g;++_)t=n[_],p.visit(f)}function h(){if(n){var m,_=n.length,g;for(a=new Array(_),m=0;m<_;++m)g=n[m],a[g.index]=+s(g,m,n)}}function d(m){var _=0,g,p,y=0,v,b,S,x,T=m.length;if(T){for(v=b=S=x=0;x<T;++x)(g=m[x])&&(p=Math.abs(g.value))&&(_+=g.value,y+=p,v+=p*(g.x||0),b+=p*(g.y||0),S+=p*(g.z||0));_*=Math.sqrt(4/T),m.x=v/y,e>1&&(m.y=b/y),e>2&&(m.z=S/y)}else{g=m,g.x=g.data.x,e>1&&(g.y=g.data.y),e>2&&(g.z=g.data.z);do _+=a[g.data.index];while(g=g.next)}m.value=_}function f(m,_,g,p,y){if(!m.value)return!0;var v=[g,p,y][e-1],b=m.x-t.x,S=e>1?m.y-t.y:0,x=e>2?m.z-t.z:0,T=v-_,w=b*b+S*S+x*x;if(T*T/u<w)return w<l&&(b===0&&(b=Eo(i),w+=b*b),e>1&&S===0&&(S=Eo(i),w+=S*S),e>2&&x===0&&(x=Eo(i),w+=x*x),w<o&&(w=Math.sqrt(o*w)),t.vx+=b*m.value*r/w,e>1&&(t.vy+=S*m.value*r/w),e>2&&(t.vz+=x*m.value*r/w)),!0;if(m.length||w>=l)return;(m.data!==t||m.next)&&(b===0&&(b=Eo(i),w+=b*b),e>1&&S===0&&(S=Eo(i),w+=S*S),e>2&&x===0&&(x=Eo(i),w+=x*x),w<o&&(w=Math.sqrt(o*w)));do m.data!==t&&(T=a[m.data.index]*r/w,t.vx+=b*T,e>1&&(t.vy+=S*T),e>2&&(t.vz+=x*T));while(m=m.next)}return c.initialize=function(m,..._){n=m,i=_.find(g=>typeof g=="function")||Math.random,e=_.find(g=>[1,2,3].includes(g))||2,h()},c.strength=function(m){return arguments.length?(s=typeof m=="function"?m:Go(+m),h(),c):s},c.distanceMin=function(m){return arguments.length?(o=m*m,c):Math.sqrt(o)},c.distanceMax=function(m){return arguments.length?(l=m*m,c):Math.sqrt(l)},c.theta=function(m){return arguments.length?(u=m*m,c):Math.sqrt(u)},c}function JX(n,e,t,i){var r,s,a=Go(.1),o,l;typeof n!="function"&&(n=Go(+n)),e==null&&(e=0),t==null&&(t=0),i==null&&(i=0);function u(h){for(var d=0,f=r.length;d<f;++d){var m=r[d],_=m.x-e||1e-6,g=(m.y||0)-t||1e-6,p=(m.z||0)-i||1e-6,y=Math.sqrt(_*_+g*g+p*p),v=(l[d]-y)*o[d]*h/y;m.vx+=_*v,s>1&&(m.vy+=g*v),s>2&&(m.vz+=p*v)}}function c(){if(r){var h,d=r.length;for(o=new Array(d),l=new Array(d),h=0;h<d;++h)l[h]=+n(r[h],h,r),o[h]=isNaN(l[h])?0:+a(r[h],h,r)}}return u.initialize=function(h,...d){r=h,s=d.find(f=>[1,2,3].includes(f))||2,c()},u.strength=function(h){return arguments.length?(a=typeof h=="function"?h:Go(+h),c(),u):a},u.radius=function(h){return arguments.length?(n=typeof h=="function"?h:Go(+h),c(),u):n},u.x=function(h){return arguments.length?(e=+h,u):e},u.y=function(h){return arguments.length?(t=+h,u):t},u.z=function(h){return arguments.length?(i=+h,u):i},u}function e7(n){n7(n);const e=t7(n);return n.on=e.on,n.off=e.off,n.fire=e.fire,n}function t7(n){let e=Object.create(null);return{on:function(t,i,r){if(typeof i!="function")throw new Error("callback is expected to be a function");let s=e[t];return s||(s=e[t]=[]),s.push({callback:i,ctx:r}),n},off:function(t,i){if(typeof t>"u")return e=Object.create(null),n;if(e[t])if(typeof i!="function")delete e[t];else{const r=e[t];for(let s=0;s<r.length;++s)r[s].callback===i&&r.splice(s,1)}return n},fire:function(t){const i=e[t];if(!i)return n;let r;arguments.length>1&&(r=Array.prototype.slice.call(arguments,1));for(let s=0;s<i.length;++s){const a=i[s];a.callback.apply(a.ctx,r)}return n}}}function n7(n){if(!n)throw new Error("Eventify cannot use falsy object as events subject");const e=["on","fire","off"];for(let t=0;t<e.length;++t)if(n.hasOwnProperty(e[t]))throw new Error("Subject cannot be eventified, since it already has property '"+e[t]+"'")}var lA=e7;const i7=tg(lA);function r7(n){if(n=n||{},"uniqueLinkId"in n&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),n.multigraph=n.uniqueLinkId),n.multigraph===void 0&&(n.multigraph=!1),typeof Map!="function")throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var e=new Map,t=new Map,i={},r=0,s=n.multigraph?b:v,a=[],o=C,l=C,u=C,c=C,h={version:20,addNode:_,addLink:y,removeLink:w,removeNode:p,getNode:g,getNodeCount:S,getLinkCount:x,getEdgeCount:x,getLinksCount:x,getNodesCount:S,getLinks:T,forEachNode:re,forEachLinkedNode:k,forEachLink:U,beginUpdate:u,endUpdate:c,clear:N,hasLink:M,hasNode:g,getLink:M};return i7(h),d(),h;function d(){var X=h.on;h.on=oe;function oe(){return h.beginUpdate=u=q,h.endUpdate=c=z,o=f,l=m,h.on=X,X.apply(h,arguments)}}function f(X,oe){a.push({link:X,changeType:oe})}function m(X,oe){a.push({node:X,changeType:oe})}function _(X,oe){if(X===void 0)throw new Error("Invalid node identifier");u();var be=g(X);return be?(be.data=oe,l(be,"update")):(be=new s7(X,oe),l(be,"add")),e.set(X,be),c(),be}function g(X){return e.get(X)}function p(X){var oe=g(X);if(!oe)return!1;u();var be=oe.links;return be&&(be.forEach(E),oe.links=null),e.delete(X),l(oe,"remove"),c(),!0}function y(X,oe,be){u();var Oe=g(X)||_(X),st=g(oe)||_(oe),ie=s(X,oe,be),W=t.has(ie.id);return t.set(ie.id,ie),AC(Oe,ie),X!==oe&&AC(st,ie),o(ie,W?"update":"add"),c(),ie}function v(X,oe,be){var Oe=L_(X,oe),st=t.get(Oe);return st?(st.data=be,st):new RC(X,oe,be,Oe)}function b(X,oe,be){var Oe=L_(X,oe),st=i.hasOwnProperty(Oe);if(st||M(X,oe)){st||(i[Oe]=0);var ie="@"+ ++i[Oe];Oe=L_(X+ie,oe+ie)}return new RC(X,oe,be,Oe)}function S(){return e.size}function x(){return t.size}function T(X){var oe=g(X);return oe?oe.links:null}function w(X,oe){return oe!==void 0&&(X=M(X,oe)),E(X)}function E(X){if(!X||!t.get(X.id))return!1;u(),t.delete(X.id);var oe=g(X.fromId),be=g(X.toId);return oe&&oe.links.delete(X),be&&be.links.delete(X),o(X,"remove"),c(),!0}function M(X,oe){if(!(X===void 0||oe===void 0))return t.get(L_(X,oe))}function N(){u(),re(function(X){p(X.id)}),c()}function U(X){if(typeof X=="function")for(var oe=t.values(),be=oe.next();!be.done;){if(X(be.value))return!0;be=oe.next()}}function k(X,oe,be){var Oe=g(X);if(Oe&&Oe.links&&typeof oe=="function")return be?O(Oe.links,X,oe):P(Oe.links,X,oe)}function P(X,oe,be){for(var Oe,st=X.values(),ie=st.next();!ie.done;){var W=ie.value,K=W.fromId===oe?W.toId:W.fromId;if(Oe=be(e.get(K),W),Oe)return!0;ie=st.next()}}function O(X,oe,be){for(var Oe,st=X.values(),ie=st.next();!ie.done;){var W=ie.value;if(W.fromId===oe&&(Oe=be(e.get(W.toId),W),Oe))return!0;ie=st.next()}}function C(){}function q(){r+=1}function z(){r-=1,r===0&&a.length>0&&(h.fire("changed",a),a.length=0)}function re(X){if(typeof X!="function")throw new Error("Function is expected to iterate over graph nodes. You passed "+X);for(var oe=e.values(),be=oe.next();!be.done;){if(X(be.value))return!0;be=oe.next()}}}function s7(n,e){this.id=n,this.links=null,this.data=e}function AC(n,e){n.links?n.links.add(e):n.links=new Set([e])}function RC(n,e,t,i){this.fromId=n,this.toId=e,this.data=t,this.id=i}function L_(n,e){return n.toString()+"👉 "+e.toString()}var uA={exports:{}},Dg={exports:{}},II=function(e){return e===0?"x":e===1?"y":e===2?"z":"c"+(e+1)};const a7=II;var Af=function(e){return t;function t(i,r){let s=r&&r.indent||0,a=r&&r.join!==void 0?r.join:`
`,o=Array(s+1).join(" "),l=[];for(let u=0;u<e;++u){let c=a7(u),h=u===0?"":o;l.push(h+i.replace(/{var}/g,c))}return l.join(a)}};const BI=Af;Dg.exports=o7;Dg.exports.generateCreateBodyFunctionBody=FI;Dg.exports.getVectorCode=zI;Dg.exports.getBodyCode=kI;function o7(n,e){let t=FI(n,e),{Body:i}=new Function(t)();return i}function FI(n,e){return`
${zI(n,e)}
${kI(n)}
return {Body: Body, Vector: Vector};
`}function kI(n){let e=BI(n),t=e("{var}",{join:", "});return`
function Body(${t}) {
  this.isPinned = false;
  this.pos = new Vector(${t});
  this.force = new Vector();
  this.velocity = new Vector();
  this.mass = 1;

  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.reset = function() {
  this.force.reset();
  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.setPosition = function (${t}) {
  ${e("this.pos.{var} = {var} || 0;",{indent:2})}
};`}function zI(n,e){let t=BI(n),i="";return e&&(i=`${t(`
   var v{var};
Object.defineProperty(this, '{var}', {
  set: function(v) { 
    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');
    v{var} = v; 
  },
  get: function() { return v{var}; }
});`)}`),`function Vector(${t("{var}",{join:", "})}) {
  ${i}
    if (typeof arguments[0] === 'object') {
      // could be another vector
      let v = arguments[0];
      ${t('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}
      ${t("this.{var} = v.{var};",{indent:4})}
    } else {
      ${t('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}
    }
  }
  
  Vector.prototype.reset = function () {
    ${t("this.{var} = ",{join:""})}0;
  };`}var l7=Dg.exports,pu={exports:{}};const cA=Af,vl=II;pu.exports=u7;pu.exports.generateQuadTreeFunctionBody=GI;pu.exports.getInsertStackCode=jI;pu.exports.getQuadNodeCode=WI;pu.exports.isSamePosition=VI;pu.exports.getChildBodyCode=$I;pu.exports.setChildBodyCode=HI;function u7(n){let e=GI(n);return new Function(e)()}function GI(n){let e=cA(n),t=Math.pow(2,n);return`
${jI()}
${WI(n)}
${VI(n)}
${$I(n)}
${HI(n)}

function createQuadTree(options, random) {
  options = options || {};
  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;
  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;

  var gravity = options.gravity;
  var updateQueue = [];
  var insertStack = new InsertStack();
  var theta = options.theta;

  var nodesCache = [];
  var currentInCache = 0;
  var root = newNode();

  return {
    insertBodies: insertBodies,

    /**
     * Gets root node if it is present
     */
    getRoot: function() {
      return root;
    },

    updateBodyForce: update,

    options: function(newOptions) {
      if (newOptions) {
        if (typeof newOptions.gravity === 'number') {
          gravity = newOptions.gravity;
        }
        if (typeof newOptions.theta === 'number') {
          theta = newOptions.theta;
        }

        return this;
      }

      return {
        gravity: gravity,
        theta: theta
      };
    }
  };

  function newNode() {
    // To avoid pressure on GC we reuse nodes.
    var node = nodesCache[currentInCache];
    if (node) {
${a("      node.")}
      node.body = null;
      node.mass = ${e("node.mass_{var} = ",{join:""})}0;
      ${e("node.min_{var} = node.max_{var} = ",{join:""})}0;
    } else {
      node = new QuadNode();
      nodesCache[currentInCache] = node;
    }

    ++currentInCache;
    return node;
  }

  function update(sourceBody) {
    var queue = updateQueue;
    var v;
    ${e("var d{var};",{indent:4})}
    var r; 
    ${e("var f{var} = 0;",{indent:4})}
    var queueLength = 1;
    var shiftIdx = 0;
    var pushIdx = 1;

    queue[0] = root;

    while (queueLength) {
      var node = queue[shiftIdx];
      var body = node.body;

      queueLength -= 1;
      shiftIdx += 1;
      var differentBody = (body !== sourceBody);
      if (body && differentBody) {
        // If the current node is a leaf node (and it is not source body),
        // calculate the force exerted by the current node on body, and add this
        // amount to body's net force.
        ${e("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Poor man's protection against zero distance.
          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
        }

        // This is standard gravitation force calculation but we divide
        // by r^3 to save two operations when normalizing force vector.
        v = gravity * body.mass * sourceBody.mass / (r * r * r);
        ${e("f{var} += v * d{var};",{indent:8})}
      } else if (differentBody) {
        // Otherwise, calculate the ratio s / r,  where s is the width of the region
        // represented by the internal node, and r is the distance between the body
        // and the node's center-of-mass
        ${e("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Sorry about code duplication. I don't want to create many functions
          // right away. Just want to see performance first.
          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
        }
        // If s / r < θ, treat this internal node as a single body, and calculate the
        // force it exerts on sourceBody, and add this amount to sourceBody's net force.
        if ((node.max_${vl(0)} - node.min_${vl(0)}) / r < theta) {
          // in the if statement above we consider node's width only
          // because the region was made into square during tree creation.
          // Thus there is no difference between using width or height.
          v = gravity * node.mass * sourceBody.mass / (r * r * r);
          ${e("f{var} += v * d{var};",{indent:10})}
        } else {
          // Otherwise, run the procedure recursively on each of the current node's children.

          // I intentionally unfolded this loop, to save several CPU cycles.
${s()}
        }
      }
    }

    ${e("sourceBody.force.{var} += f{var};",{indent:4})}
  }

  function insertBodies(bodies) {
    ${e("var {var}min = Number.MAX_VALUE;",{indent:4})}
    ${e("var {var}max = Number.MIN_VALUE;",{indent:4})}
    var i = bodies.length;

    // To reduce quad tree depth we are looking for exact bounding box of all particles.
    while (i--) {
      var pos = bodies[i].pos;
      ${e("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}
      ${e("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}
    }

    // Makes the bounds square.
    var maxSideLength = -Infinity;
    ${e("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}

    currentInCache = 0;
    root = newNode();
    ${e("root.min_{var} = {var}min;",{indent:4})}
    ${e("root.max_{var} = {var}min + maxSideLength;",{indent:4})}

    i = bodies.length - 1;
    if (i >= 0) {
      root.body = bodies[i];
    }
    while (i--) {
      insert(bodies[i], root);
    }
  }

  function insert(newBody) {
    insertStack.reset();
    insertStack.push(root, newBody);

    while (!insertStack.isEmpty()) {
      var stackItem = insertStack.pop();
      var node = stackItem.node;
      var body = stackItem.body;

      if (!node.body) {
        // This is internal node. Update the total mass of the node and center-of-mass.
        ${e("var {var} = body.pos.{var};",{indent:8})}
        node.mass += body.mass;
        ${e("node.mass_{var} += body.mass * {var};",{indent:8})}

        // Recursively insert the body in the appropriate quadrant.
        // But first find the appropriate quadrant.
        var quadIdx = 0; // Assume we are in the 0's quad.
        ${e("var min_{var} = node.min_{var};",{indent:8})}
        ${e("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}

${r(8)}

        var child = getChild(node, quadIdx);

        if (!child) {
          // The node is internal but this quadrant is not taken. Add
          // subnode to it.
          child = newNode();
          ${e("child.min_{var} = min_{var};",{indent:10})}
          ${e("child.max_{var} = max_{var};",{indent:10})}
          child.body = body;

          setChild(node, quadIdx, child);
        } else {
          // continue searching in this quadrant.
          insertStack.push(child, body);
        }
      } else {
        // We are trying to add to the leaf node.
        // We have to convert current leaf into internal node
        // and continue adding two nodes.
        var oldBody = node.body;
        node.body = null; // internal nodes do not cary bodies

        if (isSamePosition(oldBody.pos, body.pos)) {
          // Prevent infinite subdivision by bumping one node
          // anywhere in this quadrant
          var retriesCount = 3;
          do {
            var offset = random.nextDouble();
            ${e("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}

            ${e("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}
            retriesCount -= 1;
            // Make sure we don't bump it out of the box. If we do, next iteration should fix it
          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));

          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {
            // This is very bad, we ran out of precision.
            // if we do not return from the method we'll get into
            // infinite loop here. So we sacrifice correctness of layout, and keep the app running
            // Next layout iteration should get larger bounding box in the first step and fix this
            return;
          }
        }
        // Next iteration should subdivide node further.
        insertStack.push(node, oldBody);
        insertStack.push(node, body);
      }
    }
  }
}
return createQuadTree;

`;function r(o){let l=[],u=Array(o+1).join(" ");for(let c=0;c<n;++c)l.push(u+`if (${vl(c)} > max_${vl(c)}) {`),l.push(u+`  quadIdx = quadIdx + ${Math.pow(2,c)};`),l.push(u+`  min_${vl(c)} = max_${vl(c)};`),l.push(u+`  max_${vl(c)} = node.max_${vl(c)};`),l.push(u+"}");return l.join(`
`)}function s(){let o=Array(11).join(" "),l=[];for(let u=0;u<t;++u)l.push(o+`if (node.quad${u}) {`),l.push(o+`  queue[pushIdx] = node.quad${u};`),l.push(o+"  queueLength += 1;"),l.push(o+"  pushIdx += 1;"),l.push(o+"}");return l.join(`
`)}function a(o){let l=[];for(let u=0;u<t;++u)l.push(`${o}quad${u} = null;`);return l.join(`
`)}}function VI(n){let e=cA(n);return`
  function isSamePosition(point1, point2) {
    ${e("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}
  
    return ${e("d{var} < 1e-8",{join:" && "})};
  }  
`}function HI(n){var e=Math.pow(2,n);return`
function setChild(node, idx, child) {
  ${t()}
}`;function t(){let i=[];for(let r=0;r<e;++r){let s=r===0?"  ":"  else ";i.push(`${s}if (idx === ${r}) node.quad${r} = child;`)}return i.join(`
`)}}function $I(n){return`function getChild(node, idx) {
${e()}
  return null;
}`;function e(){let t=[],i=Math.pow(2,n);for(let r=0;r<i;++r)t.push(`  if (idx === ${r}) return node.quad${r};`);return t.join(`
`)}}function WI(n){let e=cA(n),t=Math.pow(2,n);var i=`
function QuadNode() {
  // body stored inside this node. In quad tree only leaf nodes (by construction)
  // contain bodies:
  this.body = null;

  // Child nodes are stored in quads. Each quad is presented by number:
  // 0 | 1
  // -----
  // 2 | 3
${r("  this.")}

  // Total mass of current node
  this.mass = 0;

  // Center of mass coordinates
  ${e("this.mass_{var} = 0;",{indent:2})}

  // bounding box coordinates
  ${e("this.min_{var} = 0;",{indent:2})}
  ${e("this.max_{var} = 0;",{indent:2})}
}
`;return i;function r(s){let a=[];for(let o=0;o<t;++o)a.push(`${s}quad${o} = null;`);return a.join(`
`)}}function jI(){return`
/**
 * Our implementation of QuadTree is non-recursive to avoid GC hit
 * This data structure represent stack of elements
 * which we are trying to insert into quad tree.
 */
function InsertStack () {
    this.stack = [];
    this.popIdx = 0;
}

InsertStack.prototype = {
    isEmpty: function() {
        return this.popIdx === 0;
    },
    push: function (node, body) {
        var item = this.stack[this.popIdx];
        if (!item) {
            // we are trying to avoid memory pressure: create new element
            // only when absolutely necessary
            this.stack[this.popIdx] = new InsertStackElement(node, body);
        } else {
            item.node = node;
            item.body = body;
        }
        ++this.popIdx;
    },
    pop: function () {
        if (this.popIdx > 0) {
            return this.stack[--this.popIdx];
        }
    },
    reset: function () {
        this.popIdx = 0;
    }
};

function InsertStackElement(node, body) {
    this.node = node; // QuadTree node
    this.body = body; // physical body which needs to be inserted to node
}
`}var c7=pu.exports,hA={exports:{}};hA.exports=d7;hA.exports.generateFunctionBody=qI;const h7=Af;function d7(n){let e=qI(n);return new Function("bodies","settings","random",e)}function qI(n){let e=h7(n);return`
  var boundingBox = {
    ${e("min_{var}: 0, max_{var}: 0,",{indent:4})}
  };

  return {
    box: boundingBox,

    update: updateBoundingBox,

    reset: resetBoundingBox,

    getBestNewPosition: function (neighbors) {
      var ${e("base_{var} = 0",{join:", "})};

      if (neighbors.length) {
        for (var i = 0; i < neighbors.length; ++i) {
          let neighborPos = neighbors[i].pos;
          ${e("base_{var} += neighborPos.{var};",{indent:10})}
        }

        ${e("base_{var} /= neighbors.length;",{indent:8})}
      } else {
        ${e("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}
      }

      var springLength = settings.springLength;
      return {
        ${e("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}
      };
    }
  };

  function updateBoundingBox() {
    var i = bodies.length;
    if (i === 0) return; // No bodies - no borders.

    ${e("var max_{var} = -Infinity;",{indent:4})}
    ${e("var min_{var} = Infinity;",{indent:4})}

    while(i--) {
      // this is O(n), it could be done faster with quadtree, if we check the root node bounds
      var bodyPos = bodies[i].pos;
      ${e("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}
      ${e("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}
    }

    ${e("boundingBox.min_{var} = min_{var};",{indent:4})}
    ${e("boundingBox.max_{var} = max_{var};",{indent:4})}
  }

  function resetBoundingBox() {
    ${e("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}
  }
`}var f7=hA.exports,dA={exports:{}};const p7=Af;dA.exports=m7;dA.exports.generateCreateDragForceFunctionBody=XI;function m7(n){let e=XI(n);return new Function("options",e)}function XI(n){return`
  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');

  return {
    update: function(body) {
      ${p7(n)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}
    }
  };
`}var g7=dA.exports,fA={exports:{}};const _7=Af;fA.exports=y7;fA.exports.generateCreateSpringForceFunctionBody=YI;function y7(n){let e=YI(n);return new Function("options","random",e)}function YI(n){let e=_7(n);return`
  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');
  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');

  return {
    /**
     * Updates forces acting on a spring
     */
    update: function (spring) {
      var body1 = spring.from;
      var body2 = spring.to;
      var length = spring.length < 0 ? options.springLength : spring.length;
      ${e("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}
      var r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

      if (r === 0) {
        ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
      }

      var d = r - length;
      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;

      ${e("body1.force.{var} += coefficient * d{var}",{indent:6})};
      body1.springCount += 1;
      body1.springLength += r;

      ${e("body2.force.{var} -= coefficient * d{var}",{indent:6})};
      body2.springCount += 1;
      body2.springLength += r;
    }
  };
`}var v7=fA.exports,pA={exports:{}};const b7=Af;pA.exports=S7;pA.exports.generateIntegratorFunctionBody=KI;function S7(n){let e=KI(n);return new Function("bodies","timeStep","adaptiveTimeStepWeight",e)}function KI(n){let e=b7(n);return`
  var length = bodies.length;
  if (length === 0) return 0;

  ${e("var d{var} = 0, t{var} = 0;",{indent:2})}

  for (var i = 0; i < length; ++i) {
    var body = bodies[i];
    if (body.isPinned) continue;

    if (adaptiveTimeStepWeight && body.springCount) {
      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);
    }

    var coeff = timeStep / body.mass;

    ${e("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}
    ${e("var v{var} = body.velocity.{var};",{indent:4})}
    var v = Math.sqrt(${e("v{var} * v{var}",{join:" + "})});

    if (v > 1) {
      // We normalize it so that we move within timeStep range. 
      // for the case when v <= 1 - we let velocity to fade out.
      ${e("body.velocity.{var} = v{var} / v;",{indent:6})}
    }

    ${e("d{var} = timeStep * body.velocity.{var};",{indent:4})}

    ${e("body.pos.{var} += d{var};",{indent:4})}

    ${e("t{var} += Math.abs(d{var});",{indent:4})}
  }

  return (${e("t{var} * t{var}",{join:" + "})})/length;
`}var x7=pA.exports,ZS,NC;function T7(){if(NC)return ZS;NC=1,ZS=n;function n(e,t,i,r){this.from=e,this.to=t,this.length=i,this.coefficient=r}return ZS}var JS,CC;function E7(){if(CC)return JS;CC=1,JS=n;function n(e,t){var i;if(e||(e={}),t){for(i in t)if(t.hasOwnProperty(i)){var r=e.hasOwnProperty(i),s=typeof t[i],a=!r||typeof e[i]!==s;a?e[i]=t[i]:s==="object"&&(e[i]=n(e[i],t[i]))}}return e}return JS}var Zf={exports:{}},DC;function M7(){if(DC)return Zf.exports;DC=1,Zf.exports=n,Zf.exports.random=n,Zf.exports.randomIterator=o;function n(l){var u=typeof l=="number"?l:+new Date;return new e(u)}function e(l){this.seed=l}e.prototype.next=a,e.prototype.nextDouble=s,e.prototype.uniform=s,e.prototype.gaussian=t,e.prototype.random=s;function t(){var l,u,c;do u=this.nextDouble()*2-1,c=this.nextDouble()*2-1,l=u*u+c*c;while(l>=1||l===0);return u*Math.sqrt(-2*Math.log(l)/l)}e.prototype.levy=i;function i(){var l=1.5,u=Math.pow(r(1+l)*Math.sin(Math.PI*l/2)/(r((1+l)/2)*l*Math.pow(2,(l-1)/2)),1/l);return this.gaussian()*u/Math.pow(Math.abs(this.gaussian()),1/l)}function r(l){return Math.sqrt(2*Math.PI/l)*Math.pow(1/Math.E*(l+1/(12*l-1/(10*l))),l)}function s(){var l=this.seed;return l=l+2127912214+(l<<12)&4294967295,l=(l^3345072700^l>>>19)&4294967295,l=l+374761393+(l<<5)&4294967295,l=(l+3550635116^l<<9)&4294967295,l=l+4251993797+(l<<3)&4294967295,l=(l^3042594569^l>>>16)&4294967295,this.seed=l,(l&268435455)/268435456}function a(l){return Math.floor(this.nextDouble()*l)}function o(l,u){var c=u||n();if(typeof c.next!="function")throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:d,shuffle:h};function h(){var f,m,_;for(f=l.length-1;f>0;--f)m=c.next(f+1),_=l[m],l[m]=l[f],l[f]=_;return l}function d(f){var m,_,g;for(m=l.length-1;m>0;--m)_=c.next(m+1),g=l[_],l[_]=l[m],l[m]=g,f(g);l.length&&f(l[0])}}return Zf.exports}var QI=L7,w7=l7,A7=c7,R7=f7,N7=g7,C7=v7,D7=x7,LC={};function L7(n){var e=T7(),t=E7(),i=lA;if(n){if(n.springCoeff!==void 0)throw new Error("springCoeff was renamed to springCoefficient");if(n.dragCoeff!==void 0)throw new Error("dragCoeff was renamed to dragCoefficient")}n=t(n,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var r=LC[n.dimensions];if(!r){var s=n.dimensions;r={Body:w7(s,n.debug),createQuadTree:A7(s),createBounds:R7(s),createDragForce:N7(s),createSpringForce:C7(s),integrate:D7(s)},LC[s]=r}var a=r.Body,o=r.createQuadTree,l=r.createBounds,u=r.createDragForce,c=r.createSpringForce,h=r.integrate,d=O=>new a(O),f=M7().random(42),m=[],_=[],g=o(n,f),p=l(m,n,f),y=c(n,f),v=u(n),b=0,S=[],x=new Map,T=0;M("nbody",k),M("spring",P);var w={bodies:m,quadTree:g,springs:_,settings:n,addForce:M,removeForce:N,getForces:U,step:function(){for(var O=0;O<S.length;++O)S[O](T);var C=h(m,n.timeStep,n.adaptiveTimeStepWeight);return T+=1,C},addBody:function(O){if(!O)throw new Error("Body is required");return m.push(O),O},addBodyAt:function(O){if(!O)throw new Error("Body position is required");var C=d(O);return m.push(C),C},removeBody:function(O){if(O){var C=m.indexOf(O);if(!(C<0))return m.splice(C,1),m.length===0&&p.reset(),!0}},addSpring:function(O,C,q,z){if(!O||!C)throw new Error("Cannot add null spring to force simulator");typeof q!="number"&&(q=-1);var re=new e(O,C,q,z>=0?z:-1);return _.push(re),re},getTotalMovement:function(){return b},removeSpring:function(O){if(O){var C=_.indexOf(O);if(C>-1)return _.splice(C,1),!0}},getBestNewBodyPosition:function(O){return p.getBestNewPosition(O)},getBBox:E,getBoundingBox:E,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(O){return O!==void 0?(n.gravity=O,g.options({gravity:O}),this):n.gravity},theta:function(O){return O!==void 0?(n.theta=O,g.options({theta:O}),this):n.theta},random:f};return P7(n,w),i(w),w;function E(){return p.update(),p.box}function M(O,C){if(x.has(O))throw new Error("Force "+O+" is already added");x.set(O,C),S.push(C)}function N(O){var C=S.indexOf(x.get(O));C<0||(S.splice(C,1),x.delete(O))}function U(){return x}function k(){if(m.length!==0){g.insertBodies(m);for(var O=m.length;O--;){var C=m[O];C.isPinned||(C.reset(),g.updateBodyForce(C),v.update(C))}}}function P(){for(var O=_.length;O--;)y.update(_[O])}}function P7(n,e){for(var t in n)U7(n,e,t)}function U7(n,e,t){if(n.hasOwnProperty(t)&&typeof e[t]!="function"){var i=Number.isFinite(n[t]);i?e[t]=function(r){if(r!==void 0){if(!Number.isFinite(r))throw new Error("Value of "+t+" should be a valid number.");return n[t]=r,e}return n[t]}:e[t]=function(r){return r!==void 0?(n[t]=r,e):n[t]}}}uA.exports=I7;uA.exports.simulator=QI;var O7=lA;function I7(n,e){if(!n)throw new Error("Graph structure cannot be undefined");var t=e&&e.createSimulator||QI,i=t(e);if(Array.isArray(e))throw new Error("Physics settings is expected to be an object");var r=n.version>19?k:U;e&&typeof e.nodeMass=="function"&&(r=e.nodeMass);var s=new Map,a={},o=0,l=i.settings.springTransform||B7;v(),g();var u=!1,c={step:function(){if(o===0)return h(!0),!0;var P=i.step();c.lastMove=P,c.fire("step");var O=P/o,C=O<=.01;return h(C),C},getNodePosition:function(P){return N(P).pos},setNodePosition:function(P){var O=N(P);O.setPosition.apply(O,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(P){var O=a[P];if(O)return{from:O.from.pos,to:O.to.pos}},getGraphRect:function(){return i.getBBox()},forEachBody:d,pinNode:function(P,O){var C=N(P.id);C.isPinned=!!O},isNodePinned:function(P){return N(P.id).isPinned},dispose:function(){n.off("changed",y),c.fire("disposed")},getBody:_,getSpring:m,getForceVectorLength:f,simulator:i,graph:n,lastMove:0};return O7(c),c;function h(P){u!==P&&(u=P,p(P))}function d(P){s.forEach(P)}function f(){var P=0,O=0;return d(function(C){P+=Math.abs(C.force.x),O+=Math.abs(C.force.y)}),Math.sqrt(P*P+O*O)}function m(P,O){var C;if(O===void 0)typeof P!="object"?C=P:C=P.id;else{var q=n.hasLink(P,O);if(!q)return;C=q.id}return a[C]}function _(P){return s.get(P)}function g(){n.on("changed",y)}function p(P){c.fire("stable",P)}function y(P){for(var O=0;O<P.length;++O){var C=P[O];C.changeType==="add"?(C.node&&b(C.node.id),C.link&&x(C.link)):C.changeType==="remove"&&(C.node&&S(C.node),C.link&&T(C.link))}o=n.getNodesCount()}function v(){o=0,n.forEachNode(function(P){b(P.id),o+=1}),n.forEachLink(x)}function b(P){var O=s.get(P);if(!O){var C=n.getNode(P);if(!C)throw new Error("initBody() was called with unknown node id");var q=C.position;if(!q){var z=w(C);q=i.getBestNewBodyPosition(z)}O=i.addBodyAt(q),O.id=P,s.set(P,O),E(P),M(C)&&(O.isPinned=!0)}}function S(P){var O=P.id,C=s.get(O);C&&(s.delete(O),i.removeBody(C))}function x(P){E(P.fromId),E(P.toId);var O=s.get(P.fromId),C=s.get(P.toId),q=i.addSpring(O,C,P.length);l(P,q),a[P.id]=q}function T(P){var O=a[P.id];if(O){var C=n.getNode(P.fromId),q=n.getNode(P.toId);C&&E(C.id),q&&E(q.id),delete a[P.id],i.removeSpring(O)}}function w(P){var O=[];if(!P.links)return O;for(var C=Math.min(P.links.length,2),q=0;q<C;++q){var z=P.links[q],re=z.fromId!==P.id?s.get(z.fromId):s.get(z.toId);re&&re.pos&&O.push(re)}return O}function E(P){var O=s.get(P);if(O.mass=r(P),Number.isNaN(O.mass))throw new Error("Node mass should be a number")}function M(P){return P&&(P.isPinned||P.data&&P.data.isPinned)}function N(P){var O=s.get(P);return O||(b(P),O=s.get(P)),O}function U(P){var O=n.getLinks(P);return O?1+O.length/3:1}function k(P){var O=n.getLinks(P);return O?1+O.size/3:1}}function B7(){}var F7=uA.exports;const k7=tg(F7);function vE(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var z7=typeof global=="object"&&global&&global.Object===Object&&global,G7=typeof self=="object"&&self&&self.Object===Object&&self,ZI=z7||G7||Function("return this")(),ex=function(){return ZI.Date.now()},V7=/\s/;function H7(n){for(var e=n.length;e--&&V7.test(n.charAt(e)););return e}var $7=/^\s+/;function W7(n){return n&&n.slice(0,H7(n)+1).replace($7,"")}var Pv=ZI.Symbol,JI=Object.prototype,j7=JI.hasOwnProperty,q7=JI.toString,Jf=Pv?Pv.toStringTag:void 0;function X7(n){var e=j7.call(n,Jf),t=n[Jf];try{n[Jf]=void 0;var i=!0}catch{}var r=q7.call(n);return i&&(e?n[Jf]=t:delete n[Jf]),r}var Y7=Object.prototype,K7=Y7.toString;function Q7(n){return K7.call(n)}var Z7="[object Null]",J7="[object Undefined]",PC=Pv?Pv.toStringTag:void 0;function eY(n){return n==null?n===void 0?J7:Z7:PC&&PC in Object(n)?X7(n):Q7(n)}function tY(n){return n!=null&&typeof n=="object"}var nY="[object Symbol]";function iY(n){return typeof n=="symbol"||tY(n)&&eY(n)==nY}var UC=NaN,rY=/^[-+]0x[0-9a-f]+$/i,sY=/^0b[01]+$/i,aY=/^0o[0-7]+$/i,oY=parseInt;function OC(n){if(typeof n=="number")return n;if(iY(n))return UC;if(vE(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=vE(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=W7(n);var t=sY.test(n);return t||aY.test(n)?oY(n.slice(2),t?2:8):rY.test(n)?UC:+n}var lY="Expected a function",uY=Math.max,cY=Math.min;function hY(n,e,t){var i,r,s,a,o,l,u=0,c=!1,h=!1,d=!0;if(typeof n!="function")throw new TypeError(lY);e=OC(e)||0,vE(t)&&(c=!!t.leading,h="maxWait"in t,s=h?uY(OC(t.maxWait)||0,e):s,d="trailing"in t?!!t.trailing:d);function f(x){var T=i,w=r;return i=r=void 0,u=x,a=n.apply(w,T),a}function m(x){return u=x,o=setTimeout(p,e),c?f(x):a}function _(x){var T=x-l,w=x-u,E=e-T;return h?cY(E,s-w):E}function g(x){var T=x-l,w=x-u;return l===void 0||T>=e||T<0||h&&w>=s}function p(){var x=ex();if(g(x))return y(x);o=setTimeout(p,_(x))}function y(x){return o=void 0,d&&i?f(x):(i=r=void 0,a)}function v(){o!==void 0&&clearTimeout(o),u=0,i=l=r=o=void 0}function b(){return o===void 0?a:y(ex())}function S(){var x=ex(),T=g(x);if(i=arguments,r=this,l=x,T){if(o===void 0)return m(l);if(h)return clearTimeout(o),o=setTimeout(p,e),f(l)}return o===void 0&&(o=setTimeout(p,e)),a}return S.cancel=v,S.flush=b,S}function IC(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function dY(n){if(Array.isArray(n))return n}function fY(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function pY(n,e,t){return Object.defineProperty(n,"prototype",{writable:!1}),n}function mY(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(i=s.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}function gY(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _Y(n,e){return dY(n)||mY(n,e)||yY(n,e)||gY()}function yY(n,e){if(n){if(typeof n=="string")return IC(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?IC(n,e):void 0}}var vY=pY(function n(e,t){var i=t.default,r=i===void 0?null:i,s=t.triggerUpdate,a=s===void 0?!0:s,o=t.onChange,l=o===void 0?function(u,c){}:o;fY(this,n),this.name=e,this.defaultVal=r,this.triggerUpdate=a,this.onChange=l});function sb(n){var e=n.stateInit,t=e===void 0?function(){return{}}:e,i=n.props,r=i===void 0?{}:i,s=n.methods,a=s===void 0?{}:s,o=n.aliases,l=o===void 0?{}:o,u=n.init,c=u===void 0?function(){}:u,h=n.update,d=h===void 0?function(){}:h,f=Object.keys(r).map(function(m){return new vY(m,r[m])});return function m(){for(var _=arguments.length,g=new Array(_),p=0;p<_;p++)g[p]=arguments[p];var y=!!(this instanceof m&&this.constructor),v=y?g.shift():void 0,b=g[0],S=b===void 0?{}:b,x=Object.assign({},t instanceof Function?t(S):t,{initialised:!1}),T={};function w(N){return E(N,S),M(),w}var E=function(U,k){c.call(w,U,x,k),x.initialised=!0},M=hY(function(){x.initialised&&(d.call(w,x,T),T={})},1);return f.forEach(function(N){w[N.name]=U(N);function U(k){var P=k.name,O=k.triggerUpdate,C=O===void 0?!1:O,q=k.onChange,z=q===void 0?function(oe,be){}:q,re=k.defaultVal,X=re===void 0?null:re;return function(oe){var be=x[P];if(!arguments.length)return be;var Oe=oe===void 0?X:oe;return x[P]=Oe,z.call(w,Oe,x,be),!T.hasOwnProperty(P)&&(T[P]=be),C&&M(),w}}}),Object.keys(a).forEach(function(N){w[N]=function(){for(var U,k=arguments.length,P=new Array(k),O=0;O<k;O++)P[O]=arguments[O];return(U=a[N]).call.apply(U,[w,x].concat(P))}}),Object.entries(l).forEach(function(N){var U=_Y(N,2),k=U[0],P=U[1];return w[k]=w[P]}),w.resetProps=function(){return f.forEach(function(N){w[N.name](N.defaultVal)}),w},w.resetProps(),x._rerender=M,y&&v&&w(v),w}}var Bt=function(n){return typeof n=="function"?n:typeof n=="string"?function(e){return e[n]}:function(e){return n}};class BC extends Map{constructor(e,t=xY){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[i,r]of e)this.set(i,r)}get(e){return super.get(FC(this,e))}has(e){return super.has(FC(this,e))}set(e,t){return super.set(bY(this,e),t)}delete(e){return super.delete(SY(this,e))}}function FC({_intern:n,_key:e},t){const i=e(t);return n.has(i)?n.get(i):t}function bY({_intern:n,_key:e},t){const i=e(t);return n.has(i)?n.get(i):(n.set(i,t),t)}function SY({_intern:n,_key:e},t){const i=e(t);return n.has(i)&&(t=n.get(i),n.delete(i)),t}function xY(n){return n!==null&&typeof n=="object"?n.valueOf():n}function TY(n,e){let t;if(e===void 0)for(const i of n)i!=null&&(t<i||t===void 0&&i>=i)&&(t=i);else{let i=-1;for(let r of n)(r=e(r,++i,n))!=null&&(t<r||t===void 0&&r>=r)&&(t=r)}return t}function EY(n,e){let t;if(e===void 0)for(const i of n)i!=null&&(t>i||t===void 0&&i>=i)&&(t=i);else{let i=-1;for(let r of n)(r=e(r,++i,n))!=null&&(t>r||t===void 0&&r>=r)&&(t=r)}return t}function bE(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function MY(n){if(Array.isArray(n))return n}function wY(n){if(Array.isArray(n))return bE(n)}function eB(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function AY(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function RY(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Yi(n,e){return n.get(eB(n,e))}function Zc(n,e,t){AY(n,e),e.set(n,t)}function P_(n,e,t){return n.set(eB(n,e),t),t}function NY(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,FY(i.key),i)}}function CY(n,e,t){return e&&NY(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function DY(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function LY(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(i=s.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}function PY(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function UY(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OY(n,e){return MY(n)||LY(n,e)||tB(n,e)||PY()}function IY(n){return wY(n)||DY(n)||tB(n)||UY()}function BY(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function FY(n){var e=BY(n,"string");return typeof e=="symbol"?e:e+""}function tB(n,e){if(n){if(typeof n=="string")return bE(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?bE(n,e):void 0}}var Jc=new WeakMap,ep=new WeakMap,eh=new WeakMap,tx=new WeakMap,nx=new WeakMap,ix=new WeakMap,kY=function(){function n(){RY(this,n),Zc(this,Jc,new Map),Zc(this,ep,new Map),Zc(this,eh,function(e){return e}),Zc(this,tx,function(){return{}}),Zc(this,nx,function(){}),Zc(this,ix,function(){})}return CY(n,[{key:"getObj",value:function(t){return Yi(Jc,this).get(Yi(eh,this).call(this,t))}},{key:"getData",value:function(t){return Yi(ep,this).get(t)}},{key:"entries",value:function(){return IY(Yi(ep,this).entries()).map(function(t){var i=OY(t,2),r=i[0],s=i[1];return[s,r]})}},{key:"id",value:function(t){return P_(eh,this,Bt(t)),this}},{key:"onCreateObj",value:function(t){return P_(tx,this,t),this}},{key:"onUpdateObj",value:function(t){return P_(nx,this,t),this}},{key:"onRemoveObj",value:function(t){return P_(ix,this,t),this}},{key:"digest",value:function(t){var i=this;t.filter(function(s){return!Yi(Jc,i).has(Yi(eh,i).call(i,s))}).forEach(function(s){var a=Yi(tx,i).call(i,s);Yi(Jc,i).set(Yi(eh,i).call(i,s),a),Yi(ep,i).set(a,s)});var r=new Map(t.map(function(s){return[Yi(eh,i).call(i,s),s]}));return Yi(Jc,this).forEach(function(s,a){r.has(a)?Yi(nx,i).call(i,s,r.get(a)):(Yi(ix,i).call(i,s,a),Yi(Jc,i).delete(a),Yi(ep,i).delete(s))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])}();function zY(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}const kC=Symbol("implicit");function nB(){var n=new BC,e=[],t=[],i=kC;function r(s){let a=n.get(s);if(a===void 0){if(i!==kC)return i;n.set(s,a=e.push(s)-1)}return t[a%t.length]}return r.domain=function(s){if(!arguments.length)return e.slice();e=[],n=new BC;for(const a of s)n.has(a)||n.set(a,e.push(a)-1);return r},r.range=function(s){return arguments.length?(t=Array.from(s),r):t.slice()},r.unknown=function(s){return arguments.length?(i=s,r):i},r.copy=function(){return nB(e,t).unknown(i)},zY.apply(r,arguments),r}function GY(n){for(var e=n.length/6|0,t=new Array(e),i=0;i<e;)t[i]="#"+n.slice(i*6,++i*6);return t}const VY=GY("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function Uv(n){"@babel/helpers - typeof";return Uv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Uv(n)}var HY=/^\s+/,$Y=/\s+$/;function $e(n,e){if(n=n||"",e=e||{},n instanceof $e)return n;if(!(this instanceof $e))return new $e(n,e);var t=WY(n);this._originalInput=n,this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||t.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=t.ok}$e.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),t,i,r,s,a,o;return t=e.r/255,i=e.g/255,r=e.b/255,t<=.03928?s=t/12.92:s=Math.pow((t+.055)/1.055,2.4),i<=.03928?a=i/12.92:a=Math.pow((i+.055)/1.055,2.4),r<=.03928?o=r/12.92:o=Math.pow((r+.055)/1.055,2.4),.2126*s+.7152*a+.0722*o},setAlpha:function(e){return this._a=iB(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=GC(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=GC(this._r,this._g,this._b),t=Math.round(e.h*360),i=Math.round(e.s*100),r=Math.round(e.v*100);return this._a==1?"hsv("+t+", "+i+"%, "+r+"%)":"hsva("+t+", "+i+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=zC(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=zC(this._r,this._g,this._b),t=Math.round(e.h*360),i=Math.round(e.s*100),r=Math.round(e.l*100);return this._a==1?"hsl("+t+", "+i+"%, "+r+"%)":"hsla("+t+", "+i+"%, "+r+"%, "+this._roundA+")"},toHex:function(e){return VC(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return YY(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(Gn(this._r,255)*100)+"%",g:Math.round(Gn(this._g,255)*100)+"%",b:Math.round(Gn(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(Gn(this._r,255)*100)+"%, "+Math.round(Gn(this._g,255)*100)+"%, "+Math.round(Gn(this._b,255)*100)+"%)":"rgba("+Math.round(Gn(this._r,255)*100)+"%, "+Math.round(Gn(this._g,255)*100)+"%, "+Math.round(Gn(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:oK[VC(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+HC(this._r,this._g,this._b,this._a),i=t,r=this._gradientType?"GradientType = 1, ":"";if(e){var s=$e(e);i="#"+HC(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+i+")"},toString:function(e){var t=!!e;e=e||this._format;var i=!1,r=this._a<1&&this._a>=0,s=!t&&r&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return s?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(i=this.toRgbString()),e==="prgb"&&(i=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(i=this.toHexString()),e==="hex3"&&(i=this.toHexString(!0)),e==="hex4"&&(i=this.toHex8String(!0)),e==="hex8"&&(i=this.toHex8String()),e==="name"&&(i=this.toName()),e==="hsl"&&(i=this.toHslString()),e==="hsv"&&(i=this.toHsvString()),i||this.toHexString())},clone:function(){return $e(this.toString())},_applyModification:function(e,t){var i=e.apply(null,[this].concat([].slice.call(t)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(JY,arguments)},brighten:function(){return this._applyModification(eK,arguments)},darken:function(){return this._applyModification(tK,arguments)},desaturate:function(){return this._applyModification(KY,arguments)},saturate:function(){return this._applyModification(QY,arguments)},greyscale:function(){return this._applyModification(ZY,arguments)},spin:function(){return this._applyModification(nK,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(sK,arguments)},complement:function(){return this._applyCombination(iK,arguments)},monochromatic:function(){return this._applyCombination(aK,arguments)},splitcomplement:function(){return this._applyCombination(rK,arguments)},triad:function(){return this._applyCombination($C,[3])},tetrad:function(){return this._applyCombination($C,[4])}};$e.fromRatio=function(n,e){if(Uv(n)=="object"){var t={};for(var i in n)n.hasOwnProperty(i)&&(i==="a"?t[i]=n[i]:t[i]=Ep(n[i]));n=t}return $e(n,e)};function WY(n){var e={r:0,g:0,b:0},t=1,i=null,r=null,s=null,a=!1,o=!1;return typeof n=="string"&&(n=hK(n)),Uv(n)=="object"&&(go(n.r)&&go(n.g)&&go(n.b)?(e=jY(n.r,n.g,n.b),a=!0,o=String(n.r).substr(-1)==="%"?"prgb":"rgb"):go(n.h)&&go(n.s)&&go(n.v)?(i=Ep(n.s),r=Ep(n.v),e=XY(n.h,i,r),a=!0,o="hsv"):go(n.h)&&go(n.s)&&go(n.l)&&(i=Ep(n.s),s=Ep(n.l),e=qY(n.h,i,s),a=!0,o="hsl"),n.hasOwnProperty("a")&&(t=n.a)),t=iB(t),{ok:a,format:n.format||o,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:t}}function jY(n,e,t){return{r:Gn(n,255)*255,g:Gn(e,255)*255,b:Gn(t,255)*255}}function zC(n,e,t){n=Gn(n,255),e=Gn(e,255),t=Gn(t,255);var i=Math.max(n,e,t),r=Math.min(n,e,t),s,a,o=(i+r)/2;if(i==r)s=a=0;else{var l=i-r;switch(a=o>.5?l/(2-i-r):l/(i+r),i){case n:s=(e-t)/l+(e<t?6:0);break;case e:s=(t-n)/l+2;break;case t:s=(n-e)/l+4;break}s/=6}return{h:s,s:a,l:o}}function qY(n,e,t){var i,r,s;n=Gn(n,360),e=Gn(e,100),t=Gn(t,100);function a(u,c,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?u+(c-u)*6*h:h<1/2?c:h<2/3?u+(c-u)*(2/3-h)*6:u}if(e===0)i=r=s=t;else{var o=t<.5?t*(1+e):t+e-t*e,l=2*t-o;i=a(l,o,n+1/3),r=a(l,o,n),s=a(l,o,n-1/3)}return{r:i*255,g:r*255,b:s*255}}function GC(n,e,t){n=Gn(n,255),e=Gn(e,255),t=Gn(t,255);var i=Math.max(n,e,t),r=Math.min(n,e,t),s,a,o=i,l=i-r;if(a=i===0?0:l/i,i==r)s=0;else{switch(i){case n:s=(e-t)/l+(e<t?6:0);break;case e:s=(t-n)/l+2;break;case t:s=(n-e)/l+4;break}s/=6}return{h:s,s:a,v:o}}function XY(n,e,t){n=Gn(n,360)*6,e=Gn(e,100),t=Gn(t,100);var i=Math.floor(n),r=n-i,s=t*(1-e),a=t*(1-r*e),o=t*(1-(1-r)*e),l=i%6,u=[t,a,s,s,o,t][l],c=[o,t,t,a,s,s][l],h=[s,s,o,t,t,a][l];return{r:u*255,g:c*255,b:h*255}}function VC(n,e,t,i){var r=[ua(Math.round(n).toString(16)),ua(Math.round(e).toString(16)),ua(Math.round(t).toString(16))];return i&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function YY(n,e,t,i,r){var s=[ua(Math.round(n).toString(16)),ua(Math.round(e).toString(16)),ua(Math.round(t).toString(16)),ua(rB(i))];return r&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function HC(n,e,t,i){var r=[ua(rB(i)),ua(Math.round(n).toString(16)),ua(Math.round(e).toString(16)),ua(Math.round(t).toString(16))];return r.join("")}$e.equals=function(n,e){return!n||!e?!1:$e(n).toRgbString()==$e(e).toRgbString()};$e.random=function(){return $e.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function KY(n,e){e=e===0?0:e||10;var t=$e(n).toHsl();return t.s-=e/100,t.s=ab(t.s),$e(t)}function QY(n,e){e=e===0?0:e||10;var t=$e(n).toHsl();return t.s+=e/100,t.s=ab(t.s),$e(t)}function ZY(n){return $e(n).desaturate(100)}function JY(n,e){e=e===0?0:e||10;var t=$e(n).toHsl();return t.l+=e/100,t.l=ab(t.l),$e(t)}function eK(n,e){e=e===0?0:e||10;var t=$e(n).toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(255*-(e/100)))),t.g=Math.max(0,Math.min(255,t.g-Math.round(255*-(e/100)))),t.b=Math.max(0,Math.min(255,t.b-Math.round(255*-(e/100)))),$e(t)}function tK(n,e){e=e===0?0:e||10;var t=$e(n).toHsl();return t.l-=e/100,t.l=ab(t.l),$e(t)}function nK(n,e){var t=$e(n).toHsl(),i=(t.h+e)%360;return t.h=i<0?360+i:i,$e(t)}function iK(n){var e=$e(n).toHsl();return e.h=(e.h+180)%360,$e(e)}function $C(n,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var t=$e(n).toHsl(),i=[$e(n)],r=360/e,s=1;s<e;s++)i.push($e({h:(t.h+s*r)%360,s:t.s,l:t.l}));return i}function rK(n){var e=$e(n).toHsl(),t=e.h;return[$e(n),$e({h:(t+72)%360,s:e.s,l:e.l}),$e({h:(t+216)%360,s:e.s,l:e.l})]}function sK(n,e,t){e=e||6,t=t||30;var i=$e(n).toHsl(),r=360/t,s=[$e(n)];for(i.h=(i.h-(r*e>>1)+720)%360;--e;)i.h=(i.h+r)%360,s.push($e(i));return s}function aK(n,e){e=e||6;for(var t=$e(n).toHsv(),i=t.h,r=t.s,s=t.v,a=[],o=1/e;e--;)a.push($e({h:i,s:r,v:s})),s=(s+o)%1;return a}$e.mix=function(n,e,t){t=t===0?0:t||50;var i=$e(n).toRgb(),r=$e(e).toRgb(),s=t/100,a={r:(r.r-i.r)*s+i.r,g:(r.g-i.g)*s+i.g,b:(r.b-i.b)*s+i.b,a:(r.a-i.a)*s+i.a};return $e(a)};$e.readability=function(n,e){var t=$e(n),i=$e(e);return(Math.max(t.getLuminance(),i.getLuminance())+.05)/(Math.min(t.getLuminance(),i.getLuminance())+.05)};$e.isReadable=function(n,e,t){var i=$e.readability(n,e),r,s;switch(s=!1,r=dK(t),r.level+r.size){case"AAsmall":case"AAAlarge":s=i>=4.5;break;case"AAlarge":s=i>=3;break;case"AAAsmall":s=i>=7;break}return s};$e.mostReadable=function(n,e,t){var i=null,r=0,s,a,o,l;t=t||{},a=t.includeFallbackColors,o=t.level,l=t.size;for(var u=0;u<e.length;u++)s=$e.readability(n,e[u]),s>r&&(r=s,i=$e(e[u]));return $e.isReadable(n,i,{level:o,size:l})||!a?i:(t.includeFallbackColors=!1,$e.mostReadable(n,["#fff","#000"],t))};var SE=$e.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},oK=$e.hexNames=lK(SE);function lK(n){var e={};for(var t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}function iB(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function Gn(n,e){uK(n)&&(n="100%");var t=cK(n);return n=Math.min(e,Math.max(0,parseFloat(n))),t&&(n=parseInt(n*e,10)/100),Math.abs(n-e)<1e-6?1:n%e/parseFloat(e)}function ab(n){return Math.min(1,Math.max(0,n))}function is(n){return parseInt(n,16)}function uK(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1}function cK(n){return typeof n=="string"&&n.indexOf("%")!=-1}function ua(n){return n.length==1?"0"+n:""+n}function Ep(n){return n<=1&&(n=n*100+"%"),n}function rB(n){return Math.round(parseFloat(n)*255).toString(16)}function WC(n){return is(n)/255}var Zs=function(){var n="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",t="(?:"+e+")|(?:"+n+")",i="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",r="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+i),rgba:new RegExp("rgba"+r),hsl:new RegExp("hsl"+i),hsla:new RegExp("hsla"+r),hsv:new RegExp("hsv"+i),hsva:new RegExp("hsva"+r),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function go(n){return!!Zs.CSS_UNIT.exec(n)}function hK(n){n=n.replace(HY,"").replace($Y,"").toLowerCase();var e=!1;if(SE[n])n=SE[n],e=!0;else if(n=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var t;return(t=Zs.rgb.exec(n))?{r:t[1],g:t[2],b:t[3]}:(t=Zs.rgba.exec(n))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=Zs.hsl.exec(n))?{h:t[1],s:t[2],l:t[3]}:(t=Zs.hsla.exec(n))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=Zs.hsv.exec(n))?{h:t[1],s:t[2],v:t[3]}:(t=Zs.hsva.exec(n))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=Zs.hex8.exec(n))?{r:is(t[1]),g:is(t[2]),b:is(t[3]),a:WC(t[4]),format:e?"name":"hex8"}:(t=Zs.hex6.exec(n))?{r:is(t[1]),g:is(t[2]),b:is(t[3]),format:e?"name":"hex"}:(t=Zs.hex4.exec(n))?{r:is(t[1]+""+t[1]),g:is(t[2]+""+t[2]),b:is(t[3]+""+t[3]),a:WC(t[4]+""+t[4]),format:e?"name":"hex8"}:(t=Zs.hex3.exec(n))?{r:is(t[1]+""+t[1]),g:is(t[2]+""+t[2]),b:is(t[3]+""+t[3]),format:e?"name":"hex"}:!1}function dK(n){var e,t;return n=n||{level:"AA",size:"small"},e=(n.level||"AA").toUpperCase(),t=(n.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),t!=="small"&&t!=="large"&&(t="small"),{level:e,size:t}}function xE(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function fK(n){if(Array.isArray(n))return n}function pK(n){if(Array.isArray(n))return xE(n)}function sB(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function mK(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function aB(n,e,t){return e=Jd(e),TK(n,mA()?Reflect.construct(e,t||[],Jd(n).constructor):e.apply(n,t))}function gK(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function oB(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function rx(n,e){return n.get(sB(n,e))}function jC(n,e,t){gK(n,e),e.set(n,t)}function qC(n,e,t){return n.set(sB(n,e),t),t}function lB(n,e,t){if(mA())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,e);var r=new(n.bind.apply(n,i));return r}function _K(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,hB(i.key),i)}}function uB(n,e,t){return e&&_K(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function ob(n,e,t){return(e=hB(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function TE(){return TE=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,e,t){var i=EK(n,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(arguments.length<3?n:t):r.value}},TE.apply(null,arguments)}function Jd(n){return Jd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Jd(n)}function cB(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&EE(n,e)}function mA(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mA=function(){return!!n})()}function yK(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function vK(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(i=s.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}function bK(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function SK(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XC(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function xK(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?XC(Object(t),!0).forEach(function(i){ob(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):XC(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function TK(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return mK(n)}function EE(n,e){return EE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},EE(n,e)}function nm(n,e){return fK(n)||vK(n,e)||dB(n,e)||bK()}function EK(n,e){for(;!{}.hasOwnProperty.call(n,e)&&(n=Jd(n))!==null;);return n}function sx(n,e,t,i){var r=TE(Jd(n.prototype),e,t);return typeof r=="function"?function(s){return r.apply(t,s)}:r}function ta(n){return pK(n)||yK(n)||dB(n)||SK()}function MK(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function hB(n){var e=MK(n,"string");return typeof e=="symbol"?e:e+""}function ME(n){"@babel/helpers - typeof";return ME=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ME(n)}function dB(n,e){if(n){if(typeof n=="string")return xE(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?xE(n,e):void 0}}var fB=function(e){e instanceof Array?e.forEach(fB):(e.map&&e.map.dispose(),e.dispose())},pB=function(e){e.geometry&&e.geometry.dispose(),e.material&&fB(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(pB)},wE=function(e){for(;e.children.length;){var t=e.children[0];e.remove(t),pB(t)}},ax=new WeakMap,U_=new WeakMap,tp=function(n){function e(t){var i,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=r.dataBindAttr,a=s===void 0?"__data":s,o=r.objBindAttr,l=o===void 0?"__threeObj":o;return oB(this,e),i=aB(this,e),ob(i,"scene",void 0),jC(i,ax,void 0),jC(i,U_,void 0),i.scene=t,qC(ax,i,a),qC(U_,i,l),i.onRemoveObj(function(){}),i}return cB(e,n),uB(e,[{key:"onCreateObj",value:function(i){var r=this;return sx(e,"onCreateObj",this)([function(s){var a=i(s);return s[rx(U_,r)]=a,a[rx(ax,r)]=s,r.scene.add(a),a}]),this}},{key:"onRemoveObj",value:function(i){var r=this;return sx(e,"onRemoveObj",this)([function(s,a){var o=sx(e,"getData",r)([s]);i(s,a),r.scene.remove(s),wE(s),delete o[rx(U_,r)]}]),this}}])}(kY),np=function(e){return isNaN(e)?parseInt($e(e).toHex(),16):e},ox=function(e){return isNaN(e)?$e(e).getAlpha():1},wK=nB(VY);function YC(n,e,t){!e||typeof t!="string"||n.filter(function(i){return!i[t]}).forEach(function(i){i[t]=wK(e(i))})}function AK(n,e){var t=n.nodes,i=n.links,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=r.nodeFilter,a=s===void 0?function(){return!0}:s,o=r.onLoopError,l=o===void 0?function(f){throw"Invalid DAG structure! Found cycle in node path: ".concat(f.join(" -> "),".")}:o,u={};t.forEach(function(f){return u[e(f)]={data:f,out:[],depth:-1,skip:!a(f)}}),i.forEach(function(f){var m=f.source,_=f.target,g=b(m),p=b(_);if(!u.hasOwnProperty(g))throw"Missing source node with id: ".concat(g);if(!u.hasOwnProperty(p))throw"Missing target node with id: ".concat(p);var y=u[g],v=u[p];y.out.push(v);function b(S){return ME(S)==="object"?e(S):S}});var c=[];d(Object.values(u));var h=Object.assign.apply(Object,[{}].concat(ta(Object.entries(u).filter(function(f){var m=nm(f,2),_=m[1];return!_.skip}).map(function(f){var m=nm(f,2),_=m[0],g=m[1];return ob({},_,g.depth)}))));return h;function d(f){for(var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,g=function(){var b=f[p];if(m.indexOf(b)!==-1){var S=[].concat(ta(m.slice(m.indexOf(b))),[b]).map(function(x){return e(x.data)});return c.some(function(x){return x.length===S.length&&x.every(function(T,w){return T===S[w]})})||(c.push(S),l(S)),1}_>b.depth&&(b.depth=_,d(b.out,[].concat(ta(m),[b]),_+(b.skip?0:1)))},p=0,y=f.length;p<y;p++)g()}}var at=window.THREE?window.THREE:{Group:Fh,Mesh:mi,MeshLambertMaterial:uI,Color:Ve,BufferGeometry:Er,BufferAttribute:Wi,Matrix4:zt,Vector3:D,SphereGeometry:Ng,CylinderGeometry:Ag,TubeGeometry:eA,ConeGeometry:Qw,Line:c5,LineBasicMaterial:eb,QuadraticBezierCurve3:Jw,CubicBezierCurve3:oI,Box3:Cc},KC={graph:r7,forcelayout:k7},RK=2,lx=new at.BufferGeometry().setAttribute?"setAttribute":"addAttribute",O_=new at.BufferGeometry().applyMatrix4?"applyMatrix4":"applyMatrix",NK=sb({props:{jsonUrl:{onChange:function(e,t){var i=this;e&&!t.fetchingJson&&(t.fetchingJson=!0,t.onLoading(),fetch(e).then(function(r){return r.json()}).then(function(r){t.fetchingJson=!1,t.onFinishLoading(r),i.graphData(r)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,t){t.engineRunning=!1}},numDimensions:{default:3,onChange:function(e,t){var i=t.d3ForceLayout.force("charge");i&&i.strength(e>2?-60:-30),e<3&&r(t.graphData.nodes,"z"),e<2&&r(t.graphData.nodes,"y");function r(s,a){s.forEach(function(o){delete o[a],delete o["v".concat(a)]})}}},dagMode:{onChange:function(e,t){!e&&t.forceEngine==="d3"&&(t.graphData.nodes||[]).forEach(function(i){return i.fx=i.fy=i.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleOffset:{default:0,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},linkDirectionalParticleThreeObject:{},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.velocityDecay(e)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(e){return e._flushObjects=!0,e._rerender(),this},d3Force:function(e,t,i){return i===void 0?e.d3ForceLayout.force(t):(e.d3ForceLayout.force(t,i),this)},d3ReheatSimulation:function(e){return e.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},tickFrame:function(e){var t=e.forceEngine!=="ngraph";return e.engineRunning&&i(),r(),s(),this;function i(){++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||t&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.layout[t?"tick":"step"](),e.onEngineTick());var a=Bt(e.nodeThreeObjectExtend);e.nodeDataMapper.entries().forEach(function(d){var f=nm(d,2),m=f[0],_=f[1];if(_){var g=t?m:e.layout.getNodePosition(m[e.nodeId]),p=a(m);(!e.nodePositionUpdate||!e.nodePositionUpdate(p?_.children[0]:_,{x:g.x,y:g.y,z:g.z},m)||p)&&(_.position.x=g.x,_.position.y=g.y||0,_.position.z=g.z||0)}});var o=Bt(e.linkWidth),l=Bt(e.linkCurvature),u=Bt(e.linkCurveRotation),c=Bt(e.linkThreeObjectExtend);e.linkDataMapper.entries().forEach(function(d){var f=nm(d,2),m=f[0],_=f[1];if(_){var g=t?m:e.layout.getLinkPosition(e.layout.graph.getLink(m.source,m.target).id),p=g[t?"source":"from"],y=g[t?"target":"to"];if(!(!p||!y||!p.hasOwnProperty("x")||!y.hasOwnProperty("x"))){h(m);var v=c(m);if(!(e.linkPositionUpdate&&e.linkPositionUpdate(v?_.children[1]:_,{start:{x:p.x,y:p.y,z:p.z},end:{x:y.x,y:y.y,z:y.z}},m)&&!v)){var b=30,S=m.__curve,x=_.children.length?_.children[0]:_;if(x.type==="Line"){if(S){var w=S.getPoints(b);x.geometry.getAttribute("position").array.length!==w.length*3&&x.geometry[lx]("position",new at.BufferAttribute(new Float32Array(w.length*3),3)),x.geometry.setFromPoints(w)}else{var T=x.geometry.getAttribute("position");(!T||!T.array||T.array.length!==6)&&x.geometry[lx]("position",T=new at.BufferAttribute(new Float32Array(2*3),3)),T.array[0]=p.x,T.array[1]=p.y||0,T.array[2]=p.z||0,T.array[3]=y.x,T.array[4]=y.y||0,T.array[5]=y.z||0,T.needsUpdate=!0}x.geometry.computeBoundingSphere()}else if(x.type==="Mesh")if(S){x.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(x.position.set(0,0,0),x.rotation.set(0,0,0),x.scale.set(1,1,1));var O=Math.ceil(o(m)*10)/10,C=O/2,q=new at.TubeGeometry(S,b,C,e.linkResolution,!1);x.geometry.dispose(),x.geometry=q}else{if(!x.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var E=Math.ceil(o(m)*10)/10,M=E/2,N=new at.CylinderGeometry(M,M,1,e.linkResolution,1,!1);N[O_](new at.Matrix4().makeTranslation(0,1/2,0)),N[O_](new at.Matrix4().makeRotationX(Math.PI/2)),x.geometry.dispose(),x.geometry=N}var U=new at.Vector3(p.x,p.y||0,p.z||0),k=new at.Vector3(y.x,y.y||0,y.z||0),P=U.distanceTo(k);x.position.x=U.x,x.position.y=U.y,x.position.z=U.z,x.scale.z=P,x.parent.localToWorld(k),x.lookAt(k)}}}}});function h(d){var f=t?d:e.layout.getLinkPosition(e.layout.graph.getLink(d.source,d.target).id),m=f[t?"source":"from"],_=f[t?"target":"to"];if(!(!m||!_||!m.hasOwnProperty("x")||!_.hasOwnProperty("x"))){var g=l(d);if(!g)d.__curve=null;else{var p=new at.Vector3(m.x,m.y||0,m.z||0),y=new at.Vector3(_.x,_.y||0,_.z||0),v=p.distanceTo(y),b,S=u(d);if(v>0){var x=_.x-m.x,T=_.y-m.y||0,w=new at.Vector3().subVectors(y,p),E=w.clone().multiplyScalar(g).cross(x!==0||T!==0?new at.Vector3(0,0,1):new at.Vector3(0,1,0)).applyAxisAngle(w.normalize(),S).add(new at.Vector3().addVectors(p,y).divideScalar(2));b=new at.QuadraticBezierCurve3(p,E,y)}else{var M=g*70,N=-S,U=N+Math.PI/2;b=new at.CubicBezierCurve3(p,new at.Vector3(M*Math.cos(U),M*Math.sin(U),0).add(p),new at.Vector3(M*Math.cos(N),M*Math.sin(N),0).add(p),y)}d.__curve=b}}}}function r(){var a=Bt(e.linkDirectionalArrowRelPos),o=Bt(e.linkDirectionalArrowLength),l=Bt(e.nodeVal);e.arrowDataMapper.entries().forEach(function(u){var c=nm(u,2),h=c[0],d=c[1];if(d){var f=t?h:e.layout.getLinkPosition(e.layout.graph.getLink(h.source,h.target).id),m=f[t?"source":"from"],_=f[t?"target":"to"];if(!(!m||!_||!m.hasOwnProperty("x")||!_.hasOwnProperty("x"))){var g=Math.cbrt(Math.max(0,l(m)||1))*e.nodeRelSize,p=Math.cbrt(Math.max(0,l(_)||1))*e.nodeRelSize,y=o(h),v=a(h),b=h.__curve?function(M){return h.__curve.getPoint(M)}:function(M){var N=function(k,P,O,C){return P[k]+(O[k]-P[k])*C||0};return{x:N("x",m,_,M),y:N("y",m,_,M),z:N("z",m,_,M)}},S=h.__curve?h.__curve.getLength():Math.sqrt(["x","y","z"].map(function(M){return Math.pow((_[M]||0)-(m[M]||0),2)}).reduce(function(M,N){return M+N},0)),x=g+y+(S-g-p-y)*v,T=b(x/S),w=b((x-y)/S);["x","y","z"].forEach(function(M){return d.position[M]=w[M]});var E=lB(at.Vector3,ta(["x","y","z"].map(function(M){return T[M]})));d.parent.localToWorld(E),d.lookAt(E)}}})}function s(){var a=Bt(e.linkDirectionalParticleSpeed),o=Bt(e.linkDirectionalParticleOffset);e.graphData.links.forEach(function(l){var u=e.particlesDataMapper.getObj(l),c=u&&u.children,h=l.__singleHopPhotonsObj&&l.__singleHopPhotonsObj.children;if(!((!h||!h.length)&&(!c||!c.length))){var d=t?l:e.layout.getLinkPosition(e.layout.graph.getLink(l.source,l.target).id),f=d[t?"source":"from"],m=d[t?"target":"to"];if(!(!f||!m||!f.hasOwnProperty("x")||!m.hasOwnProperty("x"))){var _=a(l),g=Math.abs(o(l)),p=l.__curve?function(v){return l.__curve.getPoint(v)}:function(v){var b=function(x,T,w,E){return T[x]+(w[x]-T[x])*E||0};return{x:b("x",f,m,v),y:b("y",f,m,v),z:b("z",f,m,v)}},y=[].concat(ta(c||[]),ta(h||[]));y.forEach(function(v,b){var S=v.parent.__linkThreeObjType==="singleHopPhotons";if(v.hasOwnProperty("__progressRatio")||(v.__progressRatio=S?0:(b+g)/c.length),v.__progressRatio+=_,v.__progressRatio>=1)if(!S)v.__progressRatio=v.__progressRatio%1;else{v.parent.remove(v),wE(v);return}var x=v.__progressRatio,T=p(x);v.geometry.type!=="SphereGeometry"&&v.lookAt(T.x,T.y,T.z),["x","y","z"].forEach(function(w){return v.position[w]=T[w]})})}}})}},emitParticle:function(e,t){if(t&&e.graphData.links.includes(t)){if(!t.__singleHopPhotonsObj){var i=new at.Group;i.__linkThreeObjType="singleHopPhotons",t.__singleHopPhotonsObj=i,e.graphScene.add(i)}var r=Bt(e.linkDirectionalParticleThreeObject)(t);if(r&&e.linkDirectionalParticleThreeObject===r&&(r=r.clone()),!r){var s=Bt(e.linkDirectionalParticleWidth),a=Math.ceil(s(t)*10)/10/2,o=e.linkDirectionalParticleResolution,l=new at.SphereGeometry(a,o,o),u=Bt(e.linkColor),c=Bt(e.linkDirectionalParticleColor),h=c(t)||u(t)||"#f0f0f0",d=new at.Color(np(h)),f=e.linkOpacity*3,m=new at.MeshLambertMaterial({color:d,transparent:!0,opacity:f});r=new at.Mesh(l,m)}t.__singleHopPhotonsObj.add(r)}return this},getGraphBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};if(!e.initialised)return null;var i=function r(s){var a=[];if(s.geometry){s.geometry.computeBoundingBox();var o=new at.Box3;o.copy(s.geometry.boundingBox).applyMatrix4(s.matrixWorld),a.push(o)}return a.concat.apply(a,ta((s.children||[]).filter(function(l){return!l.hasOwnProperty("__graphObjType")||l.__graphObjType==="node"&&t(l.__data)}).map(r)))}(e.graphScene);return i.length?Object.assign.apply(Object,ta(["x","y","z"].map(function(r){return ob({},r,[EY(i,function(s){return s.min[r]}),TY(i,function(s){return s.max[r]})])}))):null}},stateInit:function(){return{d3ForceLayout:QX().force("link",IX()).force("charge",ZX()).force("center",Fq()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,t){t.graphScene=e,t.nodeDataMapper=new tp(e,{objBindAttr:"__threeObj"}),t.linkDataMapper=new tp(e,{objBindAttr:"__lineObj"}),t.arrowDataMapper=new tp(e,{objBindAttr:"__arrowObj"}),t.particlesDataMapper=new tp(e,{objBindAttr:"__photonsObj"})},update:function(e,t){var i=function(W){return W.some(function(K){return t.hasOwnProperty(K)})};if(e.engineRunning=!1,typeof e.onUpdate=="function"&&e.onUpdate(),e.nodeAutoColorBy!==null&&i(["nodeAutoColorBy","graphData","nodeColor"])&&YC(e.graphData.nodes,Bt(e.nodeAutoColorBy),e.nodeColor),e.linkAutoColorBy!==null&&i(["linkAutoColorBy","graphData","linkColor"])&&YC(e.graphData.links,Bt(e.linkAutoColorBy),e.linkColor),e._flushObjects||i(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var r=Bt(e.nodeThreeObject),s=Bt(e.nodeThreeObjectExtend),a=Bt(e.nodeVal),o=Bt(e.nodeColor),l=Bt(e.nodeVisibility),u={},c={};(e._flushObjects||i(["nodeThreeObject","nodeThreeObjectExtend"]))&&e.nodeDataMapper.clear(),e.nodeDataMapper.onCreateObj(function(ie){var W=r(ie),K=s(ie);W&&e.nodeThreeObject===W&&(W=W.clone());var _e;return W&&!K?_e=W:(_e=new at.Mesh,_e.__graphDefaultObj=!0,W&&K&&_e.add(W)),_e.__graphObjType="node",_e}).onUpdateObj(function(ie,W){if(ie.__graphDefaultObj){var K=a(W)||1,_e=Math.cbrt(K)*e.nodeRelSize,Pe=e.nodeResolution;(!ie.geometry.type.match(/^Sphere(Buffer)?Geometry$/)||ie.geometry.parameters.radius!==_e||ie.geometry.parameters.widthSegments!==Pe)&&(u.hasOwnProperty(K)||(u[K]=new at.SphereGeometry(_e,Pe,Pe)),ie.geometry.dispose(),ie.geometry=u[K]);var Me=o(W),We=new at.Color(np(Me||"#ffffaa")),Sn=e.nodeOpacity*ox(Me);(ie.material.type!=="MeshLambertMaterial"||!ie.material.color.equals(We)||ie.material.opacity!==Sn)&&(c.hasOwnProperty(Me)||(c[Me]=new at.MeshLambertMaterial({color:We,transparent:!0,opacity:Sn})),ie.material.dispose(),ie.material=c[Me])}}).digest(e.graphData.nodes.filter(l))}if(e._flushObjects||i(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","linkDirectionalParticleThreeObject"])){var h=Bt(e.linkThreeObject),d=Bt(e.linkThreeObjectExtend),f=Bt(e.linkMaterial),m=Bt(e.linkVisibility),_=Bt(e.linkColor),g=Bt(e.linkWidth),p={},y={},v={},b=e.graphData.links.filter(m);if((e._flushObjects||i(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&e.linkDataMapper.clear(),e.linkDataMapper.onRemoveObj(function(ie){var W=ie.__data&&ie.__data.__singleHopPhotonsObj;W&&(W.parent.remove(W),wE(W),delete ie.__data.__singleHopPhotonsObj)}).onCreateObj(function(ie){var W=h(ie),K=d(ie);W&&e.linkThreeObject===W&&(W=W.clone());var _e;if(!W||K){var Pe=!!g(ie);if(Pe)_e=new at.Mesh;else{var Me=new at.BufferGeometry;Me[lx]("position",new at.BufferAttribute(new Float32Array(2*3),3)),_e=new at.Line(Me)}}var We;return W?K?(We=new at.Group,We.__graphDefaultObj=!0,We.add(_e),We.add(W)):We=W:(We=_e,We.__graphDefaultObj=!0),We.renderOrder=10,We.__graphObjType="link",We}).onUpdateObj(function(ie,W){if(ie.__graphDefaultObj){var K=ie.children.length?ie.children[0]:ie,_e=Math.ceil(g(W)*10)/10,Pe=!!_e;if(Pe){var Me=_e/2,We=e.linkResolution;if(!K.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||K.geometry.parameters.radiusTop!==Me||K.geometry.parameters.radialSegments!==We){if(!p.hasOwnProperty(_e)){var Sn=new at.CylinderGeometry(Me,Me,1,We,1,!1);Sn[O_](new at.Matrix4().makeTranslation(0,1/2,0)),Sn[O_](new at.Matrix4().makeRotationX(Math.PI/2)),p[_e]=Sn}K.geometry.dispose(),K.geometry=p[_e]}}var I=f(W);if(I)K.material=I;else{var jt=_(W),pt=new at.Color(np(jt||"#f0f0f0")),Ye=e.linkOpacity*ox(jt),Le=Pe?"MeshLambertMaterial":"LineBasicMaterial";if(K.material.type!==Le||!K.material.color.equals(pt)||K.material.opacity!==Ye){var nn=Pe?y:v;nn.hasOwnProperty(jt)||(nn[jt]=new at[Le]({color:pt,transparent:Ye<1,opacity:Ye,depthWrite:Ye>=1})),K.material.dispose(),K.material=nn[jt]}}}}).digest(b),e.linkDirectionalArrowLength||t.hasOwnProperty("linkDirectionalArrowLength")){var S=Bt(e.linkDirectionalArrowLength),x=Bt(e.linkDirectionalArrowColor);e.arrowDataMapper.onCreateObj(function(){var ie=new at.Mesh(void 0,new at.MeshLambertMaterial({transparent:!0}));return ie.__linkThreeObjType="arrow",ie}).onUpdateObj(function(ie,W){var K=S(W),_e=e.linkDirectionalArrowResolution;if(!ie.geometry.type.match(/^Cone(Buffer)?Geometry$/)||ie.geometry.parameters.height!==K||ie.geometry.parameters.radialSegments!==_e){var Pe=new at.ConeGeometry(K*.25,K,_e);Pe.translate(0,K/2,0),Pe.rotateX(Math.PI/2),ie.geometry.dispose(),ie.geometry=Pe}var Me=x(W)||_(W)||"#f0f0f0";ie.material.color=new at.Color(np(Me)),ie.material.opacity=e.linkOpacity*3*ox(Me)}).digest(b.filter(S))}if(e.linkDirectionalParticles||t.hasOwnProperty("linkDirectionalParticles")){var T=Bt(e.linkDirectionalParticles),w=Bt(e.linkDirectionalParticleWidth),E=Bt(e.linkDirectionalParticleColor),M=Bt(e.linkDirectionalParticleThreeObject),N={},U={};e.particlesDataMapper.onCreateObj(function(){var ie=new at.Group;return ie.__linkThreeObjType="photons",ie.__photonDataMapper=new tp(ie),ie}).onUpdateObj(function(ie,W){var K=!!ie.children.length&&ie.children[0],_e=M(W),Pe,Me;if(_e)Pe=_e.geometry,Me=_e.material;else{var We=Math.ceil(w(W)*10)/10/2,Sn=e.linkDirectionalParticleResolution;K&&K.geometry.parameters.radius===We&&K.geometry.parameters.widthSegments===Sn?Pe=K.geometry:(U.hasOwnProperty(We)||(U[We]=new at.SphereGeometry(We,Sn,Sn)),Pe=U[We]);var I=E(W)||_(W)||"#f0f0f0",jt=new at.Color(np(I)),pt=e.linkOpacity*3;K&&K.material.color.equals(jt)&&K.material.opacity===pt?Me=K.material:(N.hasOwnProperty(I)||(N[I]=new at.MeshLambertMaterial({color:jt,transparent:!0,opacity:pt})),Me=N[I])}K&&(K.geometry!==Pe&&K.geometry.dispose(),K.material!==Me&&K.material.dispose());var Ye=Math.round(Math.abs(T(W)));ie.__photonDataMapper.id(function(Le){return Le.idx}).onCreateObj(function(){return new at.Mesh(Pe,Me)}).onUpdateObj(function(Le){Le.geometry=Pe,Le.material=Me}).digest(ta(new Array(Ye)).map(function(Le,nn){return{idx:nn}}))}).digest(b.filter(T))}}if(e._flushObjects=!1,i(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){e.engineRunning=!1,e.graphData.links.forEach(function(ie){ie.source=ie[e.linkSource],ie.target=ie[e.linkTarget]});var k=e.forceEngine!=="ngraph",P;if(k){(P=e.d3ForceLayout).stop().alpha(1).numDimensions(e.numDimensions).nodes(e.graphData.nodes);var O=e.d3ForceLayout.force("link");O&&O.id(function(ie){return ie[e.nodeId]}).links(e.graphData.links);var C=e.dagMode&&AK(e.graphData,function(ie){return ie[e.nodeId]},{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),q=Math.max.apply(Math,ta(Object.values(C||[]))),z=e.dagLevelDistance||e.graphData.nodes.length/(q||1)*RK*(["radialin","radialout"].indexOf(e.dagMode)!==-1?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var re=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(ie){return delete ie[re]})}if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var X=["rl","td","zout"].includes(e.dagMode),oe=function(W){return(C[W[e.nodeId]]-q/2)*z*(X?-1:1)},be=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(ie){return ie[be]=oe(ie)})}e.d3ForceLayout.force("dagRadial",["radialin","radialout"].indexOf(e.dagMode)!==-1?JX(function(ie){var W=C[ie[e.nodeId]]||-1;return(e.dagMode==="radialin"?q-W:W)*z}).strength(function(ie){return e.dagNodeFilter(ie)?1:0}):null)}else{var Oe=KC.graph();e.graphData.nodes.forEach(function(ie){Oe.addNode(ie[e.nodeId])}),e.graphData.links.forEach(function(ie){Oe.addLink(ie.source,ie.target)}),P=KC.forcelayout(Oe,xK({dimensions:e.numDimensions},e.ngraphPhysics)),P.graph=Oe}for(var st=0;st<e.warmupTicks&&!(k&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin);st++)P[k?"tick":"step"]();e.layout=P,this.resetCountdown()}e.engineRunning=!0,e.onFinishUpdate()}});function CK(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=function(r){function s(){var a;oB(this,s);for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];return a=aB(this,s,[].concat(l)),a.__kapsuleInstance=lB(n,[].concat(ta(t?[a]:[]),l)),a}return cB(s,r),uB(s)}(e);return Object.keys(n()).forEach(function(r){return i.prototype[r]=function(){var s,a=(s=this.__kapsuleInstance)[r].apply(s,arguments);return a===this.__kapsuleInstance?this:a}}),i}var DK=window.THREE?window.THREE:{Group:Fh},mB=CK(NK,DK.Group,!0);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const LK=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],ux=new WeakMap;class PK{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=LK,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:i,material:r,object:s}=e;if(t={material:this.getMaterialData(r),geometry:{id:i.id,attributes:this.getAttributesData(i.attributes),indexVersion:i.index?i.index.version:null,drawRange:{start:i.drawRange.start,count:i.drawRange.count}},worldMatrix:s.matrixWorld.clone()},s.center&&(t.center=s.center.clone()),s.morphTargetInfluences&&(t.morphTargetInfluences=s.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:a,height:o}=e.context;t.bufferWidth=a,t.bufferHeight=o}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const i in e){const r=e[i];t[i]={version:r.version}}return t}containsNode(e){const t=e.material;for(const i in t)if(t[i]&&t[i].isNode)return!0;return e.renderer.overrideNodes.modelViewMatrix!==null||e.renderer.overrideNodes.modelNormalViewMatrix!==null}getMaterialData(e){const t={};for(const i of this.refreshUniforms){const r=e[i];r!=null&&(typeof r=="object"&&r.clone!==void 0?r.isTexture===!0?t[i]={id:r.id,version:r.version}:t[i]=r.clone():t[i]=r)}return t}equals(e,t){const{object:i,material:r,geometry:s}=e,a=this.getRenderObjectData(e);if(a.worldMatrix.equals(i.matrixWorld)!==!0)return a.worldMatrix.copy(i.matrixWorld),!1;const o=a.material;for(const g in o){const p=o[g],y=r[g];if(p.equals!==void 0){if(p.equals(y)===!1)return p.copy(y),!1}else if(y.isTexture===!0){if(p.id!==y.id||p.version!==y.version)return p.id=y.id,p.version=y.version,!1}else if(p!==y)return o[g]=y,!1}if(o.transmission>0){const{width:g,height:p}=e.context;if(a.bufferWidth!==g||a.bufferHeight!==p)return a.bufferWidth=g,a.bufferHeight=p,!1}const l=a.geometry,u=s.attributes,c=l.attributes,h=Object.keys(c),d=Object.keys(u);if(l.id!==s.id)return l.id=s.id,!1;if(h.length!==d.length)return a.geometry.attributes=this.getAttributesData(u),!1;for(const g of h){const p=c[g],y=u[g];if(y===void 0)return delete c[g],!1;if(p.version!==y.version)return p.version=y.version,!1}const f=s.index,m=l.indexVersion,_=f?f.version:null;if(m!==_)return l.indexVersion=_,!1;if(l.drawRange.start!==s.drawRange.start||l.drawRange.count!==s.drawRange.count)return l.drawRange.start=s.drawRange.start,l.drawRange.count=s.drawRange.count,!1;if(a.morphTargetInfluences){let g=!1;for(let p=0;p<a.morphTargetInfluences.length;p++)a.morphTargetInfluences[p]!==i.morphTargetInfluences[p]&&(g=!0);if(g)return!0}if(a.lights){for(let g=0;g<t.length;g++)if(a.lights[g].map!==t[g].map)return!1}return a.center&&a.center.equals(i.center)===!1?(a.center.copy(i.center),!0):(e.bundle!==null&&(a.version=e.bundle.version),!0)}getLightsData(e){const t=[];for(const i of e)i.isSpotLight===!0&&i.map!==null&&t.push({map:i.map.version});return t}getLights(e,t){if(ux.has(e)){const r=ux.get(e);if(r.renderId===t)return r.lightsData}const i=this.getLightsData(e.getLights());return ux.set(e,{renderId:t,lightsData:i}),i}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:i}=t;if(this.renderId!==i)return this.renderId=i,!0;const r=e.object.static===!0,s=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;if(r||s)return!1;const a=this.getLights(e.lightsNode,i);return this.equals(e,a)!==!0}}function zm(n,e=0){let t=3735928559^e,i=1103547991^e;if(n instanceof Array)for(let r=0,s;r<n.length;r++)s=n[r],t=Math.imul(t^s,2654435761),i=Math.imul(i^s,1597334677);else for(let r=0,s;r<n.length;r++)s=n.charCodeAt(r),t=Math.imul(t^s,2654435761),i=Math.imul(i^s,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&i)+(t>>>0)}const UK=n=>zm(n),gA=n=>zm(n),Ov=(...n)=>zm(n);function gB(n,e=!1){const t=[];n.isNode===!0&&t.push(n.id);for(const{property:i,childNode:r}of Iv(n))t.push(zm(i.slice(0,-4)),r.getCacheKey(e));return zm(t)}function*Iv(n,e=!1){for(const t of Object.getOwnPropertyNames(n)){if(t.startsWith("_")===!0)continue;const i=n[t];if(Array.isArray(i)===!0)for(let r=0;r<i.length;r++){const s=i[r];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:r,childNode:s})}else if(i&&i.isNode===!0)yield{property:t,childNode:i};else if(i&&Object.getPrototypeOf(i)===Object.prototype)for(const r in i){if(r.startsWith("_")===!0)continue;const s=i[r];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:r,childNode:s})}}}const OK=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),QC=new WeakMap;function IK(n){return OK.get(n)}function Bv(n){if(n==null)return null;const e=typeof n;return n.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix2===!0?"mat2":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function _A(n,...e){const t=n?n.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),n==="color"?new Ve(...e):t==="vec2"?new fe(...e):t==="vec3"?new D(...e):t==="vec4"?new Je(...e):t==="mat2"?new tb(...e):t==="mat3"?new vt(...e):t==="mat4"?new zt(...e):n==="bool"?e[0]||!1:n==="float"||n==="int"||n==="uint"?e[0]||0:n==="string"?e[0]||"":n==="ArrayBuffer"?FK(e[0]):null}function _B(n){let e=QC.get(n);return e===void 0&&(e={},QC.set(n,e)),e}function BK(n){let e="";const t=new Uint8Array(n);for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function FK(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer}const I_={VERTEX:"vertex"},Rt={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Ba={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},kK=["fragment","vertex"],ZC=["setup","analyze","generate"],JC=[...kK,"compute"],Rf=["x","y","z","w"],zK={analyze:"setup",generate:"analyze"};let GK=0;class ke extends sl{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=Rt.NONE,this.updateBeforeType=Rt.NONE,this.updateAfterType=Rt.NONE,this.uuid=Av.generateUUID(),this.version=0,this.global=!1,this.parents=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:GK++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,Rt.FRAME)}onRenderUpdate(e){return this.onUpdate(e,Rt.RENDER)}onObjectUpdate(e){return this.onUpdate(e,Rt.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of Iv(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=Ov(gB(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let i=0;for(const r of this.getChildren())t["node"+i++]=r;return t.outputNode||null}analyze(e,t=null){const i=e.increaseUsage(this);if(this.parents===!0){const r=e.getDataFromNode(this,"any");r.stages=r.stages||{},r.stages[e.shaderStage]=r.stages[e.shaderStage]||[],r.stages[e.shaderStage].push(t)}if(i===1){const r=e.getNodeProperties(this);for(const s of Object.values(r))s&&s.isNode===!0&&s.build(e,this)}}generate(e,t){const{outputNode:i}=e.getNodeProperties(this);if(i&&i.isNode===!0)return i.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const i=this.getShared(e);if(this!==i)return i.build(e,t);const r=e.getDataFromNode(this);r.buildStages=r.buildStages||{},r.buildStages[e.buildStage]=!0;const s=zK[e.buildStage];if(s&&r.buildStages[s]!==!0){const l=e.getBuildStage();e.setBuildStage(s),this.build(e),e.setBuildStage(l)}e.addNode(this),e.addChain(this);let a=null;const o=e.getBuildStage();if(o==="setup"){this.updateReference(e);const l=e.getNodeProperties(this);if(l.initialized!==!0){l.initialized=!0,l.outputNode=this.setup(e)||l.outputNode||null;for(const u of Object.values(l))if(u&&u.isNode===!0){if(u.parents===!0){const c=e.getNodeProperties(u);c.parents=c.parents||[],c.parents.push(this)}u.build(e)}}a=l.outputNode}else if(o==="analyze")this.analyze(e,t);else if(o==="generate"){if(this.generate.length===1){const u=this.getNodeType(e),c=e.getDataFromNode(this);a=c.snippet,a===void 0?c.generated===void 0?(c.generated=!0,a=this.generate(e)||"",c.snippet=a):(console.warn("THREE.Node: Recursion detected.",this),a="/* Recursion detected. */"):c.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),a=e.format(a,u,t)}else a=this.generate(e,t)||"";a===""&&t!==null&&t!=="void"&&t!=="OutputType"&&(console.error(`THREE.TSL: Invalid generated code, expected a "${t}".`),a=e.generateConst(t))}return e.removeChain(this),e.addSequentialNode(this),a}getSerializeChildren(){return Iv(this)}serialize(e){const t=this.getSerializeChildren(),i={};for(const{property:r,index:s,childNode:a}of t)s!==void 0?(i[r]===void 0&&(i[r]=Number.isInteger(s)?[]:{}),i[r][s]=a.toJSON(e.meta).uuid):i[r]=a.toJSON(e.meta).uuid;Object.keys(i).length>0&&(e.inputNodes=i)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const i in e.inputNodes)if(Array.isArray(e.inputNodes[i])){const r=[];for(const s of e.inputNodes[i])r.push(t[s]);this[i]=r}else if(typeof e.inputNodes[i]=="object"){const r={};for(const s in e.inputNodes[i]){const a=e.inputNodes[i][s];r[s]=t[a]}this[i]=r}else{const r=e.inputNodes[i];this[i]=t[r]}}}toJSON(e){const{uuid:t,type:i}=this,r=e===void 0||typeof e=="string";r&&(e={textures:{},images:{},nodes:{}});let s=e.nodes[t];s===void 0&&(s={uuid:t,type:i,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},r!==!0&&(e.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function a(o){const l=[];for(const u in o){const c=o[u];delete c.metadata,l.push(c)}return l}if(r){const o=a(e.textures),l=a(e.images),u=a(e.nodes);o.length>0&&(s.textures=o),l.length>0&&(s.images=l),u.length>0&&(s.nodes=u)}return s}}class Lg extends ke{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.indexNode.getNodeType(e),i=this.node.build(e),r=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${i}[ ${r} ]`}}class yB extends ke{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let i=null;for(const r of this.convertTo.split("|"))(i===null||e.getTypeLength(t)===e.getTypeLength(r))&&(i=r);return i}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const i=this.node,r=this.getNodeType(e),s=i.build(e,r);return e.format(s,r,t)}}class Ci extends ke{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const r=e.getVectorType(this.getNodeType(e,t)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,r,t);if(r!=="void"&&t!=="void"&&this.hasDependencies(e)){const a=super.build(e,r),o=e.getVarFromNode(this,null,r),l=e.getPropertyName(o);return e.addLineFlowCode(`${l} = ${a}`,this),s.snippet=a,s.propertyName=l,e.format(s.propertyName,r,t)}}return super.build(e,t)}}class VK extends Ci{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,i)=>t+e.getTypeLength(i.getNodeType(e)),0))}generate(e,t){const i=this.getNodeType(e),r=e.getTypeLength(i),s=this.nodes,a=e.getComponentType(i),o=[];let l=0;for(const c of s){if(l>=r){console.error(`THREE.TSL: Length of parameters exceeds maximum length of function '${i}()' type.`);break}let h=c.getNodeType(e),d=e.getTypeLength(h),f;if(l+d>r&&(console.error(`THREE.TSL: Length of '${i}()' data exceeds maximum length of output type.`),d=r-l,h=e.getTypeFromLength(d)),l+=d,f=c.build(e,h),e.getComponentType(h)!==a){const _=e.getTypeFromLength(d,a);f=e.format(f,h,_)}o.push(f)}const u=`${e.getType(i)}( ${o.join(", ")} )`;return e.format(u,i,t)}}const HK=Rf.join("");class $K extends ke{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Rf.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const i=this.node,r=e.getTypeLength(i.getNodeType(e));let s=null;if(r>1){let a=null;this.getVectorLength()>=r&&(a=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const l=i.build(e,a);this.components.length===r&&this.components===HK.slice(0,this.components.length)?s=e.format(l,a,t):s=e.format(`${l}.${this.components}`,this.getNodeType(e),t)}else s=i.build(e,t);return s}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class WK extends Ci{static get type(){return"SetNode"}constructor(e,t,i){super(),this.sourceNode=e,this.components=t,this.targetNode=i}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:i,targetNode:r}=this,s=this.getNodeType(e),a=e.getComponentType(r.getNodeType(e)),o=e.getTypeFromLength(i.length,a),l=r.build(e,o),u=t.build(e,s),c=e.getTypeLength(s),h=[];for(let d=0;d<c;d++){const f=Rf[d];f===i[0]?(h.push(l),d+=i.length-1):h.push(u+"."+f)}return`${e.getType(s)}( ${h.join(", ")} )`}}class jK extends Ci{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:i}=this,r=this.getNodeType(e),s=i.build(e),a=e.getVarFromNode(this),o=e.getPropertyName(a);e.addLineFlowCode(o+" = "+s,this);const l=e.getTypeLength(r),u=[];let c=0;for(let h=0;h<l;h++){const d=Rf[h];d===t[c]?(u.push("1.0 - "+(o+"."+d)),c++):u.push(o+"."+d)}return`${e.getType(r)}( ${u.join(", ")} )`}}class yA extends ke{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?Bv(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=Bv(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=BK(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?_A(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}const eD=/float|u?int/;class ro extends yA{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const i=this.getNodeType(e);return eD.test(i)&&eD.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),i,t)}}class qK extends ke{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!=="void"}getNodeType(e){return this.hasMember(e)===!1?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return"float";const i=this.getNodeType(e);return e.getStructTypeNode(i).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){console.warn(`THREE.TSL: Member "${this.property}" does not exist in struct.`);const i=this.getNodeType(e);return e.generateConst(i)}return this.structNode.build(e)+"."+this.property}}let bc=null;const AE=new Map;function J(n,e){if(AE.has(n)){console.warn(`THREE.TSL: Redefinition of method chaining '${n}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${n} is not a function`);AE.set(n,e),n!=="assign"&&(ke.prototype[n]=function(...t){return this.isStackNode?this.add(e(...t)):e(this,...t)},ke.prototype[n+"Assign"]=function(...t){return this.isStackNode?this.assign(t[0],e(...t)):this.assign(e(this,...t))})}const XK=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),tD=n=>XK(n).split("").sort().join("");ke.prototype.assign=function(...n){if(this.isStackNode!==!0)return bc!==null?bc.assign(this,...n):console.error("THREE.TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{const e=AE.get("assign");return this.add(e(...n))}};ke.prototype.toVarIntent=function(){return this};ke.prototype.get=function(n){return new qK(this,n)};const im={};function B_(n,e,t){im[n]=im[e]=im[t]={get(){this._cache=this._cache||{};let a=this._cache[n];return a===void 0&&(a=new $K(this,n),this._cache[n]=a),a},set(a){this[n].assign(de(a))}};const i=n.toUpperCase(),r=e.toUpperCase(),s=t.toUpperCase();ke.prototype["set"+i]=ke.prototype["set"+r]=ke.prototype["set"+s]=function(a){const o=tD(n);return new WK(this,o,de(a))},ke.prototype["flip"+i]=ke.prototype["flip"+r]=ke.prototype["flip"+s]=function(){const a=tD(n);return new jK(this,a)}}const ba=["x","y","z","w"],Sa=["r","g","b","a"],xa=["s","t","p","q"];for(let n=0;n<4;n++){let e=ba[n],t=Sa[n],i=xa[n];B_(e,t,i);for(let r=0;r<4;r++){e=ba[n]+ba[r],t=Sa[n]+Sa[r],i=xa[n]+xa[r],B_(e,t,i);for(let s=0;s<4;s++){e=ba[n]+ba[r]+ba[s],t=Sa[n]+Sa[r]+Sa[s],i=xa[n]+xa[r]+xa[s],B_(e,t,i);for(let a=0;a<4;a++)e=ba[n]+ba[r]+ba[s]+ba[a],t=Sa[n]+Sa[r]+Sa[s]+Sa[a],i=xa[n]+xa[r]+xa[s]+xa[a],B_(e,t,i)}}}for(let n=0;n<32;n++)im[n]={get(){this._cache=this._cache||{};let e=this._cache[n];return e===void 0&&(e=new Lg(this,new ro(n,"uint")),this._cache[n]=e),e},set(e){this[n].assign(de(e))}};Object.defineProperties(ke.prototype,im);const nD=new WeakMap,YK=function(n,e=null){const t=Bv(n);return t==="node"?n:e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string"?de(RE(n,e)):t==="shader"?n.isFn?n:ue(n):n},KK=function(n,e=null){for(const t in n)n[t]=de(n[t],e);return n},QK=function(n,e=null){const t=n.length;for(let i=0;i<t;i++)n[i]=de(n[i],e);return n},vB=function(n,e=null,t=null,i=null){function r(c){return i!==null?(c=de(Object.assign(c,i)),i.intent===!0&&(c=c.toVarIntent())):c=de(c),c}let s,a=e,o,l;function u(c){let h;return a?h=/[a-z]/i.test(a)?a+"()":a:h=n.type,o!==void 0&&c.length<o?(console.error(`THREE.TSL: "${h}" parameter length is less than minimum required.`),c.concat(new Array(o-c.length).fill(0))):l!==void 0&&c.length>l?(console.error(`THREE.TSL: "${h}" parameter length exceeds limit.`),c.slice(0,l)):c}return e===null?s=(...c)=>r(new n(...id(u(c)))):t!==null?(t=de(t),s=(...c)=>r(new n(e,...id(u(c)),t))):s=(...c)=>r(new n(e,...id(u(c)))),s.setParameterLength=(...c)=>(c.length===1?o=l=c[0]:c.length===2&&([o,l]=c),s),s.setName=c=>(a=c,s),s},ZK=function(n,...e){return de(new n(...id(e)))};class JK extends ke{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:i}=this,r=e.getNodeProperties(t),s=e.getClosestSubBuild(t.subBuilds)||"",a=s||"default";if(r[a])return r[a];const o=e.subBuildFn;e.subBuildFn=s;let l=null;if(t.layout){let u=nD.get(e.constructor);u===void 0&&(u=new WeakMap,nD.set(e.constructor,u));let c=u.get(t);c===void 0&&(c=de(e.buildFunctionNode(t)),u.set(t,c)),e.addInclude(c);const h=i?eQ(i):null;l=de(c.call(h))}else{const u=new Proxy(e,{get:(m,_,g)=>{let p;return Symbol.iterator===_?p=function*(){yield void 0}:p=Reflect.get(m,_,g),p}}),c=i?tQ(i):null,h=Array.isArray(i)?i.length>0:i!==null,d=t.jsFunc,f=h||d.length>1?d(c,u):d(u);l=de(f)}return e.subBuildFn=o,t.once&&(r[a]=l),l}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),i=e.getSubBuildOutput(this);return t[i]=t[i]||this.setupOutput(e),t[i].subBuild=e.getClosestSubBuild(this),t[i]}build(e,t=null){let i=null;const r=e.getBuildStage(),s=e.getNodeProperties(this),a=e.getSubBuildOutput(this),o=this.getOutputNode(e);if(r==="setup"){const l=e.getSubBuildProperty("initialized",this);if(s[l]!==!0&&(s[l]=!0,s[a]=this.getOutputNode(e),s[a].build(e),this.shaderNode.subBuilds))for(const u of e.chaining){const c=e.getDataFromNode(u,"any");c.subBuilds=c.subBuilds||new Set;for(const h of this.shaderNode.subBuilds)c.subBuilds.add(h)}i=s[a]}else r==="analyze"?o.build(e,t):r==="generate"&&(i=o.build(e,t)||"");return i}}function eQ(n){let e;return xA(n),n[0]&&(n[0].isNode||Object.getPrototypeOf(n[0])!==Object.prototype)?e=[...n]:e=n[0],e}function tQ(n){let e=0;return xA(n),new Proxy(n,{get:(t,i,r)=>{let s;if(i==="length")return s=n.length,s;if(Symbol.iterator===i)s=function*(){for(const a of n)yield de(a)};else{if(n.length>0)if(Object.getPrototypeOf(n[0])===Object.prototype){const a=n[0];a[i]===void 0?s=a[e++]:s=Reflect.get(a,i,r)}else n[0]instanceof ke&&(n[i]===void 0?s=n[e++]:s=Reflect.get(n,i,r));else s=Reflect.get(t,i,r);s=de(s)}return s}})}class nQ extends ke{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(e=null){return de(new JK(this,e))}setup(){return this.call()}}const iQ=[!1,!0],rQ=[0,1,2,3],sQ=[-1,-2],bB=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],vA=new Map;for(const n of iQ)vA.set(n,new ro(n));const bA=new Map;for(const n of rQ)bA.set(n,new ro(n,"uint"));const SA=new Map([...bA].map(n=>new ro(n.value,"int")));for(const n of sQ)SA.set(n,new ro(n,"int"));const lb=new Map([...SA].map(n=>new ro(n.value)));for(const n of bB)lb.set(n,new ro(n));for(const n of bB)lb.set(-n,new ro(-n));const ub={bool:vA,uint:bA,ints:SA,float:lb},iD=new Map([...vA,...lb]),RE=(n,e)=>iD.has(n)?iD.get(n):n.isNode===!0?n:new ro(n,e),bi=function(n,e=null){return(...t)=>{for(const r of t)if(r===void 0)return console.error(`THREE.TSL: Invalid parameter for the type "${n}".`),de(new ro(0,n));if((t.length===0||!["bool","float","int","uint"].includes(n)&&t.every(r=>{const s=typeof r;return s!=="object"&&s!=="function"}))&&(t=[_A(n,...t)]),t.length===1&&e!==null&&e.has(t[0]))return F_(e.get(t[0]));if(t.length===1){const r=RE(t[0],n);return r.nodeType===n?F_(r):F_(new yB(r,n))}const i=t.map(r=>RE(r));return F_(new VK(i,n))}},rD=n=>typeof n=="object"&&n!==null?n.value:n,aQ=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function Mp(n,e){return new nQ(n,e)}const de=(n,e=null)=>YK(n,e),F_=(n,e=null)=>de(n,e).toVarIntent(),xA=(n,e=null)=>new KK(n,e),id=(n,e=null)=>new QK(n,e),Xt=(n,e=null,t=null,i=null)=>new vB(n,e,t,i),Se=(n,...e)=>new ZK(n,...e),De=(n,e=null,t=null,i={})=>new vB(n,e,t,{intent:!0,...i});let oQ=0;class lQ extends ke{constructor(e,t=null){super();let i=null;t!==null&&(typeof t=="object"?i=t.return:(typeof t=="string"?i=t:console.error("THREE.TSL: Invalid layout type."),t=null)),this.shaderNode=new Mp(e,i),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if(typeof e.inputs!="object"){const i={name:"fn"+oQ++,type:t,inputs:[]};for(const r in e)r!=="return"&&i.inputs.push({name:r,type:e[r]});e=i}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return this.shaderNode.nodeType==="void"&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return console.error('THREE.TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),e.generateConst(t)}}function ue(n,e=null){const t=new lQ(n,e);return new Proxy(()=>{},{apply(i,r,s){return t.call(...s)},get(i,r,s){return Reflect.get(t,r,s)},set(i,r,s,a){return Reflect.set(t,r,s,a)}})}const Fv=n=>{bc=n},TA=()=>bc,ri=(...n)=>bc.If(...n);function SB(n){return bc&&bc.add(n),n}J("toStack",SB);const uQ=new bi("color"),te=new bi("float",ub.float),Dn=new bi("int",ub.ints),cQ=new bi("uint",ub.uint),EA=new bi("bool",ub.bool),xe=new bi("vec2"),Mo=new bi("ivec2"),hQ=new bi("uvec2"),dQ=new bi("bvec2"),ae=new bi("vec3"),fQ=new bi("ivec3"),pQ=new bi("uvec3"),mQ=new bi("bvec3"),St=new bi("vec4"),gQ=new bi("ivec4"),_Q=new bi("uvec4"),yQ=new bi("bvec4"),MA=new bi("mat2"),xr=new bi("mat3"),rd=new bi("mat4");J("toColor",uQ);J("toFloat",te);J("toInt",Dn);J("toUint",cQ);J("toBool",EA);J("toVec2",xe);J("toIVec2",Mo);J("toUVec2",hQ);J("toBVec2",dQ);J("toVec3",ae);J("toIVec3",fQ);J("toUVec3",pQ);J("toBVec3",mQ);J("toVec4",St);J("toIVec4",gQ);J("toUVec4",_Q);J("toBVec4",yQ);J("toMat2",MA);J("toMat3",xr);J("toMat4",rd);const vQ=Xt(Lg).setParameterLength(2),bQ=(n,e)=>de(new yB(de(n),e));J("element",vQ);J("convert",bQ);J("append",n=>(console.warn("THREE.TSL: .append() has been renamed to .toStack()."),SB(n)));class on extends ke{static get type(){return"PropertyNode"}constructor(e,t=null,i=!1){super(e),this.name=t,this.varying=i,this.isPropertyNode=!0,this.global=!0}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Jl=(n,e)=>de(new on(n,e)),kv=(n,e)=>de(new on(n,e,!0)),Kt=Se(on,"vec4","DiffuseColor"),sD=Se(on,"vec3","EmissiveColor"),Co=Se(on,"float","Roughness"),zv=Se(on,"float","Metalness"),NE=Se(on,"float","Clearcoat"),Gv=Se(on,"float","ClearcoatRoughness"),zh=Se(on,"vec3","Sheen"),wA=Se(on,"float","SheenRoughness"),AA=Se(on,"float","Iridescence"),xB=Se(on,"float","IridescenceIOR"),TB=Se(on,"float","IridescenceThickness"),CE=Se(on,"float","AlphaT"),Vu=Se(on,"float","Anisotropy"),Cy=Se(on,"vec3","AnisotropyT"),sd=Se(on,"vec3","AnisotropyB"),ss=Se(on,"color","SpecularColor"),Vv=Se(on,"float","SpecularF90"),DE=Se(on,"float","Shininess"),rm=Se(on,"vec4","Output"),cx=Se(on,"float","dashSize"),aD=Se(on,"float","gapSize"),Dy=Se(on,"float","IOR"),LE=Se(on,"float","Transmission"),EB=Se(on,"float","Thickness"),MB=Se(on,"float","AttenuationDistance"),wB=Se(on,"color","AttenuationColor"),AB=Se(on,"float","Dispersion");class RB extends ke{static get type(){return"UniformGroupNode"}constructor(e,t=!1,i=1){super("string"),this.name=e,this.shared=t,this.order=i,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const SQ=n=>new RB(n),RA=(n,e=0)=>new RB(n,!0,e),xQ=RA("frame"),Ke=RA("render"),NB=SQ("object");class Pg extends yA{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=NB}setName(e){return this.name=e,this}label(e){return console.warn('THREE.TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(i=>{const r=e(i,this);r!==void 0&&(this.value=r)},t)}getInputType(e){let t=super.getInputType(e);return t==="bool"&&(t="uint"),t}generate(e,t){const i=this.getNodeType(e),r=this.getUniformHash(e);let s=e.getNodeFromHash(r);s===void 0&&(e.setHashNode(this,r),s=this);const a=s.getInputType(e),o=e.getUniformFromNode(s,a,e.shaderStage,this.name||e.context.nodeName),l=e.getPropertyName(o);e.context.nodeName!==void 0&&delete e.context.nodeName;let u=l;if(i==="bool"){const c=e.getDataFromNode(this);let h=c.propertyName;if(h===void 0){const d=e.getVarFromNode(this,null,"bool");h=e.getPropertyName(d),c.propertyName=h,u=e.format(l,a,i),e.addLineFlowCode(`${h} = ${u}`,this)}u=h}return e.format(u,i,t)}}const lt=(n,e)=>{const t=aQ(e||n);return t===n&&(n=_A(t)),n=n&&n.isNode===!0?n.node&&n.node.value||n.value:n,de(new Pg(n,t))};class oD extends Ci{static get type(){return"ArrayNode"}constructor(e,t,i=null){super(e),this.count=t,this.values=i,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const TQ=(...n)=>{let e;if(n.length===1){const t=n[0];e=new oD(null,t.length,t)}else{const t=n[0],i=n[1];e=new oD(t,i)}return de(e)};J("toArray",(n,e)=>TQ(Array(e).fill(n)));class EQ extends Ci{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const i=e.getTypeLength(t.node.getNodeType(e));return Rf.join("").slice(0,i)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:i}=this,r=t.getScope(),s=e.getNodeProperties(r);s.assign=!0;const a=e.getNodeProperties(this);a.sourceNode=i,a.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:i,sourceNode:r}=e.getNodeProperties(this),s=this.needsSplitAssign(e),a=i.build(e),o=i.getNodeType(e),l=r.build(e,o),u=r.getNodeType(e),c=e.getDataFromNode(this);let h;if(c.initialized===!0)t!=="void"&&(h=a);else if(s){const d=e.getVarFromNode(this,null,o),f=e.getPropertyName(d);e.addLineFlowCode(`${f} = ${l}`,this);const m=i.node,g=m.node.context({assign:!0}).build(e);for(let p=0;p<m.components.length;p++){const y=m.components[p];e.addLineFlowCode(`${g}.${y} = ${f}[ ${p} ]`,this)}t!=="void"&&(h=a)}else h=`${a} = ${l}`,(t==="void"||u==="void")&&(e.addLineFlowCode(h,this),t!=="void"&&(h=a));return c.initialized=!0,e.format(h,o,t)}}const MQ=Xt(EQ).setParameterLength(2);J("assign",MQ);class wQ extends Ci{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],i=this.functionNode,r=i.getInputs(e),s=this.parameters,a=(l,u)=>{const c=u.type,h=c==="pointer";let d;return h?d="&"+l.build(e):d=l.build(e,c),d};if(Array.isArray(s)){if(s.length>r.length)console.error("THREE.TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),s.length=r.length;else if(s.length<r.length)for(console.error("THREE.TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");s.length<r.length;)s.push(te(0));for(let l=0;l<s.length;l++)t.push(a(s[l],r[l]))}else for(const l of r){const u=s[l.name];u!==void 0?t.push(a(u,l)):(console.error(`THREE.TSL: Input '${l.name}' not found in 'Fn()'.`),t.push(a(te(0),l)))}return`${i.build(e,"property")}( ${t.join(", ")} )`}}const AQ=(n,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?id(e):xA(e[0]),de(new wQ(de(n),e)));J("call",AQ);const RQ={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class Wn extends Ci{static get type(){return"OperatorNode"}constructor(e,t,i,...r){if(super(),r.length>0){let s=new Wn(e,t,i);for(let a=0;a<r.length-1;a++)s=new Wn(e,s,r[a]);t=s,i=r[r.length-1]}this.op=e,this.aNode=t,this.bNode=i,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(RQ[this.op],t)}getNodeType(e,t=null){const i=this.op,r=this.aNode,s=this.bNode,a=r.getNodeType(e),o=s?s.getNodeType(e):null;if(a==="void"||o==="void")return t||"void";if(i==="%")return a;if(i==="~"||i==="&"||i==="|"||i==="^"||i===">>"||i==="<<")return e.getIntegerType(a);if(i==="!"||i==="&&"||i==="||"||i==="^^")return"bool";if(i==="=="||i==="!="||i==="<"||i===">"||i==="<="||i===">="){const l=Math.max(e.getTypeLength(a),e.getTypeLength(o));return l>1?`bvec${l}`:"bool"}else{if(e.isMatrix(a)){if(o==="float")return a;if(e.isVector(o))return e.getVectorFromMatrix(a);if(e.isMatrix(o))return a}else if(e.isMatrix(o)){if(a==="float")return o;if(e.isVector(a))return e.getVectorFromMatrix(o)}return e.getTypeLength(o)>e.getTypeLength(a)?o:a}}generate(e,t){const i=this.op,{aNode:r,bNode:s}=this,a=this.getNodeType(e,t);let o=null,l=null;a!=="void"?(o=r.getNodeType(e),l=s?s.getNodeType(e):null,i==="<"||i===">"||i==="<="||i===">="||i==="=="||i==="!="?e.isVector(o)?l=o:e.isVector(l)?o=l:o!==l&&(o=l="float"):i===">>"||i==="<<"?(o=a,l=e.changeComponentType(l,"uint")):i==="%"?(o=a,l=e.isInteger(o)&&e.isInteger(l)?l:o):e.isMatrix(o)?l==="float"?l="float":e.isVector(l)?l=e.getVectorFromMatrix(o):e.isMatrix(l)||(o=l=a):e.isMatrix(l)?o==="float"?o="float":e.isVector(o)?o=e.getVectorFromMatrix(l):o=l=a:o=l=a):o=l=a;const u=r.build(e,o),c=s?s.build(e,l):null,h=e.getFunctionOperator(i);if(t!=="void"){const d=e.renderer.coordinateSystem===br;if(i==="=="||i==="!="||i==="<"||i===">"||i==="<="||i===">=")return d?e.isVector(o)?e.format(`${this.getOperatorMethod(e,t)}( ${u}, ${c} )`,a,t):e.format(`( ${u} ${i} ${c} )`,a,t):e.format(`( ${u} ${i} ${c} )`,a,t);if(i==="%")return e.isInteger(l)?e.format(`( ${u} % ${c} )`,a,t):e.format(`${this.getOperatorMethod(e,a)}( ${u}, ${c} )`,a,t);if(i==="!"||i==="~")return e.format(`(${i}${u})`,o,t);if(h)return e.format(`${h}( ${u}, ${c} )`,a,t);if(e.isMatrix(o)&&l==="float")return e.format(`( ${c} ${i} ${u} )`,a,t);if(o==="float"&&e.isMatrix(l))return e.format(`${u} ${i} ${c}`,a,t);{let f=`( ${u} ${i} ${c} )`;return!d&&a==="bool"&&e.isVector(o)&&e.isVector(l)&&(f=`all${f}`),e.format(f,a,t)}}else if(o!=="void")return h?e.format(`${h}( ${u}, ${c} )`,a,t):e.isMatrix(o)&&l==="float"?e.format(`${c} ${i} ${u}`,a,t):e.format(`${u} ${i} ${c}`,a,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Hr=De(Wn,"+").setParameterLength(2,1/0).setName("add"),dr=De(Wn,"-").setParameterLength(2,1/0).setName("sub"),Nt=De(Wn,"*").setParameterLength(2,1/0).setName("mul"),Ya=De(Wn,"/").setParameterLength(2,1/0).setName("div"),NA=De(Wn,"%").setParameterLength(2).setName("mod"),CB=De(Wn,"==").setParameterLength(2).setName("equal"),NQ=De(Wn,"!=").setParameterLength(2).setName("notEqual"),CQ=De(Wn,"<").setParameterLength(2).setName("lessThan"),DQ=De(Wn,">").setParameterLength(2).setName("greaterThan"),LQ=De(Wn,"<=").setParameterLength(2).setName("lessThanEqual"),PQ=De(Wn,">=").setParameterLength(2).setName("greaterThanEqual"),UQ=De(Wn,"&&").setParameterLength(2,1/0).setName("and"),OQ=De(Wn,"||").setParameterLength(2,1/0).setName("or"),IQ=De(Wn,"!").setParameterLength(1).setName("not"),BQ=De(Wn,"^^").setParameterLength(2).setName("xor"),FQ=De(Wn,"&").setParameterLength(2).setName("bitAnd"),kQ=De(Wn,"~").setParameterLength(2).setName("bitNot"),zQ=De(Wn,"|").setParameterLength(2).setName("bitOr"),GQ=De(Wn,"^").setParameterLength(2).setName("bitXor"),VQ=De(Wn,"<<").setParameterLength(2).setName("shiftLeft"),HQ=De(Wn,">>").setParameterLength(2).setName("shiftRight"),$Q=ue(([n])=>(n.addAssign(1),n)),WQ=ue(([n])=>(n.subAssign(1),n)),jQ=ue(([n])=>{const e=Dn(n).toConst();return n.addAssign(1),e}),qQ=ue(([n])=>{const e=Dn(n).toConst();return n.subAssign(1),e});J("add",Hr);J("sub",dr);J("mul",Nt);J("div",Ya);J("mod",NA);J("equal",CB);J("notEqual",NQ);J("lessThan",CQ);J("greaterThan",DQ);J("lessThanEqual",LQ);J("greaterThanEqual",PQ);J("and",UQ);J("or",OQ);J("not",IQ);J("xor",BQ);J("bitAnd",FQ);J("bitNot",kQ);J("bitOr",zQ);J("bitXor",GQ);J("shiftLeft",VQ);J("shiftRight",HQ);J("incrementBefore",$Q);J("decrementBefore",WQ);J("increment",jQ);J("decrement",qQ);const XQ=(n,e)=>(console.warn('THREE.TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),NA(Dn(n),Dn(e)));J("modInt",XQ);class H extends Ci{static get type(){return"MathNode"}constructor(e,t,i=null,r=null){if(super(),(e===H.MAX||e===H.MIN)&&arguments.length>3){let s=new H(e,t,i);for(let a=2;a<arguments.length-1;a++)s=new H(e,s,arguments[a]);t=s,i=arguments[arguments.length-1],r=null}this.method=e,this.aNode=t,this.bNode=i,this.cNode=r,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),i=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),a=e.isMatrix(i)?0:e.getTypeLength(i),o=e.isMatrix(r)?0:e.getTypeLength(r);return s>a&&s>o?t:a>o?i:o>s?r:t}getNodeType(e){const t=this.method;return t===H.LENGTH||t===H.DISTANCE||t===H.DOT?"float":t===H.CROSS?"vec3":t===H.ALL||t===H.ANY?"bool":t===H.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:i,method:r}=this;let s=null;if(r===H.ONE_MINUS)s=dr(1,t);else if(r===H.RECIPROCAL)s=Ya(1,t);else if(r===H.DIFFERENCE)s=Ls(dr(t,i));else if(r===H.TRANSFORM_DIRECTION){let a=t,o=i;e.isMatrix(a.getNodeType(e))?o=St(ae(o),0):a=St(ae(a),0);const l=Nt(a,o).xyz;s=Vm(l)}return s!==null?s:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let r=this.method;const s=this.getNodeType(e),a=this.getInputType(e),o=this.aNode,l=this.bNode,u=this.cNode,c=e.renderer.coordinateSystem;if(r===H.NEGATE)return e.format("( - "+o.build(e,a)+" )",s,t);{const h=[];return r===H.CROSS?h.push(o.build(e,s),l.build(e,s)):c===br&&r===H.STEP?h.push(o.build(e,e.getTypeLength(o.getNodeType(e))===1?"float":a),l.build(e,a)):c===br&&(r===H.MIN||r===H.MAX)?h.push(o.build(e,a),l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":a)):r===H.REFRACT?h.push(o.build(e,a),l.build(e,a),u.build(e,"float")):r===H.MIX?h.push(o.build(e,a),l.build(e,a),u.build(e,e.getTypeLength(u.getNodeType(e))===1?"float":a)):(c===ru&&r===H.ATAN&&l!==null&&(r="atan2"),e.shaderStage!=="fragment"&&(r===H.DFDX||r===H.DFDY)&&(console.warn(`THREE.TSL: '${r}' is not supported in the ${e.shaderStage} stage.`),r="/*"+r+"*/"),h.push(o.build(e,a)),l!==null&&h.push(l.build(e,a)),u!==null&&h.push(u.build(e,a))),e.format(`${e.getMethod(r,s)}( ${h.join(", ")} )`,s,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}H.ALL="all";H.ANY="any";H.RADIANS="radians";H.DEGREES="degrees";H.EXP="exp";H.EXP2="exp2";H.LOG="log";H.LOG2="log2";H.SQRT="sqrt";H.INVERSE_SQRT="inversesqrt";H.FLOOR="floor";H.CEIL="ceil";H.NORMALIZE="normalize";H.FRACT="fract";H.SIN="sin";H.COS="cos";H.TAN="tan";H.ASIN="asin";H.ACOS="acos";H.ATAN="atan";H.ABS="abs";H.SIGN="sign";H.LENGTH="length";H.NEGATE="negate";H.ONE_MINUS="oneMinus";H.DFDX="dFdx";H.DFDY="dFdy";H.ROUND="round";H.RECIPROCAL="reciprocal";H.TRUNC="trunc";H.FWIDTH="fwidth";H.TRANSPOSE="transpose";H.DETERMINANT="determinant";H.INVERSE="inverse";H.EQUALS="equals";H.MIN="min";H.MAX="max";H.STEP="step";H.REFLECT="reflect";H.DISTANCE="distance";H.DIFFERENCE="difference";H.DOT="dot";H.CROSS="cross";H.POW="pow";H.TRANSFORM_DIRECTION="transformDirection";H.MIX="mix";H.CLAMP="clamp";H.REFRACT="refract";H.SMOOTHSTEP="smoothstep";H.FACEFORWARD="faceforward";const YQ=te(1e-6),KQ=te(Math.PI),QQ=De(H,H.ALL).setParameterLength(1),ZQ=De(H,H.ANY).setParameterLength(1),JQ=De(H,H.RADIANS).setParameterLength(1),eZ=De(H,H.DEGREES).setParameterLength(1),DB=De(H,H.EXP).setParameterLength(1),Gm=De(H,H.EXP2).setParameterLength(1),LB=De(H,H.LOG).setParameterLength(1),Xo=De(H,H.LOG2).setParameterLength(1),CA=De(H,H.SQRT).setParameterLength(1),tZ=De(H,H.INVERSE_SQRT).setParameterLength(1),oc=De(H,H.FLOOR).setParameterLength(1),DA=De(H,H.CEIL).setParameterLength(1),Vm=De(H,H.NORMALIZE).setParameterLength(1),mu=De(H,H.FRACT).setParameterLength(1),ra=De(H,H.SIN).setParameterLength(1),Al=De(H,H.COS).setParameterLength(1),nZ=De(H,H.TAN).setParameterLength(1),iZ=De(H,H.ASIN).setParameterLength(1),PB=De(H,H.ACOS).setParameterLength(1),UB=De(H,H.ATAN).setParameterLength(1,2),Ls=De(H,H.ABS).setParameterLength(1),Hv=De(H,H.SIGN).setParameterLength(1),Yo=De(H,H.LENGTH).setParameterLength(1),rZ=De(H,H.NEGATE).setParameterLength(1),sZ=De(H,H.ONE_MINUS).setParameterLength(1),OB=De(H,H.DFDX).setParameterLength(1),IB=De(H,H.DFDY).setParameterLength(1),aZ=De(H,H.ROUND).setParameterLength(1),oZ=De(H,H.RECIPROCAL).setParameterLength(1),lZ=De(H,H.TRUNC).setParameterLength(1),uZ=De(H,H.FWIDTH).setParameterLength(1),cZ=De(H,H.TRANSPOSE).setParameterLength(1),hZ=De(H,H.DETERMINANT).setParameterLength(1),dZ=De(H,H.INVERSE).setParameterLength(1),fZ=(n,e)=>(console.warn('THREE.TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),CB(n,e)),ef=De(H,H.MIN).setParameterLength(2,1/0),rr=De(H,H.MAX).setParameterLength(2,1/0),BB=De(H,H.STEP).setParameterLength(2),pZ=De(H,H.REFLECT).setParameterLength(2),mZ=De(H,H.DISTANCE).setParameterLength(2),gZ=De(H,H.DIFFERENCE).setParameterLength(2),LA=De(H,H.DOT).setParameterLength(2),FB=De(H,H.CROSS).setParameterLength(2),cb=De(H,H.POW).setParameterLength(2),kB=n=>Nt(n,n),_Z=n=>Nt(n,n,n),yZ=n=>Nt(n,n,n,n),vZ=De(H,H.TRANSFORM_DIRECTION).setParameterLength(2),bZ=n=>Nt(Hv(n),cb(Ls(n),1/3)),zB=n=>LA(n,n),On=De(H,H.MIX).setParameterLength(3),nl=(n,e=0,t=1)=>de(new H(H.CLAMP,de(n),de(e),de(t))),GB=n=>nl(n),VB=De(H,H.REFRACT).setParameterLength(3),au=De(H,H.SMOOTHSTEP).setParameterLength(3),SZ=De(H,H.FACEFORWARD).setParameterLength(3),xZ=ue(([n])=>{const i=43758.5453,r=LA(n.xy,xe(12.9898,78.233)),s=NA(r,KQ);return mu(ra(s).mul(i))}),TZ=(n,e,t)=>On(e,t,n),EZ=(n,e,t)=>au(e,t,n),MZ=(n,e)=>BB(e,n),wZ=(n,e)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),UB(n,e));J("all",QQ);J("any",ZQ);J("equals",fZ);J("radians",JQ);J("degrees",eZ);J("exp",DB);J("exp2",Gm);J("log",LB);J("log2",Xo);J("sqrt",CA);J("inverseSqrt",tZ);J("floor",oc);J("ceil",DA);J("normalize",Vm);J("fract",mu);J("sin",ra);J("cos",Al);J("tan",nZ);J("asin",iZ);J("acos",PB);J("atan",UB);J("abs",Ls);J("sign",Hv);J("length",Yo);J("lengthSq",zB);J("negate",rZ);J("oneMinus",sZ);J("dFdx",OB);J("dFdy",IB);J("round",aZ);J("reciprocal",oZ);J("trunc",lZ);J("fwidth",uZ);J("atan2",wZ);J("min",ef);J("max",rr);J("step",MZ);J("reflect",pZ);J("distance",mZ);J("dot",LA);J("cross",FB);J("pow",cb);J("pow2",kB);J("pow3",_Z);J("pow4",yZ);J("transformDirection",vZ);J("mix",TZ);J("clamp",nl);J("refract",VB);J("smoothstep",EZ);J("faceForward",SZ);J("difference",gZ);J("saturate",GB);J("cbrt",bZ);J("transpose",cZ);J("determinant",hZ);J("inverse",dZ);J("rand",xZ);class AZ extends ke{static get type(){return"ConditionalNode"}constructor(e,t,i=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=i}getNodeType(e){const{ifNode:t,elseNode:i}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const r=t.getNodeType(e);if(i!==null){const s=i.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(r))return s}return r}setup(e){const t=this.condNode.cache(),i=this.ifNode.cache(),r=this.elseNode?this.elseNode.cache():null,s=e.context.nodeBlock;e.getDataFromNode(i).parentNodeBlock=s,r!==null&&(e.getDataFromNode(r).parentNodeBlock=s);const a=e.context.uniformFlow,o=e.getNodeProperties(this);o.condNode=t,o.ifNode=a?i:i.context({nodeBlock:i}),o.elseNode=r?a?r:r.context({nodeBlock:r}):null}generate(e,t){const i=this.getNodeType(e),r=e.getDataFromNode(this);if(r.nodeProperty!==void 0)return r.nodeProperty;const{condNode:s,ifNode:a,elseNode:o}=e.getNodeProperties(this),l=e.currentFunctionNode,u=t!=="void",c=u?Jl(i).build(e):"";r.nodeProperty=c;const h=s.build(e,"bool");if(e.context.uniformFlow&&o!==null){const m=a.build(e,i),_=o.build(e,i),g=e.getTernary(h,m,_);return e.format(g,i,t)}e.addFlowCode(`
${e.tab}if ( ${h} ) {

`).addFlowTab();let f=a.build(e,i);if(f&&(u?f=c+" = "+f+";":(f="return "+f+";",l===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),f="// "+f))),e.removeFlowTab().addFlowCode(e.tab+"	"+f+`

`+e.tab+"}"),o!==null){e.addFlowCode(` else {

`).addFlowTab();let m=o.build(e,i);m&&(u?m=c+" = "+m+";":(m="return "+m+";",l===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),m="// "+m))),e.removeFlowTab().addFlowCode(e.tab+"	"+m+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(c,i,t)}}const Sr=Xt(AZ).setParameterLength(2,3);J("select",Sr);class HB extends ke{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.getContext();e.setContext({...e.context,...this.value}),this.node.build(e),e.setContext(t)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.value}),this.node.build(e),e.setContext(t)}generate(e,t){const i=e.getContext();e.setContext({...e.context,...this.value});const r=this.node.build(e,t);return e.setContext(i),r}}const hb=Xt(HB).setParameterLength(1,2),RZ=n=>hb(n,{uniformFlow:!0}),$B=(n,e)=>hb(n,{nodeName:e});function NZ(n,e){return console.warn('THREE.TSL: "label()" has been deprecated. Use "setName()" instead.'),$B(n,e)}J("context",hb);J("label",NZ);J("uniformFlow",RZ);J("setName",$B);class Ly extends ke{static get type(){return"VarNode"}constructor(e,t=null,i=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=i,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}build(...e){return this.intent===!0&&e[0].getNodeProperties(this).assign!==!0?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:i,readOnly:r}=this,{renderer:s}=e,a=s.backend.isWebGPUBackend===!0;let o=!1,l=!1;r&&(o=e.isDeterministic(t),l=a?r:o);const u=e.getVectorType(this.getNodeType(e)),c=t.build(e,u),h=e.getVarFromNode(this,i,u,void 0,l),d=e.getPropertyName(h);let f=d;if(l)if(a)f=o?`const ${d}`:`let ${d}`;else{const m=t.getArrayCount(e);f=`const ${e.getVar(h.type,d,m)}`}return e.addLineFlowCode(`${f} = ${c}`,this),d}}const PA=Xt(Ly),CZ=(n,e=null)=>PA(n,e).toStack(),DZ=(n,e=null)=>PA(n,e,!0).toStack(),LZ=n=>TA()===null?n:PA(n).setIntent(!0).toStack();J("toVar",CZ);J("toConst",DZ);J("toVarIntent",LZ);class PZ extends ke{static get type(){return"SubBuild"}constructor(e,t,i=null){super(i),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const i=this.node.build(e,...t);return e.removeSubBuild(),i}}const sm=(n,e,t=null)=>de(new PZ(de(n),e,t));class UZ extends ke{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let i=t.varying;if(i===void 0){const r=this.name,s=this.getNodeType(e),a=this.interpolationType,o=this.interpolationSampling;t.varying=i=e.getVaryingFromNode(this,r,s,a,o),t.node=sm(this.node,"VERTEX")}return i.needsInterpolation||(i.needsInterpolation=e.shaderStage==="fragment"),i}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(I_.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(I_.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),i=e.getNodeProperties(this),r=this.setupVarying(e);if(i[t]===void 0){const s=this.getNodeType(e),a=e.getPropertyName(r,I_.VERTEX);e.flowNodeFromShaderStage(I_.VERTEX,i.node,s,a),i[t]=a}return e.getPropertyName(r)}}const gu=Xt(UZ).setParameterLength(1,2),OZ=n=>gu(n);J("toVarying",gu);J("toVertexStage",OZ);J("varying",(...n)=>(console.warn("THREE.TSL: .varying() has been renamed to .toVarying()."),gu(...n)));J("vertexStage",(...n)=>(console.warn("THREE.TSL: .vertexStage() has been renamed to .toVertexStage()."),gu(...n)));const IZ=ue(([n])=>{const e=n.mul(.9478672986).add(.0521327014).pow(2.4),t=n.mul(.0773993808),i=n.lessThanEqual(.04045);return On(e,t,i)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),BZ=ue(([n])=>{const e=n.pow(.41666).mul(1.055).sub(.055),t=n.mul(12.92),i=n.lessThanEqual(.0031308);return On(e,t,i)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),UA="WorkingColorSpace",FZ="OutputColorSpace";class WB extends Ci{static get type(){return"ColorSpaceNode"}constructor(e,t,i){super("vec4"),this.colorNode=e,this.source=t,this.target=i}resolveColorSpace(e,t){return t===UA?Ze.workingColorSpace:t===FZ?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,i=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target);let s=t;return Ze.enabled===!1||i===r||!i||!r||(Ze.getTransfer(i)===Re&&(s=St(IZ(s.rgb),s.a)),Ze.getPrimaries(i)!==Ze.getPrimaries(r)&&(s=St(xr(Ze._getMatrix(new vt,i,r)).mul(s.rgb),s.a)),Ze.getTransfer(r)===Re&&(s=St(BZ(s.rgb),s.a))),s}}const kZ=(n,e)=>de(new WB(de(n),UA,e)),OA=(n,e)=>de(new WB(de(n),e,UA));J("workingToColorSpace",kZ);J("colorSpaceToWorking",OA);let zZ=class extends Lg{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),i=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,i,r)}};class jB extends ke{static get type(){return"ReferenceBaseNode"}constructor(e,t,i=null,r=null){super(),this.property=e,this.uniformType=t,this.object=i,this.count=r,this.properties=e.split("."),this.reference=i,this.node=null,this.group=null,this.updateType=Rt.OBJECT}setGroup(e){return this.group=e,this}element(e){return de(new zZ(this,de(e)))}setNodeType(e){const t=lt(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let i=e[t[0]];for(let r=1;r<t.length;r++)i=i[t[r]];return i}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const GZ=(n,e,t)=>de(new jB(n,e,t));class VZ extends jB{static get type(){return"RendererReferenceNode"}constructor(e,t,i=null){super(e,t,i),this.renderer=i,this.setGroup(Ke)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const HZ=(n,e,t=null)=>de(new VZ(n,e,t));class $Z extends Ci{static get type(){return"ToneMappingNode"}constructor(e,t=jZ,i=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=i}customCacheKey(){return Ov(this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,i=this.toneMapping;if(i===zr)return t;let r=null;const s=e.renderer.library.getToneMappingFunction(i);return s!==null?r=St(s(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",i),r=t),r}}const WZ=(n,e,t)=>de(new $Z(n,de(e),de(t))),jZ=HZ("toneMappingExposure","float");J("toneMapping",(n,e,t)=>WZ(e,t,n));class qZ extends yA{static get type(){return"BufferAttributeNode"}constructor(e,t=null,i=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=i,this.bufferOffset=r,this.usage=wv,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),i=this.value,r=e.getTypeLength(t),s=this.bufferStride||r,a=this.bufferOffset,o=i.isInterleavedBuffer===!0?i:new rI(i,s),l=new Yw(o,r,a);o.setUsage(this.usage),this.attribute=l,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),i=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(i);let s=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=r,s=r):s=gu(this).build(e,t),s}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const IA=(n,e=null,t=0,i=0)=>de(new qZ(n,e,t,i)),XZ=(n,e=null,t=0,i=0)=>IA(n,e,t,i).setUsage(Ih),lD=(n,e=null,t=0,i=0)=>IA(n,e,t,i).setInstanced(!0),uD=(n,e=null,t=0,i=0)=>XZ(n,e,t,i).setInstanced(!0);J("toAttribute",n=>IA(n.value));class YZ extends ke{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=Rt.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return console.warn('THREE.TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const i=e.getNodeProperties(this);i.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:i}=e;if(i==="compute"){const r=this.computeNode.build(e,"void");r!==""&&e.addLineFlowCode(r,this)}else{const s=e.getNodeProperties(this).outputComputeNode;if(s)return s.build(e,t)}}}const qB=(n,e=[64])=>{(e.length===0||e.length>3)&&console.error("THREE.TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let t=0;t<e.length;t++){const i=e[t];(typeof i!="number"||i<=0||!Number.isInteger(i))&&console.error(`THREE.TSL: compute() workgroupSize element at index [ ${t} ] must be a positive integer`)}for(;e.length<3;)e.push(1);return de(new YZ(de(n),e))},KZ=(n,e,t)=>qB(n,t).setCount(e);J("compute",KZ);J("computeKernel",qB);class QZ extends ke{static get type(){return"CacheNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){const t=e.getCache(),i=e.getCacheFromNode(this,this.parent);e.setCache(i);const r=this.node.getNodeType(e);return e.setCache(t),r}build(e,...t){const i=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const s=this.node.build(e,...t);return e.setCache(i),s}}const Py=(n,e)=>de(new QZ(de(n),e));J("cache",Py);class ZZ extends ke{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const JZ=Xt(ZZ).setParameterLength(2);J("bypass",JZ);class XB extends ke{static get type(){return"RemapNode"}constructor(e,t,i,r=te(0),s=te(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=i,this.outLowNode=r,this.outHighNode=s,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:i,outLowNode:r,outHighNode:s,doClamp:a}=this;let o=e.sub(t).div(i.sub(t));return a===!0&&(o=o.clamp()),o.mul(s.sub(r)).add(r)}}const eJ=Xt(XB,null,null,{doClamp:!1}).setParameterLength(3,5),tJ=Xt(XB).setParameterLength(3,5);J("remap",eJ);J("remapClamp",tJ);class Uy extends ke{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const i=this.getNodeType(e),r=this.snippet;if(i==="void")e.addLineFlowCode(r,this);else return e.format(r,i,t)}}const tf=Xt(Uy).setParameterLength(1,2),nJ=n=>(n?Sr(n,tf("discard")):tf("discard")).toStack();J("discard",nJ);class iJ extends Ci{static get type(){return"RenderOutputNode"}constructor(e,t,i){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=i,this.isRenderOutputNode=!0}setup({context:e}){let t=this.colorNode||e.color;const i=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||zr,r=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Or;return i!==zr&&(t=t.toneMapping(i)),r!==Or&&r!==Ze.workingColorSpace&&(t=t.workingToColorSpace(r)),t}}const rJ=(n,e=null,t=null)=>de(new iJ(de(n),e,t));J("renderOutput",rJ);class sJ extends Ci{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,i=this.node.build(e),r="--- TSL debug - "+e.shaderStage+" shader ---",s="-".repeat(r.length);let a="";return a+="// #"+r+`#
`,a+=e.flow.code.replace(/^\t/mg,"")+`
`,a+="/* ... */ "+i+` /* ... */
`,a+="// #"+s+`#
`,t!==null?t(e,a):console.log(a),i}}const aJ=(n,e=null)=>de(new sJ(de(n),e)).toStack();J("debug",aJ);class YB extends ke{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const i=this.getAttributeName(e);if(e.hasGeometryAttribute(i)){const r=e.geometry.getAttribute(i);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),i=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const s=e.geometry.getAttribute(t),a=e.getTypeFromAttribute(s),o=e.getAttribute(t,a);return e.shaderStage==="vertex"?e.format(o.name,a,i):gu(this).build(e,i)}else return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(i)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const ou=(n,e=null)=>de(new YB(n,e)),Ug=(n=0)=>ou("uv"+(n>0?n:""),"vec2");class oJ extends ke{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const i=this.textureNode.build(e,"property"),r=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${i}, ${r} )`,this.getNodeType(e),t)}}const ad=Xt(oJ).setParameterLength(1,2);class lJ extends Pg{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=Rt.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,i=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(i&&i.width!==void 0){const{width:r,height:s}=i;this.value=Math.log2(Math.max(r,s))}}}const uJ=Xt(lJ).setParameterLength(1),KB=new _i;class Nf extends Pg{static get type(){return"TextureNode"}constructor(e=KB,t=null,i=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=i,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Rt.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===wn?"uvec4":this.value.type===Oi?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Ug(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=lt(this.value.matrix)),this._matrixUniform.mul(ae(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?Rt.OBJECT:Rt.NONE,this}setupUV(e,t){const i=this.value;return e.isFlipY()&&(i.image instanceof ImageBitmap&&i.flipY===!0||i.isRenderTargetTexture===!0||i.isFramebufferTexture===!0||i.isDepthTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(Dn(ad(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const i=this.value;if(!i||i.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let r=this.uvNode;(r===null||e.context.forceUVContext===!0)&&e.context.getUV&&(r=e.context.getUV(this,e)),r||(r=this.getDefaultUV()),this.updateMatrix===!0&&(r=this.getTransformedUV(r)),r=this.setupUV(e,r);let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),t.uvNode=r,t.levelNode=s,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateOffset(e,t){return t.build(e,"ivec2")}generateSnippet(e,t,i,r,s,a,o,l,u){const c=this.value;let h;return r?h=e.generateTextureLevel(c,t,i,r,a,u):s?h=e.generateTextureBias(c,t,i,s,a,u):l?h=e.generateTextureGrad(c,t,i,l,a,u):o?h=e.generateTextureCompare(c,t,i,o,a,u):this.sampler===!1?h=e.generateTextureLoad(c,t,i,a,u):h=e.generateTexture(c,t,i,a,u),h}generate(e,t){const i=this.value,r=e.getNodeProperties(this),s=super.generate(e,"property");if(/^sampler/.test(t))return s+"_sampler";if(e.isReference(t))return s;{const a=e.getDataFromNode(this);let o=a.propertyName;if(o===void 0){const{uvNode:c,levelNode:h,biasNode:d,compareNode:f,depthNode:m,gradNode:_,offsetNode:g}=r,p=this.generateUV(e,c),y=h?h.build(e,"float"):null,v=d?d.build(e,"float"):null,b=m?m.build(e,"int"):null,S=f?f.build(e,"float"):null,x=_?[_[0].build(e,"vec2"),_[1].build(e,"vec2")]:null,T=g?this.generateOffset(e,g):null,w=e.getVarFromNode(this);o=e.getPropertyName(w);const E=this.generateSnippet(e,s,p,y,v,b,S,x,T);e.addLineFlowCode(`${o} = ${E}`,this),a.snippet=E,a.propertyName=o}let l=o;const u=this.getNodeType(e);return e.needsToWorkingColorSpace(i)&&(l=OA(tf(l,u),i.colorSpace).setup(e).build(e,u)),e.format(l,u,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=de(e),t.referenceNode=this.getBase(),de(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){const t=this.clone();t.biasNode=de(e).mul(uJ(t)),t.referenceNode=this.getBase();const i=t.value;return t.generateMipmaps===!1&&(i&&i.generateMipmaps===!1||i.minFilter===Ln||i.magFilter===Ln)&&(console.warn("THREE.TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),de(t)}level(e){const t=this.clone();return t.levelNode=de(e),t.referenceNode=this.getBase(),de(t)}size(e){return ad(this,e)}bias(e){const t=this.clone();return t.biasNode=de(e),t.referenceNode=this.getBase(),de(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){const t=this.clone();return t.compareNode=de(e),t.referenceNode=this.getBase(),de(t)}grad(e,t){const i=this.clone();return i.gradNode=[de(e),de(t)],i.referenceNode=this.getBase(),de(i)}depth(e){const t=this.clone();return t.depthNode=de(e),t.referenceNode=this.getBase(),de(t)}offset(e){const t=this.clone();return t.offsetNode=de(e),t.referenceNode=this.getBase(),de(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}const cJ=Xt(Nf).setParameterLength(1,4).setName("texture"),qt=(n=KB,e=null,t=null,i=null)=>{let r;return n&&n.isTextureNode===!0?(r=de(n.clone()),r.referenceNode=n.getBase(),e!==null&&(r.uvNode=de(e)),t!==null&&(r.levelNode=de(t)),i!==null&&(r.biasNode=de(i))):r=cJ(n,e,t,i),r},Js=(...n)=>qt(...n).setSampler(!1);class QB extends Pg{static get type(){return"BufferNode"}constructor(e,t,i=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=i}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const ZB=(n,e,t)=>de(new QB(n,e,t));class hJ extends Lg{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),i=this.getNodeType(),r=this.node.getPaddedType();return e.format(t,r,i)}}class dJ extends QB{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?Bv(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=Rt.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,i=this.elementType;if(i==="float"||i==="int"||i==="uint")for(let r=0;r<e.length;r++){const s=r*4;t[s]=e[r]}else if(i==="color")for(let r=0;r<e.length;r++){const s=r*4,a=e[r];t[s]=a.r,t[s+1]=a.g,t[s+2]=a.b||0}else if(i==="mat2")for(let r=0;r<e.length;r++){const s=r*4,a=e[r];t[s]=a.elements[0],t[s+1]=a.elements[1],t[s+2]=a.elements[2],t[s+3]=a.elements[3]}else if(i==="mat3")for(let r=0;r<e.length;r++){const s=r*16,a=e[r];t[s]=a.elements[0],t[s+1]=a.elements[1],t[s+2]=a.elements[2],t[s+4]=a.elements[3],t[s+5]=a.elements[4],t[s+6]=a.elements[5],t[s+8]=a.elements[6],t[s+9]=a.elements[7],t[s+10]=a.elements[8],t[s+15]=1}else if(i==="mat4")for(let r=0;r<e.length;r++){const s=r*16,a=e[r];for(let o=0;o<a.elements.length;o++)t[s+o]=a.elements[o]}else for(let r=0;r<e.length;r++){const s=r*4,a=e[r];t[s]=a.x,t[s+1]=a.y,t[s+2]=a.z||0,t[s+3]=a.w||0}}setup(e){const t=this.array.length,i=this.elementType;let r=Float32Array;const s=this.paddedType,a=e.getTypeLength(s);return i.charAt(0)==="i"&&(r=Int32Array),i.charAt(0)==="u"&&(r=Uint32Array),this.value=new r(t*a),this.bufferCount=t,this.bufferType=s,super.setup(e)}element(e){return de(new hJ(this,de(e)))}}const aa=(n,e)=>de(new dJ(n,e));class fJ extends ke{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const Og=Xt(fJ).setParameterLength(1);let ip,rp;class Tn extends ke{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===Tn.DPR?"float":this.scope===Tn.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Rt.NONE;return(this.scope===Tn.SIZE||this.scope===Tn.VIEWPORT||this.scope===Tn.DPR)&&(e=Rt.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===Tn.VIEWPORT?t!==null?rp.copy(t.viewport):(e.getViewport(rp),rp.multiplyScalar(e.getPixelRatio())):this.scope===Tn.DPR?this._output.value=e.getPixelRatio():t!==null?(ip.width=t.width,ip.height=t.height):e.getDrawingBufferSize(ip)}setup(){const e=this.scope;let t=null;return e===Tn.SIZE?t=lt(ip||(ip=new fe)):e===Tn.VIEWPORT?t=lt(rp||(rp=new Je)):e===Tn.DPR?t=lt(1):t=xe(db.div(PE)),this._output=t,t}generate(e){if(this.scope===Tn.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const i=e.getNodeProperties(PE).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${i}.y - ${t}.y )`}return t}return super.generate(e)}}Tn.COORDINATE="coordinate";Tn.VIEWPORT="viewport";Tn.SIZE="size";Tn.UV="uv";Tn.DPR="dpr";const pJ=Se(Tn,Tn.DPR),od=Se(Tn,Tn.UV),PE=Se(Tn,Tn.SIZE),db=Se(Tn,Tn.COORDINATE),JB=Se(Tn,Tn.VIEWPORT),mJ=JB.zw;JB.xy;const BA=lt(0,"uint").setName("u_cameraIndex").setGroup(RA("cameraIndex")).toVarying("v_cameraIndex"),ju=lt("float").setName("cameraNear").setGroup(Ke).onRenderUpdate(({camera:n})=>n.near),qu=lt("float").setName("cameraFar").setGroup(Ke).onRenderUpdate(({camera:n})=>n.far),eF=ue(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const r of n.cameras)t.push(r.projectionMatrix);e=aa(t).setGroup(Ke).setName("cameraProjectionMatrices").element(n.isMultiViewCamera?Og("gl_ViewID_OVR"):BA).toConst("cameraProjectionMatrix")}else e=lt("mat4").setName("cameraProjectionMatrix").setGroup(Ke).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),ol=ue(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const r of n.cameras)t.push(r.matrixWorldInverse);e=aa(t).setGroup(Ke).setName("cameraViewMatrices").element(n.isMultiViewCamera?Og("gl_ViewID_OVR"):BA).toConst("cameraViewMatrix")}else e=lt("mat4").setName("cameraViewMatrix").setGroup(Ke).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),gJ=ue(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(let r=0,s=n.cameras.length;r<s;r++)t.push(new D);e=aa(t).setGroup(Ke).setName("cameraPositions").onRenderUpdate(({camera:r},s)=>{const a=r.cameras,o=s.array;for(let l=0,u=a.length;l<u;l++)o[l].setFromMatrixPosition(a[l].matrixWorld)}).element(n.isMultiViewCamera?Og("gl_ViewID_OVR"):BA).toConst("cameraPosition")}else e=lt(new D).setName("cameraPosition").setGroup(Ke).onRenderUpdate(({camera:t},i)=>i.value.setFromMatrixPosition(t.matrixWorld));return e}).once()(),cD=new Eg;class gn extends ke{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Rt.OBJECT,this.uniformNode=new Pg(null)}getNodeType(){const e=this.scope;if(e===gn.WORLD_MATRIX)return"mat4";if(e===gn.POSITION||e===gn.VIEW_POSITION||e===gn.DIRECTION||e===gn.SCALE)return"vec3";if(e===gn.RADIUS)return"float"}update(e){const t=this.object3d,i=this.uniformNode,r=this.scope;if(r===gn.WORLD_MATRIX)i.value=t.matrixWorld;else if(r===gn.POSITION)i.value=i.value||new D,i.value.setFromMatrixPosition(t.matrixWorld);else if(r===gn.SCALE)i.value=i.value||new D,i.value.setFromMatrixScale(t.matrixWorld);else if(r===gn.DIRECTION)i.value=i.value||new D,t.getWorldDirection(i.value);else if(r===gn.VIEW_POSITION){const s=e.camera;i.value=i.value||new D,i.value.setFromMatrixPosition(t.matrixWorld),i.value.applyMatrix4(s.matrixWorldInverse)}else if(r===gn.RADIUS){const s=e.object.geometry;s.boundingSphere===null&&s.computeBoundingSphere(),cD.copy(s.boundingSphere).applyMatrix4(t.matrixWorld),i.value=cD.radius}}generate(e){const t=this.scope;return t===gn.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===gn.POSITION||t===gn.VIEW_POSITION||t===gn.DIRECTION||t===gn.SCALE?this.uniformNode.nodeType="vec3":t===gn.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}gn.WORLD_MATRIX="worldMatrix";gn.POSITION="position";gn.SCALE="scale";gn.VIEW_POSITION="viewPosition";gn.DIRECTION="direction";gn.RADIUS="radius";const _J=Xt(gn,gn.POSITION).setParameterLength(1);class $s extends gn{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}$s.DIRECTION;const Sc=Se($s,$s.WORLD_MATRIX);$s.POSITION;$s.SCALE;$s.VIEW_POSITION;$s.RADIUS;const yJ=lt(new vt).onObjectUpdate(({object:n},e)=>e.value.getNormalMatrix(n.matrixWorld)),fb=ue(n=>n.renderer.overrideNodes.modelViewMatrix||vJ).once()().toVar("modelViewMatrix"),vJ=ol.mul(Sc),hD=ue(n=>(n.context.isHighPrecisionModelViewMatrix=!0,lt("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),dD=ue(n=>{const e=n.context.isHighPrecisionModelViewMatrix;return lt("mat3").onObjectUpdate(({object:t,camera:i})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),pb=ou("position","vec3"),Ji=pb.toVarying("positionLocal"),fD=pb.toVarying("positionPrevious"),nf=ue(n=>Sc.mul(Ji).xyz.toVarying(n.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),tF=ue(()=>Ji.transformDirection(Sc).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),ui=ue(n=>n.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),Yn=ui.negate().toVarying("v_positionViewDirection").normalize().toVar("positionViewDirection");class bJ extends ke{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!=="fragment")return"true";const{material:t}=e;return t.side===bn?"false":e.getFrontFacing()}}const SJ=Se(bJ),nF=te(SJ).mul(2).sub(1),Ig=ue(([n],{material:e})=>{const t=e.side;return t===bn?n=n.mul(-1):t===Qi&&(n=n.mul(nF)),n}),iF=ou("normal","vec3"),Ka=ue(n=>n.geometry.hasAttribute("normal")===!1?(console.warn('THREE.TSL: Vertex attribute "normal" not found on geometry.'),ae(0,1,0)):iF,"vec3").once()().toVar("normalLocal"),xJ=ui.dFdx().cross(ui.dFdy()).normalize().toVar("normalFlat"),Hm=ue(n=>{let e;return n.material.flatShading===!0?e=xJ:e=rF(Ka).toVarying("v_normalViewGeometry").normalize(),e},"vec3").once()().toVar("normalViewGeometry"),TJ=ue(n=>{let e=Hm.transformDirection(ol);return n.material.flatShading!==!0&&(e=e.toVarying("v_normalWorldGeometry")),e.normalize().toVar("normalWorldGeometry")},"vec3").once()(),fn=ue(({subBuildFn:n,material:e,context:t})=>{let i;return n==="NORMAL"||n==="VERTEX"?(i=Hm,e.flatShading!==!0&&(i=Ig(i))):i=t.setupNormal().context({getUV:null}),i},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),Cf=fn.transformDirection(ol).toVar("normalWorld"),Gh=ue(({subBuildFn:n,context:e})=>{let t;return n==="NORMAL"||n==="VERTEX"?t=fn:t=e.setupClearcoatNormal().context({getUV:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),EJ=ue(([n,e=Sc])=>{const t=xr(e),i=n.div(ae(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(i).xyz}),rF=ue(([n],e)=>{const t=e.renderer.overrideNodes.modelNormalViewMatrix;if(t!==null)return t.transformDirection(n);const i=yJ.mul(n);return ol.transformDirection(i)});ue(()=>(console.warn('THREE.TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),fn)).once(["NORMAL","VERTEX"])();ue(()=>(console.warn('THREE.TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),Cf)).once(["NORMAL","VERTEX"])();ue(()=>(console.warn('THREE.TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),Gh)).once(["NORMAL","VERTEX"])();const pD=new Vr,hx=new zt,MJ=lt(0).onReference(({material:n})=>n).onObjectUpdate(({material:n})=>n.refractionRatio),dx=lt(1).onReference(({material:n})=>n).onObjectUpdate(function({material:n,scene:e}){return n.envMap?n.envMapIntensity:e.environmentIntensity}),sF=lt(new zt).onReference(function(n){return n.material}).onObjectUpdate(function({material:n,scene:e}){const t=e.environment!==null&&n.envMap===null?e.environmentRotation:n.envMapRotation;return t?(pD.copy(t),hx.makeRotationFromEuler(pD)):hx.identity(),hx}),wJ=Yn.negate().reflect(fn),AJ=Yn.negate().refract(fn,MJ),RJ=wJ.transformDirection(ol).toVar("reflectVector"),NJ=AJ.transformDirection(ol).toVar("reflectVector"),CJ=new Mg;class DJ extends Nf{static get type(){return"CubeTextureNode"}constructor(e,t=null,i=null,r=null){super(e,t,i,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===ja?RJ:e.mapping===qa?NJ:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),ae(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const i=this.value;return(e.renderer.coordinateSystem===ru||!i.isRenderTargetTexture)&&(t=ae(t.x.negate(),t.yz)),sF.mul(t)}generateUV(e,t){return t.build(e,"vec3")}}const LJ=Xt(DJ).setParameterLength(1,4).setName("cubeTexture"),$m=(n=CJ,e=null,t=null,i=null)=>{let r;return n&&n.isCubeTextureNode===!0?(r=de(n.clone()),r.referenceNode=n,e!==null&&(r.uvNode=de(e)),t!==null&&(r.levelNode=de(t)),i!==null&&(r.biasNode=de(i))):r=LJ(n,e,t,i),r};class PJ extends Lg{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),i=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,i,r)}}class FA extends ke{static get type(){return"ReferenceNode"}constructor(e,t,i=null,r=null){super(),this.property=e,this.uniformType=t,this.object=i,this.count=r,this.properties=e.split("."),this.reference=i,this.node=null,this.group=null,this.name=null,this.updateType=Rt.OBJECT}element(e){return de(new PJ(this,de(e)))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return console.warn('THREE.TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;this.count!==null?t=ZB(null,e,this.count):Array.isArray(this.getValueFromReference())?t=aa(null,e):e==="texture"?t=qt(null):e==="cubeTexture"?t=$m(null):t=lt(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.setName(this.name),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let i=e[t[0]];for(let r=1;r<t.length;r++)i=i[t[r]];return i}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Mn=(n,e,t)=>de(new FA(n,e,t)),mD=(n,e,t,i)=>de(new FA(n,e,i,t));class UJ extends FA{static get type(){return"MaterialReferenceNode"}constructor(e,t,i=null){super(e,t,i),this.material=i,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const Ul=(n,e,t=null)=>de(new UJ(n,e,t)),aF=Ug(),OJ=ui.dFdx(),IJ=ui.dFdy(),oF=aF.dFdx(),lF=aF.dFdy(),uF=fn,cF=IJ.cross(uF),hF=uF.cross(OJ),UE=cF.mul(oF.x).add(hF.mul(lF.x)),OE=cF.mul(oF.y).add(hF.mul(lF.y)),gD=UE.dot(UE).max(OE.dot(OE)),dF=gD.equal(0).select(0,gD.inverseSqrt()),BJ=UE.mul(dF).toVar("tangentViewFrame"),FJ=OE.mul(dF).toVar("bitangentViewFrame"),fF=ue(n=>(n.geometry.hasAttribute("tangent")===!1&&n.geometry.computeTangents(),ou("tangent","vec4")))(),kA=fF.xyz.toVar("tangentLocal"),pF=ue(({subBuildFn:n,geometry:e,material:t})=>{let i;return n==="VERTEX"||e.hasAttribute("tangent")?i=fb.mul(St(kA,0)).xyz.toVarying("v_tangentView").normalize():i=BJ,t.flatShading!==!0&&(i=Ig(i)),i},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),kJ=ue(([n,e],{subBuildFn:t,material:i})=>{let r=n.mul(fF.w).xyz;return t==="NORMAL"&&i.flatShading!==!0&&(r=r.toVarying(e)),r}).once(["NORMAL"]),zJ=ue(({subBuildFn:n,geometry:e,material:t})=>{let i;return n==="VERTEX"||e.hasAttribute("tangent")?i=kJ(fn.cross(pF),"v_bitangentView").normalize():i=FJ,t.flatShading!==!0&&(i=Ig(i)),i},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),wp=xr(pF,zJ,fn).toVar("TBNViewMatrix"),GJ=ue(()=>{let n=sd.cross(Yn);return n=n.cross(sd).normalize(),n=On(n,fn,Vu.mul(Co.oneMinus()).oneMinus().pow2().pow2()).normalize(),n}).once()();class VJ extends Ci{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=tl}setup({material:e}){const{normalMapType:t,scaleNode:i}=this;let r=this.node.mul(2).sub(1);if(i!==null){let a=i;e.flatShading===!0&&(a=Ig(a)),r=ae(r.xy.mul(a),r.z)}let s=null;return t===KO?s=rF(r):t===tl?s=wp.mul(r).normalize():(console.error(`THREE.NodeMaterial: Unsupported normal map type: ${t}`),s=fn),s}}const _D=Xt(VJ).setParameterLength(1,2),HJ=ue(({textureNode:n,bumpScale:e})=>{const t=r=>n.cache().context({getUV:s=>r(s.uvNode||Ug()),forceUVContext:!0}),i=te(t(r=>r));return xe(te(t(r=>r.add(r.dFdx()))).sub(i),te(t(r=>r.add(r.dFdy()))).sub(i)).mul(e)}),$J=ue(n=>{const{surf_pos:e,surf_norm:t,dHdxy:i}=n,r=e.dFdx().normalize(),s=e.dFdy().normalize(),a=t,o=s.cross(a),l=a.cross(r),u=r.dot(o).mul(nF),c=u.sign().mul(i.x.mul(o).add(i.y.mul(l)));return u.abs().mul(t).sub(c).normalize()});class WJ extends Ci{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=HJ({textureNode:this.textureNode,bumpScale:e});return $J({surf_pos:ui,surf_norm:fn,dHdxy:t})}}const jJ=Xt(WJ).setParameterLength(1,2),yD=new Map;class ee extends ke{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let i=yD.get(e);return i===void 0&&(i=Ul(e,t),yD.set(e,i)),i}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,i=this.scope;let r=null;if(i===ee.COLOR){const s=t.color!==void 0?this.getColor(i):ae();t.map&&t.map.isTexture===!0?r=s.mul(this.getTexture("map")):r=s}else if(i===ee.OPACITY){const s=this.getFloat(i);t.alphaMap&&t.alphaMap.isTexture===!0?r=s.mul(this.getTexture("alpha")):r=s}else if(i===ee.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?r=this.getTexture("specular").r:r=te(1);else if(i===ee.SPECULAR_INTENSITY){const s=this.getFloat(i);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?r=s.mul(this.getTexture(i).a):r=s}else if(i===ee.SPECULAR_COLOR){const s=this.getColor(i);t.specularColorMap&&t.specularColorMap.isTexture===!0?r=s.mul(this.getTexture(i).rgb):r=s}else if(i===ee.ROUGHNESS){const s=this.getFloat(i);t.roughnessMap&&t.roughnessMap.isTexture===!0?r=s.mul(this.getTexture(i).g):r=s}else if(i===ee.METALNESS){const s=this.getFloat(i);t.metalnessMap&&t.metalnessMap.isTexture===!0?r=s.mul(this.getTexture(i).b):r=s}else if(i===ee.EMISSIVE){const s=this.getFloat("emissiveIntensity"),a=this.getColor(i).mul(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?r=a.mul(this.getTexture(i)):r=a}else if(i===ee.NORMAL)t.normalMap?(r=_D(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=t.normalMapType):t.bumpMap?r=jJ(this.getTexture("bump").r,this.getFloat("bumpScale")):r=fn;else if(i===ee.CLEARCOAT){const s=this.getFloat(i);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?r=s.mul(this.getTexture(i).r):r=s}else if(i===ee.CLEARCOAT_ROUGHNESS){const s=this.getFloat(i);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(i).r):r=s}else if(i===ee.CLEARCOAT_NORMAL)t.clearcoatNormalMap?r=_D(this.getTexture(i),this.getCache(i+"Scale","vec2")):r=fn;else if(i===ee.SHEEN){const s=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?r=s.mul(this.getTexture("sheenColor").rgb):r=s}else if(i===ee.SHEEN_ROUGHNESS){const s=this.getFloat(i);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(i).a):r=s,r=r.clamp(.07,1)}else if(i===ee.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const s=this.getTexture(i);r=MA(sp.x,sp.y,sp.y.negate(),sp.x).mul(s.rg.mul(2).sub(xe(1)).normalize().mul(s.b))}else r=sp;else if(i===ee.IRIDESCENCE_THICKNESS){const s=Mn("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const a=Mn("0","float",t.iridescenceThicknessRange);r=s.sub(a).mul(this.getTexture(i).g).add(a)}else r=s}else if(i===ee.TRANSMISSION){const s=this.getFloat(i);t.transmissionMap?r=s.mul(this.getTexture(i).r):r=s}else if(i===ee.THICKNESS){const s=this.getFloat(i);t.thicknessMap?r=s.mul(this.getTexture(i).g):r=s}else if(i===ee.IOR)r=this.getFloat(i);else if(i===ee.LIGHT_MAP)r=this.getTexture(i).rgb.mul(this.getFloat("lightMapIntensity"));else if(i===ee.AO)r=this.getTexture(i).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(i===ee.LINE_DASH_OFFSET)r=t.dashOffset?this.getFloat(i):te(0);else{const s=this.getNodeType(e);r=this.getCache(i,s)}return r}}ee.ALPHA_TEST="alphaTest";ee.COLOR="color";ee.OPACITY="opacity";ee.SHININESS="shininess";ee.SPECULAR="specular";ee.SPECULAR_STRENGTH="specularStrength";ee.SPECULAR_INTENSITY="specularIntensity";ee.SPECULAR_COLOR="specularColor";ee.REFLECTIVITY="reflectivity";ee.ROUGHNESS="roughness";ee.METALNESS="metalness";ee.NORMAL="normal";ee.CLEARCOAT="clearcoat";ee.CLEARCOAT_ROUGHNESS="clearcoatRoughness";ee.CLEARCOAT_NORMAL="clearcoatNormal";ee.EMISSIVE="emissive";ee.ROTATION="rotation";ee.SHEEN="sheen";ee.SHEEN_ROUGHNESS="sheenRoughness";ee.ANISOTROPY="anisotropy";ee.IRIDESCENCE="iridescence";ee.IRIDESCENCE_IOR="iridescenceIOR";ee.IRIDESCENCE_THICKNESS="iridescenceThickness";ee.IOR="ior";ee.TRANSMISSION="transmission";ee.THICKNESS="thickness";ee.ATTENUATION_DISTANCE="attenuationDistance";ee.ATTENUATION_COLOR="attenuationColor";ee.LINE_SCALE="scale";ee.LINE_DASH_SIZE="dashSize";ee.LINE_GAP_SIZE="gapSize";ee.LINE_WIDTH="linewidth";ee.LINE_DASH_OFFSET="dashOffset";ee.POINT_SIZE="size";ee.DISPERSION="dispersion";ee.LIGHT_MAP="light";ee.AO="ao";const qJ=Se(ee,ee.ALPHA_TEST),XJ=Se(ee,ee.COLOR),YJ=Se(ee,ee.SHININESS),KJ=Se(ee,ee.EMISSIVE),mF=Se(ee,ee.OPACITY),QJ=Se(ee,ee.SPECULAR),vD=Se(ee,ee.SPECULAR_INTENSITY),ZJ=Se(ee,ee.SPECULAR_COLOR),Oy=Se(ee,ee.SPECULAR_STRENGTH),fx=Se(ee,ee.REFLECTIVITY),JJ=Se(ee,ee.ROUGHNESS),eee=Se(ee,ee.METALNESS),tee=Se(ee,ee.NORMAL),nee=Se(ee,ee.CLEARCOAT),iee=Se(ee,ee.CLEARCOAT_ROUGHNESS),ree=Se(ee,ee.CLEARCOAT_NORMAL),see=Se(ee,ee.ROTATION),aee=Se(ee,ee.SHEEN),oee=Se(ee,ee.SHEEN_ROUGHNESS),lee=Se(ee,ee.ANISOTROPY),uee=Se(ee,ee.IRIDESCENCE),cee=Se(ee,ee.IRIDESCENCE_IOR),hee=Se(ee,ee.IRIDESCENCE_THICKNESS),dee=Se(ee,ee.TRANSMISSION),fee=Se(ee,ee.THICKNESS),pee=Se(ee,ee.IOR),mee=Se(ee,ee.ATTENUATION_DISTANCE),gee=Se(ee,ee.ATTENUATION_COLOR),_ee=Se(ee,ee.LINE_SCALE),yee=Se(ee,ee.LINE_DASH_SIZE),vee=Se(ee,ee.LINE_GAP_SIZE);ee.LINE_WIDTH;const bee=Se(ee,ee.LINE_DASH_OFFSET),See=Se(ee,ee.POINT_SIZE),xee=Se(ee,ee.DISPERSION),gF=Se(ee,ee.LIGHT_MAP),Tee=Se(ee,ee.AO),sp=lt(new fe).onReference(function(n){return n.material}).onRenderUpdate(function({material:n}){this.value.set(n.anisotropy*Math.cos(n.anisotropyRotation),n.anisotropy*Math.sin(n.anisotropyRotation))}),_F=ue(n=>n.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class In extends ke{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),i=this.scope;let r;if(i===In.VERTEX)r=e.getVertexIndex();else if(i===In.INSTANCE)r=e.getInstanceIndex();else if(i===In.DRAW)r=e.getDrawIndex();else if(i===In.INVOCATION_LOCAL)r=e.getInvocationLocalIndex();else if(i===In.INVOCATION_SUBGROUP)r=e.getInvocationSubgroupIndex();else if(i===In.SUBGROUP)r=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+i);let s;return e.shaderStage==="vertex"||e.shaderStage==="compute"?s=r:s=gu(this).build(e,t),s}}In.VERTEX="vertex";In.INSTANCE="instance";In.SUBGROUP="subgroup";In.INVOCATION_LOCAL="invocationLocal";In.INVOCATION_SUBGROUP="invocationSubgroup";In.DRAW="draw";const Eee=Se(In,In.VERTEX),zA=Se(In,In.INSTANCE);In.SUBGROUP;In.INVOCATION_SUBGROUP;In.INVOCATION_LOCAL;const Mee=Se(In,In.DRAW);class wee extends ke{static get type(){return"InstanceNode"}constructor(e,t,i=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=i,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Rt.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{instanceMatrix:t,instanceColor:i}=this,{count:r}=t;let{instanceMatrixNode:s,instanceColorNode:a}=this;if(s===null){if(r<=1e3)s=ZB(t.array,"mat4",Math.max(r,1)).element(zA);else{const l=new Y5(t.array,16,1);this.buffer=l;const u=t.usage===Ih?uD:lD,c=[u(l,"vec4",16,0),u(l,"vec4",16,4),u(l,"vec4",16,8),u(l,"vec4",16,12)];s=rd(...c)}this.instanceMatrixNode=s}if(i&&a===null){const l=new a5(i.array,3),u=i.usage===Ih?uD:lD;this.bufferColor=l,a=ae(u(l,"vec3",3,0)),this.instanceColorNode=a}const o=s.mul(Ji).xyz;if(Ji.assign(o),e.hasGeometryAttribute("normal")){const l=EJ(Ka,s);Ka.assign(l)}this.instanceColorNode!==null&&kv("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==Ih&&this.buffer!==null&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==Ih&&this.bufferColor!==null&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}class Aee extends wee{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:i,instanceColor:r}=e;super(t,i,r),this.instancedMesh=e}}const Ree=Xt(Aee).setParameterLength(1);class Nee extends ke{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=zA:this.batchingIdNode=Mee);const i=ue(([m])=>{const _=Dn(ad(Js(this.batchMesh._indirectTexture),0).x),g=Dn(m).mod(_),p=Dn(m).div(_);return Js(this.batchMesh._indirectTexture,Mo(g,p)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(Dn(this.batchingIdNode)),r=this.batchMesh._matricesTexture,s=Dn(ad(Js(r),0).x),a=te(i).mul(4).toInt().toVar(),o=a.mod(s),l=a.div(s),u=rd(Js(r,Mo(o,l)),Js(r,Mo(o.add(1),l)),Js(r,Mo(o.add(2),l)),Js(r,Mo(o.add(3),l))),c=this.batchMesh._colorsTexture;if(c!==null){const _=ue(([g])=>{const p=Dn(ad(Js(c),0).x),y=g,v=y.mod(p),b=y.div(p);return Js(c,Mo(v,b)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(i);kv("vec3","vBatchColor").assign(_)}const h=xr(u);Ji.assign(u.mul(Ji));const d=Ka.div(ae(h[0].dot(h[0]),h[1].dot(h[1]),h[2].dot(h[2]))),f=h.mul(d).xyz;Ka.assign(f),e.hasGeometryAttribute("tangent")&&kA.mulAssign(h)}}const Cee=Xt(Nee).setParameterLength(1),bD=new WeakMap;class Dee extends ke{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=Rt.OBJECT,this.skinIndexNode=ou("skinIndex","uvec4"),this.skinWeightNode=ou("skinWeight","vec4"),this.bindMatrixNode=Mn("bindMatrix","mat4"),this.bindMatrixInverseNode=Mn("bindMatrixInverse","mat4"),this.boneMatricesNode=mD("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=Ji,this.toPositionNode=Ji,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:i,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:a}=this,o=e.element(i.x),l=e.element(i.y),u=e.element(i.z),c=e.element(i.w),h=s.mul(t),d=Hr(o.mul(r.x).mul(h),l.mul(r.y).mul(h),u.mul(r.z).mul(h),c.mul(r.w).mul(h));return a.mul(d).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=Ka){const{skinIndexNode:i,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:a}=this,o=e.element(i.x),l=e.element(i.y),u=e.element(i.z),c=e.element(i.w);let h=Hr(r.x.mul(o),r.y.mul(l),r.z.mul(u),r.w.mul(c));return h=a.mul(h).mul(s),h.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=mD("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,fD)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||_B(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&fD.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const i=this.getSkinnedNormal();Ka.assign(i),e.hasGeometryAttribute("tangent")&&kA.assign(i)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;bD.get(t)!==e.frameId&&(bD.set(t,e.frameId),this.previousBoneMatricesNode!==null&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}}const Lee=n=>de(new Dee(n));class Pee extends ke{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const i={};for(let a=0,o=this.params.length-1;a<o;a++){const l=this.params[a],u=l.isNode!==!0&&l.name||this.getVarName(a),c=l.isNode!==!0&&l.type||"int";i[u]=tf(u,c)}const r=e.addStack();t.returnsNode=this.params[this.params.length-1](i,e),t.stackNode=r;const s=this.params[0];return s.isNode!==!0&&typeof s.update=="function"&&(t.updateNode=ue(this.params[0].update)(i)),e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),i=this.params,r=t.stackNode;for(let o=0,l=i.length-1;o<l;o++){const u=i[o];let c=!1,h=null,d=null,f=null,m=null,_=null,g=null;u.isNode?u.getNodeType(e)==="bool"?(c=!0,m="bool",d=u.build(e,m)):(m="int",f=this.getVarName(o),h="0",d=u.build(e,m),_="<"):(m=u.type||"int",f=u.name||this.getVarName(o),h=u.start,d=u.end,_=u.condition,g=u.update,typeof h=="number"?h=e.generateConst(m,h):h&&h.isNode&&(h=h.build(e,m)),typeof d=="number"?d=e.generateConst(m,d):d&&d.isNode&&(d=d.build(e,m)),h!==void 0&&d===void 0?(h=h+" - 1",d="0",_=">="):d!==void 0&&h===void 0&&(h="0",_="<"),_===void 0&&(Number(h)>Number(d)?_=">=":_="<"));let p;if(c)p=`while ( ${d} )`;else{const y={start:h,end:d},v=y.start,b=y.end;let S;const x=()=>_.includes("<")?"+=":"-=";if(g!=null)switch(typeof g){case"function":S=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":S=f+" "+x()+" "+e.generateConst(m,g);break;case"string":S=f+" "+g;break;default:g.isNode?S=f+" "+x()+" "+g.build(e):(console.error("THREE.TSL: 'Loop( { update: ... } )' is not a function, string or number."),S="break /* invalid update */")}else m==="int"||m==="uint"?g=_.includes("<")?"++":"--":g=x()+" 1.",S=f+" "+g;const T=e.getVar(m,f)+" = "+v,w=f+" "+_+" "+b;p=`for ( ${T}; ${w}; ${S} )`}e.addFlowCode((o===0?`
`:"")+e.tab+p+` {

`).addFlowTab()}const s=r.build(e,"void"),a=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+s);for(let o=0,l=this.params.length-1;o<l;o++)e.addFlowCode((o===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),a}}const oa=(...n)=>de(new Pee(id(n,"int"))).toStack(),Uee=()=>tf("break").toStack(),px=new WeakMap,ns=new Je,SD=ue(({bufferMap:n,influence:e,stride:t,width:i,depth:r,offset:s})=>{const a=Dn(Eee).mul(t).add(s),o=a.div(i),l=a.sub(o.mul(i));return Js(n,Mo(l,o)).depth(r).xyz.mul(e)});function Oee(n){const e=n.morphAttributes.position!==void 0,t=n.morphAttributes.normal!==void 0,i=n.morphAttributes.color!==void 0,r=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,s=r!==void 0?r.length:0;let a=px.get(n);if(a===void 0||a.count!==s){let p=function(){_.dispose(),px.delete(n),n.removeEventListener("dispose",p)};a!==void 0&&a.texture.dispose();const o=n.morphAttributes.position||[],l=n.morphAttributes.normal||[],u=n.morphAttributes.color||[];let c=0;e===!0&&(c=1),t===!0&&(c=2),i===!0&&(c=3);let h=n.attributes.position.count*c,d=1;const f=4096;h>f&&(d=Math.ceil(h/f),h=f);const m=new Float32Array(h*d*4*s),_=new $w(m,h,d,s);_.type=li,_.needsUpdate=!0;const g=c*4;for(let y=0;y<s;y++){const v=o[y],b=l[y],S=u[y],x=h*d*4*y;for(let T=0;T<v.count;T++){const w=T*g;e===!0&&(ns.fromBufferAttribute(v,T),m[x+w+0]=ns.x,m[x+w+1]=ns.y,m[x+w+2]=ns.z,m[x+w+3]=0),t===!0&&(ns.fromBufferAttribute(b,T),m[x+w+4]=ns.x,m[x+w+5]=ns.y,m[x+w+6]=ns.z,m[x+w+7]=0),i===!0&&(ns.fromBufferAttribute(S,T),m[x+w+8]=ns.x,m[x+w+9]=ns.y,m[x+w+10]=ns.z,m[x+w+11]=S.itemSize===4?ns.w:1)}}a={count:s,texture:_,stride:c,size:new fe(h,d)},px.set(n,a),n.addEventListener("dispose",p)}return a}class Iee extends ke{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=lt(1),this.updateType=Rt.OBJECT}setup(e){const{geometry:t}=e,i=t.morphAttributes.position!==void 0,r=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,s=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,a=s!==void 0?s.length:0,{texture:o,stride:l,size:u}=Oee(t);i===!0&&Ji.mulAssign(this.morphBaseInfluence),r===!0&&Ka.mulAssign(this.morphBaseInfluence);const c=Dn(u.width);oa(a,({i:h})=>{const d=te(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?d.assign(Js(this.mesh.morphTexture,Mo(Dn(h).add(1),Dn(zA))).r):d.assign(Mn("morphTargetInfluences","float").element(h).toVar()),ri(d.notEqual(0),()=>{i===!0&&Ji.addAssign(SD({bufferMap:o,influence:d,stride:l,width:c,depth:h,offset:Dn(0)})),r===!0&&Ka.addAssign(SD({bufferMap:o,influence:d,stride:l,width:c,depth:h,offset:Dn(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,i)=>t+i,0)}}const Bee=Xt(Iee).setParameterLength(1);class Df extends ke{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class Fee extends Df{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class kee extends HB{static get type(){return"LightingContextNode"}constructor(e,t=null,i=null,r=null){super(e),this.lightingModel=t,this.backdropNode=i,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,i=ae().toVar("directDiffuse"),r=ae().toVar("directSpecular"),s=ae().toVar("indirectDiffuse"),a=ae().toVar("indirectSpecular"),o={directDiffuse:i,directSpecular:r,indirectDiffuse:s,indirectSpecular:a};return{radiance:ae().toVar("radiance"),irradiance:ae().toVar("irradiance"),iblIrradiance:ae().toVar("iblIrradiance"),ambientOcclusion:te(1).toVar("ambientOcclusion"),reflectedLight:o,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const zee=Xt(kee);class Gee extends Df{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}const th=new fe;class yF extends Nf{static get type(){return"ViewportTextureNode"}constructor(e=od,t=null,i=null){let r=null;i===null?(r=new d5,r.minFilter=Ir,i=r):r=i,super(i,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=r,this.isOutputTextureNode=!0,this.updateBeforeType=Rt.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,i;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,i=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,i=this._cacheTextures),e===null)return t;if(i.has(e)===!1){const r=t.clone();i.set(e,r)}return i.get(e)}updateReference(e){const t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){const t=e.renderer,i=t.getRenderTarget();i===null?t.getDrawingBufferSize(th):th.set(i.width,i.height);const r=this.getTextureForReference(i);(r.image.width!==th.width||r.image.height!==th.height)&&(r.image.width=th.width,r.image.height=th.height,r.needsUpdate=!0);const s=r.generateMipmaps;r.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(r),r.generateMipmaps=s}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const vF=Xt(yF,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let k_=null;class Vee extends yF{static get type(){return"ViewportDepthTextureNode"}constructor(e=od,t=null){k_===null&&(k_=new ks),super(e,t,k_)}getTextureForReference(){return k_}}const Hee=Xt(Vee).setParameterLength(0,2);class Br extends ke{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===Br.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,i=this.valueNode;let r=null;if(t===Br.DEPTH_BASE)i!==null&&(r=xF().assign(i));else if(t===Br.DEPTH)e.isPerspectiveCamera?r=$ee(ui.z,ju,qu):r=am(ui.z,ju,qu);else if(t===Br.LINEAR_DEPTH)if(i!==null)if(e.isPerspectiveCamera){const s=bF(i,ju,qu);r=am(s,ju,qu)}else r=i;else r=am(ui.z,ju,qu);return r}}Br.DEPTH_BASE="depthBase";Br.DEPTH="depth";Br.LINEAR_DEPTH="linearDepth";const am=(n,e,t)=>n.add(e).div(e.sub(t)),$ee=(n,e,t)=>e.add(n).mul(t).div(t.sub(e).mul(n)),bF=(n,e,t)=>e.mul(t).div(t.sub(e).mul(n).sub(t)),SF=(n,e,t)=>{e=e.max(1e-6).toVar();const i=Xo(n.negate().div(e)),r=Xo(t.div(e));return i.div(r)},xF=Xt(Br,Br.DEPTH_BASE),TF=Se(Br,Br.DEPTH),Wee=Xt(Br,Br.LINEAR_DEPTH).setParameterLength(0,1);Hee();TF.assign=n=>xF(n);class zs extends ke{static get type(){return"ClippingNode"}constructor(e=zs.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:i,unionPlanes:r}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===zs.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(i,r):this.scope===zs.HARDWARE?this.setupHardwareClipping(r,e):this.setupDefault(i,r)}setupAlphaToCoverage(e,t){return ue(()=>{const i=te().toVar("distanceToPlane"),r=te().toVar("distanceToGradient"),s=te(1).toVar("clipOpacity"),a=t.length;if(this.hardwareClipping===!1&&a>0){const l=aa(t).setGroup(Ke);oa(a,({i:u})=>{const c=l.element(u);i.assign(ui.dot(c.xyz).negate().add(c.w)),r.assign(i.fwidth().div(2)),s.mulAssign(au(r.negate(),r,i))})}const o=e.length;if(o>0){const l=aa(e).setGroup(Ke),u=te(1).toVar("intersectionClipOpacity");oa(o,({i:c})=>{const h=l.element(c);i.assign(ui.dot(h.xyz).negate().add(h.w)),r.assign(i.fwidth().div(2)),u.mulAssign(au(r.negate(),r,i).oneMinus())}),s.mulAssign(u.oneMinus())}Kt.a.mulAssign(s),Kt.a.equal(0).discard()})()}setupDefault(e,t){return ue(()=>{const i=t.length;if(this.hardwareClipping===!1&&i>0){const s=aa(t).setGroup(Ke);oa(i,({i:a})=>{const o=s.element(a);ui.dot(o.xyz).greaterThan(o.w).discard()})}const r=e.length;if(r>0){const s=aa(e).setGroup(Ke),a=EA(!0).toVar("clipped");oa(r,({i:o})=>{const l=s.element(o);a.assign(ui.dot(l.xyz).greaterThan(l.w).and(a))}),a.discard()}})()}setupHardwareClipping(e,t){const i=e.length;return t.enableHardwareClipping(i),ue(()=>{const r=aa(e).setGroup(Ke),s=Og(t.getClipDistance());oa(i,({i:a})=>{const o=r.element(a),l=ui.dot(o.xyz).sub(o.w).negate();s.element(a).assign(l)})})()}}zs.ALPHA_TO_COVERAGE="alphaToCoverage";zs.DEFAULT="default";zs.HARDWARE="hardware";const jee=()=>de(new zs),qee=()=>de(new zs(zs.ALPHA_TO_COVERAGE)),Xee=()=>de(new zs(zs.HARDWARE)),Yee=.05,xD=ue(([n])=>mu(Nt(1e4,ra(Nt(17,n.x).add(Nt(.1,n.y)))).mul(Hr(.1,Ls(ra(Nt(13,n.y).add(n.x))))))),TD=ue(([n])=>xD(xe(xD(n.xy),n.z))),Kee=ue(([n])=>{const e=rr(Yo(OB(n.xyz)),Yo(IB(n.xyz))),t=te(1).div(te(Yee).mul(e)).toVar("pixScale"),i=xe(Gm(oc(Xo(t))),Gm(DA(Xo(t)))),r=xe(TD(oc(i.x.mul(n.xyz))),TD(oc(i.y.mul(n.xyz)))),s=mu(Xo(t)),a=Hr(Nt(s.oneMinus(),r.x),Nt(s,r.y)),o=ef(s,s.oneMinus()),l=ae(a.mul(a).div(Nt(2,o).mul(dr(1,o))),a.sub(Nt(.5,o)).div(dr(1,o)),dr(1,dr(1,a).mul(dr(1,a)).div(Nt(2,o).mul(dr(1,o))))),u=a.lessThan(o.oneMinus()).select(a.lessThan(o).select(l.x,l.y),l.z);return nl(u,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class Qee extends YB{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),i=e.hasGeometryAttribute(t);let r;return i===!0?r=super.generate(e):r=e.generateConst(this.nodeType,new Je(1,1,1,1)),r}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const Zee=(n=0)=>de(new Qee(n)),Jee=ue(([n])=>St(n.rgb.mul(n.a),n.a),{color:"vec4",return:"vec4"});class vi extends ir{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{console.warn('THREE.NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}customProgramCacheKey(){return this.type+gB(this)}build(e){this.setup(e)}setupObserver(e){return new PK(e)}setup(e){e.context.setupNormal=()=>sm(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,i=t.getRenderTarget();e.addStack();const r=sm(this.setupVertex(e),"VERTEX"),s=this.vertexNode||r;e.stack.outputNode=s,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let a;const o=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(i!==null?i.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const l=this.setupLighting(e);o!==null&&e.stack.add(o);const u=St(l,Kt.a).max(0);a=this.setupOutput(e,u),rm.assign(a);const c=this.outputNode!==null;if(c&&(a=this.outputNode),i!==null){const h=t.getMRT(),d=this.mrtNode;h!==null?(c&&rm.assign(a),a=h,d!==null&&(a=h.merge(d))):d!==null&&(a=d)}}else{let l=this.fragmentNode;l.isOutputStructNode!==!0&&(l=St(l)),a=this.setupOutput(e,l)}e.stack.outputNode=a,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:i}=e.clippingContext;let r=null;if(t.length>0||i.length>0){const s=e.renderer.samples;this.alphaToCoverage&&s>1?r=qee():e.stack.add(jee())}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.add(Xee()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:i}=e;let r=this.depthNode;if(r===null){const s=t.getMRT();s&&s.has("depth")?r=s.get("depth"):t.logarithmicDepthBuffer===!0&&(i.isPerspectiveCamera?r=SF(ui.z,ju,qu):r=am(ui.z,ju,qu))}r!==null&&TF.assign(r).toStack()}setupPositionView(){return fb.mul(Ji).xyz}setupModelViewProjection(){return eF.mul(ui)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),_F}setupPosition(e){const{object:t,geometry:i}=e;if((i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color)&&Bee(t).toStack(),t.isSkinnedMesh===!0&&Lee(t).toStack(),this.displacementMap){const r=Ul("displacementMap","texture"),s=Ul("displacementScale","float"),a=Ul("displacementBias","float");Ji.addAssign(Ka.normalize().mul(r.x.mul(s).add(a)))}return t.isBatchedMesh&&Cee(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&Ree(t).toStack(),this.positionNode!==null&&Ji.assign(sm(this.positionNode,"POSITION","vec3")),Ji}setupDiffuseColor({object:e,geometry:t}){this.maskNode!==null&&EA(this.maskNode).not().discard();let i=this.colorNode?St(this.colorNode):XJ;this.vertexColors===!0&&t.hasAttribute("color")&&(i=i.mul(Zee())),e.instanceColor&&(i=kv("vec3","vInstanceColor").mul(i)),e.isBatchedMesh&&e._colorsTexture&&(i=kv("vec3","vBatchColor").mul(i)),Kt.assign(i);const r=this.opacityNode?te(this.opacityNode):mF;Kt.a.assign(Kt.a.mul(r));let s=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(s=this.alphaTestNode!==null?te(this.alphaTestNode):qJ,Kt.a.lessThanEqual(s).discard()),this.alphaHash===!0&&Kt.a.lessThan(Kee(Ji)).discard(),this.transparent===!1&&this.blending===ms&&this.alphaToCoverage===!1?Kt.a.assign(1):s===null&&Kt.a.lessThanEqual(0).discard()}setupVariants(){}setupOutgoingLight(){return this.lights===!0?ae(0):Kt.rgb}setupNormal(){return this.normalNode?ae(this.normalNode):tee}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?Ul("envMap","cubeTexture"):Ul("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Gee(gF)),t}setupLights(e){const t=[],i=this.setupEnvironment(e);i&&i.isLightingNode&&t.push(i);const r=this.setupLightMap(e);if(r&&r.isLightingNode&&t.push(r),this.aoNode!==null||e.material.aoMap){const a=this.aoNode!==null?this.aoNode:Tee;t.push(new Fee(a))}let s=this.lightsNode||e.lightsNode;return t.length>0&&(s=e.renderer.lighting.createNode([...s.getLights(),...t])),s}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:i,backdropAlphaNode:r,emissiveNode:s}=this,o=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let l=this.setupOutgoingLight(e);if(o&&o.getScope().hasLights){const u=this.setupLightingModel(e)||null;l=zee(o,u,i,r)}else i!==null&&(l=ae(r!==null?On(l,i,r):i));return(s&&s.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(sD.assign(ae(s||KJ)),l=l.add(sD)),l}setupFog(e,t){const i=e.fogNode;return i&&(rm.assign(t),t=St(i.toVar())),t}setupPremultipliedAlpha(e,t){return Jee(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const i in e){const r=e[i];this[i]===void 0&&(this[i]=r,r&&r.clone&&(this[i]=r.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const i in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,i)===void 0&&t[i].get!==void 0&&Object.defineProperty(this.constructor.prototype,i,t[i])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const i=ir.prototype.toJSON.call(this,e),r=Iv(this);i.inputNodes={};for(const{property:a,childNode:o}of r)i.inputNodes[a]=o.toJSON(e).uuid;function s(a){const o=[];for(const l in a){const u=a[l];delete u.metadata,o.push(u)}return o}if(t){const a=s(e.textures),o=s(e.images),l=s(e.nodes);a.length>0&&(i.textures=a),o.length>0&&(i.images=o),l.length>0&&(i.nodes=l)}return i}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const ete=new eb;class tte extends vi{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(ete),this.setValues(e)}}const nte=new I5;class ite extends vi{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(nte),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?te(this.offsetNode):bee,t=this.dashScaleNode?te(this.dashScaleNode):_ee,i=this.dashSizeNode?te(this.dashSizeNode):yee,r=this.gapSizeNode?te(this.gapSizeNode):vee;cx.assign(i),aD.assign(r);const s=gu(ou("lineDistance").mul(t));(e?s.add(e):s).mod(cx.add(aD)).greaterThan(cx).discard()}}const rte=n=>de(n).mul(.5).add(.5),ste=new L5;class ate extends vi{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(ste),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?te(this.opacityNode):mF;Kt.assign(OA(St(rte(fn),e),hr))}}const EF=ue(([n=tF])=>{const e=n.z.atan(n.x).mul(1/(Math.PI*2)).add(.5),t=n.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return xe(e,t)});class MF extends iI{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const i=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const s=new Dc(5,5,5),a=EF(tF),o=new vi;o.colorNode=qt(t,a,0),o.side=bn,o.blending=kr;const l=new mi(s,o),u=new J0;u.add(l),t.minFilter===Ir&&(t.minFilter=wi);const c=new nI(1,10,this),h=e.getMRT();return e.setMRT(null),c.update(e,u),e.setMRT(h),t.minFilter=i,t.currentGenerateMipmaps=r,l.geometry.dispose(),l.material.dispose(),this}}const om=new WeakMap;class ote extends Ci{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=$m(null);const t=new Mg;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=Rt.RENDER}updateBefore(e){const{renderer:t,material:i}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const s=r.isTextureNode?r.value:i[r.property];if(s&&s.isTexture){const a=s.mapping;if(a===wd||a===Ad){if(om.has(s)){const o=om.get(s);ED(o,s.mapping),this._cubeTexture=o}else{const o=s.image;if(lte(o)){const l=new MF(o.height);l.fromEquirectangularTexture(t,s),ED(l.texture,s.mapping),this._cubeTexture=l.texture,om.set(s,l.texture),s.addEventListener("dispose",wF)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function lte(n){return n==null?!1:n.height>0}function wF(n){const e=n.target;e.removeEventListener("dispose",wF);const t=om.get(e);t!==void 0&&(om.delete(e),t.dispose())}function ED(n,e){e===wd?n.mapping=ja:e===Ad&&(n.mapping=qa)}const AF=Xt(ote).setParameterLength(1);class GA extends Df{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=AF(this.envNode)}}class ute extends Df{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=te(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class mb{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class RF extends mb{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,i=e.reflectedLight,r=e.irradianceLightMap;i.indirectDiffuse.assign(St(0)),r?i.indirectDiffuse.addAssign(r):i.indirectDiffuse.addAssign(St(1,1,1,0)),i.indirectDiffuse.mulAssign(t),i.indirectDiffuse.mulAssign(Kt.rgb)}finish(e){const{material:t,context:i}=e,r=i.outgoingLight,s=e.context.environment;if(s)switch(t.combine){case Sg:r.rgb.assign(On(r.rgb,r.rgb.mul(s.rgb),Oy.mul(fx)));break;case VO:r.rgb.assign(On(r.rgb,s.rgb,Oy.mul(fx)));break;case HO:r.rgb.addAssign(s.rgb.mul(Oy.mul(fx)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const cte=new Da;class hte extends vi{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(cte),this.setValues(e)}setupNormal(){return Ig(Hm)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new GA(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new ute(gF)),t}setupOutgoingLight(){return Kt.rgb}setupLightingModel(){return new RF}}const Wm=ue(({f0:n,f90:e,dotVH:t})=>{const i=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return n.mul(i.oneMinus()).add(e.mul(i))}),rf=ue(n=>n.diffuseColor.mul(1/Math.PI)),dte=()=>te(.25),fte=ue(({dotNH:n})=>DE.mul(te(.5)).add(1).mul(te(1/Math.PI)).mul(n.pow(DE))),pte=ue(({lightDirection:n})=>{const e=n.add(Yn).normalize(),t=fn.dot(e).clamp(),i=Yn.dot(e).clamp(),r=Wm({f0:ss,f90:1,dotVH:i}),s=dte(),a=fte({dotNH:t});return r.mul(s).mul(a)});class NF extends RF{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:i}){const s=fn.dot(e).clamp().mul(t);i.directDiffuse.addAssign(s.mul(rf({diffuseColor:Kt.rgb}))),this.specular===!0&&i.directSpecular.addAssign(s.mul(pte({lightDirection:e})).mul(Oy))}indirect(e){const{ambientOcclusion:t,irradiance:i,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(i.mul(rf({diffuseColor:Kt}))),r.indirectDiffuse.mulAssign(t)}}const mte=new uI;class gte extends vi{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(mte),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new GA(t):null}setupLightingModel(){return new NF(!1)}}const _te=new C5;class yte extends vi{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(_te),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new GA(t):null}setupLightingModel(){return new NF}setupVariants(){const e=(this.shininessNode?te(this.shininessNode):YJ).max(1e-4);DE.assign(e);const t=this.specularNode||QJ;ss.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const vte=ue(n=>{if(n.geometry.hasAttribute("normal")===!1)return te(0);const e=Hm.dFdx().abs().max(Hm.dFdy().abs());return e.x.max(e.y).max(e.z)}),CF=ue(n=>{const{roughness:e}=n,t=vte();let i=e.max(.0525);return i=i.add(t),i=i.min(1),i}),bte=ue(({alpha:n,dotNL:e,dotNV:t})=>{const i=n.pow2(),r=e.mul(i.add(i.oneMinus().mul(t.pow2())).sqrt()),s=t.mul(i.add(i.oneMinus().mul(e.pow2())).sqrt());return Ya(.5,r.add(s).max(YQ))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),Ste=ue(({alphaT:n,alphaB:e,dotTV:t,dotBV:i,dotTL:r,dotBL:s,dotNV:a,dotNL:o})=>{const l=o.mul(ae(n.mul(t),e.mul(i),a).length()),u=a.mul(ae(n.mul(r),e.mul(s),o).length());return Ya(.5,l.add(u)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),xte=ue(({alpha:n,dotNH:e})=>{const t=n.pow2(),i=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(i.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),Tte=te(1/Math.PI),Ete=ue(({alphaT:n,alphaB:e,dotNH:t,dotTH:i,dotBH:r})=>{const s=n.mul(e),a=ae(e.mul(i),n.mul(r),s.mul(t)),o=a.dot(a),l=s.div(o);return Tte.mul(s.mul(l.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),MD=ue(({lightDirection:n,f0:e,f90:t,roughness:i,f:r,normalView:s=fn,USE_IRIDESCENCE:a,USE_ANISOTROPY:o})=>{const l=i.pow2(),u=n.add(Yn).normalize(),c=s.dot(n).clamp(),h=s.dot(Yn).clamp(),d=s.dot(u).clamp(),f=Yn.dot(u).clamp();let m=Wm({f0:e,f90:t,dotVH:f}),_,g;if(rD(a)&&(m=AA.mix(m,r)),rD(o)){const p=Cy.dot(n),y=Cy.dot(Yn),v=Cy.dot(u),b=sd.dot(n),S=sd.dot(Yn),x=sd.dot(u);_=Ste({alphaT:CE,alphaB:l,dotTV:y,dotBV:S,dotTL:p,dotBL:b,dotNV:h,dotNL:c}),g=Ete({alphaT:CE,alphaB:l,dotNH:d,dotTH:v,dotBH:x})}else _=bte({alpha:l,dotNL:c,dotNV:h}),g=xte({alpha:l,dotNH:d});return m.mul(_).mul(g)}),DF=ue(({roughness:n,dotNV:e})=>{const t=St(-1,-.0275,-.572,.022),i=St(1,.0425,1.04,-.04),r=n.mul(t).add(i),s=r.x.mul(r.x).min(e.mul(-9.28).exp2()).mul(r.x).add(r.y);return xe(-1.04,1.04).mul(s).add(r.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),LF=ue(n=>{const{dotNV:e,specularColor:t,specularF90:i,roughness:r}=n,s=DF({dotNV:e,roughness:r});return t.mul(s.x).add(i.mul(s.y))}),Mte=ue(({f:n,f90:e,dotVH:t})=>{const i=t.oneMinus().saturate(),r=i.mul(i),s=i.mul(r,r).clamp(0,.9999);return n.sub(ae(e).mul(s)).div(s.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),wte=ue(({roughness:n,dotNH:e})=>{const t=n.pow2(),i=te(1).div(t),s=e.pow2().oneMinus().max(.0078125);return te(2).add(i).mul(s.pow(i.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),Ate=ue(({dotNV:n,dotNL:e})=>te(1).div(te(4).mul(e.add(n).sub(e.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),Rte=ue(({lightDirection:n})=>{const e=n.add(Yn).normalize(),t=fn.dot(n).clamp(),i=fn.dot(Yn).clamp(),r=fn.dot(e).clamp(),s=wte({roughness:wA,dotNH:r}),a=Ate({dotNV:i,dotNL:t});return zh.mul(s).mul(a)}),Nte=ue(({N:n,V:e,roughness:t})=>{const s=.0078125,a=n.dot(e).saturate(),o=xe(t,a.oneMinus().sqrt());return o.assign(o.mul(.984375).add(s)),o}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),Cte=ue(({f:n})=>{const e=n.length();return rr(e.mul(e).add(n.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),z_=ue(({v1:n,v2:e})=>{const t=n.dot(e),i=t.abs().toVar(),r=i.mul(.0145206).add(.4965155).mul(i).add(.8543985).toVar(),s=i.add(4.1616724).mul(i).add(3.417594).toVar(),a=r.div(s),o=t.greaterThan(0).select(a,rr(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(a));return n.cross(e).mul(o)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),wD=ue(({N:n,V:e,P:t,mInv:i,p0:r,p1:s,p2:a,p3:o})=>{const l=s.sub(r).toVar(),u=o.sub(r).toVar(),c=l.cross(u),h=ae().toVar();return ri(c.dot(t.sub(r)).greaterThanEqual(0),()=>{const d=e.sub(n.mul(e.dot(n))).normalize(),f=n.cross(d).negate(),m=i.mul(xr(d,f,n).transpose()).toVar(),_=m.mul(r.sub(t)).normalize().toVar(),g=m.mul(s.sub(t)).normalize().toVar(),p=m.mul(a.sub(t)).normalize().toVar(),y=m.mul(o.sub(t)).normalize().toVar(),v=ae(0).toVar();v.addAssign(z_({v1:_,v2:g})),v.addAssign(z_({v1:g,v2:p})),v.addAssign(z_({v1:p,v2:y})),v.addAssign(z_({v1:y,v2:_})),h.assign(ae(Cte({f:v})))}),h}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),gb=1/6,PF=n=>Nt(gb,Nt(n,Nt(n,n.negate().add(3)).sub(3)).add(1)),IE=n=>Nt(gb,Nt(n,Nt(n,Nt(3,n).sub(6))).add(4)),UF=n=>Nt(gb,Nt(n,Nt(n,Nt(-3,n).add(3)).add(3)).add(1)),BE=n=>Nt(gb,cb(n,3)),AD=n=>PF(n).add(IE(n)),RD=n=>UF(n).add(BE(n)),ND=n=>Hr(-1,IE(n).div(PF(n).add(IE(n)))),CD=n=>Hr(1,BE(n).div(UF(n).add(BE(n)))),DD=(n,e,t)=>{const i=n.uvNode,r=Nt(i,e.zw).add(.5),s=oc(r),a=mu(r),o=AD(a.x),l=RD(a.x),u=ND(a.x),c=CD(a.x),h=ND(a.y),d=CD(a.y),f=xe(s.x.add(u),s.y.add(h)).sub(.5).mul(e.xy),m=xe(s.x.add(c),s.y.add(h)).sub(.5).mul(e.xy),_=xe(s.x.add(u),s.y.add(d)).sub(.5).mul(e.xy),g=xe(s.x.add(c),s.y.add(d)).sub(.5).mul(e.xy),p=AD(a.y).mul(Hr(o.mul(n.sample(f).level(t)),l.mul(n.sample(m).level(t)))),y=RD(a.y).mul(Hr(o.mul(n.sample(_).level(t)),l.mul(n.sample(g).level(t))));return p.add(y)},Dte=ue(([n,e])=>{const t=xe(n.size(Dn(e))),i=xe(n.size(Dn(e.add(1)))),r=Ya(1,t),s=Ya(1,i),a=DD(n,St(r,t),oc(e)),o=DD(n,St(s,i),DA(e));return mu(e).mix(a,o)}),LD=ue(([n,e,t,i,r])=>{const s=ae(VB(e.negate(),Vm(n),Ya(1,i))),a=ae(Yo(r[0].xyz),Yo(r[1].xyz),Yo(r[2].xyz));return Vm(s).mul(t.mul(a))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),Lte=ue(([n,e])=>n.mul(nl(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),Pte=vF(),Ute=vF(),PD=ue(([n,e,t],{material:i})=>{const s=(i.side===bn?Pte:Ute).sample(n),a=Xo(PE.x).mul(Lte(e,t));return Dte(s,a)}),UD=ue(([n,e,t])=>(ri(t.notEqual(0),()=>{const i=LB(e).negate().div(t);return DB(i.negate().mul(n))}),ae(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),Ote=ue(([n,e,t,i,r,s,a,o,l,u,c,h,d,f,m])=>{let _,g;if(m){_=St().toVar(),g=ae().toVar();const S=c.sub(1).mul(m.mul(.025)),x=ae(c.sub(S),c,c.add(S));oa({start:0,end:3},({i:T})=>{const w=x.element(T),E=LD(n,e,h,w,o),M=a.add(E),N=u.mul(l.mul(St(M,1))),U=xe(N.xy.div(N.w)).toVar();U.addAssign(1),U.divAssign(2),U.assign(xe(U.x,U.y.oneMinus()));const k=PD(U,t,w);_.element(T).assign(k.element(T)),_.a.addAssign(k.a),g.element(T).assign(i.element(T).mul(UD(Yo(E),d,f).element(T)))}),_.a.divAssign(3)}else{const S=LD(n,e,h,c,o),x=a.add(S),T=u.mul(l.mul(St(x,1))),w=xe(T.xy.div(T.w)).toVar();w.addAssign(1),w.divAssign(2),w.assign(xe(w.x,w.y.oneMinus())),_=PD(w,t,c),g=i.mul(UD(Yo(S),d,f))}const p=g.rgb.mul(_.rgb),y=n.dot(e).clamp(),v=ae(LF({dotNV:y,specularColor:r,specularF90:s,roughness:t})),b=g.r.add(g.g,g.b).div(3);return St(v.oneMinus().mul(p),_.a.oneMinus().mul(b).oneMinus())}),Ite=xr(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),Bte=n=>{const e=n.sqrt();return ae(1).add(e).div(ae(1).sub(e))},OD=(n,e)=>n.sub(e).div(n.add(e)).pow2(),Fte=(n,e)=>{const t=n.mul(2*Math.PI*1e-9),i=ae(54856e-17,44201e-17,52481e-17),r=ae(1681e3,1795300,2208400),s=ae(43278e5,93046e5,66121e5),a=te(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let o=i.mul(s.mul(2*Math.PI).sqrt()).mul(r.mul(t).add(e).cos()).mul(t.pow2().negate().mul(s).exp());return o=ae(o.x.add(a),o.y,o.z).div(10685e-11),Ite.mul(o)},kte=ue(({outsideIOR:n,eta2:e,cosTheta1:t,thinFilmThickness:i,baseF0:r})=>{const s=On(n,e,au(0,.03,i)),o=n.div(s).pow2().mul(t.pow2().oneMinus()).oneMinus();ri(o.lessThan(0),()=>ae(1));const l=o.sqrt(),u=OD(s,n),c=Wm({f0:u,f90:1,dotVH:t}),h=c.oneMinus(),d=s.lessThan(n).select(Math.PI,0),f=te(Math.PI).sub(d),m=Bte(r.clamp(0,.9999)),_=OD(m,s.toVec3()),g=Wm({f0:_,f90:1,dotVH:l}),p=ae(m.x.lessThan(s).select(Math.PI,0),m.y.lessThan(s).select(Math.PI,0),m.z.lessThan(s).select(Math.PI,0)),y=s.mul(i,l,2),v=ae(f).add(p),b=c.mul(g).clamp(1e-5,.9999),S=b.sqrt(),x=h.pow2().mul(g).div(ae(1).sub(b)),w=c.add(x).toVar(),E=x.sub(h).toVar();return oa({start:1,end:2,condition:"<=",name:"m"},({m:M})=>{E.mulAssign(S);const N=Fte(te(M).mul(y),te(M).mul(v)).mul(2);w.addAssign(E.mul(N))}),w.max(ae(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),zte=ue(({normal:n,viewDir:e,roughness:t})=>{const i=n.dot(e).saturate(),r=t.pow2(),s=Sr(t.lessThan(.25),te(-339.2).mul(r).add(te(161.4).mul(t)).sub(25.9),te(-8.48).mul(r).add(te(14.3).mul(t)).sub(9.95)),a=Sr(t.lessThan(.25),te(44).mul(r).sub(te(23.7).mul(t)).add(3.26),te(1.97).mul(r).sub(te(3.27).mul(t)).add(.72));return Sr(t.lessThan(.25),0,te(.1).mul(t).sub(.025)).add(s.mul(i).add(a).exp()).mul(1/Math.PI).saturate()}),mx=ae(.04),gx=te(1);class OF extends mb{constructor(e=!1,t=!1,i=!1,r=!1,s=!1,a=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=i,this.anisotropy=r,this.transmission=s,this.dispersion=a,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=ae().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=ae().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=ae().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=ae().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=ae().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=fn.dot(Yn).clamp();this.iridescenceFresnel=kte({outsideIOR:te(1),eta2:xB,cosTheta1:t,thinFilmThickness:TB,baseF0:ss}),this.iridescenceF0=Mte({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=nf,i=gJ.sub(nf).normalize(),r=Cf,s=e.context;s.backdrop=Ote(r,i,Co,Kt,ss,Vv,t,Sc,ol,eF,Dy,EB,wB,MB,this.dispersion?AB:null),s.backdropAlpha=LE,Kt.a.mulAssign(On(1,s.backdrop.a,LE))}super.start(e)}computeMultiscattering(e,t,i){const r=fn.dot(Yn).clamp(),s=DF({roughness:Co,dotNV:r}),o=(this.iridescenceF0?AA.mix(ss,this.iridescenceF0):ss).mul(s.x).add(i.mul(s.y)),u=s.x.add(s.y).oneMinus(),c=ss.add(ss.oneMinus().mul(.047619)),h=o.mul(c).div(u.mul(c).oneMinus());e.addAssign(o),t.addAssign(h.mul(u))}direct({lightDirection:e,lightColor:t,reflectedLight:i}){const s=fn.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(s.mul(Rte({lightDirection:e}))),this.clearcoat===!0){const o=Gh.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(o.mul(MD({lightDirection:e,f0:mx,f90:gx,roughness:Gv,normalView:Gh})))}i.directDiffuse.addAssign(s.mul(rf({diffuseColor:Kt.rgb}))),i.directSpecular.addAssign(s.mul(MD({lightDirection:e,f0:ss,f90:1,roughness:Co,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:i,halfHeight:r,reflectedLight:s,ltc_1:a,ltc_2:o}){const l=t.add(i).sub(r),u=t.sub(i).sub(r),c=t.sub(i).add(r),h=t.add(i).add(r),d=fn,f=Yn,m=ui.toVar(),_=Nte({N:d,V:f,roughness:Co}),g=a.sample(_).toVar(),p=o.sample(_).toVar(),y=xr(ae(g.x,0,g.y),ae(0,1,0),ae(g.z,0,g.w)).toVar(),v=ss.mul(p.x).add(ss.oneMinus().mul(p.y)).toVar();s.directSpecular.addAssign(e.mul(v).mul(wD({N:d,V:f,P:m,mInv:y,p0:l,p1:u,p2:c,p3:h}))),s.directDiffuse.addAssign(e.mul(Kt).mul(wD({N:d,V:f,P:m,mInv:xr(1,0,0,0,1,0,0,0,1),p0:l,p1:u,p2:c,p3:h})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(t.mul(rf({diffuseColor:Kt})))}indirectSpecular(e){const{radiance:t,iblIrradiance:i,reflectedLight:r}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(i.mul(zh,zte({normal:fn,viewDir:Yn,roughness:wA}))),this.clearcoat===!0){const c=Gh.dot(Yn).clamp(),h=LF({dotNV:c,specularColor:mx,specularF90:gx,roughness:Gv});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(h))}const s=ae().toVar("singleScattering"),a=ae().toVar("multiScattering"),o=i.mul(1/Math.PI);this.computeMultiscattering(s,a,Vv);const l=s.add(a),u=Kt.mul(l.r.max(l.g).max(l.b).oneMinus());r.indirectSpecular.addAssign(t.mul(s)),r.indirectSpecular.addAssign(a.mul(o)),r.indirectDiffuse.addAssign(u.mul(o))}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:i}=e.context,s=fn.dot(Yn).clamp().add(t),a=Co.mul(-16).oneMinus().negate().exp2(),o=t.sub(s.pow(a).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),i.indirectDiffuse.mulAssign(t),i.indirectSpecular.mulAssign(o)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const i=Gh.dot(Yn).clamp(),r=Wm({dotVH:i,f0:mx,f90:gx}),s=t.mul(NE.mul(r).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(NE));t.assign(s)}if(this.sheen===!0){const i=zh.r.max(zh.g).max(zh.b).mul(.157).oneMinus(),r=t.mul(i).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(r)}}}const ID=te(1),FE=te(-2),G_=te(.8),_x=te(-1),V_=te(.4),yx=te(2),H_=te(.305),vx=te(3),BD=te(.21),Gte=te(4),FD=te(4),Vte=te(16),Hte=ue(([n])=>{const e=ae(Ls(n)).toVar(),t=te(-1).toVar();return ri(e.x.greaterThan(e.z),()=>{ri(e.x.greaterThan(e.y),()=>{t.assign(Sr(n.x.greaterThan(0),0,3))}).Else(()=>{t.assign(Sr(n.y.greaterThan(0),1,4))})}).Else(()=>{ri(e.z.greaterThan(e.y),()=>{t.assign(Sr(n.z.greaterThan(0),2,5))}).Else(()=>{t.assign(Sr(n.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),$te=ue(([n,e])=>{const t=xe().toVar();return ri(e.equal(0),()=>{t.assign(xe(n.z,n.y).div(Ls(n.x)))}).ElseIf(e.equal(1),()=>{t.assign(xe(n.x.negate(),n.z.negate()).div(Ls(n.y)))}).ElseIf(e.equal(2),()=>{t.assign(xe(n.x.negate(),n.y).div(Ls(n.z)))}).ElseIf(e.equal(3),()=>{t.assign(xe(n.z.negate(),n.y).div(Ls(n.x)))}).ElseIf(e.equal(4),()=>{t.assign(xe(n.x.negate(),n.z).div(Ls(n.y)))}).Else(()=>{t.assign(xe(n.x,n.y).div(Ls(n.z)))}),Nt(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),Wte=ue(([n])=>{const e=te(0).toVar();return ri(n.greaterThanEqual(G_),()=>{e.assign(ID.sub(n).mul(_x.sub(FE)).div(ID.sub(G_)).add(FE))}).ElseIf(n.greaterThanEqual(V_),()=>{e.assign(G_.sub(n).mul(yx.sub(_x)).div(G_.sub(V_)).add(_x))}).ElseIf(n.greaterThanEqual(H_),()=>{e.assign(V_.sub(n).mul(vx.sub(yx)).div(V_.sub(H_)).add(yx))}).ElseIf(n.greaterThanEqual(BD),()=>{e.assign(H_.sub(n).mul(Gte.sub(vx)).div(H_.sub(BD)).add(vx))}).Else(()=>{e.assign(te(-2).mul(Xo(Nt(1.16,n))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),jte=ue(([n,e])=>{const t=n.toVar();t.assign(Nt(2,t).sub(1));const i=ae(t,1).toVar();return ri(e.equal(0),()=>{i.assign(i.zyx)}).ElseIf(e.equal(1),()=>{i.assign(i.xzy),i.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{i.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{i.assign(i.zyx),i.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{i.assign(i.xzy),i.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{i.z.mulAssign(-1)}),i}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),qte=ue(([n,e,t,i,r,s])=>{const a=te(t),o=ae(e),l=nl(Wte(a),FE,s),u=mu(l),c=oc(l),h=ae(kE(n,o,c,i,r,s)).toVar();return ri(u.notEqual(0),()=>{const d=ae(kE(n,o,c.add(1),i,r,s)).toVar();h.assign(On(h,d,u))}),h}),kE=ue(([n,e,t,i,r,s])=>{const a=te(t).toVar(),o=ae(e),l=te(Hte(o)).toVar(),u=te(rr(FD.sub(a),0)).toVar();a.assign(rr(a,FD));const c=te(Gm(a)).toVar(),h=xe($te(o,l).mul(c.sub(2)).add(1)).toVar();return ri(l.greaterThan(2),()=>{h.y.addAssign(c),l.subAssign(3)}),h.x.addAssign(l.mul(c)),h.x.addAssign(u.mul(Nt(3,Vte))),h.y.addAssign(Nt(4,Gm(s).sub(c))),h.x.mulAssign(i),h.y.mulAssign(r),n.sample(h).grad(xe(),xe())}),bx=ue(({envMap:n,mipInt:e,outputDirection:t,theta:i,axis:r,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:o})=>{const l=Al(i),u=t.mul(l).add(r.cross(t).mul(ra(i))).add(r.mul(r.dot(t).mul(l.oneMinus())));return kE(n,u,e,s,a,o)}),Xte=ue(({n,latitudinal:e,poleAxis:t,outputDirection:i,weights:r,samples:s,dTheta:a,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h})=>{const d=ae(Sr(e,t,FB(t,i))).toVar();ri(d.equal(ae(0)),()=>{d.assign(ae(i.z,0,i.x.negate()))}),d.assign(Vm(d));const f=ae().toVar();return f.addAssign(r.element(0).mul(bx({theta:0,axis:d,outputDirection:i,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h}))),oa({start:Dn(1),end:n},({i:m})=>{ri(m.greaterThanEqual(s),()=>{Uee()});const _=te(a.mul(te(m))).toVar();f.addAssign(r.element(m).mul(bx({theta:_.mul(-1),axis:d,outputDirection:i,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h}))),f.addAssign(r.element(m).mul(bx({theta:_,axis:d,outputDirection:i,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h})))}),St(f,1)}),Vh=4,kD=[.125,.215,.35,.446,.526,.582],Xu=20,Sx=new Cg(-1,1,1,-1,0,1),Yte=new Ii(90,1),zD=new Ve;let xx=null,Tx=0,Ex=0;const Hu=(1+Math.sqrt(5))/2,nh=1/Hu,GD=[new D(-Hu,nh,0),new D(Hu,nh,0),new D(-nh,0,Hu),new D(nh,0,Hu),new D(0,Hu,-nh),new D(0,Hu,nh),new D(-1,1,-1),new D(1,1,-1),new D(-1,1,1),new D(1,1,1)],Kte=new D,IF=new WeakMap,Qte=[3,1,5,0,4,2],Mx=jte(Ug(),ou("faceIndex")).normalize(),VA=ae(Mx.x,Mx.y,Mx.z);class Zte{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,i=.1,r=100,s={}){const{size:a=256,position:o=Kte,renderTarget:l=null}=s;if(this._setSize(a),this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const c=l||this._allocateTarget();return s.renderTarget=c,this.fromSceneAsync(e,t,i,r,s),c}xx=this._renderer.getRenderTarget(),Tx=this._renderer.getActiveCubeFace(),Ex=this._renderer.getActiveMipmapLevel();const u=l||this._allocateTarget();return u.depthBuffer=!0,this._init(u),this._sceneToCubeUV(e,i,r,u,o),t>0&&this._blur(u,0,0,t),this._applyPMREM(u),this._cleanup(u),u}async fromSceneAsync(e,t=0,i=.1,r=100,s={}){return this._hasInitialized===!1&&await this._renderer.init(),this.fromScene(e,t,i,r,s)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(e);const i=t||this._allocateTarget();return this.fromEquirectangularAsync(e,i),i}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const i=t||this._allocateTarget();return this.fromCubemapAsync(e,t),i}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=HD(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=$D(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===ja||e.mapping===qa?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(xx,Tx,Ex),e.scissorTest=!1,$_(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),xx=this._renderer.getRenderTarget(),Tx=this._renderer.getActiveCubeFace(),Ex=this._renderer.getActiveMipmapLevel();const i=t||this._allocateTarget();return this._init(i),this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return VD(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=VD(e.width,e.height);const{_lodMax:t}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=Jte(t)),this._blurMaterial=ene(t,e.width,e.height)}}async _compileMaterial(e){const t=new mi(this._lodPlanes[0],e);await this._renderer.compile(t,Sx)}_sceneToCubeUV(e,t,i,r,s){const a=Yte;a.near=t,a.far=i;const o=[1,1,1,1,-1,1],l=[1,-1,1,-1,1,-1],u=this._renderer,c=u.autoClear;u.getClearColor(zD),u.autoClear=!1;let h=this._backgroundBox;if(h===null){const m=new Da({name:"PMREM.Background",side:bn,depthWrite:!1,depthTest:!1});h=new mi(new Dc,m)}let d=!1;const f=e.background;f?f.isColor&&(h.material.color.copy(f),e.background=null,d=!0):(h.material.color.copy(zD),d=!0),u.setRenderTarget(r),u.clear(),d&&u.render(h,a);for(let m=0;m<6;m++){const _=m%3;_===0?(a.up.set(0,o[m],0),a.position.set(s.x,s.y,s.z),a.lookAt(s.x+l[m],s.y,s.z)):_===1?(a.up.set(0,0,o[m]),a.position.set(s.x,s.y,s.z),a.lookAt(s.x,s.y+l[m],s.z)):(a.up.set(0,o[m],0),a.position.set(s.x,s.y,s.z),a.lookAt(s.x,s.y,s.z+l[m]));const g=this._cubeSize;$_(r,_*g,m>2?g:0,g,g),u.render(e,a)}u.autoClear=c,e.background=f}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===ja||e.mapping===qa;r?this._cubemapMaterial===null&&(this._cubemapMaterial=HD(e)):this._equirectMaterial===null&&(this._equirectMaterial=$D(e));const s=r?this._cubemapMaterial:this._equirectMaterial;s.fragmentNode.value=e;const a=this._lodMeshes[0];a.material=s;const o=this._cubeSize;$_(t,0,0,3*o,2*o),i.setRenderTarget(t),i.render(a,Sx)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=GD[(r-s-1)%GD.length];this._blur(e,s-1,s,a,o)}t.autoClear=i}_blur(e,t,i,r,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,r,"latitudinal",s),this._halfBlur(a,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,a,o){const l=this._renderer,u=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,h=this._lodMeshes[r];h.material=u;const d=IF.get(u),f=this._sizeLods[i]-1,m=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*Xu-1),_=s/m,g=isFinite(s)?1+Math.floor(c*_):Xu;g>Xu&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${Xu}`);const p=[];let y=0;for(let T=0;T<Xu;++T){const w=T/_,E=Math.exp(-w*w/2);p.push(E),T===0?y+=E:T<g&&(y+=2*E)}for(let T=0;T<p.length;T++)p[T]=p[T]/y;e.texture.frame=(e.texture.frame||0)+1,d.envMap.value=e.texture,d.samples.value=g,d.weights.array=p,d.latitudinal.value=a==="latitudinal"?1:0,o&&(d.poleAxis.value=o);const{_lodMax:v}=this;d.dTheta.value=m,d.mipInt.value=v-i;const b=this._sizeLods[r],S=3*b*(r>v-Vh?r-v+Vh:0),x=4*(this._cubeSize-b);$_(t,S,x,3*b,2*b),l.setRenderTarget(t),l.render(h,Sx)}}function Jte(n){const e=[],t=[],i=[],r=[];let s=n;const a=n-Vh+1+kD.length;for(let o=0;o<a;o++){const l=Math.pow(2,s);t.push(l);let u=1/l;o>n-Vh?u=kD[o-n+Vh-1]:o===0&&(u=0),i.push(u);const c=1/(l-2),h=-c,d=1+c,f=[h,h,d,h,d,d,h,h,d,d,h,d],m=6,_=6,g=3,p=2,y=1,v=new Float32Array(g*_*m),b=new Float32Array(p*_*m),S=new Float32Array(y*_*m);for(let T=0;T<m;T++){const w=T%3*2/3-1,E=T>2?0:-1,M=[w,E,0,w+2/3,E,0,w+2/3,E+1,0,w,E,0,w+2/3,E+1,0,w,E+1,0],N=Qte[T];v.set(M,g*_*N),b.set(f,p*_*N);const U=[N,N,N,N,N,N];S.set(U,y*_*N)}const x=new Er;x.setAttribute("position",new Wi(v,g)),x.setAttribute("uv",new Wi(b,p)),x.setAttribute("faceIndex",new Wi(S,y)),e.push(x),r.push(new mi(x,null)),s>Vh&&s--}return{lodPlanes:e,sizeLods:t,sigmas:i,lodMeshes:r}}function VD(n,e){const t={magFilter:wi,minFilter:wi,generateMipmaps:!1,type:Fi,format:ii,colorSpace:_c},i=new Nc(n,e,t);return i.texture.mapping=pc,i.texture.name="PMREM.cubeUv",i.texture.isPMREMTexture=!0,i.scissorTest=!0,i}function $_(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function HA(n){const e=new vi;return e.depthTest=!1,e.depthWrite=!1,e.blending=kr,e.name=`PMREM_${n}`,e}function ene(n,e,t){const i=aa(new Array(Xu).fill(0)),r=lt(new D(0,1,0)),s=lt(0),a=te(Xu),o=lt(0),l=lt(1),u=qt(null),c=lt(0),h=te(1/e),d=te(1/t),f=te(n),m={n:a,latitudinal:o,weights:i,poleAxis:r,outputDirection:VA,dTheta:s,samples:l,envMap:u,mipInt:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:f},_=HA("blur");return _.fragmentNode=Xte({...m,latitudinal:o.equal(1)}),IF.set(_,m),_}function HD(n){const e=HA("cubemap");return e.fragmentNode=$m(n,VA),e}function $D(n){const e=HA("equirect");return e.fragmentNode=qt(n,EF(VA),0),e}const WD=new WeakMap;function tne(n){const e=Math.log2(n)-2,t=1/n;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:t,maxMip:e}}function nne(n,e,t){const i=ine(e);let r=i.get(n);if((r!==void 0?r.pmremVersion:-1)!==n.pmremVersion){const a=n.image;if(n.isCubeTexture)if(sne(a))r=t.fromCubemap(n,r);else return null;else if(ane(a))r=t.fromEquirectangular(n,r);else return null;r.pmremVersion=n.pmremVersion,i.set(n,r)}return r.texture}function ine(n){let e=WD.get(n);return e===void 0&&(e=new WeakMap,WD.set(n,e)),e}class rne extends Ci{static get type(){return"PMREMNode"}constructor(e,t=null,i=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=i,this._generator=null;const r=new _i;r.isRenderTargetTexture=!0,this._texture=qt(r),this._width=lt(0),this._height=lt(0),this._maxMip=lt(0),this.updateBeforeType=Rt.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=tne(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const i=t?t.pmremVersion:-1,r=this._value;i!==r.pmremVersion&&(r.isPMREMTexture===!0?t=r:t=nne(r,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new Zte(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this)),t=sF.mul(ae(t.x,t.y.negate(),t.z));let i=this.levelNode;return i===null&&e.context.getTextureLevel&&(i=e.context.getTextureLevel(this)),qte(this._texture,t,i,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function sne(n){if(n==null)return!1;let e=0;const t=6;for(let i=0;i<t;i++)n[i]!==void 0&&e++;return e===t}function ane(n){return n==null?!1:n.height>0}const BF=Xt(rne).setParameterLength(1,3),jD=new WeakMap;class one extends Df{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let i=this.envNode;if(i.isTextureNode||i.isMaterialReferenceNode){const h=i.isTextureNode?i.value:t[i.property];let d=jD.get(h);d===void 0&&(d=BF(h),jD.set(h,d)),i=d}const s=t.useAnisotropy===!0||t.anisotropy>0?GJ:fn,a=i.context(qD(Co,s)).mul(dx),o=i.context(lne(Cf)).mul(Math.PI).mul(dx),l=Py(a),u=Py(o);e.context.radiance.addAssign(l),e.context.iblIrradiance.addAssign(u);const c=e.context.lightingModel.clearcoatRadiance;if(c){const h=i.context(qD(Gv,Gh)).mul(dx),d=Py(h);c.addAssign(d)}}}const qD=(n,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Yn.negate().reflect(e),t=n.mul(n).mix(t,e).normalize(),t=t.transformDirection(ol)),t),getTextureLevel:()=>n}},lne=n=>({getUV:()=>n,getTextureLevel:()=>te(1)}),une=new lI;class FF extends vi{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(une),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new one(t):null}setupLightingModel(){return new OF}setupSpecular(){const e=On(ae(.04),Kt.rgb,zv);ss.assign(e),Vv.assign(1)}setupVariants(){const e=this.metalnessNode?te(this.metalnessNode):eee;zv.assign(e);let t=this.roughnessNode?te(this.roughnessNode):JJ;t=CF({roughness:t}),Co.assign(t),this.setupSpecular(),Kt.assign(St(Kt.rgb.mul(e.oneMinus()),Kt.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const cne=new N5;class hne extends FF{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(cne),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?te(this.iorNode):pee;Dy.assign(e),ss.assign(On(ef(kB(Dy.sub(1).div(Dy.add(1))).mul(ZJ),ae(1)).mul(vD),Kt.rgb,zv)),Vv.assign(On(vD,1,zv))}setupLightingModel(){return new OF(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?te(this.clearcoatNode):nee,i=this.clearcoatRoughnessNode?te(this.clearcoatRoughnessNode):iee;NE.assign(t),Gv.assign(CF({roughness:i}))}if(this.useSheen){const t=this.sheenNode?ae(this.sheenNode):aee,i=this.sheenRoughnessNode?te(this.sheenRoughnessNode):oee;zh.assign(t),wA.assign(i)}if(this.useIridescence){const t=this.iridescenceNode?te(this.iridescenceNode):uee,i=this.iridescenceIORNode?te(this.iridescenceIORNode):cee,r=this.iridescenceThicknessNode?te(this.iridescenceThicknessNode):hee;AA.assign(t),xB.assign(i),TB.assign(r)}if(this.useAnisotropy){const t=(this.anisotropyNode?xe(this.anisotropyNode):lee).toVar();Vu.assign(t.length()),ri(Vu.equal(0),()=>{t.assign(xe(1,0))}).Else(()=>{t.divAssign(xe(Vu)),Vu.assign(Vu.saturate())}),CE.assign(Vu.pow2().mix(Co.pow2(),1)),Cy.assign(wp[0].mul(t.x).add(wp[1].mul(t.y))),sd.assign(wp[1].mul(t.x).sub(wp[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?te(this.transmissionNode):dee,i=this.thicknessNode?te(this.thicknessNode):fee,r=this.attenuationDistanceNode?te(this.attenuationDistanceNode):mee,s=this.attenuationColorNode?ae(this.attenuationColorNode):gee;if(LE.assign(t),EB.assign(i),MB.assign(r),wB.assign(s),this.useDispersion){const a=this.dispersionNode?te(this.dispersionNode):xee;AB.assign(a)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?ae(this.clearcoatNormalNode):ree}setup(e){e.context.setupClearcoatNormal=()=>sm(this.setupClearcoatNormal(e),"NORMAL","vec3"),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const dne=ue(({normal:n,lightDirection:e,builder:t})=>{const i=n.dot(e),r=xe(i.mul(.5).add(.5),0);if(t.material.gradientMap){const s=Ul("gradientMap","texture").context({getUV:()=>r});return ae(s.r)}else{const s=r.fwidth().mul(.5);return On(ae(.7),ae(1),au(te(.7).sub(s.x),te(.7).add(s.x),r.x))}});class fne extends mb{direct({lightDirection:e,lightColor:t,reflectedLight:i},r){const s=dne({normal:iF,lightDirection:e,builder:r}).mul(t);i.directDiffuse.addAssign(s.mul(rf({diffuseColor:Kt.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:i,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(i.mul(rf({diffuseColor:Kt}))),r.indirectDiffuse.mulAssign(t)}}const pne=new D5;class mne extends vi{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(pne),this.setValues(e)}setupLightingModel(){return new fne}}const gne=ue(()=>{const n=ae(Yn.z,0,Yn.x.negate()).normalize(),e=Yn.cross(n);return xe(n.dot(fn),e.dot(fn)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),_ne=new O5;class yne extends vi{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(_ne),this.setValues(e)}setupVariants(e){const t=gne;let i;e.material.matcap?i=Ul("matcap","texture").context({getUV:()=>t}):i=ae(On(.2,.8,t.y)),Kt.rgb.mulAssign(i.rgb)}}class vne extends Ci{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:i}=this;if(this.getNodeType(e)==="vec2"){const s=t.cos(),a=t.sin();return MA(s,a,a.negate(),s).mul(i)}else{const s=t,a=rd(St(1,0,0,0),St(0,Al(s.x),ra(s.x).negate(),0),St(0,ra(s.x),Al(s.x),0),St(0,0,0,1)),o=rd(St(Al(s.y),0,ra(s.y),0),St(0,1,0,0),St(ra(s.y).negate(),0,Al(s.y),0),St(0,0,0,1)),l=rd(St(Al(s.z),ra(s.z).negate(),0,0),St(ra(s.z),Al(s.z),0,0),St(0,0,1,0),St(0,0,0,1));return a.mul(o).mul(l).mul(St(i,1)).xyz}}}const kF=Xt(vne).setParameterLength(2),bne=new r5;class zF extends vi{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(bne),this.setValues(e)}setupPositionView(e){const{object:t,camera:i}=e,{positionNode:r,rotationNode:s,scaleNode:a,sizeAttenuation:o}=this,l=fb.mul(ae(r||0));let u=xe(Sc[0].xyz.length(),Sc[1].xyz.length());a!==null&&(u=u.mul(xe(a))),i.isPerspectiveCamera&&o===!1&&(u=u.mul(l.z.negate()));let c=pb.xy;if(t.center&&t.center.isVector2===!0){const f=GZ("center","vec2",t);c=c.sub(f.sub(.5))}c=c.mul(u);const h=te(s||see),d=kF(c,h);return St(l.xy.add(d),l.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const Sne=new h5,xne=new fe;class Tne extends zF{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(Sne),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return fb.mul(ae(e||Ji)).xyz}setupVertexSprite(e){const{material:t,camera:i}=e,{rotationNode:r,scaleNode:s,sizeNode:a,sizeAttenuation:o}=this;let l=super.setupVertex(e);if(t.isNodeMaterial!==!0)return l;let u=a!==null?xe(a):See;u=u.mul(pJ),i.isPerspectiveCamera&&o===!0&&(u=u.mul(Ene.div(ui.z.negate()))),s&&s.isNode&&(u=u.mul(xe(s)));let c=pb.xy;if(r&&r.isNode){const h=te(r);c=kF(c,h)}return c=c.mul(u),c=c.div(mJ.div(2)),c=c.mul(l.w),l=l.add(St(c,0,0)),l}setupVertex(e){return e.object.isPoints?super.setupVertex(e):this.setupVertexSprite(e)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const Ene=lt(1).onFrameUpdate(function({renderer:n}){const e=n.getSize(xne);this.value=.5*e.y});class Mne extends mb{constructor(){super(),this.shadowNode=te(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){Kt.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(Kt.rgb)}}const wne=new R5;class Ane extends vi{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(wne),this.setValues(e)}setupLightingModel(){return new Mne}}Jl("vec3");Jl("vec3");Jl("vec3");class Rne{constructor(e,t){this.nodes=e,this.info=t,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,i)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this._animationLoop!==null&&this._animationLoop(t,i)};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class fa{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let i=0;i<e.length-1;i++)if(t=t.get(e[i]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let i=this.weakMap;for(let r=0;r<e.length-1;r++){const s=e[r];i.has(s)===!1&&i.set(s,new WeakMap),i=i.get(s)}return i.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let i=0;i<e.length-1;i++)if(t=t.get(e[i]),t===void 0)return!1;return t.delete(e[e.length-1])}}let Nne=0;function Cne(n){const e=Object.keys(n);let t=Object.getPrototypeOf(n);for(;t;){const i=Object.getOwnPropertyDescriptors(t);for(const r in i)if(i[r]!==void 0){const s=i[r];s&&typeof s.get=="function"&&e.push(r)}t=Object.getPrototypeOf(t)}return e}class Dne{constructor(e,t,i,r,s,a,o,l,u,c){this.id=Nne++,this._nodes=e,this._geometries=t,this.renderer=i,this.object=r,this.material=s,this.scene=a,this.camera=o,this.lightsNode=l,this.context=u,this.geometry=r.geometry,this.version=s.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=c,this.clippingContextCacheKey=c!==null?c.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,i=[],r=new Set,s={};for(const a of e){let o;if(a.node&&a.node.attribute?o=a.node.attribute:(o=t.getAttribute(a.name),s[a.name]=o.version),o===void 0)continue;i.push(o);const l=o.isInterleavedBufferAttribute?o.data:o;r.add(l)}return this.attributes=i,this.attributesId=s,this.vertexBuffers=Array.from(r.values()),i}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:i,group:r,drawRange:s}=this,a=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),o=this.getIndex(),l=o!==null;let u=1;if(i.isInstancedBufferGeometry===!0?u=i.instanceCount:e.count!==void 0&&(u=Math.max(0,e.count)),u===0)return null;if(a.instanceCount=u,e.isBatchedMesh===!0)return a;let c=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(c=2);let h=s.start*c,d=(s.start+s.count)*c;r!==null&&(h=Math.max(h,r.start*c),d=Math.min(d,(r.start+r.count)*c));const f=i.attributes.position;let m=1/0;l?m=o.count:f!=null&&(m=f.count),h=Math.max(h,0),d=Math.min(d,m);const _=d-h;return _<0||_===1/0?null:(a.vertexCount=_,a.firstVertex=h,a)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const i of Object.keys(e.attributes).sort()){const r=e.attributes[i];t+=i+",",r.data&&(t+=r.data.stride+","),r.offset&&(t+=r.offset+","),r.itemSize&&(t+=r.itemSize+","),r.normalized&&(t+="n,")}for(const i of Object.keys(e.morphAttributes).sort()){const r=e.morphAttributes[i];t+="morph-"+i+",";for(let s=0,a=r.length;s<a;s++){const o=r[s];t+=o.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t,renderer:i}=this;let r=t.customProgramCacheKey();for(const s of Cne(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(s))continue;const a=t[s];let o;if(a!==null){const l=typeof a;l==="number"?o=a!==0?"1":"0":l==="object"?(o="{",a.isTexture&&(o+=a.mapping,i.backend.isWebGPUBackend===!0&&(o+=a.magFilter,o+=a.minFilter,o+=a.wrapS,o+=a.wrapT,o+=a.wrapR)),o+="}"):o=String(a)}else o=String(a);r+=o+","}return r+=this.clippingContextCacheKey+",",e.geometry&&(r+=this.getGeometryCacheKey()),e.skeleton&&(r+=e.skeleton.bones.length+","),e.isBatchedMesh&&(r+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(r+=e._colorsTexture.uuid+",")),(e.isInstancedMesh||e.count>1)&&(r+=e.uuid+","),r+=e.receiveShadow+",",UK(r)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const e=this.attributesId;for(const t in e){const i=this.geometry.getAttribute(t);if(i===void 0||e[t]!==i.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=Ov(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=Ov(e,1)),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const Du=[];class Lne{constructor(e,t,i,r,s,a){this.renderer=e,this.nodes=t,this.geometries=i,this.pipelines=r,this.bindings=s,this.info=a,this.chainMaps={}}get(e,t,i,r,s,a,o,l){const u=this.getChainMap(l);Du[0]=e,Du[1]=t,Du[2]=a,Du[3]=s;let c=u.get(Du);return c===void 0?(c=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,i,r,s,a,o,l),u.set(Du,c)):(c.updateClipping(o),c.needsGeometryUpdate&&c.setGeometry(e.geometry),(c.version!==t.version||c.needsUpdate)&&(c.initialCacheKey!==c.getCacheKey()?(c.dispose(),c=this.get(e,t,i,r,s,a,o,l)):c.version=t.version)),Du.length=0,c}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new fa)}dispose(){this.chainMaps={}}createRenderObject(e,t,i,r,s,a,o,l,u,c,h){const d=this.getChainMap(h),f=new Dne(e,t,i,r,s,a,o,l,u,c);return f.onDispose=()=>{this.pipelines.delete(f),this.bindings.delete(f),this.nodes.delete(f),d.delete(f.getChainArray())},f}}class _u{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const Fs={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},Ol=16,Pne=211,Une=212;class One extends _u{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const i=this.get(e);if(i.version===void 0)t===Fs.VERTEX?this.backend.createAttribute(e):t===Fs.INDEX?this.backend.createIndexAttribute(e):t===Fs.STORAGE?this.backend.createStorageAttribute(e):t===Fs.INDIRECT&&this.backend.createIndirectStorageAttribute(e),i.version=this._getBufferAttribute(e).version;else{const r=this._getBufferAttribute(e);(i.version<r.version||r.usage===Ih)&&(this.backend.updateAttribute(e),i.version=r.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function GF(n){return n.index!==null?n.index.version:n.attributes.position.version}function XD(n){const e=[],t=n.index,i=n.attributes.position;if(t!==null){const s=t.array;for(let a=0,o=s.length;a<o;a+=3){const l=s[a+0],u=s[a+1],c=s[a+2];e.push(l,u,u,c,c,l)}}else{const s=i.array;for(let a=0,o=s.length/3-1;a<o;a+=3){const l=a+0,u=a+1,c=a+2;e.push(l,u,u,c,c,l)}}const r=new(Vw(e)?qw:jw)(e,1);return r.version=GF(n),r}class Ine extends _u{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,i=this.get(t);i.initialized=!0,this.info.memory.geometries++;const r=()=>{this.info.memory.geometries--;const s=t.index,a=e.getAttributes();s!==null&&this.attributes.delete(s);for(const l of a)this.attributes.delete(l);const o=this.wireframes.get(t);o!==void 0&&this.attributes.delete(o),t.removeEventListener("dispose",r)};t.addEventListener("dispose",r)}updateAttributes(e){const t=e.getAttributes();for(const s of t)s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute?this.updateAttribute(s,Fs.STORAGE):this.updateAttribute(s,Fs.VERTEX);const i=this.getIndex(e);i!==null&&this.updateAttribute(i,Fs.INDEX);const r=e.geometry.indirect;r!==null&&this.updateAttribute(r,Fs.INDIRECT)}updateAttribute(e,t){const i=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,i)):this.attributeCall.get(e.data)!==i&&(this.attributes.update(e,t),this.attributeCall.set(e.data,i),this.attributeCall.set(e,i)):this.attributeCall.get(e)!==i&&(this.attributes.update(e,t),this.attributeCall.set(e,i))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:i}=e;let r=t.index;if(i.wireframe===!0){const s=this.wireframes;let a=s.get(t);a===void 0?(a=XD(t),s.set(t,a)):a.version!==GF(t)&&(this.attributes.delete(a),a=XD(t),s.set(t,a)),r=a}return r}}class Bne{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,i){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=i*(t/3):e.isPoints?this.render.points+=i*t:e.isLineSegments?this.render.lines+=i*(t/2):e.isLine?this.render.lines+=i*(t-1):console.error("THREE.WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class VF{constructor(e){this.cacheKey=e,this.usedTimes=0}}class Fne extends VF{constructor(e,t,i){super(e),this.vertexProgram=t,this.fragmentProgram=i}}class kne extends VF{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let zne=0;class wx{constructor(e,t,i,r=null,s=null){this.id=zne++,this.code=e,this.stage=t,this.name=i,this.transforms=r,this.attributes=s,this.usedTimes=0}}class Gne extends _u{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:i}=this,r=this.get(e);if(this._needsComputeUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.computeProgram.usedTimes--);const a=this.nodes.getForCompute(e);let o=this.programs.compute.get(a.computeShader);o===void 0&&(s&&s.computeProgram.usedTimes===0&&this._releaseProgram(s.computeProgram),o=new wx(a.computeShader,"compute",e.name,a.transforms,a.nodeAttributes),this.programs.compute.set(a.computeShader,o),i.createProgram(o));const l=this._getComputeCacheKey(e,o);let u=this.caches.get(l);u===void 0&&(s&&s.usedTimes===0&&this._releasePipeline(s),u=this._getComputePipeline(e,o,l,t)),u.usedTimes++,o.usedTimes++,r.version=e.version,r.pipeline=u}return r.pipeline}getForRender(e,t=null){const{backend:i}=this,r=this.get(e);if(this._needsRenderUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.vertexProgram.usedTimes--,s.fragmentProgram.usedTimes--);const a=e.getNodeBuilderState(),o=e.material?e.material.name:"";let l=this.programs.vertex.get(a.vertexShader);l===void 0&&(s&&s.vertexProgram.usedTimes===0&&this._releaseProgram(s.vertexProgram),l=new wx(a.vertexShader,"vertex",o),this.programs.vertex.set(a.vertexShader,l),i.createProgram(l));let u=this.programs.fragment.get(a.fragmentShader);u===void 0&&(s&&s.fragmentProgram.usedTimes===0&&this._releaseProgram(s.fragmentProgram),u=new wx(a.fragmentShader,"fragment",o),this.programs.fragment.set(a.fragmentShader,u),i.createProgram(u));const c=this._getRenderCacheKey(e,l,u);let h=this.caches.get(c);h===void 0?(s&&s.usedTimes===0&&this._releasePipeline(s),h=this._getRenderPipeline(e,l,u,c,t)):e.pipeline=h,h.usedTimes++,l.usedTimes++,u.usedTimes++,r.pipeline=h}return r.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,i,r){i=i||this._getComputeCacheKey(e,t);let s=this.caches.get(i);return s===void 0&&(s=new kne(i,t),this.caches.set(i,s),this.backend.createComputePipeline(s,r)),s}_getRenderPipeline(e,t,i,r,s){r=r||this._getRenderCacheKey(e,t,i);let a=this.caches.get(r);return a===void 0&&(a=new Fne(r,t,i),this.caches.set(r,a),e.pipeline=a,this.backend.createRenderPipeline(e,s)),a}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,i){return t.id+","+i.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,i=e.stage;this.programs[i].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class Vne extends _u{constructor(e,t,i,r,s,a){super(),this.backend=e,this.textures=i,this.pipelines=s,this.attributes=r,this.nodes=t,this.info=a,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const i of t){const r=this.get(i);r.bindGroup===void 0&&(this._init(i),this.backend.createBindings(i,t,0),r.bindGroup=i)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const i of t){const r=this.get(i);r.bindGroup===void 0&&(this._init(i),this.backend.createBindings(i,t,0),r.bindGroup=i)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isStorageBuffer){const i=t.attribute,r=i.isIndirectStorageBufferAttribute?Fs.INDIRECT:Fs.STORAGE;this.attributes.update(i,r)}}_update(e,t){const{backend:i}=this;let r=!1,s=!0,a=0,o=0;for(const l of e.bindings)if(!(l.isNodeUniformsGroup&&this.nodes.updateGroup(l)===!1)){if(l.isStorageBuffer){const u=l.attribute,c=u.isIndirectStorageBufferAttribute?Fs.INDIRECT:Fs.STORAGE;this.attributes.update(u,c)}if(l.isUniformBuffer)l.update()&&i.updateBinding(l);else if(l.isSampledTexture){const u=l.update(),c=l.texture,h=this.textures.get(c);if(u&&(this.textures.updateTexture(c),l.generation!==h.generation&&(l.generation=h.generation,r=!0,s=!1)),i.get(c).externalTexture!==void 0||h.isDefaultTexture?s=!1:(a=a*10+c.id,o+=c.version),c.isStorageTexture===!0){const f=this.get(c);l.store===!0?f.needsMipmap=!0:this.textures.needsMipmaps(c)&&f.needsMipmap===!0&&(this.backend.generateMipmaps(c),f.needsMipmap=!1)}}else l.isSampler&&l.update()}r===!0&&this.backend.updateBindings(e,t,s?a:0,o)}}function Hne(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?n.z-e.z:n.id-e.id}function YD(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function KD(n){return(n.transmission>0||n.transmissionNode)&&n.side===Qi&&n.forceSinglePass===!1}class $ne{constructor(e,t,i){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,i),this.lightsArray=[],this.scene=t,this.camera=i,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,i,r,s,a,o){let l=this.renderItems[this.renderItemsIndex];return l===void 0?(l={id:e.id,object:e,geometry:t,material:i,groupOrder:r,renderOrder:e.renderOrder,z:s,group:a,clippingContext:o},this.renderItems[this.renderItemsIndex]=l):(l.id=e.id,l.object=e,l.geometry=t,l.material=i,l.groupOrder=r,l.renderOrder=e.renderOrder,l.z=s,l.group=a,l.clippingContext=o),this.renderItemsIndex++,l}push(e,t,i,r,s,a,o){const l=this.getNextRenderItem(e,t,i,r,s,a,o);e.occlusionTest===!0&&this.occlusionQueryCount++,i.transparent===!0||i.transmission>0?(KD(i)&&this.transparentDoublePass.push(l),this.transparent.push(l)):this.opaque.push(l)}unshift(e,t,i,r,s,a,o){const l=this.getNextRenderItem(e,t,i,r,s,a,o);i.transparent===!0||i.transmission>0?(KD(i)&&this.transparentDoublePass.unshift(l),this.transparent.unshift(l)):this.opaque.unshift(l)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||Hne),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||YD),this.transparent.length>1&&this.transparent.sort(t||YD)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const i=this.renderItems[e];if(i.id===null)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.groupOrder=null,i.renderOrder=null,i.z=null,i.group=null,i.clippingContext=null}}}const ap=[];class Wne{constructor(e){this.lighting=e,this.lists=new fa}get(e,t){const i=this.lists;ap[0]=e,ap[1]=t;let r=i.get(ap);return r===void 0&&(r=new $ne(this.lighting,e,t),i.set(ap,r)),ap.length=0,r}dispose(){this.lists=new fa}}let jne=0;class qne{constructor(){this.id=jne++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new Je,this.scissor=!1,this.scissorValue=new Je,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return HF(this)}}function HF(n){const{textures:e,activeCubeFace:t,activeMipmapLevel:i}=n,r=[t,i];for(const s of e)r.push(s.id);return gA(r)}const op=[],Xne=new J0,Yne=new Xw;class Kne{constructor(){this.chainMaps={}}get(e,t,i=null){op[0]=e,op[1]=t;let r;if(i===null)r="default";else{const o=i.texture.format;r=`${i.textures.length}:${o}:${i.samples}:${i.depthBuffer}:${i.stencilBuffer}`}const s=this._getChainMap(r);let a=s.get(op);return a===void 0&&(a=new qne,s.set(op,a)),op.length=0,i!==null&&(a.sampleCount=i.samples===0?1:i.samples),a}getForClear(e=null){return this.get(Xne,Yne,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new fa)}dispose(){this.chainMaps={}}}const Qne=new D;class Zne extends _u{constructor(e,t,i){super(),this.renderer=e,this.backend=t,this.info=i}updateRenderTarget(e,t=0){const i=this.get(e),r=e.samples===0?1:e.samples,s=i.depthTextureMips||(i.depthTextureMips={}),a=e.textures,o=this.getSize(a[0]),l=o.width>>t,u=o.height>>t;let c=e.depthTexture||s[t];const h=e.depthBuffer===!0||e.stencilBuffer===!0;let d=!1;c===void 0&&h&&(c=new ks,c.format=e.stencilBuffer?ys:_s,c.type=e.stencilBuffer?gs:wn,c.image.width=l,c.image.height=u,c.image.depth=o.depth,c.isArrayTexture=e.multiview===!0&&o.depth>1,s[t]=c),(i.width!==o.width||o.height!==i.height)&&(d=!0,c&&(c.needsUpdate=!0,c.image.width=l,c.image.height=u,c.image.depth=c.isArrayTexture?c.image.depth:1)),i.width=o.width,i.height=o.height,i.textures=a,i.depthTexture=c||null,i.depth=e.depthBuffer,i.stencil=e.stencilBuffer,i.renderTarget=e,i.sampleCount!==r&&(d=!0,c&&(c.needsUpdate=!0),i.sampleCount=r);const f={sampleCount:r};if(e.isXRRenderTarget!==!0){for(let m=0;m<a.length;m++){const _=a[m];d&&(_.needsUpdate=!0),this.updateTexture(_,f)}c&&this.updateTexture(c,f)}if(i.initialized!==!0){i.initialized=!0;const m=()=>{e.removeEventListener("dispose",m);for(let _=0;_<a.length;_++)this._destroyTexture(a[_]);c&&this._destroyTexture(c),this.delete(e),this.backend.delete(e)};e.addEventListener("dispose",m)}}updateTexture(e,t={}){const i=this.get(e);if(i.initialized===!0&&i.version===e.version)return;const r=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,s=this.backend;if(r&&i.initialized===!0&&(s.destroySampler(e),s.destroyTexture(e)),e.isFramebufferTexture){const u=this.renderer.getRenderTarget();u?e.type=u.texture.type:e.type=Kn}const{width:a,height:o,depth:l}=this.getSize(e);if(t.width=a,t.height=o,t.depth=l,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,a,o):1,e.isCubeTexture&&e.mipmaps.length>0&&t.levels++,r||e.isStorageTexture===!0||e.isExternalTexture===!0)s.createSampler(e),s.createTexture(e,t),i.generation=e.version;else if(i.initialized!==!0&&s.createSampler(e),e.version>0){const c=e.image;if(c===void 0)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(c.complete===!1)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const h=[];for(const d of e.images)h.push(d);t.images=h}else t.image=c;(i.isDefaultTexture===void 0||i.isDefaultTexture===!0)&&(s.createTexture(e,t),i.isDefaultTexture=!1,i.generation=e.version),e.source.dataReady===!0&&s.updateTexture(e,t),t.needsMipmaps&&e.mipmaps.length===0&&s.generateMipmaps(e),e.onUpdate&&e.onUpdate(e)}}else s.createDefaultTexture(e),i.isDefaultTexture=!0,i.generation=e.version;if(i.initialized!==!0){i.initialized=!0,i.generation=e.version,this.info.memory.textures++,e.isVideoTexture&&Ze.getTransfer(e.colorSpace)!==Re&&console.warn("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace.");const u=()=>{e.removeEventListener("dispose",u),this._destroyTexture(e)};e.addEventListener("dispose",u)}i.version=e.version}getSize(e,t=Qne){let i=e.images?e.images[0]:e.image;return i?(i.image!==void 0&&(i=i.image),typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement?(t.width=i.videoWidth||1,t.height=i.videoHeight||1,t.depth=1):i instanceof VideoFrame?(t.width=i.displayWidth||1,t.height=i.displayHeight||1,t.depth=1):(t.width=i.width||1,t.height=i.height||1,t.depth=e.isCubeTexture?6:i.depth||1)):t.width=t.height=t.depth=1,t}getMipLevels(e,t,i){let r;return e.mipmaps.length>0?r=e.mipmaps.length:e.isCompressedTexture===!0?r=1:r=Math.floor(Math.log2(Math.max(t,i)))+1,r}needsMipmaps(e){return e.generateMipmaps===!0||e.mipmaps.length>0}_destroyTexture(e){this.has(e)===!0&&(this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e),this.info.memory.textures--)}}class $A extends Ve{constructor(e,t,i,r=1){super(e,t,i),this.a=r}set(e,t,i,r=1){return this.a=r,super.set(e,t,i)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class Jne extends on{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class eie extends ke{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this.isStackNode=!0}getNodeType(e){return this.hasOutput?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.hasOutput?this.outputNode.getMemberType(e,t):"void"}add(e){return e.isNode!==!0?(console.error("THREE.TSL: Invalid node added to stack."),this):(this.nodes.push(e),this)}If(e,t){const i=new Mp(t);return this._currentCond=Sr(e,i),this.add(this._currentCond)}ElseIf(e,t){const i=new Mp(t),r=Sr(e,i);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(e){return this._currentCond.elseNode=new Mp(e),this}Switch(e){return this._expressionNode=de(e),this}Case(...e){const t=[];if(e.length>=2)for(let o=0;o<e.length-1;o++)t.push(this._expressionNode.equal(de(e[o])));else console.error("THREE.TSL: Invalid parameter length. Case() requires at least two parameters.");const i=e[e.length-1],r=new Mp(i);let s=t[0];for(let o=1;o<t.length;o++)s=s.or(t[o]);const a=Sr(s,r);return this._currentCond===null?(this._currentCond=a,this.add(this._currentCond)):(this._currentCond.elseNode=a,this._currentCond=a,this)}Default(e){return this.Else(e),this}setup(e){const t=e.getNodeProperties(this);let i=0;for(const r of this.getChildren())r.isVarNode&&r.intent===!0&&e.getNodeProperties(r).assign!==!0||(t["node"+i++]=r);return t.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(e,...t){const i=e.currentStack,r=TA();Fv(this),e.currentStack=this;const s=e.buildStage;for(const o of this.nodes)if(!(o.isVarNode&&o.intent===!0&&e.getNodeProperties(o).assign!==!0)){if(s==="setup")o.build(e);else if(s==="analyze")o.build(e,this);else if(s==="generate"){const l=e.getDataFromNode(o,"any").stages,u=l&&l[e.shaderStage];if(o.isVarNode&&u&&u.length===1&&u[0]&&u[0].isStackNode)continue;o.build(e,"void")}}let a;return this.hasOutput?a=this.outputNode.build(e,...t):a=super.build(e,...t),Fv(r),e.currentStack=i,a}}const Ax=Xt(eie).setParameterLength(0,1);new ia;new D;new D;new D;new zt;new D(0,0,-1);new Je;new D;new D;new Je;new fe;const tie=new Nc;od.flipX();tie.depthTexture=new ks(1,1);const Rx=new Cg(-1,1,1,-1,0,1);class nie extends Er{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new hi([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new hi(t,2))}}const iie=new nie;class WA extends mi{constructor(e=null){super(iie,e),this.camera=Rx,this.isQuadMesh=!0}async renderAsync(e){return e.renderAsync(this,Rx)}render(e){e.render(this,Rx)}}class jm extends ke{static get type(){return"EventNode"}constructor(e,t){super("void"),this.eventType=e,this.callback=t,e===jm.OBJECT?this.updateType=Rt.OBJECT:e===jm.MATERIAL&&(this.updateType=Rt.RENDER)}update(e){this.callback(e)}}jm.OBJECT="object";jm.MATERIAL="material";const lp=new Vr,Nx=new zt;class Fr extends ke{static get type(){return"SceneNode"}constructor(e=Fr.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,i=this.scene!==null?this.scene:e.scene;let r;return t===Fr.BACKGROUND_BLURRINESS?r=Mn("backgroundBlurriness","float",i):t===Fr.BACKGROUND_INTENSITY?r=Mn("backgroundIntensity","float",i):t===Fr.BACKGROUND_ROTATION?r=lt("mat4").setName("backgroundRotation").setGroup(Ke).onRenderUpdate(()=>{const s=i.background;return s!==null&&s.isTexture&&s.mapping!==Lw?(lp.copy(i.backgroundRotation),lp.x*=-1,lp.y*=-1,lp.z*=-1,Nx.makeRotationFromEuler(lp)):Nx.identity(),Nx}):console.error("THREE.SceneNode: Unknown scope:",t),r}}Fr.BACKGROUND_BLURRINESS="backgroundBlurriness";Fr.BACKGROUND_INTENSITY="backgroundIntensity";Fr.BACKGROUND_ROTATION="backgroundRotation";const rie=Se(Fr,Fr.BACKGROUND_BLURRINESS),QD=Se(Fr,Fr.BACKGROUND_INTENSITY),sie=Se(Fr,Fr.BACKGROUND_ROTATION),aie=ue(({texture:n,uv:e})=>{const i=ae().toVar();return ri(e.x.lessThan(1e-4),()=>{i.assign(ae(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{i.assign(ae(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{i.assign(ae(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{i.assign(ae(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{i.assign(ae(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{i.assign(ae(0,0,-1))}).Else(()=>{const s=n.sample(e.add(ae(-.01,0,0))).r.sub(n.sample(e.add(ae(.01,0,0))).r),a=n.sample(e.add(ae(0,-.01,0))).r.sub(n.sample(e.add(ae(0,.01,0))).r),o=n.sample(e.add(ae(0,0,-.01))).r.sub(n.sample(e.add(ae(0,0,.01))).r);i.assign(ae(s,a,o))}),i.normalize()});class oie extends Nf{static get type(){return"Texture3DNode"}constructor(e,t=null,i=null){super(e,t,i),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return ae(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const i=this.value;return e.isFlipY()&&(i.isRenderTargetTexture===!0||i.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(Dn(ad(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,"vec3")}generateOffset(e,t){return t.build(e,"ivec3")}normal(e){return aie({texture:this,uv:e})}}const lie=Xt(oie).setParameterLength(1,3),W_=new fe;class uie extends Nf{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class ZD extends uie{static get type(){return"PassMultipleTextureNode"}constructor(e,t,i=!1){super(e,null),this.textureName=t,this.previousTexture=i}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e}}class _b extends Ci{static get type(){return"PassNode"}constructor(e,t,i,r={}){super("vec4"),this.scope=e,this.scene=t,this.camera=i,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const s=new ks;s.isRenderTargetTexture=!0,s.name="depth";const a=new Nc(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Fi,...r});a.texture.name="output",a.depthTexture=s,this.renderTarget=a,this._textures={output:a.texture,depth:s},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=lt(0),this._cameraFar=lt(0),this._mrt=null,this._layers=null,this._resolution=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=Rt.FRAME,this.global=!0}setResolution(e){return this._resolution=e,this}getResolution(){return this._resolution}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const i=this._textures[e],r=this.renderTarget.textures.indexOf(i);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=i,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=de(new ZD(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=de(new ZD(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const i=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=bF(this.getTextureNode(e),i,r)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const i=this._cameraNear,r=this._cameraFar,s=this.getViewZNode(e);this._linearDepthNodes[e]=t=am(s,i,r)}return t}async compileAsync(e){const t=e.getRenderTarget(),i=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(i)}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,this.renderTarget.texture.type=e.getColorBufferType(),this.scope===_b.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:i}=this;let r,s;const a=t.getOutputRenderTarget();a&&a.isXRRenderTarget===!0?(s=1,r=t.xr.getCamera(),t.xr.updateCamera(r),W_.set(a.width,a.height)):(r=this.camera,s=t.getPixelRatio(),t.getSize(W_)),this._pixelRatio=s,this.setSize(W_.width,W_.height);const o=t.getRenderTarget(),l=t.getMRT(),u=r.layers.mask;this._cameraNear.value=r.near,this._cameraFar.value=r.far,this._layers!==null&&(r.layers.mask=this._layers.mask);for(const c in this._previousTextures)this.toggleTexture(c);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(i,r),t.setRenderTarget(o),t.setMRT(l),r.layers.mask=u}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio*this._resolution,r=this._height*this._pixelRatio*this._resolution;this.renderTarget.setSize(i,r),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,i,r){e===null?this._scissor=null:(this._scissor===null&&(this._scissor=new Je),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,i,r),this._scissor.multiplyScalar(this._pixelRatio*this._resolution).floor())}setViewport(e,t,i,r){e===null?this._viewport=null:(this._viewport===null&&(this._viewport=new Je),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,i,r),this._viewport.multiplyScalar(this._pixelRatio*this._resolution).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}_b.COLOR="color";_b.DEPTH="depth";const cie=ue(([n,e])=>n.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),hie=ue(([n,e])=>(n=n.mul(e),n.div(n.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),die=ue(([n,e])=>{n=n.mul(e),n=n.sub(.004).max(0);const t=n.mul(n.mul(6.2).add(.5)),i=n.mul(n.mul(6.2).add(1.7)).add(.06);return t.div(i).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),fie=ue(([n])=>{const e=n.mul(n.add(.0245786)).sub(90537e-9),t=n.mul(n.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),pie=ue(([n,e])=>{const t=xr(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),i=xr(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(e).div(.6),n=t.mul(n),n=fie(n),n=i.mul(n),n.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),mie=xr(ae(1.6605,-.1246,-.0182),ae(-.5876,1.1329,-.1006),ae(-.0728,-.0083,1.1187)),gie=xr(ae(.6274,.0691,.0164),ae(.3293,.9195,.088),ae(.0433,.0113,.8956)),_ie=ue(([n])=>{const e=ae(n).toVar(),t=ae(e.mul(e)).toVar(),i=ae(t.mul(t)).toVar();return te(15.5).mul(i.mul(t)).sub(Nt(40.14,i.mul(e))).add(Nt(31.96,i).sub(Nt(6.868,t.mul(e))).add(Nt(.4298,t).add(Nt(.1191,e).sub(.00232))))}),yie=ue(([n,e])=>{const t=ae(n).toVar(),i=xr(ae(.856627153315983,.137318972929847,.11189821299995),ae(.0951212405381588,.761241990602591,.0767994186031903),ae(.0482516061458583,.101439036467562,.811302368396859)),r=xr(ae(1.1271005818144368,-.1413297634984383,-.14132976349843826),ae(-.11060664309660323,1.157823702216272,-.11060664309660294),ae(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=te(-12.47393),a=te(4.026069);return t.mulAssign(e),t.assign(gie.mul(t)),t.assign(i.mul(t)),t.assign(rr(t,1e-10)),t.assign(Xo(t)),t.assign(t.sub(s).div(a.sub(s))),t.assign(nl(t,0,1)),t.assign(_ie(t)),t.assign(r.mul(t)),t.assign(cb(rr(ae(0),t),ae(2.2))),t.assign(mie.mul(t)),t.assign(nl(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),vie=ue(([n,e])=>{const t=te(.76),i=te(.15);n=n.mul(e);const r=ef(n.r,ef(n.g,n.b)),s=Sr(r.lessThan(.08),r.sub(Nt(6.25,r.mul(r))),.04);n.subAssign(s);const a=rr(n.r,rr(n.g,n.b));ri(a.lessThan(t),()=>n);const o=dr(1,t),l=dr(1,o.mul(o).div(a.add(o.sub(t))));n.mulAssign(l.div(a));const u=dr(1,Ya(1,i.mul(a.sub(l)).add(1)));return On(n,ae(l),u)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class ur extends ke{static get type(){return"CodeNode"}constructor(e="",t=[],i=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=i}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const r of t)r.build(e);const i=e.getCodeFromNode(this,this.getNodeType(e));return i.code=this.code,i.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class bie extends ur{static get type(){return"FunctionNode"}constructor(e="",t=[],i=""){super(e,t,i)}getNodeType(e){return this.getNodeFunction(e).type}getMemberType(e,t){const i=this.getNodeType(e);return e.getStructTypeNode(i).getMemberType(e,t)}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let i=t.nodeFunction;return i===void 0&&(i=e.parser.parseFunction(this.code),t.nodeFunction=i),i}generate(e,t){super.generate(e);const i=this.getNodeFunction(e),r=i.name,s=i.type,a=e.getCodeFromNode(this,s);r!==""&&(a.name=r);const o=e.getPropertyName(a),l=this.getNodeFunction(e).getCode(o);return a.code=l+`
`,t==="property"?o:e.format(`${o}()`,s,t)}}function $F(n){let e;const t=n.context.getViewZ;return t!==void 0&&(e=t(this)),(e||ui.z).negate()}const Sie=ue(([n,e],t)=>{const i=$F(t);return au(n,e,i)}),xie=ue(([n],e)=>{const t=$F(e);return n.mul(n,t,t).negate().exp().oneMinus()}),JD=ue(([n,e])=>St(e.toFloat().mix(rm.rgb,n.toVec3()),rm.a));class Tie extends ke{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:i}=e;i.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}Xt(Tie);class so extends ke{static get type(){return"AtomicFunctionNode"}constructor(e,t,i){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=i,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),i=t.parents,r=this.method,s=this.getNodeType(e),a=this.getInputType(e),o=this.pointerNode,l=this.valueNode,u=[];u.push(`&${o.build(e,a)}`),l!==null&&u.push(l.build(e,a));const c=`${e.getMethod(r,s)}( ${u.join(", ")} )`;if(i?i.length===1&&i[0].isStackNode===!0:!1)e.addLineFlowCode(c,this);else return t.constNode===void 0&&(t.constNode=tf(c,s).toConst()),t.constNode.build(e)}}so.ATOMIC_LOAD="atomicLoad";so.ATOMIC_STORE="atomicStore";so.ATOMIC_ADD="atomicAdd";so.ATOMIC_SUB="atomicSub";so.ATOMIC_MAX="atomicMax";so.ATOMIC_MIN="atomicMin";so.ATOMIC_AND="atomicAnd";so.ATOMIC_OR="atomicOr";so.ATOMIC_XOR="atomicXor";Xt(so);class $t extends Ci{static get type(){return"SubgroupFunctionNode"}constructor(e,t=null,i=null){super(),this.method=e,this.aNode=t,this.bNode=i}getInputType(e){const t=this.aNode?this.aNode.getNodeType(e):null,i=this.bNode?this.bNode.getNodeType(e):null,r=e.isMatrix(t)?0:e.getTypeLength(t),s=e.isMatrix(i)?0:e.getTypeLength(i);return r>s?t:i}getNodeType(e){const t=this.method;return t===$t.SUBGROUP_ELECT?"bool":t===$t.SUBGROUP_BALLOT?"uvec4":this.getInputType(e)}generate(e,t){const i=this.method,r=this.getNodeType(e),s=this.getInputType(e),a=this.aNode,o=this.bNode,l=[];if(i===$t.SUBGROUP_BROADCAST||i===$t.SUBGROUP_SHUFFLE||i===$t.QUAD_BROADCAST){const c=o.getNodeType(e);l.push(a.build(e,r),o.build(e,c==="float"?"int":r))}else i===$t.SUBGROUP_SHUFFLE_XOR||i===$t.SUBGROUP_SHUFFLE_DOWN||i===$t.SUBGROUP_SHUFFLE_UP?l.push(a.build(e,r),o.build(e,"uint")):(a!==null&&l.push(a.build(e,s)),o!==null&&l.push(o.build(e,s)));const u=l.length===0?"()":`( ${l.join(", ")} )`;return e.format(`${e.getMethod(i,r)}${u}`,r,t)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}$t.SUBGROUP_ELECT="subgroupElect";$t.SUBGROUP_BALLOT="subgroupBallot";$t.SUBGROUP_ADD="subgroupAdd";$t.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";$t.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";$t.SUBGROUP_MUL="subgroupMul";$t.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";$t.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";$t.SUBGROUP_AND="subgroupAnd";$t.SUBGROUP_OR="subgroupOr";$t.SUBGROUP_XOR="subgroupXor";$t.SUBGROUP_MIN="subgroupMin";$t.SUBGROUP_MAX="subgroupMax";$t.SUBGROUP_ALL="subgroupAll";$t.SUBGROUP_ANY="subgroupAny";$t.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";$t.QUAD_SWAP_X="quadSwapX";$t.QUAD_SWAP_Y="quadSwapY";$t.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";$t.SUBGROUP_BROADCAST="subgroupBroadcast";$t.SUBGROUP_SHUFFLE="subgroupShuffle";$t.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";$t.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";$t.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";$t.QUAD_BROADCAST="quadBroadcast";let j_;function yb(n){j_=j_||new WeakMap;let e=j_.get(n);return e===void 0&&j_.set(n,e={}),e}function jA(n){const e=yb(n);return e.shadowMatrix||(e.shadowMatrix=lt("mat4").setGroup(Ke).onRenderUpdate(t=>((n.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&n.shadow.updateMatrices(n),n.shadow.matrix)))}function Eie(n,e=nf){const t=jA(n).mul(e);return t.xyz.div(t.w)}function WF(n){const e=yb(n);return e.position||(e.position=lt(new D).setGroup(Ke).onRenderUpdate((t,i)=>i.value.setFromMatrixPosition(n.matrixWorld)))}function Mie(n){const e=yb(n);return e.targetPosition||(e.targetPosition=lt(new D).setGroup(Ke).onRenderUpdate((t,i)=>i.value.setFromMatrixPosition(n.target.matrixWorld)))}function jF(n){const e=yb(n);return e.viewPosition||(e.viewPosition=lt(new D).setGroup(Ke).onRenderUpdate(({camera:t},i)=>{i.value=i.value||new D,i.value.setFromMatrixPosition(n.matrixWorld),i.value.applyMatrix4(t.matrixWorldInverse)}))}const qF=n=>ol.transformDirection(WF(n).sub(Mie(n))),wie=n=>n.sort((e,t)=>e.id-t.id),Aie=(n,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===n)return t;return null},Cx=new WeakMap,up=[];class XF extends ke{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=Jl("vec3","totalDiffuse"),this.totalSpecularNode=Jl("vec3","totalSpecular"),this.outgoingLightNode=Jl("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let i=0;i<e.length;i++){const r=e[i];if(up.push(r.id),up.push(r.castShadow?1:0),r.isSpotLight===!0){const s=r.map!==null?r.map.id:-1,a=r.colorNode?r.colorNode.getCacheKey():-1;up.push(s,a)}}const t=gA(up);return up.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const i of this._lightNodes)t.push(i.getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const i of t.nodes)i.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],i=this._lightNodes,r=wie(this._lights),s=e.renderer.library;for(const a of r)if(a.isNode)t.push(de(a));else{let o=null;if(i!==null&&(o=Aie(a.id,i)),o===null){const l=s.getLightNodeClass(a.constructor);if(l===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${a.constructor.name}`);continue}let u=null;Cx.has(a)?u=Cx.get(a):(u=de(new l(a)),Cx.set(a,u)),t.push(u)}}this._lightNodes=t}setupDirectLight(e,t,i){const{lightingModel:r,reflectedLight:s}=e.context;r.direct({...i,lightNode:t,reflectedLight:s},e)}setupDirectRectAreaLight(e,t,i){const{lightingModel:r,reflectedLight:s}=e.context;r.directRectArea({...i,lightNode:t,reflectedLight:s},e)}setupLights(e,t){for(const i of t)i.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let i=this.outgoingLightNode;const r=e.context,s=r.lightingModel,a=e.getNodeProperties(this);if(s){const{totalDiffuseNode:o,totalSpecularNode:l}=this;r.outgoingLight=i;const u=e.addStack();a.nodes=u.nodes,s.start(e);const{backdrop:c,backdropAlpha:h}=r,{directDiffuse:d,directSpecular:f,indirectDiffuse:m,indirectSpecular:_}=r.reflectedLight;let g=d.add(m);c!==null&&(h!==null?g=ae(h.mix(g,c)):g=ae(c),r.material.transparent=!0),o.assign(g),l.assign(f.add(_)),i.assign(o.add(l)),s.finish(e),i=i.bypass(e.removeStack())}else a.nodes=[];return e.lightsNode=t,i}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class Rie extends ke{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=Rt.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){YF.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||nf)}}const YF=Jl("vec3","shadowPositionWorld");function Nie(n,e={}){return e.toneMapping=n.toneMapping,e.toneMappingExposure=n.toneMappingExposure,e.outputColorSpace=n.outputColorSpace,e.renderTarget=n.getRenderTarget(),e.activeCubeFace=n.getActiveCubeFace(),e.activeMipmapLevel=n.getActiveMipmapLevel(),e.renderObjectFunction=n.getRenderObjectFunction(),e.pixelRatio=n.getPixelRatio(),e.mrt=n.getMRT(),e.clearColor=n.getClearColor(e.clearColor||new Ve),e.clearAlpha=n.getClearAlpha(),e.autoClear=n.autoClear,e.scissorTest=n.getScissorTest(),e}function Cie(n,e){return e=Nie(n,e),n.setMRT(null),n.setRenderObjectFunction(null),n.setClearColor(0,1),n.autoClear=!0,e}function Die(n,e){n.toneMapping=e.toneMapping,n.toneMappingExposure=e.toneMappingExposure,n.outputColorSpace=e.outputColorSpace,n.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),n.setRenderObjectFunction(e.renderObjectFunction),n.setPixelRatio(e.pixelRatio),n.setMRT(e.mrt),n.setClearColor(e.clearColor,e.clearAlpha),n.autoClear=e.autoClear,n.setScissorTest(e.scissorTest)}function Lie(n,e={}){return e.background=n.background,e.backgroundNode=n.backgroundNode,e.overrideMaterial=n.overrideMaterial,e}function Pie(n,e){return e=Lie(n,e),n.background=null,n.backgroundNode=null,n.overrideMaterial=null,e}function Uie(n,e){n.background=e.background,n.backgroundNode=e.backgroundNode,n.overrideMaterial=e.overrideMaterial}function Oie(n,e,t){return t=Cie(n,t),t=Pie(e,t),t}function Iie(n,e,t){Die(n,t),Uie(e,t)}const e2=new WeakMap,Bie=ue(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{let i=qt(n,e.xy).setName("t_basic");return n.isArrayTexture&&(i=i.depth(t)),i.compare(e.z)}),Fie=ue(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:i})=>{const r=(g,p)=>{let y=qt(n,g);return n.isArrayTexture&&(y=y.depth(i)),y.compare(p)},s=Mn("mapSize","vec2",t).setGroup(Ke),a=Mn("radius","float",t).setGroup(Ke),o=xe(1).div(s),l=o.x.negate().mul(a),u=o.y.negate().mul(a),c=o.x.mul(a),h=o.y.mul(a),d=l.div(2),f=u.div(2),m=c.div(2),_=h.div(2);return Hr(r(e.xy.add(xe(l,u)),e.z),r(e.xy.add(xe(0,u)),e.z),r(e.xy.add(xe(c,u)),e.z),r(e.xy.add(xe(d,f)),e.z),r(e.xy.add(xe(0,f)),e.z),r(e.xy.add(xe(m,f)),e.z),r(e.xy.add(xe(l,0)),e.z),r(e.xy.add(xe(d,0)),e.z),r(e.xy,e.z),r(e.xy.add(xe(m,0)),e.z),r(e.xy.add(xe(c,0)),e.z),r(e.xy.add(xe(d,_)),e.z),r(e.xy.add(xe(0,_)),e.z),r(e.xy.add(xe(m,_)),e.z),r(e.xy.add(xe(l,h)),e.z),r(e.xy.add(xe(0,h)),e.z),r(e.xy.add(xe(c,h)),e.z)).mul(1/17)}),kie=ue(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:i})=>{const r=(h,d)=>{let f=qt(n,h);return n.isArrayTexture&&(f=f.depth(i)),f.compare(d)},s=Mn("mapSize","vec2",t).setGroup(Ke),a=xe(1).div(s),o=a.x,l=a.y,u=e.xy,c=mu(u.mul(s).add(.5));return u.subAssign(c.mul(a)),Hr(r(u,e.z),r(u.add(xe(o,0)),e.z),r(u.add(xe(0,l)),e.z),r(u.add(a),e.z),On(r(u.add(xe(o.negate(),0)),e.z),r(u.add(xe(o.mul(2),0)),e.z),c.x),On(r(u.add(xe(o.negate(),l)),e.z),r(u.add(xe(o.mul(2),l)),e.z),c.x),On(r(u.add(xe(0,l.negate())),e.z),r(u.add(xe(0,l.mul(2))),e.z),c.y),On(r(u.add(xe(o,l.negate())),e.z),r(u.add(xe(o,l.mul(2))),e.z),c.y),On(On(r(u.add(xe(o.negate(),l.negate())),e.z),r(u.add(xe(o.mul(2),l.negate())),e.z),c.x),On(r(u.add(xe(o.negate(),l.mul(2))),e.z),r(u.add(xe(o.mul(2),l.mul(2))),e.z),c.x),c.y)).mul(1/9)}),zie=ue(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{const i=te(1).toVar();let r=qt(n).sample(e.xy);n.isArrayTexture&&(r=r.depth(t)),r=r.rg;const s=BB(e.z,r.x);return ri(s.notEqual(te(1)),()=>{const a=e.z.sub(r.x),o=rr(0,r.y.mul(r.y));let l=o.div(o.add(a.mul(a)));l=nl(dr(l,.3).div(.95-.3)),i.assign(nl(rr(s,l)))}),i}),Gie=ue(([n,e,t])=>{let i=nf.sub(n).length();return i=i.sub(e).div(t.sub(e)),i=i.saturate(),i}),Vie=n=>{const e=n.shadow.camera,t=Mn("near","float",e).setGroup(Ke),i=Mn("far","float",e).setGroup(Ke),r=_J(n);return Gie(r,t,i)},Hie=n=>{let e=e2.get(n);if(e===void 0){const t=n.isPointLight?Vie(n):null;e=new vi,e.colorNode=St(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,e2.set(n,e)}return e},t2=new fa,ih=[],$ie=(n,e,t,i)=>{ih[0]=n,ih[1]=e;let r=t2.get(ih);return(r===void 0||r.shadowType!==t||r.useVelocity!==i)&&(r=(s,a,o,l,u,c,...h)=>{(s.castShadow===!0||s.receiveShadow&&t===os)&&(i&&(_B(s).useVelocity=!0),s.onBeforeShadow(n,s,o,e.camera,l,a.overrideMaterial,c),n.renderObject(s,a,o,l,u,c,...h),s.onAfterShadow(n,s,o,e.camera,l,a.overrideMaterial,c))},r.shadowType=t,r.useVelocity=i,t2.set(ih,r)),ih[0]=null,ih[1]=null,r},Wie=ue(({samples:n,radius:e,size:t,shadowPass:i,depthLayer:r})=>{const s=te(0).toVar("meanVertical"),a=te(0).toVar("squareMeanVertical"),o=n.lessThanEqual(te(1)).select(te(0),te(2).div(n.sub(1))),l=n.lessThanEqual(te(1)).select(te(0),te(-1));oa({start:Dn(0),end:Dn(n),type:"int",condition:"<"},({i:c})=>{const h=l.add(te(c).mul(o));let d=i.sample(Hr(db.xy,xe(0,h).mul(e)).div(t));i.value.isArrayTexture&&(d=d.depth(r)),d=d.x,s.addAssign(d),a.addAssign(d.mul(d))}),s.divAssign(n),a.divAssign(n);const u=CA(a.sub(s.mul(s)));return xe(s,u)}),jie=ue(({samples:n,radius:e,size:t,shadowPass:i,depthLayer:r})=>{const s=te(0).toVar("meanHorizontal"),a=te(0).toVar("squareMeanHorizontal"),o=n.lessThanEqual(te(1)).select(te(0),te(2).div(n.sub(1))),l=n.lessThanEqual(te(1)).select(te(0),te(-1));oa({start:Dn(0),end:Dn(n),type:"int",condition:"<"},({i:c})=>{const h=l.add(te(c).mul(o));let d=i.sample(Hr(db.xy,xe(h,0).mul(e)).div(t));i.value.isArrayTexture&&(d=d.depth(r)),s.addAssign(d.x),a.addAssign(Hr(d.y.mul(d.y),d.x.mul(d.x)))}),s.divAssign(n),a.divAssign(n);const u=CA(a.sub(s.mul(s)));return xe(s,u)}),qie=[Bie,Fie,kie,zie];let Dx;const q_=new WA;class KF extends Rie{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:i,shadowCoord:r,shadow:s,depthLayer:a}){const o=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),l=t({depthTexture:i,shadowCoord:r,shadow:s,depthLayer:a});return o.select(l,te(1))}setupShadowCoord(e,t){const{shadow:i}=this,{renderer:r}=e,s=Mn("bias","float",i).setGroup(Ke);let a=t,o;if(i.camera.isOrthographicCamera||r.logarithmicDepthBuffer!==!0)a=a.xyz.div(a.w),o=a.z,r.coordinateSystem===ru&&(o=o.mul(2).sub(1));else{const l=a.w;a=a.xy.div(l);const u=Mn("near","float",i.camera).setGroup(Ke),c=Mn("far","float",i.camera).setGroup(Ke);o=SF(l.negate(),u,c)}return a=ae(a.x,a.y.oneMinus(),o.add(s)),a}getShadowFilterFn(e){return qie[e]}setupRenderTarget(e,t){const i=new ks(e.mapSize.width,e.mapSize.height);i.name="ShadowDepthTexture",i.compareFunction=K0;const r=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return r.texture.name="ShadowMap",r.texture.type=e.mapType,r.depthTexture=i,{shadowMap:r,depthTexture:i}}setupShadow(e){const{renderer:t}=e,{light:i,shadow:r}=this,s=t.shadowMap.type,{depthTexture:a,shadowMap:o}=this.setupRenderTarget(r,e);if(r.camera.updateProjectionMatrix(),s===os&&r.isPointLightShadow!==!0){a.compareFunction=null,o.depth>1?(o._vsmShadowMapVertical||(o._vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:zo,type:Fi,depth:o.depth,depthBuffer:!1}),o._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=o._vsmShadowMapVertical,o._vsmShadowMapHorizontal||(o._vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:zo,type:Fi,depth:o.depth,depthBuffer:!1}),o._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=o._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:zo,type:Fi,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:zo,type:Fi,depthBuffer:!1}));let p=qt(a);a.isArrayTexture&&(p=p.depth(this.depthLayer));let y=qt(this.vsmShadowMapVertical.texture);a.isArrayTexture&&(y=y.depth(this.depthLayer));const v=Mn("blurSamples","float",r).setGroup(Ke),b=Mn("radius","float",r).setGroup(Ke),S=Mn("mapSize","vec2",r).setGroup(Ke);let x=this.vsmMaterialVertical||(this.vsmMaterialVertical=new vi);x.fragmentNode=Wie({samples:v,radius:b,size:S,shadowPass:p,depthLayer:this.depthLayer}).context(e.getSharedContext()),x.name="VSMVertical",x=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new vi),x.fragmentNode=jie({samples:v,radius:b,size:S,shadowPass:y,depthLayer:this.depthLayer}).context(e.getSharedContext()),x.name="VSMHorizontal"}const l=Mn("intensity","float",r).setGroup(Ke),u=Mn("normalBias","float",r).setGroup(Ke),c=jA(i).mul(YF.add(Cf.mul(u))),h=this.setupShadowCoord(e,c),d=r.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(d===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const f=s===os&&r.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:a,m=this.setupShadowFilter(e,{filterFn:d,shadowTexture:o.texture,depthTexture:f,shadowCoord:h,shadow:r,depthLayer:this.depthLayer});let _=qt(o.texture,h);a.isArrayTexture&&(_=_.depth(this.depthLayer));const g=On(1,m.rgb.mix(_,1),l.mul(_.a)).toVar();return this.shadowMap=o,this.shadow.map=o,g}setup(e){if(e.renderer.shadowMap.enabled!==!1)return ue(()=>{let t=this._node;return this.setupShadowPosition(e),t===null&&(this._node=t=this.setupShadow(e)),e.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(t=e.material.receivedShadowNode(t)),t})()}renderShadow(e){const{shadow:t,shadowMap:i,light:r}=this,{renderer:s,scene:a}=e;t.updateMatrices(r),i.setSize(t.mapSize.width,t.mapSize.height,i.depth),s.render(a,t.camera)}updateShadow(e){const{shadowMap:t,light:i,shadow:r}=this,{renderer:s,scene:a,camera:o}=e,l=s.shadowMap.type,u=t.depthTexture.version;this._depthVersionCached=u;const c=r.camera.layers.mask;r.camera.layers.mask&4294967294||(r.camera.layers.mask=o.layers.mask);const h=s.getRenderObjectFunction(),d=s.getMRT(),f=d?d.has("velocity"):!1;Dx=Oie(s,a,Dx),a.overrideMaterial=Hie(i),s.setRenderObjectFunction($ie(s,r,l,f)),s.setClearColor(0,0),s.setRenderTarget(t),this.renderShadow(e),s.setRenderObjectFunction(h),l===os&&r.isPointLightShadow!==!0&&this.vsmPass(s),r.camera.layers.mask=c,Iie(s,a,Dx)}vsmPass(e){const{shadow:t}=this,i=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,i),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,i),e.setRenderTarget(this.vsmShadowMapVertical),q_.material=this.vsmMaterialVertical,q_.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),q_.material=this.vsmMaterialHorizontal,q_.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),super.dispose()}updateBefore(e){const{shadow:t}=this;let i=t.needsUpdate||t.autoUpdate;i&&(this._cameraFrameId[e.camera]===e.frameId&&(i=!1),this._cameraFrameId[e.camera]=e.frameId),i&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const Xie=(n,e)=>de(new KF(n,e)),Yie=new Ve,Ma=ue(([n,e])=>{const t=n.toVar(),i=Ls(t),r=Ya(1,rr(i.x,rr(i.y,i.z)));i.mulAssign(r),t.mulAssign(r.mul(e.mul(2).oneMinus()));const s=xe(t.xy).toVar(),o=e.mul(1.5).oneMinus();return ri(i.z.greaterThanEqual(o),()=>{ri(t.z.greaterThan(0),()=>{s.x.assign(dr(4,t.x))})}).ElseIf(i.x.greaterThanEqual(o),()=>{const l=Hv(t.x);s.x.assign(t.z.mul(l).add(l.mul(2)))}).ElseIf(i.y.greaterThanEqual(o),()=>{const l=Hv(t.y);s.x.assign(t.x.add(l.mul(2)).add(2)),s.y.assign(t.z.mul(l).sub(2))}),xe(.125,.25).mul(s).add(xe(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),Kie=ue(({depthTexture:n,bd3D:e,dp:t,texelSize:i})=>qt(n,Ma(e,i.y)).compare(t)),Qie=ue(({depthTexture:n,bd3D:e,dp:t,texelSize:i,shadow:r})=>{const s=Mn("radius","float",r).setGroup(Ke),a=xe(-1,1).mul(s).mul(i.y);return qt(n,Ma(e.add(a.xyy),i.y)).compare(t).add(qt(n,Ma(e.add(a.yyy),i.y)).compare(t)).add(qt(n,Ma(e.add(a.xyx),i.y)).compare(t)).add(qt(n,Ma(e.add(a.yyx),i.y)).compare(t)).add(qt(n,Ma(e,i.y)).compare(t)).add(qt(n,Ma(e.add(a.xxy),i.y)).compare(t)).add(qt(n,Ma(e.add(a.yxy),i.y)).compare(t)).add(qt(n,Ma(e.add(a.xxx),i.y)).compare(t)).add(qt(n,Ma(e.add(a.yxx),i.y)).compare(t)).mul(1/9)}),Zie=ue(({filterFn:n,depthTexture:e,shadowCoord:t,shadow:i})=>{const r=t.xyz.toVar(),s=r.length(),a=lt("float").setGroup(Ke).onRenderUpdate(()=>i.camera.near),o=lt("float").setGroup(Ke).onRenderUpdate(()=>i.camera.far),l=Mn("bias","float",i).setGroup(Ke),u=lt(i.mapSize).setGroup(Ke),c=te(1).toVar();return ri(s.sub(o).lessThanEqual(0).and(s.sub(a).greaterThanEqual(0)),()=>{const h=s.sub(a).div(o.sub(a)).toVar();h.addAssign(l);const d=r.normalize(),f=xe(1).div(u.mul(xe(4,2)));c.assign(n({depthTexture:e,bd3D:d,dp:h,texelSize:f,shadow:i}))}),c}),n2=new Je,rh=new fe,cp=new fe;class Jie extends KF{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===K6?Kie:Qie}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:i,depthTexture:r,shadowCoord:s,shadow:a}){return Zie({filterFn:t,shadowTexture:i,depthTexture:r,shadowCoord:s,shadow:a})}renderShadow(e){const{shadow:t,shadowMap:i,light:r}=this,{renderer:s,scene:a}=e,o=t.getFrameExtents();cp.copy(t.mapSize),cp.multiply(o),i.setSize(cp.width,cp.height),rh.copy(t.mapSize);const l=s.autoClear,u=s.getClearColor(Yie),c=s.getClearAlpha();s.autoClear=!1,s.setClearColor(t.clearColor,t.clearAlpha),s.clear();const h=t.getViewportCount();for(let d=0;d<h;d++){const f=t.getViewport(d),m=rh.x*f.x,_=cp.y-rh.y-rh.y*f.y;n2.set(m,_,rh.x*f.z,rh.y*f.w),i.viewport.copy(n2),t.updateMatrices(r,d),s.render(a,t.camera)}s.autoClear=l,s.setClearColor(u,c)}}const ere=(n,e)=>de(new Jie(n,e));class Pc extends Df{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new Ve,this.colorNode=e&&e.colorNode||lt(this.color).setGroup(Ke),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=Rt.FRAME}getHash(){return this.light.uuid}getLightVector(e){return jF(this.light).sub(e.context.positionView||ui)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return Xie(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let i=this.shadowColorNode;if(i===null){const r=this.light.shadow.shadowNode;let s;r!==void 0?s=de(r):s=this.setupShadowNode(),this.shadowNode=s,this.shadowColorNode=i=this.colorNode.mul(s),this.baseColorNode=this.colorNode}this.colorNode=i}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),i=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),i&&e.lightsNode.setupDirectRectAreaLight(e,this,i)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const QF=ue(({lightDistance:n,cutoffDistance:e,decayExponent:t})=>{const i=n.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(i.mul(n.div(e).pow4().oneMinus().clamp().pow2()),i)}),tre=({color:n,lightVector:e,cutoffDistance:t,decayExponent:i})=>{const r=e.normalize(),s=e.length(),a=QF({lightDistance:s,cutoffDistance:t,decayExponent:i}),o=n.mul(a);return{lightDirection:r,lightColor:o}};class nre extends Pc{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=lt(0).setGroup(Ke),this.decayExponentNode=lt(2).setGroup(Ke)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return ere(this.light)}setupDirect(e){return tre({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}ue(([n=Ug()],{renderer:e,material:t})=>{const i=zB(n.mul(2).sub(1));let r;if(t.alphaToCoverage&&e.samples>1){const s=te(i.fwidth()).toVar();r=au(s.oneMinus(),s.add(1),i).oneMinus()}else r=Sr(i.greaterThan(1),0,1);return r});const ire=ue(([n,e])=>{const t=n.x,i=n.y,r=n.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(2*.511664).mul(i)),s=s.add(e.element(2).mul(2*.511664).mul(r)),s=s.add(e.element(3).mul(2*.511664).mul(t)),s=s.add(e.element(4).mul(2*.429043).mul(t).mul(i)),s=s.add(e.element(5).mul(2*.429043).mul(i).mul(r)),s=s.add(e.element(6).mul(r.mul(r).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(2*.429043).mul(t).mul(r)),s=s.add(e.element(8).mul(.429043).mul(Nt(t,t).sub(Nt(i,i)))),s}),Qs=new $A;class rre extends _u{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,i){const r=this.renderer,s=this.nodes.getBackgroundNode(e)||e.background;let a=!1;if(s===null)r._clearColor.getRGB(Qs),Qs.a=r._clearColor.a;else if(s.isColor===!0)s.getRGB(Qs),Qs.a=1,a=!0;else if(s.isNode===!0){const l=this.get(e),u=s;Qs.copy(r._clearColor);let c=l.backgroundMesh;if(c===void 0){let _=function(){s.removeEventListener("dispose",_),c.material.dispose(),c.geometry.dispose()};const d=hb(St(u).mul(QD),{getUV:()=>sie.mul(TJ),getTextureLevel:()=>rie});let f=_F;f=f.setZ(f.w);const m=new vi;m.name="Background.material",m.side=bn,m.depthTest=!1,m.depthWrite=!1,m.allowOverride=!1,m.fog=!1,m.lights=!1,m.vertexNode=f,m.colorNode=d,l.backgroundMeshNode=d,l.backgroundMesh=c=new mi(new Ng(1,32,32),m),c.frustumCulled=!1,c.name="Background.mesh",c.onBeforeRender=function(g,p,y){this.matrixWorld.copyPosition(y.matrixWorld)},s.addEventListener("dispose",_)}const h=u.getCacheKey();l.backgroundCacheKey!==h&&(l.backgroundMeshNode.node=St(u).mul(QD),l.backgroundMeshNode.needsUpdate=!0,c.material.needsUpdate=!0,l.backgroundCacheKey=h),t.unshift(c,c.geometry,c.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",s);const o=r.xr.getEnvironmentBlendMode();if(o==="additive"?Qs.set(0,0,0,1):o==="alpha-blend"&&Qs.set(0,0,0,0),r.autoClear===!0||a===!0){const l=i.clearColorValue;l.r=Qs.r,l.g=Qs.g,l.b=Qs.b,l.a=Qs.a,(r.backend.isWebGLBackend===!0||r.alpha===!0)&&(l.r*=l.a,l.g*=l.a,l.b*=l.a),i.depthClearValue=r._clearDepth,i.stencilClearValue=r._clearStencil,i.clearColor=r.autoClearColor===!0,i.clearDepth=r.autoClearDepth===!0,i.clearStencil=r.autoClearStencil===!0}else i.clearColor=!1,i.clearDepth=!1,i.clearStencil=!1}}let sre=0;class zE{constructor(e="",t=[],i=0,r=[]){this.name=e,this.bindings=t,this.index=i,this.bindingsReference=r,this.id=sre++}}class are{constructor(e,t,i,r,s,a,o,l,u,c=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=i,this.transforms=c,this.nodeAttributes=r,this.bindings=s,this.updateNodes=a,this.updateBeforeNodes=o,this.updateAfterNodes=l,this.observer=u,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const r=new zE(t.name,[],t.index,t.bindingsReference);e.push(r);for(const s of t.bindings)r.bindings.push(s.clone())}else e.push(t);return e}}class i2{constructor(e,t,i=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=i}}class ore{constructor(e,t,i){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=i}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class ZF{constructor(e,t,i=!1,r=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=i,this.count=r}}class lre extends ZF{constructor(e,t,i=null,r=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=i,this.interpolationSampling=r}}class ure{constructor(e,t,i=""){this.name=e,this.type=t,this.code=i,Object.defineProperty(this,"isNodeCode",{value:!0})}}let cre=0;class Lx{constructor(e=null){this.id=cre++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class hre{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class yu{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class dre extends yu{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class fre extends yu{constructor(e,t=new fe){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class pre extends yu{constructor(e,t=new D){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class mre extends yu{constructor(e,t=new Je){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class gre extends yu{constructor(e,t=new Ve){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class _re extends yu{constructor(e,t=new tb){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class yre extends yu{constructor(e,t=new vt){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class vre extends yu{constructor(e,t=new zt){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class bre extends dre{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Sre extends fre{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class xre extends pre{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Tre extends mre{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Ere extends gre{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Mre extends _re{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class wre extends yre{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Are extends vre{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}const r2=new WeakMap,Rre=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),X_=n=>/e/g.test(n)?String(n).replace(/\+/g,""):(n=Number(n),n+(n%1?"":".0"));class JF{constructor(e,t,i){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=i,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=Ax(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new Lx,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.currentStack=null,this.subBuildFn=null}getBindGroupsCache(){let e=r2.get(this.renderer);return e===void 0&&(e=new fa,r2.set(this.renderer,e)),e}createRenderTarget(e,t,i){return new Nc(e,t,i)}createCubeRenderTarget(e,t){return new MF(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const i=this.getBindGroupsCache(),r=[];let s=!0;for(const o of t)r.push(o),s=s&&o.groupNode.shared!==!0;let a;return s?(a=i.get(r),a===void 0&&(a=new zE(e,r,this.bindingsIndexes[e].group,r),i.set(r,a))):a=new zE(e,r,this.bindingsIndexes[e].group,r),a}getBindGroupArray(e,t){const i=this.bindings[t];let r=i[e];return r===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),i[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(e===null){const t={},i=this.bindings;for(const r of JC)for(const s in i[r]){const a=i[r][s];(t[s]||(t[s]=[])).push(...a)}e=[];for(const r in t){const s=t[r],a=this._getBindGroup(r,s);e.push(a)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,i)=>t.bindings[0].groupNode.order-i.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const i=e[t];this.bindingsIndexes[i.name].group=t,i.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==Rt.NONE&&this.updateNodes.push(e);for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),i=e.getUpdateAfterType();t!==Rt.NONE&&this.updateBeforeNodes.push(e),i!==Rt.NONE&&this.updateAfterNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===wi||e.magFilter===ed||e.magFilter===ko||e.magFilter===Ir||e.minFilter===wi||e.minFilter===ed||e.minFilter===ko||e.minFilter===Ir}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getTernary(){return null}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const i=this.getDataFromNode(e);return i.cache===void 0&&(i.cache=new Lx(t?this.getCache():null)),i.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,i=null){let r=this.generateArrayDeclaration(e,t)+"( ";for(let s=0;s<t;s++){const a=i?i[s]:null;a!==null?r+=a.build(this,e):r+=this.generateConst(e),s<t-1&&(r+=", ")}return r+=" )",r}generateStruct(e,t,i=null){const r=[];for(const s of t){const{name:a,type:o}=s;i&&i[a]&&i[a].isNode?r.push(i[a].build(this,o)):r.push(this.generateConst(o))}return e+"( "+r.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new Ve:e==="vec2"?t=new fe:e==="vec3"?t=new D:e==="vec4"&&(t=new Je)),e==="float")return X_(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${X_(t.r)}, ${X_(t.g)}, ${X_(t.b)} )`;const i=this.getTypeLength(e),r=this.getComponentType(e),s=a=>this.generateConst(r,a);if(i===2)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)} )`;if(i===3)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)} )`;if(i===4&&e!=="mat2")return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)}, ${s(t.w)} )`;if(i>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(s).join(", ")} )`;if(i>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const i=this.attributes;for(const s of i)if(s.name===e)return s;const r=new i2(e,t);return this.registerDeclaration(r),i.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Oi)return"int";if(t===wn)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let i=IK(e);const r=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(i=i.replace("vec","mat")),r+i}getTypeFromArray(e){return Rre.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const i=t.array,r=e.itemSize,s=e.normalized;let a;return!(e instanceof JO)&&s!==!0&&(a=this.getTypeFromArray(i)),this.getTypeFromLength(r,a)}getTypeLength(e){const t=this.getVectorType(e),i=/vec([2-4])/.exec(t);return i!==null?Number(i[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}addStack(){this.stack=Ax(this.stack);const e=TA();return this.stacks.push(e),Fv(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,Fv(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,i=null){i=i===null?e.isGlobal(this)?this.globalCache:this.cache:i;let r=i.getData(e);r===void 0&&(r={},i.setData(e,r)),r[t]===void 0&&(r[t]={});let s=r[t];const a=r.any?r.any.subBuilds:null,o=this.getClosestSubBuild(a);return o&&(s.subBuildsCache===void 0&&(s.subBuildsCache={}),s=s.subBuildsCache[o]||(s.subBuildsCache[o]={}),s.subBuilds=a),s}getNodeProperties(e,t="any"){const i=this.getDataFromNode(e,t);return i.properties||(i.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const i=this.getDataFromNode(e);let r=i.bufferAttribute;if(r===void 0){const s=this.uniforms.index++;r=new i2("nodeAttribute"+s,t,e),this.bufferAttributes.push(r),i.bufferAttribute=r}return r}getStructTypeNode(e,t=this.shaderStage){return this.types[t][e]||null}getStructTypeFromNode(e,t,i=null,r=this.shaderStage){const s=this.getDataFromNode(e,r,this.globalCache);let a=s.structType;if(a===void 0){const o=this.structs.index++;i===null&&(i="StructType"+o),a=new hre(i,t),this.structs[r].push(a),this.types[r][i]=e,s.structType=a}return a}getOutputStructTypeFromNode(e,t){const i=this.getStructTypeFromNode(e,t,"OutputType","fragment");return i.output=!0,i}getUniformFromNode(e,t,i=this.shaderStage,r=null){const s=this.getDataFromNode(e,i,this.globalCache);let a=s.uniform;if(a===void 0){const o=this.uniforms.index++;a=new ore(r||"nodeUniform"+o,t,e),this.uniforms[i].push(a),this.registerDeclaration(a),s.uniform=a}return a}getVarFromNode(e,t=null,i=e.getNodeType(this),r=this.shaderStage,s=!1){const a=this.getDataFromNode(e,r),o=this.getSubBuildProperty("variable",a.subBuilds);let l=a[o];if(l===void 0){const u=s?"_const":"_var",c=this.vars[r]||(this.vars[r]=[]),h=this.vars[u]||(this.vars[u]=0);t===null&&(t=(s?"nodeConst":"nodeVar")+h,this.vars[u]++),o!=="variable"&&(t=this.getSubBuildProperty(t,a.subBuilds));const d=e.getArrayCount(this);l=new ZF(t,i,s,d),s||c.push(l),this.registerDeclaration(l),a[o]=l}return l}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,i=e.getNodeType(this),r=null,s=null){const a=this.getDataFromNode(e,"any"),o=this.getSubBuildProperty("varying",a.subBuilds);let l=a[o];if(l===void 0){const u=this.varyings,c=u.length;t===null&&(t="nodeVarying"+c),o!=="varying"&&(t=this.getSubBuildProperty(t,a.subBuilds)),l=new lre(t,i,r,s),u.push(l),this.registerDeclaration(l),a[o]=l}return l}registerDeclaration(e){const t=this.shaderStage,i=this.declarations[t]||(this.declarations[t]={}),r=this.getPropertyName(e);let s=1,a=r;for(;i[a]!==void 0;)a=r+"_"+s++;s>1&&(e.name=a,console.warn(`THREE.TSL: Declaration name '${r}' of '${e.type}' already in use. Renamed to '${a}'.`)),i[a]=e}getCodeFromNode(e,t,i=this.shaderStage){const r=this.getDataFromNode(e);let s=r.code;if(s===void 0){const a=this.codes[i]||(this.codes[i]=[]),o=a.length;s=new ure("nodeCode"+o,t),a.push(s),r.code=s}return s}addFlowCodeHierarchy(e,t){const{flowCodes:i,flowCodeBlock:r}=this.getDataFromNode(e);let s=!0,a=t;for(;a;){if(r.get(a)===!0){s=!1;break}a=this.getDataFromNode(a).parentNodeBlock}if(s)for(const o of i)this.addLineFlowCode(o)}addLineFlowCodeBlock(e,t,i){const r=this.getDataFromNode(e),s=r.flowCodes||(r.flowCodes=[]),a=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);s.push(t),a.set(i,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),i=this.flowChildNode(e,t);return this.flowsData.set(e,i),i}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new bie,i=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=i,t}flowShaderNode(e){const t=e.layout,i={[Symbol.iterator](){let a=0;const o=Object.values(this);return{next:()=>({value:o[a],done:a++>=o.length})}}};for(const a of t.inputs)i[a.name]=new Jne(a.type,a.name);e.layout=null;const r=e.call(i),s=this.flowStagesNode(r,t.type);return e.layout=t,s}flowBuildStage(e,t,i=null){const r=this.getBuildStage();this.setBuildStage(t);const s=e.build(this,i);return this.setBuildStage(r),s}flowStagesNode(e,t=null){const i=this.flow,r=this.vars,s=this.declarations,a=this.cache,o=this.buildStage,l=this.stack,u={code:""};this.flow=u,this.vars={},this.declarations={},this.cache=new Lx,this.stack=Ax();for(const c of ZC)this.setBuildStage(c),u.result=e.build(this,t);return u.vars=this.getVars(this.shaderStage),this.flow=i,this.vars=r,this.declarations=s,this.cache=a,this.stack=l,this.setBuildStage(o),u}getFunctionOperator(){return null}buildFunctionCode(){console.warn("Abstract function.")}flowChildNode(e,t=null){const i=this.flow,r={code:""};return this.flow=r,r.result=e.build(this,t),this.flow=i,r}flowNodeFromShaderStage(e,t,i=null,r=null){const s=this.tab,a=this.cache,o=this.shaderStage,l=this.context;this.setShaderStage(e);const u={...this.context};delete u.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=u;let c=null;if(this.buildStage==="generate"){const h=this.flowChildNode(t,i);r!==null&&(h.code+=`${this.tab+r} = ${h.result};
`),this.flowCode[e]=this.flowCode[e]+h.code,c=h}else c=t.build(this);return this.setShaderStage(o),this.cache=a,this.tab=s,this.context=l,c}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,t,i=null){return`${i!==null?this.generateArrayDeclaration(e,i):this.getType(e)} ${t}`}getVars(e){let t="";const i=this.vars[e];if(i!==void 0)for(const r of i)t+=`${this.getVar(r.type,r.name)}; `;return t}getUniforms(){console.warn("Abstract function.")}getCodes(e){const t=this.codes[e];let i="";if(t!==void 0)for(const r of t)i+=r.code+`
`;return i}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(e&&e.isNode?e.isShaderCallNodeInternal?t=e.shaderNode.subBuilds:e.isStackNode?t=[e.subBuild]:t=this.getDataFromNode(e,"any").subBuilds:e instanceof Set?t=[...e]:t=e,!t)return null;const i=this.subBuildLayers;for(let r=t.length-1;r>=0;r--){const s=t[r];if(i.includes(s))return s}return null}getSubBuildOutput(e){return this.getSubBuildProperty("outputNode",e)}getSubBuildProperty(e="",t=null){let i;t!==null?i=this.getClosestSubBuild(t):i=this.subBuildFn;let r;return i?r=e?i+"_"+e:i:r=e,r}build(){const{object:e,material:t,renderer:i}=this;if(t!==null){let r=i.library.fromMaterial(t);r===null&&(console.error(`NodeMaterial: Material "${t.type}" is not compatible.`),r=new vi),r.build(this)}else this.addFlow("compute",e);for(const r of ZC){this.setBuildStage(r),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const s of JC){this.setShaderStage(s);const a=this.flowNodes[s];for(const o of a)r==="generate"?this.flowNode(o):o.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if(t==="float"||t==="int"||t==="uint")return new bre(e);if(t==="vec2"||t==="ivec2"||t==="uvec2")return new Sre(e);if(t==="vec3"||t==="ivec3"||t==="uvec3")return new xre(e);if(t==="vec4"||t==="ivec4"||t==="uvec4")return new Tre(e);if(t==="color")return new Ere(e);if(t==="mat2")return new Mre(e);if(t==="mat3")return new wre(e);if(t==="mat4")return new Are(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,i){if(t=this.getVectorType(t),i=this.getVectorType(i),t===i||i===null||this.isReference(i))return e;const r=this.getTypeLength(t),s=this.getTypeLength(i);return r===16&&s===9?`${this.getType(i)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:r===9&&s===4?`${this.getType(i)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:r>4||s>4||s===0?e:r===s?`${this.getType(i)}( ${e} )`:r>s?(e=i==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,s)}`,this.format(e,this.getTypeFromLength(s,this.getComponentType(t)),i)):s===4&&r>1?`${this.getType(i)}( ${this.format(e,t,"vec3")}, 1.0 )`:r===2?`${this.getType(i)}( ${this.format(e,t,"vec2")}, 0.0 )`:(r===1&&s>1&&t!==this.getComponentType(i)&&(e=`${this.getType(this.getComponentType(i))}( ${e} )`),`${this.getType(i)}( ${e} )`)}getSignature(){return`// Three.js r${xf} - Node System
`}}class s2{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let i=e.get(t);return i===void 0&&(i={renderMap:new WeakMap,frameMap:new WeakMap},e.set(t,i)),i}updateBeforeNode(e){const t=e.getUpdateBeforeType(),i=e.updateReference(this);if(t===Rt.FRAME){const{frameMap:r}=this._getMaps(this.updateBeforeMap,i);r.get(i)!==this.frameId&&e.updateBefore(this)!==!1&&r.set(i,this.frameId)}else if(t===Rt.RENDER){const{renderMap:r}=this._getMaps(this.updateBeforeMap,i);r.get(i)!==this.renderId&&e.updateBefore(this)!==!1&&r.set(i,this.renderId)}else t===Rt.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),i=e.updateReference(this);if(t===Rt.FRAME){const{frameMap:r}=this._getMaps(this.updateAfterMap,i);r.get(i)!==this.frameId&&e.updateAfter(this)!==!1&&r.set(i,this.frameId)}else if(t===Rt.RENDER){const{renderMap:r}=this._getMaps(this.updateAfterMap,i);r.get(i)!==this.renderId&&e.updateAfter(this)!==!1&&r.set(i,this.renderId)}else t===Rt.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),i=e.updateReference(this);if(t===Rt.FRAME){const{frameMap:r}=this._getMaps(this.updateMap,i);r.get(i)!==this.frameId&&e.update(this)!==!1&&r.set(i,this.frameId)}else if(t===Rt.RENDER){const{renderMap:r}=this._getMaps(this.updateMap,i);r.get(i)!==this.renderId&&e.update(this)!==!1&&r.set(i,this.renderId)}else t===Rt.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class qA{constructor(e,t,i=null,r="",s=!1){this.type=e,this.name=t,this.count=i,this.qualifier=r,this.isConst=s}}qA.isNodeFunctionInput=!0;class Nre extends Pc{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:qF(this.light),lightColor:e}}}const Px=new zt,Y_=new zt;let hp=null;class Cre extends Pc{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=lt(new D).setGroup(Ke),this.halfWidth=lt(new D).setGroup(Ke),this.updateType=Rt.RENDER}update(e){super.update(e);const{light:t}=this,i=e.camera.matrixWorldInverse;Y_.identity(),Px.copy(t.matrixWorld),Px.premultiply(i),Y_.extractRotation(Px),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(Y_),this.halfHeight.value.applyMatrix4(Y_)}setupDirectRectArea(e){let t,i;e.isAvailable("float32Filterable")?(t=qt(hp.LTC_FLOAT_1),i=qt(hp.LTC_FLOAT_2)):(t=qt(hp.LTC_HALF_1),i=qt(hp.LTC_HALF_2));const{colorNode:r,light:s}=this,a=jF(s);return{lightColor:r,lightPosition:a,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:i}}static setLTC(e){hp=e}}class XA extends Pc{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=lt(0).setGroup(Ke),this.penumbraCosNode=lt(0).setGroup(Ke),this.cutoffDistanceNode=lt(0).setGroup(Ke),this.decayExponentNode=lt(0).setGroup(Ke),this.colorNode=lt(this.color).setGroup(Ke)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:i,penumbraCosNode:r}=this;return au(i,r,t)}getLightCoord(e){const t=e.getNodeProperties(this);let i=t.projectionUV;return i===void 0&&(i=Eie(this.light,e.context.positionWorld),t.projectionUV=i),i}setupDirect(e){const{colorNode:t,cutoffDistanceNode:i,decayExponentNode:r,light:s}=this,a=this.getLightVector(e),o=a.normalize(),l=o.dot(qF(s)),u=this.getSpotAttenuation(e,l),c=a.length(),h=QF({lightDistance:c,cutoffDistance:i,decayExponent:r});let d=t.mul(u).mul(h),f,m;return s.colorNode?(m=this.getLightCoord(e),f=s.colorNode(m)):s.map&&(m=this.getLightCoord(e),f=qt(s.map,m.xy).onRenderUpdate(()=>s.map)),f&&(d=m.mul(2).sub(1).abs().lessThan(1).all().select(d.mul(f),d)),{lightColor:d,lightDirection:o}}}class Dre extends XA{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const i=this.light.iesMap;let r=null;if(i&&i.isTexture===!0){const s=t.acos().mul(1/Math.PI);r=qt(i,xe(s,0),0).r}else r=super.getSpotAttenuation(t);return r}}const Lre=ue(([n,e])=>{const t=n.abs().sub(e);return Yo(rr(t,0)).add(ef(rr(t.x,t.y),0))});class Pre extends XA{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let i=1;t.map!==null&&(i=t.map.width/t.map.height),t.shadow.aspect=i}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=te(0),i=this.penumbraCosNode,r=jA(this.light).mul(e.context.positionWorld||nf);return ri(r.w.greaterThan(0),()=>{const s=r.xyz.div(r.w),a=Lre(s.xy.sub(xe(.5)),xe(.5)),o=Ya(-1,dr(1,PB(i)).sub(1));t.assign(GB(a.mul(-2).mul(o)))}),t}}class Ure extends Pc{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class Ore extends Pc{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=WF(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=lt(new Ve).setGroup(Ke)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:i,lightDirectionNode:r}=this,a=Cf.dot(r).mul(.5).add(.5),o=On(i,t,a);e.context.irradiance.addAssign(o)}}class Ire extends Pc{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let i=0;i<9;i++)t.push(new D);this.lightProbe=aa(t)}update(e){const{light:t}=this;super.update(e);for(let i=0;i<9;i++)this.lightProbe.array[i].copy(t.sh.coefficients[i]).multiplyScalar(t.intensity)}setup(e){const t=ire(Cf,this.lightProbe);e.context.irradiance.addAssign(t)}}class e3{parseFunction(){console.warn("Abstract function.")}}class YA{constructor(e,t,i="",r=""){this.type=e,this.inputs=t,this.name=i,this.precision=r}getCode(){console.warn("Abstract function.")}}YA.isNodeFunction=!0;const Bre=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,Fre=/[a-z_0-9]+/ig,a2="#pragma main",kre=n=>{n=n.trim();const e=n.indexOf(a2),t=e!==-1?n.slice(e+a2.length):n,i=t.match(Bre);if(i!==null&&i.length===5){const r=i[4],s=[];let a=null;for(;(a=Fre.exec(r))!==null;)s.push(a);const o=[];let l=0;for(;l<s.length;){const m=s[l][0]==="const";m===!0&&l++;let _=s[l][0];_==="in"||_==="out"||_==="inout"?l++:_="";const g=s[l++][0];let p=Number.parseInt(s[l][0]);Number.isNaN(p)===!1?l++:p=null;const y=s[l++][0];o.push(new qA(g,y,p,_,m))}const u=t.substring(i[0].length),c=i[3]!==void 0?i[3]:"",h=i[2],d=i[1]!==void 0?i[1]:"",f=e!==-1?n.slice(0,e):"";return{type:h,inputs:o,name:c,precision:d,inputsCode:r,blockCode:u,headerCode:f}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class zre extends YA{constructor(e){const{type:t,inputs:i,name:r,precision:s,inputsCode:a,blockCode:o,headerCode:l}=kre(e);super(t,i,r,s),this.inputsCode=a,this.blockCode=o,this.headerCode=l}getCode(e=this.name){let t;const i=this.blockCode;if(i!==""){const{type:r,inputsCode:s,headerCode:a,precision:o}=this;let l=`${r} ${e} ( ${s.trim()} )`;o!==""&&(l=`${o} ${l}`),t=a+l+i}else t="";return t}}class Gre extends e3{parseFunction(e){return new zre(e)}}const o2=new WeakMap,Ta=[],Lu=[];class Vre extends _u{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new s2,this.nodeBuilderCache=new Map,this.callHashCache=new fa,this.groupsData=new fa,this.cacheLib={}}updateGroup(e){const t=e.groupNode,i=t.name;if(i===NB.name)return!0;if(i===Ke.name){const s=this.get(e),a=this.nodeFrame.renderId;return s.renderId!==a?(s.renderId=a,!0):!1}if(i===xQ.name){const s=this.get(e),a=this.nodeFrame.frameId;return s.frameId!==a?(s.frameId=a,!0):!1}Ta[0]=t,Ta[1]=e;let r=this.groupsData.get(Ta);return r===void 0&&this.groupsData.set(Ta,r={}),Ta.length=0,r.version!==t.version?(r.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let i=t.nodeBuilderState;if(i===void 0){const{nodeBuilderCache:r}=this,s=this.getForRenderCacheKey(e);if(i=r.get(s),i===void 0){const a=this.backend.createNodeBuilder(e.object,this.renderer);a.scene=e.scene,a.material=e.material,a.camera=e.camera,a.context.material=e.material,a.lightsNode=e.lightsNode,a.environmentNode=this.getEnvironmentNode(e.scene),a.fogNode=this.getFogNode(e.scene),a.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&a.enableMultiview(),a.build(),i=this._createNodeBuilderState(a),r.set(s,i)}i.usedTimes++,t.nodeBuilderState=i}return i}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let i=t.nodeBuilderState;if(i===void 0){const r=this.backend.createNodeBuilder(e,this.renderer);r.build(),i=this._createNodeBuilderState(r),t.nodeBuilderState=i}return i}_createNodeBuilderState(e){return new are(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const i=this.get(e);i.environmentNode&&(t=i.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const i=this.get(e);i.backgroundNode&&(t=i.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){Ta[0]=e,Ta[1]=t;const i=this.renderer.info.calls,r=this.callHashCache.get(Ta)||{};if(r.callId!==i){const s=this.getEnvironmentNode(e),a=this.getFogNode(e);t&&Lu.push(t.getCacheKey(!0)),s&&Lu.push(s.getCacheKey()),a&&Lu.push(a.getCacheKey()),Lu.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),Lu.push(this.renderer.shadowMap.enabled?1:0),r.callId=i,r.cacheKey=gA(Lu),this.callHashCache.set(Ta,r),Lu.length=0}return Ta.length=0,r.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),i=e.background;if(i){const r=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==i||r){const s=this.getCacheNode("background",i,()=>{if(i.isCubeTexture===!0||i.mapping===wd||i.mapping===Ad||i.mapping===pc){if(e.backgroundBlurriness>0||i.mapping===pc)return BF(i);{let a;return i.isCubeTexture===!0?a=$m(i):a=qt(i),AF(a)}}else{if(i.isTexture===!0)return qt(i,od.flipY()).setUpdateMatrix(!0);i.isColor!==!0&&console.error("WebGPUNodes: Unsupported background configuration.",i)}},r);t.backgroundNode=s,t.background=i,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,i,r=!1){const s=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let a=s.get(t);return(a===void 0||r)&&(a=i(),s.set(t,a)),a}updateFog(e){const t=this.get(e),i=e.fog;if(i){if(t.fog!==i){const r=this.getCacheNode("fog",i,()=>{if(i.isFogExp2){const s=Mn("color","color",i).setGroup(Ke),a=Mn("density","float",i).setGroup(Ke);return JD(s,xie(a))}else if(i.isFog){const s=Mn("color","color",i).setGroup(Ke),a=Mn("near","float",i).setGroup(Ke),o=Mn("far","float",i).setGroup(Ke);return JD(s,Sie(a,o))}else console.error("THREE.Renderer: Unsupported fog configuration.",i)});t.fogNode=r,t.fog=i}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),i=e.environment;if(i){if(t.environment!==i){const r=this.getCacheNode("environment",i,()=>{if(i.isCubeTexture===!0)return $m(i);if(i.isTexture===!0)return qt(i);console.error("Nodes: Unsupported environment configuration.",i)});t.environmentNode=r,t.environment=i}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,i=null,r=null,s=null){const a=this.nodeFrame;return a.renderer=e,a.scene=t,a.object=i,a.camera=r,a.material=s,a}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return o2.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,i=this.getOutputCacheKey(),r=e.isArrayTexture?lie(e,ae(od,Og("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):qt(e,od).renderOutput(t.toneMapping,t.currentColorSpace);return o2.set(e,i),r}updateBefore(e){const t=e.getNodeBuilderState();for(const i of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(i)}updateAfter(e){const t=e.getNodeBuilderState();for(const i of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(i)}updateForCompute(e){const t=this.getNodeFrame(),i=this.getForCompute(e);for(const r of i.updateNodes)t.updateNode(r)}updateForRender(e){const t=this.getNodeFrameForRender(e),i=e.getNodeBuilderState();for(const r of i.updateNodes)t.updateNode(r)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new s2,this.nodeBuilderCache=new Map,this.cacheLib={}}}const Ux=new ia;class $v{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new vt,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,i){const r=e.length;for(let s=0;s<r;s++){Ux.copy(e[s]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const a=t[i+s],o=Ux.normal;a.x=-o.x,a.y=-o.y,a.z=-o.z,a.w=Ux.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let i=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const r=t.clippingPlanes,s=r.length;let a,o;if(this.clipIntersection?(a=this.intersectionPlanes,o=e.intersectionPlanes.length):(a=this.unionPlanes,o=e.unionPlanes.length),a.length!==o+s){a.length=o+s;for(let l=0;l<s;l++)a[o+l]=new Je;i=!0}this.projectPlanes(r,a,o),i&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new $v(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class Hre{constructor(e,t){this.bundleGroup=e,this.camera=t}}const dp=[];class $re{constructor(){this.bundles=new fa}get(e,t){const i=this.bundles;dp[0]=e,dp[1]=t;let r=i.get(dp);return r===void 0&&(r=new Hre(e,t),i.set(dp,r)),dp.length=0,r}dispose(){this.bundles=new fa}}class t3{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const i=this.getMaterialNodeClass(e.type);if(i!==null){t=new i;for(const r in e)t[r]=e[r]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,i){if(i.has(t)){console.warn(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);i.set(t,e)}addClass(e,t,i){if(i.has(t)){console.warn(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);i.set(t,e)}}const Wre=new XF,fp=[];class jre extends fa{constructor(){super()}createNode(e=[]){return new XF().setLights(e)}getNode(e,t){if(e.isQuadMesh)return Wre;fp[0]=e,fp[1]=t;let i=this.get(fp);return i===void 0&&(i=this.createNode(),this.set(fp,i)),fp.length=0,i}}class Ap extends Nc{constructor(e=1,t=1,i={}){super(e,t,i),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}}const l2=new D,u2=new D;class qre extends sl{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new Ii,this._cameraL.viewport=new Je,this._cameraR=new Ii,this._cameraR.viewport=new Je,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new dI,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<"u",this._frameBufferTargets=null,this._createXRLayer=Jre.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new fe,this._onSessionEvent=Kre.bind(this),this._onSessionEnd=Qre.bind(this),this._onInputSourcesChange=Zre.bind(this),this._onAnimationFrame=ese.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&console.warn("THREE.XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&console.warn("THREE.XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,i,r,s,a,o,l={}){const u=new Rg(e,t),c=new Ap(s,a,{format:ii,type:Kn,depthTexture:new ks(s,a,l.stencil?gs:wn,void 0,void 0,void 0,void 0,void 0,void 0,l.stencil?ys:_s),stencilBuffer:l.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});c._autoAllocateDepthBuffer=!0;const h=new Da({color:16777215,side:ps});h.map=c.texture,h.map.offset.y=1,h.map.repeat.y=-1;const d=new mi(u,h);d.position.copy(i),d.quaternion.copy(r);const f={type:"quad",width:e,height:t,translation:i,quaternion:r,pixelwidth:s,pixelheight:a,plane:d,material:h,rendercall:o,renderTarget:c};if(this._layers.push(f),this._session!==null){f.plane.material=new Da({color:16777215,side:ps}),f.plane.material.blending=Jh,f.plane.material.blendEquation=Zi,f.plane.material.blendSrc=To,f.plane.material.blendDst=To,f.xrlayer=this._createXRLayer(f);const m=this._session.renderState.layers;m.unshift(f.xrlayer),this._session.updateRenderState({layers:m})}else c.isXRRenderTarget=!1;return d}createCylinderLayer(e,t,i,r,s,a,o,l,u={}){const c=new Ag(e,e,e*t/i,64,64,!0,Math.PI-t/2,t),h=new Ap(a,o,{format:ii,type:Kn,depthTexture:new ks(a,o,u.stencil?gs:wn,void 0,void 0,void 0,void 0,void 0,void 0,u.stencil?ys:_s),stencilBuffer:u.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});h._autoAllocateDepthBuffer=!0;const d=new Da({color:16777215,side:bn});d.map=h.texture,d.map.offset.y=1,d.map.repeat.y=-1;const f=new mi(c,d);f.position.copy(r),f.quaternion.copy(s);const m={type:"cylinder",radius:e,centralAngle:t,aspectratio:i,translation:r,quaternion:s,pixelwidth:a,pixelheight:o,plane:f,material:d,rendercall:l,renderTarget:h};if(this._layers.push(m),this._session!==null){m.plane.material=new Da({color:16777215,side:bn}),m.plane.material.blending=Jh,m.plane.material.blendEquation=Zi,m.plane.material.blendSrc=To,m.plane.material.blendDst=To,m.xrlayer=this._createXRLayer(m);const _=this._session.renderState.layers;_.unshift(m.xrlayer),this._session.updateRenderState({layers:_})}else h.isXRRenderTarget=!1;return f}renderLayers(){const e=new D,t=new da,i=this._renderer,r=this.isPresenting,s=i.getOutputRenderTarget(),a=i._frameBufferTarget;this.isPresenting=!1;const o=new fe;i.getSize(o);const l=i._quad;for(const u of this._layers)if(u.renderTarget.isXRRenderTarget=this._session!==null,u.renderTarget._hasExternalTextures=u.renderTarget.isXRRenderTarget,u.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){u.xrlayer.transform=new XRRigidTransform(u.plane.getWorldPosition(e),u.plane.getWorldQuaternion(t));const c=this._glBinding.getSubImage(u.xrlayer,this._xrFrame);i.backend.setXRRenderTargetTextures(u.renderTarget,c.colorTexture,void 0),i._setXRLayerSize(u.renderTarget.width,u.renderTarget.height),i.setOutputRenderTarget(u.renderTarget),i.setRenderTarget(null),i._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:h,quad:d}=this._frameBufferTargets.get(u.renderTarget)||{frameBufferTarget:null,quad:null};h?(i._frameBufferTarget=h,i._quad=d):(i._quad=new WA(new vi),this._frameBufferTargets.set(u.renderTarget,{frameBufferTarget:i._getFrameBufferTarget(),quad:i._quad})),u.rendercall(),i._frameBufferTarget=null}else i.setRenderTarget(u.renderTarget),u.rendercall();i.setRenderTarget(null),i.setOutputRenderTarget(s),i._frameBufferTarget=a,i._setXRLayerSize(o.x,o.y),i._quad=l,this.isPresenting=r}getSession(){return this._session}async setSession(e){const t=this._renderer,i=t.backend;this._gl=t.getContext();const r=this._gl,s=r.getContextAttributes();if(this._session=e,e!==null){if(i.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await i.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._supportsLayers===!0){let a=null,o=null,l=null;t.depth&&(l=t.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,a=t.stencil?ys:_s,o=t.stencil?gs:wn);const u={colorFormat:r.RGBA8,depthFormat:l,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(u.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const c=this._glBinding.createProjectionLayer(u),h=[c];this._glProjLayer=c,t.setPixelRatio(1),t._setXRLayerSize(c.textureWidth,c.textureHeight);const d=this._useMultiview?2:1,f=new ks(c.textureWidth,c.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,a,d);if(this._xrRenderTarget=new Ap(c.textureWidth,c.textureHeight,{format:ii,type:Kn,colorSpace:t.outputColorSpace,depthTexture:f,stencilBuffer:t.stencil,samples:s.antialias?4:0,resolveDepthBuffer:c.ignoreDepthValues===!1,resolveStencilBuffer:c.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const m of this._layers)m.plane.material=new Da({color:16777215,side:m.type==="cylinder"?bn:ps}),m.plane.material.blending=Jh,m.plane.material.blendEquation=Zi,m.plane.material.blendSrc=To,m.plane.material.blendDst=To,m.xrlayer=this._createXRLayer(m),h.unshift(m.xrlayer);e.updateRenderState({layers:h})}else{const a={antialias:t.samples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},o=new XRWebGLLayer(e,r,a);this._glBaseLayer=o,e.updateRenderState({baseLayer:o}),t.setPixelRatio(1),t._setXRLayerSize(o.framebufferWidth,o.framebufferHeight),this._xrRenderTarget=new Ap(o.framebufferWidth,o.framebufferHeight,{format:ii,type:Kn,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:o.ignoreDepthValues===!1,resolveStencilBuffer:o.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const i=e.near,r=e.far,s=this._cameraXR,a=this._cameraL,o=this._cameraR;s.near=o.near=a.near=i,s.far=o.far=a.far=r,s.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==s.near||this._currentDepthFar!==s.far)&&(t.updateRenderState({depthNear:s.near,depthFar:s.far}),this._currentDepthNear=s.near,this._currentDepthFar=s.far),s.layers.mask=e.layers.mask|6,a.layers.mask=s.layers.mask&3,o.layers.mask=s.layers.mask&5;const l=e.parent,u=s.cameras;c2(s,l);for(let c=0;c<u.length;c++)c2(u[c],l);u.length===2?Xre(s,a,o):s.projectionMatrix.copy(a.projectionMatrix),Yre(e,s,l)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new wy,this._controllers[e]=t),t}}function Xre(n,e,t){l2.setFromMatrixPosition(e.matrixWorld),u2.setFromMatrixPosition(t.matrixWorld);const i=l2.distanceTo(u2),r=e.projectionMatrix.elements,s=t.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],u=(r[9]-1)/r[5],c=(r[8]-1)/r[0],h=(s[8]+1)/s[0],d=a*c,f=a*h,m=i/(-c+h),_=m*-c;if(e.matrixWorld.decompose(n.position,n.quaternion,n.scale),n.translateX(_),n.translateZ(m),n.matrixWorld.compose(n.position,n.quaternion,n.scale),n.matrixWorldInverse.copy(n.matrixWorld).invert(),r[10]===-1)n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const g=a+m,p=o+m,y=d-_,v=f+(i-_),b=l*o/p*g,S=u*o/p*g;n.projectionMatrix.makePerspective(y,v,b,S,g,p),n.projectionMatrixInverse.copy(n.projectionMatrix).invert()}}function c2(n,e){e===null?n.matrixWorld.copy(n.matrix):n.matrixWorld.multiplyMatrices(e.matrixWorld,n.matrix),n.matrixWorldInverse.copy(n.matrixWorld).invert()}function Yre(n,e,t){t===null?n.matrix.copy(e.matrixWorld):(n.matrix.copy(t.matrixWorld),n.matrix.invert(),n.matrix.multiply(e.matrixWorld)),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld(!0),n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse),n.isPerspectiveCamera&&(n.fov=yc*2*Math.atan(1/n.projectionMatrix.elements[5]),n.zoom=1)}function Kre(n){const e=this._controllerInputSources.indexOf(n.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const i=this.getReferenceSpace();t.update(n.inputSource,n.frame,i),t.dispatchEvent({type:n.type,data:n.inputSource})}}function Qre(){const n=this._session,e=this._renderer;n.removeEventListener("select",this._onSessionEvent),n.removeEventListener("selectstart",this._onSessionEvent),n.removeEventListener("selectend",this._onSessionEvent),n.removeEventListener("squeeze",this._onSessionEvent),n.removeEventListener("squeezestart",this._onSessionEvent),n.removeEventListener("squeezeend",this._onSessionEvent),n.removeEventListener("end",this._onSessionEnd),n.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const i=this._controllerInputSources[t];i!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(i))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._sessionUsesLayers===!0)for(const t of this._layers)t.renderTarget=new Ap(t.pixelwidth,t.pixelheight,{format:ii,type:Kn,depthTexture:new ks(t.pixelwidth,t.pixelheight,t.stencilBuffer?gs:wn,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?ys:_s),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function Zre(n){const e=this._controllers,t=this._controllerInputSources;for(let i=0;i<n.removed.length;i++){const r=n.removed[i],s=t.indexOf(r);s>=0&&(t[s]=null,e[s].disconnect(r))}for(let i=0;i<n.added.length;i++){const r=n.added[i];let s=t.indexOf(r);if(s===-1){for(let o=0;o<e.length;o++)if(o>=t.length){t.push(r),s=o;break}else if(t[o]===null){t[o]=r,s=o;break}if(s===-1)break}const a=e[s];a&&a.connect(r)}}function Jre(n){return n.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(n.translation,n.quaternion),width:n.width/2,height:n.height/2,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(n.translation,n.quaternion),radius:n.radius,centralAngle:n.centralAngle,aspectRatio:n.aspectRatio,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1})}function ese(n,e){if(e===void 0)return;const t=this._cameraXR,i=this._renderer,r=i.backend,s=this._glBaseLayer,a=this.getReferenceSpace(),o=e.getViewerPose(a);if(this._xrFrame=e,o!==null){const l=o.views;this._glBaseLayer!==null&&r.setXRTarget(s.framebuffer);let u=!1;l.length!==t.cameras.length&&(t.cameras.length=0,u=!0);for(let c=0;c<l.length;c++){const h=l[c];let d;if(this._supportsLayers===!0){const m=this._glBinding.getViewSubImage(this._glProjLayer,h);d=m.viewport,c===0&&r.setXRRenderTargetTextures(this._xrRenderTarget,m.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:m.depthStencilTexture)}else d=s.getViewport(h);let f=this._cameras[c];f===void 0&&(f=new Ii,f.layers.enable(c),f.viewport=new Je,this._cameras[c]=f),f.matrix.fromArray(h.transform.matrix),f.matrix.decompose(f.position,f.quaternion,f.scale),f.projectionMatrix.fromArray(h.projectionMatrix),f.projectionMatrixInverse.copy(f.projectionMatrix).invert(),f.viewport.set(d.x,d.y,d.width,d.height),c===0&&(t.matrix.copy(f.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),u===!0&&t.cameras.push(f)}i.setOutputRenderTarget(this._xrRenderTarget)}for(let l=0;l<this._controllers.length;l++){const u=this._controllerInputSources[l],c=this._controllers[l];u!==null&&c!==void 0&&c.update(u,e,a)}this._currentAnimationLoop&&this._currentAnimationLoop(n,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}const h2=new J0,sh=new fe,Ox=new Je,Ix=new wg,Bx=new Kw,K_=new zt,_o=new Je;class tse{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:i=!1,alpha:r=!0,depth:s=!0,stencil:a=!1,antialias:o=!1,samples:l=0,getFallback:u=null,colorBufferType:c=Fi,multiview:h=!1}=t;this.domElement=e.getDomElement(),this.backend=e,this.samples=l||o===!0?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=i,this.outputColorSpace=hr,this.toneMapping=zr,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=s,this.stencil=a,this.info=new Bne,this.overrideNodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new t3,this.lighting=new jre,this._getFallback=u,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new Je(0,0,this._width,this._height),this._scissor=new Je(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new WA(new vi),this._quad.material.name="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const d=this.alpha===!0?0:1;this._clearColor=new $A(0,0,0,d),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=c,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:Sw},this.xr=new qre(this,h),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(f,m,_)=>{await this.compileAsync(f,m);const g=this._renderLists.get(f,m),p=this._renderContexts.get(f,m,this._renderTarget),y=f.overrideMaterial||_.material,v=this._objects.get(_,y,f,m,g.lightsNode,p,p.clippingContext),{fragmentShader:b,vertexShader:S}=v.getNodeBuilderState();return{fragmentShader:b,vertexShader:S}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let i=this.backend;try{await i.init(this)}catch(r){if(this._getFallback!==null)try{this.backend=i=this._getFallback(r),await i.init(this)}catch(s){t(s);return}else{t(r);return}}this._nodes=new Vre(this,i),this._animation=new Rne(this._nodes,this.info),this._attributes=new One(i),this._background=new rre(this,this._nodes),this._geometries=new Ine(this._attributes,this.info),this._textures=new Zne(this,i,this.info),this._pipelines=new Gne(i,this._nodes),this._bindings=new Vne(i,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new Lne(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new Wne(this.lighting),this._bundles=new $re,this._renderContexts=new Kne,this._animation.start(),this._initialized=!0,e(this)}),this._initPromise)}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,i=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const r=this._nodes.nodeFrame,s=r.renderId,a=this._currentRenderContext,o=this._currentRenderObjectFunction,l=this._compilationPromises,u=e.isScene===!0?e:h2;i===null&&(i=e);const c=this._renderTarget,h=this._renderContexts.get(i,t,c),d=this._activeMipmapLevel,f=[];this._currentRenderContext=h,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=f,r.renderId++,r.update(),h.depth=this.depth,h.stencil=this.stencil,h.clippingContext||(h.clippingContext=new $v),h.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,c);const m=this._renderLists.get(e,t);if(m.begin(),this._projectObject(e,t,0,m,h.clippingContext),i!==e&&i.traverseVisible(function(v){v.isLight&&v.layers.test(t.layers)&&m.pushLight(v)}),m.finish(),c!==null){this._textures.updateRenderTarget(c,d);const v=this._textures.get(c);h.textures=v.textures,h.depthTexture=v.depthTexture}else h.textures=null,h.depthTexture=null;this._background.update(u,m,h);const _=m.opaque,g=m.transparent,p=m.transparentDoublePass,y=m.lightsNode;this.opaque===!0&&_.length>0&&this._renderObjects(_,t,u,y),this.transparent===!0&&g.length>0&&this._renderTransparents(g,p,t,u,y),r.renderId=s,this._currentRenderContext=a,this._currentRenderObjectFunction=o,this._compilationPromises=l,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(f)}async renderAsync(e,t){this._initialized===!1&&await this.init(),this._renderScene(e,t)}async waitForGPU(){await this.backend.waitForGPU()}set highPrecision(e){e===!0?(this.overrideNodes.modelViewMatrix=hD,this.overrideNodes.modelNormalViewMatrix=dD):this.highPrecision&&(this.overrideNodes.modelViewMatrix=null,this.overrideNodes.modelNormalViewMatrix=null)}get highPrecision(){return this.overrideNodes.modelViewMatrix===hD&&this.overrideNodes.modelNormalViewMatrix===dD}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),console.error(t),this._isDeviceLost=!0}_renderBundle(e,t,i){const{bundleGroup:r,camera:s,renderList:a}=e,o=this._currentRenderContext,l=this._bundles.get(r,s),u=this.backend.get(l);u.renderContexts===void 0&&(u.renderContexts=new Set);const c=r.version!==u.version,h=u.renderContexts.has(o)===!1||c;if(u.renderContexts.add(o),h){this.backend.beginBundle(o),(u.renderObjects===void 0||c)&&(u.renderObjects=[]),this._currentRenderBundle=l;const{transparentDoublePass:d,transparent:f,opaque:m}=a;this.opaque===!0&&m.length>0&&this._renderObjects(m,s,t,i),this.transparent===!0&&f.length>0&&this._renderTransparents(f,d,s,t,i),this._currentRenderBundle=null,this.backend.finishBundle(o,l),u.version=r.version}else{const{renderObjects:d}=u;for(let f=0,m=d.length;f<m;f++){const _=d[f];this._nodes.needsRefresh(_)&&(this._nodes.updateBefore(_),this._nodes.updateForRender(_),this._bindings.updateForRender(_),this._nodes.updateAfter(_))}}this.backend.addBundle(o,l)}render(e,t){if(this._initialized===!1)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,t);this._renderScene(e,t)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this,i=e!==zr,r=t!==Ze.workingColorSpace;if(i===!1&&r===!1)return null;const{width:s,height:a}=this.getDrawingBufferSize(sh),{depth:o,stencil:l}=this;let u=this._frameBufferTarget;u===null&&(u=new Nc(s,a,{depthBuffer:o,stencilBuffer:l,type:this._colorBufferType,format:ii,colorSpace:Ze.workingColorSpace,generateMipmaps:!1,minFilter:wi,magFilter:wi,samples:this.samples}),u.isPostProcessingRenderTarget=!0,this._frameBufferTarget=u);const c=this.getOutputRenderTarget();return u.depthBuffer=o,u.stencilBuffer=l,c!==null?u.setSize(c.width,c.height,c.depth):u.setSize(s,a,1),u.viewport.copy(this._viewport),u.scissor.copy(this._scissor),u.viewport.multiplyScalar(this._pixelRatio),u.scissor.multiplyScalar(this._pixelRatio),u.scissorTest=this._scissorTest,u.multiview=c!==null?c.multiview:!1,u.resolveDepthBuffer=c!==null?c.resolveDepthBuffer:!0,u._autoAllocateDepthBuffer=c!==null?c._autoAllocateDepthBuffer:!1,u}_renderScene(e,t,i=!0){if(this._isDeviceLost===!0)return;const r=i?this._getFrameBufferTarget():null,s=this._nodes.nodeFrame,a=s.renderId,o=this._currentRenderContext,l=this._currentRenderObjectFunction,u=e.isScene===!0?e:h2,c=this._renderTarget||this._outputRenderTarget,h=this._activeCubeFace,d=this._activeMipmapLevel;let f;r!==null?(f=r,this.setRenderTarget(f)):f=c;const m=this._renderContexts.get(e,t,f);this._currentRenderContext=m,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,s.renderId=this.info.calls;const _=this.coordinateSystem,g=this.xr;if(t.coordinateSystem!==_&&g.isPresenting===!1&&(t.coordinateSystem=_,t.updateProjectionMatrix(),t.isArrayCamera))for(const k of t.cameras)k.coordinateSystem=_,k.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),g.enabled===!0&&g.isPresenting===!0&&(g.cameraAutoUpdate===!0&&g.updateCamera(t),t=g.getCamera());let p=this._viewport,y=this._scissor,v=this._pixelRatio;f!==null&&(p=f.viewport,y=f.scissor,v=1),this.getDrawingBufferSize(sh),Ox.set(0,0,sh.width,sh.height);const b=p.minDepth===void 0?0:p.minDepth,S=p.maxDepth===void 0?1:p.maxDepth;m.viewportValue.copy(p).multiplyScalar(v).floor(),m.viewportValue.width>>=d,m.viewportValue.height>>=d,m.viewportValue.minDepth=b,m.viewportValue.maxDepth=S,m.viewport=m.viewportValue.equals(Ox)===!1,m.scissorValue.copy(y).multiplyScalar(v).floor(),m.scissor=this._scissorTest&&m.scissorValue.equals(Ox)===!1,m.scissorValue.width>>=d,m.scissorValue.height>>=d,m.clippingContext||(m.clippingContext=new $v),m.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,f);const x=t.isArrayCamera?Bx:Ix;t.isArrayCamera||(K_.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),x.setFromProjectionMatrix(K_,t.coordinateSystem,t.reversedDepth));const T=this._renderLists.get(e,t);if(T.begin(),this._projectObject(e,t,0,T,m.clippingContext),T.finish(),this.sortObjects===!0&&T.sort(this._opaqueSort,this._transparentSort),f!==null){this._textures.updateRenderTarget(f,d);const k=this._textures.get(f);m.textures=k.textures,m.depthTexture=k.depthTexture,m.width=k.width,m.height=k.height,m.renderTarget=f,m.depth=f.depthBuffer,m.stencil=f.stencilBuffer}else m.textures=null,m.depthTexture=null,m.width=sh.width,m.height=sh.height,m.depth=this.depth,m.stencil=this.stencil;m.width>>=d,m.height>>=d,m.activeCubeFace=h,m.activeMipmapLevel=d,m.occlusionQueryCount=T.occlusionQueryCount,m.scissorValue.max(_o.set(0,0,0,0)),m.scissorValue.x+m.scissorValue.width>m.width&&(m.scissorValue.width=Math.max(m.width-m.scissorValue.x,0)),m.scissorValue.y+m.scissorValue.height>m.height&&(m.scissorValue.height=Math.max(m.height-m.scissorValue.y,0)),this._background.update(u,T,m),m.camera=t,this.backend.beginRender(m);const{bundles:w,lightsNode:E,transparentDoublePass:M,transparent:N,opaque:U}=T;return w.length>0&&this._renderBundles(w,u,E),this.opaque===!0&&U.length>0&&this._renderObjects(U,t,u,E),this.transparent===!0&&N.length>0&&this._renderTransparents(N,M,t,u,E),this.backend.finishRender(m),s.renderId=a,this._currentRenderContext=o,this._currentRenderObjectFunction=l,r!==null&&(this.setRenderTarget(c,h,d),this._renderOutput(f)),u.onAfterRender(this,e,t,f),m}_setXRLayerSize(e,t){this._width=e,this._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const i=this.autoClear,r=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=i,this.xr.enabled=r}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,i){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=i,this.domElement.width=Math.floor(e*i),this.domElement.height=Math.floor(t*i),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setSize(e,t,i=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),i===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,i,r){const s=this._scissor;e.isVector4?s.copy(e):s.set(e,t,i,r)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,i,r,s=0,a=1){const o=this._viewport;e.isVector4?o.copy(e):o.set(e,t,i,r),o.minDepth=s,o.maxDepth=a}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,i=!0){if(this._initialized===!1)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,t,i);const r=this._renderTarget||this._getFrameBufferTarget();let s=null;if(r!==null){this._textures.updateRenderTarget(r);const a=this._textures.get(r);s=this._renderContexts.getForClear(r),s.textures=a.textures,s.depthTexture=a.depthTexture,s.width=a.width,s.height=a.height,s.renderTarget=r,s.depth=r.depthBuffer,s.stencil=r.stencilBuffer,s.clearColorValue=this.backend.getClearColor(),s.activeCubeFace=this.getActiveCubeFace(),s.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,i,s),r!==null&&this._renderTarget===null&&this._renderOutput(r)}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,i=!0){this._initialized===!1&&await this.init(),this.clear(e,t,i)}async clearColorAsync(){this.clearAsync(!0,!1,!1)}async clearDepthAsync(){this.clearAsync(!1,!0,!1)}async clearStencilAsync(){this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:zr}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:Ze.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,i=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=i}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e,t=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);const i=this._nodes.nodeFrame,r=i.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,i.renderId=this.info.calls;const s=this.backend,a=this._pipelines,o=this._bindings,l=this._nodes,u=Array.isArray(e)?e:[e];if(u[0]===void 0||u[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");s.beginCompute(e);for(const c of u){if(a.has(c)===!1){const f=()=>{c.removeEventListener("dispose",f),a.delete(c),o.delete(c),l.delete(c)};c.addEventListener("dispose",f);const m=c.onInitFunction;m!==null&&m.call(c,{renderer:this})}l.updateForCompute(c),o.updateForCompute(c);const h=o.getForCompute(c),d=a.getForCompute(c,h);s.compute(e,c,h,d,t)}s.finishCompute(e),i.renderId=r}async computeAsync(e,t=null){this._initialized===!1&&await this.init(),this.compute(e,t)}async hasFeatureAsync(e){return this._initialized===!1&&await this.init(),this.backend.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){return this._initialized===!1?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){this._initialized===!1&&await this.init(),this._textures.updateTexture(e)}initTexture(e){this._initialized===!1&&console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=_o.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=_o.copy(t).floor();else{console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=_o.set(0,0,e.image.width,e.image.height);let i=this._currentRenderContext,r;i!==null?r=i.renderTarget:(r=this._renderTarget||this._getFrameBufferTarget(),r!==null&&(this._textures.updateRenderTarget(r),i=this._textures.get(r))),this._textures.updateTexture(e,{renderTarget:r}),this.backend.copyFramebufferToTexture(e,i,t)}copyTextureToTexture(e,t,i=null,r=null,s=0,a=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,i,r,s,a)}async readRenderTargetPixelsAsync(e,t,i,r,s,a=0,o=0){return this.backend.copyTextureToBuffer(e.textures[a],t,i,r,s,o)}_projectObject(e,t,i,r,s){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)i=e.renderOrder,e.isClippingGroup&&e.enabled&&(s=s.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)r.pushLight(e);else if(e.isSprite){const l=t.isArrayCamera?Bx:Ix;if(!e.frustumCulled||l.intersectsSprite(e,t)){this.sortObjects===!0&&_o.setFromMatrixPosition(e.matrixWorld).applyMatrix4(K_);const{geometry:u,material:c}=e;c.visible&&r.push(e,u,c,i,_o.z,null,s)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const l=t.isArrayCamera?Bx:Ix;if(!e.frustumCulled||l.intersectsObject(e,t)){const{geometry:u,material:c}=e;if(this.sortObjects===!0&&(u.boundingSphere===null&&u.computeBoundingSphere(),_o.copy(u.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(K_)),Array.isArray(c)){const h=u.groups;for(let d=0,f=h.length;d<f;d++){const m=h[d],_=c[m.materialIndex];_&&_.visible&&r.push(e,u,_,i,_o.z,m,s)}}else c.visible&&r.push(e,u,c,i,_o.z,null,s)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const l=r;r=this._renderLists.get(e,t),r.begin(),l.pushBundle({bundleGroup:e,camera:t,renderList:r}),r.finish()}const o=e.children;for(let l=0,u=o.length;l<u;l++)this._projectObject(o[l],t,i,r,s)}_renderBundles(e,t,i){for(const r of e)this._renderBundle(r,t,i)}_renderTransparents(e,t,i,r,s){if(t.length>0){for(const{material:a}of t)a.side=bn;this._renderObjects(t,i,r,s,"backSide");for(const{material:a}of t)a.side=ps;this._renderObjects(e,i,r,s);for(const{material:a}of t)a.side=Qi}else this._renderObjects(e,i,r,s)}_renderObjects(e,t,i,r,s=null){for(let a=0,o=e.length;a<o;a++){const{object:l,geometry:u,material:c,group:h,clippingContext:d}=e[a];this._currentRenderObjectFunction(l,i,t,u,c,h,r,d,s)}}renderObject(e,t,i,r,s,a,o,l=null,u=null){let c,h,d;if(e.onBeforeRender(this,t,i,r,s,a),s.allowOverride===!0&&t.overrideMaterial!==null){const f=t.overrideMaterial;s.positionNode&&s.positionNode.isNode&&(c=f.positionNode,f.positionNode=s.positionNode),f.alphaTest=s.alphaTest,f.alphaMap=s.alphaMap,f.transparent=s.transparent||s.transmission>0,f.isShadowPassMaterial&&(f.side=s.shadowSide===null?s.side:s.shadowSide,s.depthNode&&s.depthNode.isNode&&(d=f.depthNode,f.depthNode=s.depthNode),s.castShadowNode&&s.castShadowNode.isNode&&(h=f.colorNode,f.colorNode=s.castShadowNode),s.castShadowPositionNode&&s.castShadowPositionNode.isNode&&(c=f.positionNode,f.positionNode=s.castShadowPositionNode)),s=f}s.transparent===!0&&s.side===Qi&&s.forceSinglePass===!1?(s.side=bn,this._handleObjectFunction(e,s,t,i,o,a,l,"backSide"),s.side=ps,this._handleObjectFunction(e,s,t,i,o,a,l,u),s.side=Qi):this._handleObjectFunction(e,s,t,i,o,a,l,u),c!==void 0&&(t.overrideMaterial.positionNode=c),d!==void 0&&(t.overrideMaterial.depthNode=d),h!==void 0&&(t.overrideMaterial.colorNode=h),e.onAfterRender(this,t,i,r,s,a)}_renderObjectDirect(e,t,i,r,s,a,o,l){const u=this._objects.get(e,t,i,r,s,this._currentRenderContext,o,l);u.drawRange=e.geometry.drawRange,u.group=a;const c=this._nodes.needsRefresh(u);c&&(this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u)),this._pipelines.updateForRender(u),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(u),u.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(u,this.info),c&&this._nodes.updateAfter(u)}_createObjectPipeline(e,t,i,r,s,a,o,l){const u=this._objects.get(e,t,i,r,s,this._currentRenderContext,o,l);u.drawRange=e.geometry.drawRange,u.group=a,this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u),this._pipelines.getForRender(u,this._compilationPromises),this._nodes.updateAfter(u)}get compile(){return this.compileAsync}}class n3{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}function nse(n){return n+(Ol-n%Ol)%Ol}let i3=class extends n3{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return nse(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}};class r3 extends i3{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let ise=0;class s3 extends r3{constructor(e,t){super("UniformBuffer_"+ise++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class rse extends r3{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let i=0,r=this.uniforms.length;i<r;i++){const s=this.uniforms[i],a=s.boundary,o=s.itemSize*e,l=t%Ol,u=l%a,c=l+u;t+=u,c!==0&&Ol-c<o&&(t+=Ol-c),s.offset=t/e,t+=o}return Math.ceil(t/Ol)*Ol}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset,a=e.getType();if(i[s]!==r){const o=this._getBufferForType(a);o[s]=i[s]=r,t=!0}return t}updateVector2(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset,a=e.getType();if(i[s+0]!==r.x||i[s+1]!==r.y){const o=this._getBufferForType(a);o[s+0]=i[s+0]=r.x,o[s+1]=i[s+1]=r.y,t=!0}return t}updateVector3(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset,a=e.getType();if(i[s+0]!==r.x||i[s+1]!==r.y||i[s+2]!==r.z){const o=this._getBufferForType(a);o[s+0]=i[s+0]=r.x,o[s+1]=i[s+1]=r.y,o[s+2]=i[s+2]=r.z,t=!0}return t}updateVector4(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset,a=e.getType();if(i[s+0]!==r.x||i[s+1]!==r.y||i[s+2]!==r.z||i[s+4]!==r.w){const o=this._getBufferForType(a);o[s+0]=i[s+0]=r.x,o[s+1]=i[s+1]=r.y,o[s+2]=i[s+2]=r.z,o[s+3]=i[s+3]=r.w,t=!0}return t}updateColor(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset;if(i[s+0]!==r.r||i[s+1]!==r.g||i[s+2]!==r.b){const a=this.buffer;a[s+0]=i[s+0]=r.r,a[s+1]=i[s+1]=r.g,a[s+2]=i[s+2]=r.b,t=!0}return t}updateMatrix3(e){let t=!1;const i=this.values,r=e.getValue().elements,s=e.offset;if(i[s+0]!==r[0]||i[s+1]!==r[1]||i[s+2]!==r[2]||i[s+4]!==r[3]||i[s+5]!==r[4]||i[s+6]!==r[5]||i[s+8]!==r[6]||i[s+9]!==r[7]||i[s+10]!==r[8]){const a=this.buffer;a[s+0]=i[s+0]=r[0],a[s+1]=i[s+1]=r[1],a[s+2]=i[s+2]=r[2],a[s+4]=i[s+4]=r[3],a[s+5]=i[s+5]=r[4],a[s+6]=i[s+6]=r[5],a[s+8]=i[s+8]=r[6],a[s+9]=i[s+9]=r[7],a[s+10]=i[s+10]=r[8],t=!0}return t}updateMatrix4(e){let t=!1;const i=this.values,r=e.getValue().elements,s=e.offset;return ase(i,r,s)===!1&&(this.buffer.set(r,s),sse(i,r,s),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function sse(n,e,t){for(let i=0,r=e.length;i<r;i++)n[t+i]=e[i]}function ase(n,e,t){for(let i=0,r=e.length;i<r;i++)if(n[t+i]!==e[i])return!1;return!0}let ose=0;class a3 extends rse{constructor(e,t){super(e),this.id=ose++,this.groupNode=t,this.isNodeUniformsGroup=!0}}class o3 extends n3{constructor(e,t){super(e),this.texture=t,this.version=t?t.version:0,this.generation=null,this.isSampler=!0}set texture(e){if(this._texture===e)return;const t=()=>{this._texture=null,this.generation=null,this.version=0};this._texture&&this._texture.removeEventListener("dispose",t),this._texture=e,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener("dispose",t)}get texture(){return this._texture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}clone(){const e=super.clone();return e._texture=null,e.texture=this.texture,e}}let lse=0;class use extends o3{constructor(e,t){super(e,t),this.id=lse++,this.store=!1,this.isSampledTexture=!0}}class vb extends use{constructor(e,t,i,r=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=i,this.access=r}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class l3 extends vb{constructor(e,t,i,r=null){super(e,t,i,r),this.isSampledCubeTexture=!0}}class GE extends vb{constructor(e,t,i,r=null){super(e,t,i,r),this.isSampledTexture3D=!0}}const d2={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint"},cse={low:"lowp",medium:"mediump",high:"highp"},f2={swizzleAssign:!0,storageBuffer:!1},p2={perspective:"smooth",linear:"noperspective"},m2={centroid:"centroid"},g2=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`;class hse extends JF{constructor(e,t){super(e,t,new Gre),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Or}getMethod(e){return d2[e]||e}getBitcastMethod(e,t){return d2[`bitcast_${t}_${e}`]}getTernary(e,t,i){return`${e} ? ${t} : ${i}`}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,i=this.flowShaderNode(e),r=[];for(const a of t.inputs)r.push(this.getType(a.type)+" "+a.name);return`${this.getType(t.type)} ${t.name}( ${r.join(", ")} ) {

	${i.vars}

${i.code}
	return ${i.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const i=t.array,r=t.count*t.itemSize,{itemSize:s}=t,a=t.array.constructor.name.toLowerCase().includes("int");let o=a?Tf:Tg;s===2?o=a?Ef:zo:s===3?o=a?i8:xg:s===4&&(o=a?Mf:ii);const l={Float32Array:li,Uint8Array:Kn,Uint16Array:la,Uint32Array:wn,Int8Array:sc,Int16Array:ac,Int32Array:Oi,Uint8ClampedArray:Kn},u=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(r/s))));let c=Math.ceil(r/s/u);u*c*s<r&&c++;const h=u*c*s,d=new i.constructor(h);d.set(i,0),t.array=d;const f=new s5(t.array,u,c,o,l[t.array.constructor.name]||li);f.needsUpdate=!0,f.isPBOTexture=!0;const m=new Nf(f,null,null);m.setPrecision("high"),t.pboNode=m,t.pbo=m.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:i}=e,r=t.value;if(this.renderer.backend.has(r)){const c=this.renderer.backend.get(r);c.pbo=r.pbo}const s=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.nodeName),a=this.getPropertyName(s);this.increaseUsage(i);const o=i.build(this,"uint"),l=this.getDataFromNode(e);let u=l.propertyName;if(u===void 0){const c=this.getVarFromNode(e);u=this.getPropertyName(c);const h=this.getDataFromNode(t);let d=h.propertySizeName;d===void 0&&(d=u+"Size",this.getVarFromNode(t,d,"uint"),this.addLineFlowCode(`${d} = uint( textureSize( ${a}, 0 ).x )`,e),h.propertySizeName=d);const{itemSize:f}=r,m="."+Rf.join("").slice(0,f),_=`ivec2(${o} % ${d}, ${o} / ${d})`,g=this.generateTextureLoad(null,a,_,null,null,"0");let p="vec4";r.pbo.type===wn?p="uvec4":r.pbo.type===Oi&&(p="ivec4"),this.addLineFlowCode(`${u} = ${p}(${g})${m}`,e),l.propertyName=u}return u}generateTextureLoad(e,t,i,r,s,a="0"){let o;return r?s?o=`texelFetchOffset( ${t}, ivec3( ${i}, ${r} ), ${a}, ${s} )`:o=`texelFetch( ${t}, ivec3( ${i}, ${r} ), ${a} )`:s?o=`texelFetchOffset( ${t}, ${i}, ${a}, ${s} )`:o=`texelFetch( ${t}, ${i}, ${a} )`,e!==null&&e.isDepthTexture&&(o+=".x"),o}generateTexture(e,t,i,r,s){return r&&(i=`vec3( ${i}, ${r} )`),e.isDepthTexture?s?`textureOffset( ${t}, ${i}, ${s} ).x`:`texture( ${t}, ${i} ).x`:s?`textureOffset( ${t}, ${i}, ${s} )`:`texture( ${t}, ${i} )`}generateTextureLevel(e,t,i,r,s){return s?`textureLodOffset( ${t}, ${i}, ${r}, ${s} )`:`textureLod( ${t}, ${i}, ${r} )`}generateTextureBias(e,t,i,r,s){return s?`textureOffset( ${t}, ${i}, ${s}, ${r} )`:`texture( ${t}, ${i}, ${r} )`}generateTextureGrad(e,t,i,r,s){return s?`textureGradOffset( ${t}, ${i}, ${r[0]}, ${r[1]}, ${s} )`:`textureGrad( ${t}, ${i}, ${r[0]}, ${r[1]} )`}generateTextureCompare(e,t,i,r,s,a,o=this.shaderStage){if(o==="fragment")return s?a?`textureOffset( ${t}, vec4( ${i}, ${s}, ${r} ), ${a} )`:`texture( ${t}, vec4( ${i}, ${s}, ${r} ) )`:a?`textureOffset( ${t}, vec3( ${i}, ${r} ), ${a} )`:`texture( ${t}, vec3( ${i}, ${r} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}getVars(e){const t=[],i=this.vars[e];if(i!==void 0)for(const r of i)t.push(`${this.getVar(r.type,r.name,r.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],i=[],r={};for(const a of t){let o=null,l=!1;if(a.type==="texture"||a.type==="texture3D"){const c=a.node.value;let h="";(c.isDataTexture===!0||c.isData3DTexture===!0)&&(c.type===wn?h="u":c.type===Oi&&(h="i")),a.type==="texture3D"&&c.isArrayTexture===!1?o=`${h}sampler3D ${a.name};`:c.compareFunction?c.isArrayTexture===!0?o=`sampler2DArrayShadow ${a.name};`:o=`sampler2DShadow ${a.name};`:c.isArrayTexture===!0||c.isDataArrayTexture===!0||c.isCompressedArrayTexture===!0?o=`${h}sampler2DArray ${a.name};`:o=`${h}sampler2D ${a.name};`}else if(a.type==="cubeTexture")o=`samplerCube ${a.name};`;else if(a.type==="buffer"){const c=a.node,h=this.getType(c.bufferType),d=c.bufferCount,f=d>0?d:"";o=`${c.name} {
	${h} ${a.name}[${f}];
};
`}else o=`${this.getVectorType(a.type)} ${this.getPropertyName(a,e)};`,l=!0;const u=a.node.precision;if(u!==null&&(o=cse[u]+" "+o),l){o="	"+o;const c=a.groupNode.name;(r[c]||(r[c]=[])).push(o)}else o="uniform "+o,i.push(o)}let s="";for(const a in r){const o=r[a];s+=this._getGLSLUniformStruct(e+"_"+a,o.join(`
`))+`
`}return s+=i.join(`
`),s}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Oi){let i=e;e.isInterleavedBufferAttribute&&(i=e.data);const r=i.array;r instanceof Uint32Array||r instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const i=this.getAttributesArray();let r=0;for(const s of i)t+=`layout( location = ${r++} ) in ${s.type} ${s.name};
`}return t}getStructMembers(e){const t=[];for(const i of e.members)t.push(`	${i.type} ${i.name};`);return t.join(`
`)}getStructs(e){const t=[],i=this.structs[e],r=[];for(const s of i)if(s.output)for(const a of s.members)r.push(`layout( location = ${a.index} ) out ${a.type} ${a.name};`);else{let a="struct "+s.name+` {
`;a+=this.getStructMembers(s),a+=`
};
`,t.push(a)}return r.length===0&&r.push("layout( location = 0 ) out vec4 fragColor;"),`
`+r.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const i=this.varyings;if(e==="vertex"||e==="compute")for(const r of i){e==="compute"&&(r.needsInterpolation=!0);const s=this.getType(r.type);if(r.needsInterpolation)if(r.interpolationType){const a=p2[r.interpolationType]||r.interpolationType,o=m2[r.interpolationSampling]||"";t+=`${a} ${o} out ${s} ${r.name};
`}else{const a=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${a}out ${s} ${r.name};
`}else t+=`${s} ${r.name};
`}else if(e==="fragment"){for(const r of i)if(r.needsInterpolation){const s=this.getType(r.type);if(r.interpolationType){const a=p2[r.interpolationType]||r.interpolationType,o=m2[r.interpolationSampling]||"";t+=`${a} ${o} in ${s} ${r.name};
`}else{const a=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${a}in ${s} ${r.name};
`}}}for(const r of this.builtins[e])t+=`${r};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((i,r)=>i*r,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,i=this.shaderStage){const r=this.extensions[i]||(this.extensions[i]=new Map);r.has(e)===!1&&r.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const r=this.renderer.backend.extensions;this.object.isBatchedMesh&&r.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const i=this.extensions[e];if(i!==void 0)for(const{name:r,behavior:s}of i.values())t.push(`#extension ${r} : ${s}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=f2[e];if(t===void 0){let i;switch(t=!1,e){case"float32Filterable":i="OES_texture_float_linear";break;case"clipDistance":i="WEBGL_clip_cull_distance";break}if(i!==void 0){const r=this.renderer.backend.extensions;r.has(i)&&(r.get(i),t=!0)}f2[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let i=0;i<e.length;i++){const r=e[i],s=this.getPropertyName(r.attributeNode);s&&(t+=`${r.varyingName} = ${s};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${g2}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${g2}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

// structs
${e.structs}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let i=`// code

`;i+=this.flowCode[t];const r=this.flowNodes[t],s=r[r.length-1];for(const o of r){const l=this.getFlowData(o),u=o.name;u&&(i.length>0&&(i+=`
`),i+=`	// flow -> ${u}
	`),i+=`${l.code}
	`,o===s&&t!=="compute"&&(i+=`// result
	`,t==="vertex"?(i+="gl_Position = ",i+=`${l.result};`):t==="fragment"&&(o.outputNode.isOutputStructNode||(i+="fragColor = ",i+=`${l.result};`)))}const a=e[t];a.extensions=this.getExtensions(t),a.uniforms=this.getUniforms(t),a.attributes=this.getAttributes(t),a.varyings=this.getVaryings(t),a.vars=this.getVars(t),a.structs=this.getStructs(t),a.codes=this.getCodes(t),a.transforms=this.getTransforms(t),a.flow=i}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,i,r=null){const s=super.getUniformFromNode(e,t,i,r),a=this.getDataFromNode(e,i,this.globalCache);let o=a.uniformGPU;if(o===void 0){const l=e.groupNode,u=l.name,c=this.getBindGroupArray(u,i);if(t==="texture")o=new vb(s.name,s.node,l),c.push(o);else if(t==="cubeTexture")o=new l3(s.name,s.node,l),c.push(o);else if(t==="texture3D")o=new GE(s.name,s.node,l),c.push(o);else if(t==="buffer"){e.name=`NodeBuffer_${e.id}`,s.name=`buffer${e.id}`;const h=new s3(e,l);h.name=e.name,c.push(h),o=h}else{const h=this.uniformGroups[i]||(this.uniformGroups[i]={});let d=h[u];d===void 0&&(d=new a3(i+"_"+u,l),h[u]=d,c.push(d)),o=this.getNodeUniform(s,t),d.addUniform(o)}a.uniformGPU=o}return s}}let Fx=null,ah=null;class u3{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={render:null,compute:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}destroySampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}getTimestampUID(e){const t=this.get(e);let i=e.isComputeNode===!0?"c":"r";return i+=":"+t.frameCalls+":"+e.id,i}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){vs("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t){vs(`WebGPURenderer: No timestamp query pool for type '${e}' found.`);return}const i=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=i,i}async waitForGPU(){}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return Fx=Fx||new fe,this.renderer.getDrawingBufferSize(Fx)}setScissorTest(){}getClearColor(){const e=this.renderer;return ah=ah||new $A,e.getClearColor(ah),ah.getRGB(ah),ah}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:QO(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${xf} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let dse=0;class fse{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class pse{constructor(e){this.backend=e}createAttribute(e,t){const i=this.backend,{gl:r}=i,s=e.array,a=e.usage||r.STATIC_DRAW,o=e.isInterleavedBufferAttribute?e.data:e,l=i.get(o);let u=l.bufferGPU;u===void 0&&(u=this._createBuffer(r,t,s,a),l.bufferGPU=u,l.bufferType=t,l.version=o.version);let c;if(s instanceof Float32Array)c=r.FLOAT;else if(typeof Float16Array<"u"&&s instanceof Float16Array)c=r.HALF_FLOAT;else if(s instanceof Uint16Array)e.isFloat16BufferAttribute?c=r.HALF_FLOAT:c=r.UNSIGNED_SHORT;else if(s instanceof Int16Array)c=r.SHORT;else if(s instanceof Uint32Array)c=r.UNSIGNED_INT;else if(s instanceof Int32Array)c=r.INT;else if(s instanceof Int8Array)c=r.BYTE;else if(s instanceof Uint8Array)c=r.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)c=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+s);let h={bufferGPU:u,bufferType:t,type:c,byteLength:s.byteLength,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:c===r.INT||c===r.UNSIGNED_INT||e.gpuType===Oi,id:dse++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const d=this._createBuffer(r,t,s,a);h=new fse(h,d)}i.set(e,h)}updateAttribute(e){const t=this.backend,{gl:i}=t,r=e.array,s=e.isInterleavedBufferAttribute?e.data:e,a=t.get(s),o=a.bufferType,l=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(i.bindBuffer(o,a.bufferGPU),l.length===0)i.bufferSubData(o,0,r);else{for(let u=0,c=l.length;u<c;u++){const h=l[u];i.bufferSubData(o,h.start*r.BYTES_PER_ELEMENT,r,h.start,h.count)}s.clearUpdateRanges()}i.bindBuffer(o,null),a.version=s.version}destroyAttribute(e){const t=this.backend,{gl:i}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const r=t.get(e);i.deleteBuffer(r.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:i}=t,r=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:s}=t.get(r),a=e.array,o=a.byteLength;i.bindBuffer(i.COPY_READ_BUFFER,s);const l=i.createBuffer();i.bindBuffer(i.COPY_WRITE_BUFFER,l),i.bufferData(i.COPY_WRITE_BUFFER,o,i.STREAM_READ),i.copyBufferSubData(i.COPY_READ_BUFFER,i.COPY_WRITE_BUFFER,0,0,o),await t.utils._clientWaitAsync();const u=new e.array.constructor(a.length);return i.bindBuffer(i.COPY_WRITE_BUFFER,l),i.getBufferSubData(i.COPY_WRITE_BUFFER,0,u),i.deleteBuffer(l),i.bindBuffer(i.COPY_READ_BUFFER,null),i.bindBuffer(i.COPY_WRITE_BUFFER,null),u.buffer}_createBuffer(e,t,i,r){const s=e.createBuffer();return e.bindBuffer(t,s),e.bufferData(t,i,r),e.bindBuffer(t,null),s}}let kx,pp;class mse{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;kx={[Zi]:e.FUNC_ADD,[xw]:e.FUNC_SUBTRACT,[Tw]:e.FUNC_REVERSE_SUBTRACT},pp={[To]:e.ZERO,[Ew]:e.ONE,[Mw]:e.SRC_COLOR,[Mm]:e.SRC_ALPHA,[Dw]:e.SRC_ALPHA_SATURATE,[Nw]:e.DST_COLOR,[Aw]:e.DST_ALPHA,[ww]:e.ONE_MINUS_SRC_COLOR,[wm]:e.ONE_MINUS_SRC_ALPHA,[Cw]:e.ONE_MINUS_DST_COLOR,[Rw]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),i=e.getParameter(e.VIEWPORT);this.currentScissor=new Je().fromArray(t),this.currentViewport=new Je().fromArray(i),this._tempVec4=new Je}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==FO?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===uE?t.cullFace(t.BACK):e===kO?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:i}=this;e!==t&&(i.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,i,r,s,a,o,l){const{gl:u}=this;if(e===kr){this.currentBlendingEnabled===!0&&(this.disable(u.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(u.BLEND),this.currentBlendingEnabled=!0),e!==Jh){if(e!==this.currentBlending||l!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==Zi||this.currentBlendEquationAlpha!==Zi)&&(u.blendEquation(u.FUNC_ADD),this.currentBlendEquation=Zi,this.currentBlendEquationAlpha=Zi),l)switch(e){case ms:u.blendFuncSeparate(u.ONE,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case Td:u.blendFunc(u.ONE,u.ONE);break;case Ed:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case Md:u.blendFuncSeparate(u.DST_COLOR,u.ONE_MINUS_SRC_ALPHA,u.ZERO,u.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}else switch(e){case ms:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case Td:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE,u.ONE,u.ONE);break;case Ed:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Md:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=l}return}s=s||t,a=a||i,o=o||r,(t!==this.currentBlendEquation||s!==this.currentBlendEquationAlpha)&&(u.blendEquationSeparate(kx[t],kx[s]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=s),(i!==this.currentBlendSrc||r!==this.currentBlendDst||a!==this.currentBlendSrcAlpha||o!==this.currentBlendDstAlpha)&&(u.blendFuncSeparate(pp[i],pp[r],pp[a],pp[o]),this.currentBlendSrc=i,this.currentBlendDst=r,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=o),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case Am:t.depthFunc(t.NEVER);break;case Rm:t.depthFunc(t.ALWAYS);break;case Nm:t.depthFunc(t.LESS);break;case iu:t.depthFunc(t.LEQUAL);break;case Cm:t.depthFunc(t.EQUAL);break;case Dm:t.depthFunc(t.GEQUAL);break;case Lm:t.depthFunc(t.GREATER);break;case Pm:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,i,r){const s=this._tempVec4.set(e,t,i,r);if(this.currentScissor.equals(s)===!1){const{gl:a}=this;a.scissor(s.x,s.y,s.z,s.w),this.currentScissor.copy(s)}}viewport(e,t,i,r){const s=this._tempVec4.set(e,t,i,r);if(this.currentViewport.equals(s)===!1){const{gl:a}=this;a.viewport(s.x,s.y,s.z,s.w),this.currentViewport.copy(s)}}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,i){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==i)&&(this.gl.stencilFunc(e,t,i),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=i)}setStencilOp(e,t,i){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==i)&&(this.gl.stencilOp(e,t,i),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=i)}setMaterial(e,t,i){const{gl:r}=this;e.side===Qi?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let s=e.side===bn;t&&(s=!s),this.setFlipSided(s),e.blending===ms&&e.transparent===!1?this.setBlending(kr):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const a=e.stencilWrite;if(this.setStencilTest(a),a&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.samples>1?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),i>0&&this.currentClippingPlanes!==i)for(let l=0;l<8;l++)l<i?this.enable(12288+l):this.disable(12288+l)}setPolygonOffset(e,t,i){const{gl:r}=this;e?(this.enable(r.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==i)&&(r.polygonOffset(t,i),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=i)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const i=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(i.bindVertexArray(e),t!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:i,currentBoundFramebuffers:r}=this;return r[e]!==t?(i.bindFramebuffer(e,t),r[e]=t,e===i.DRAW_FRAMEBUFFER&&(r[i.FRAMEBUFFER]=t),e===i.FRAMEBUFFER&&(r[i.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:i}=this;let r=[],s=!1;if(e.textures!==null){r=this.currentDrawbuffers.get(t),r===void 0&&(r=[],this.currentDrawbuffers.set(t,r));const a=e.textures;if(r.length!==a.length||r[0]!==i.COLOR_ATTACHMENT0){for(let o=0,l=a.length;o<l;o++)r[o]=i.COLOR_ATTACHMENT0+o;r.length=a.length,s=!0}}else r[0]!==i.BACK&&(r[0]=i.BACK,s=!0);s&&i.drawBuffers(r)}activeTexture(e){const{gl:t,currentTextureSlot:i,maxTextures:r}=this;e===void 0&&(e=t.TEXTURE0+r-1),i!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,i){const{gl:r,currentTextureSlot:s,currentBoundTextures:a,maxTextures:o}=this;i===void 0&&(s===null?i=r.TEXTURE0+o-1:i=s);let l=a[i];l===void 0&&(l={type:void 0,texture:void 0},a[i]=l),(l.type!==e||l.texture!==t)&&(s!==i&&(r.activeTexture(i),this.currentTextureSlot=i),r.bindTexture(e,t),l.type=e,l.texture=t)}bindBufferBase(e,t,i){const{gl:r}=this,s=`${e}-${t}`;return this.currentBoundBufferBases[s]!==i?(r.bindBufferBase(e,t,i),this.currentBoundBufferBases[s]=i,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:i}=this,r=i[t];r!==void 0&&r.type!==void 0&&(e.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}}class gse{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=Or){const{gl:i,extensions:r}=this;let s;const a=Ze.getTransfer(t);if(e===Kn)return i.UNSIGNED_BYTE;if(e===j0)return i.UNSIGNED_SHORT_4_4_4_4;if(e===q0)return i.UNSIGNED_SHORT_5_5_5_1;if(e===X0)return i.UNSIGNED_INT_5_9_9_9_REV;if(e===Y0)return i.UNSIGNED_INT_10F_11F_11F_REV;if(e===sc)return i.BYTE;if(e===ac)return i.SHORT;if(e===la)return i.UNSIGNED_SHORT;if(e===Oi)return i.INT;if(e===wn)return i.UNSIGNED_INT;if(e===li)return i.FLOAT;if(e===Fi)return i.HALF_FLOAT;if(e===Uw)return i.ALPHA;if(e===xg)return i.RGB;if(e===ii)return i.RGBA;if(e===_s)return i.DEPTH_COMPONENT;if(e===ys)return i.DEPTH_STENCIL;if(e===Tg)return i.RED;if(e===Tf)return i.RED_INTEGER;if(e===zo)return i.RG;if(e===Ef)return i.RG_INTEGER;if(e===Mf)return i.RGBA_INTEGER;if(e===Xl||e===Yl||e===Kl||e===Ql)if(a===Re)if(s=r.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(e===Xl)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===Yl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===Kl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===Ql)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=r.get("WEBGL_compressed_texture_s3tc"),s!==null){if(e===Xl)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Yl)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Kl)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Ql)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===Um||e===Om||e===Im||e===Bm)if(s=r.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(e===Um)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Om)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Im)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Bm)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===Rd||e===Nd||e===Cd)if(s=r.get("WEBGL_compressed_texture_etc"),s!==null){if(e===Rd||e===Nd)return a===Re?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(e===Cd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===Dd||e===Ld||e===Pd||e===Ud||e===Od||e===Id||e===Bd||e===Fd||e===kd||e===zd||e===Gd||e===Vd||e===Hd||e===$d)if(s=r.get("WEBGL_compressed_texture_astc"),s!==null){if(e===Dd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===Ld)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===Pd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===Ud)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===Od)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===Id)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===Bd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===Fd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===kd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===zd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===Gd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===Vd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===Hd)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===$d)return a===Re?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===Wd)if(s=r.get("EXT_texture_compression_bptc"),s!==null){if(e===Wd)return a===Re?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===jd||e===qd||e===Xd||e===Yd)if(s=r.get("EXT_texture_compression_rgtc"),s!==null){if(e===jd)return s.COMPRESSED_RED_RGTC1_EXT;if(e===qd)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===Xd)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===Yd)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===gs?i.UNSIGNED_INT_24_8:i[e]!==void 0?i[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((i,r)=>{function s(){const a=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(a===e.WAIT_FAILED){e.deleteSync(t),r();return}if(a===e.TIMEOUT_EXPIRED){requestAnimationFrame(s);return}e.deleteSync(t),i()}s()})}}let _2=!1,Q_,zx,y2;class _se{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},_2===!1&&(this._init(),_2=!0)}_init(){const e=this.gl;Q_={[mc]:e.REPEAT,[Ia]:e.CLAMP_TO_EDGE,[gc]:e.MIRRORED_REPEAT},zx={[Ln]:e.NEAREST,[Pw]:e.NEAREST_MIPMAP_NEAREST,[ko]:e.NEAREST_MIPMAP_LINEAR,[wi]:e.LINEAR,[ed]:e.LINEAR_MIPMAP_NEAREST,[Ir]:e.LINEAR_MIPMAP_LINEAR},y2={[Ow]:e.NEVER,[zw]:e.ALWAYS,[K0]:e.LESS,[Q0]:e.LEQUAL,[Iw]:e.EQUAL,[kw]:e.GEQUAL,[Bw]:e.GREATER,[Fw]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let i;return e.isCubeTexture===!0?i=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?i=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?i=t.TEXTURE_3D:i=t.TEXTURE_2D,i}getInternalFormat(e,t,i,r,s=!1){const{gl:a,extensions:o}=this;if(e!==null){if(a[e]!==void 0)return a[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let l=t;if(t===a.RED&&(i===a.FLOAT&&(l=a.R32F),i===a.HALF_FLOAT&&(l=a.R16F),i===a.UNSIGNED_BYTE&&(l=a.R8),i===a.UNSIGNED_SHORT&&(l=a.R16),i===a.UNSIGNED_INT&&(l=a.R32UI),i===a.BYTE&&(l=a.R8I),i===a.SHORT&&(l=a.R16I),i===a.INT&&(l=a.R32I)),t===a.RED_INTEGER&&(i===a.UNSIGNED_BYTE&&(l=a.R8UI),i===a.UNSIGNED_SHORT&&(l=a.R16UI),i===a.UNSIGNED_INT&&(l=a.R32UI),i===a.BYTE&&(l=a.R8I),i===a.SHORT&&(l=a.R16I),i===a.INT&&(l=a.R32I)),t===a.RG&&(i===a.FLOAT&&(l=a.RG32F),i===a.HALF_FLOAT&&(l=a.RG16F),i===a.UNSIGNED_BYTE&&(l=a.RG8),i===a.UNSIGNED_SHORT&&(l=a.RG16),i===a.UNSIGNED_INT&&(l=a.RG32UI),i===a.BYTE&&(l=a.RG8I),i===a.SHORT&&(l=a.RG16I),i===a.INT&&(l=a.RG32I)),t===a.RG_INTEGER&&(i===a.UNSIGNED_BYTE&&(l=a.RG8UI),i===a.UNSIGNED_SHORT&&(l=a.RG16UI),i===a.UNSIGNED_INT&&(l=a.RG32UI),i===a.BYTE&&(l=a.RG8I),i===a.SHORT&&(l=a.RG16I),i===a.INT&&(l=a.RG32I)),t===a.RGB){const u=s?Kd:Ze.getTransfer(r);i===a.FLOAT&&(l=a.RGB32F),i===a.HALF_FLOAT&&(l=a.RGB16F),i===a.UNSIGNED_BYTE&&(l=a.RGB8),i===a.UNSIGNED_SHORT&&(l=a.RGB16),i===a.UNSIGNED_INT&&(l=a.RGB32UI),i===a.BYTE&&(l=a.RGB8I),i===a.SHORT&&(l=a.RGB16I),i===a.INT&&(l=a.RGB32I),i===a.UNSIGNED_BYTE&&(l=u===Re?a.SRGB8:a.RGB8),i===a.UNSIGNED_SHORT_5_6_5&&(l=a.RGB565),i===a.UNSIGNED_SHORT_5_5_5_1&&(l=a.RGB5_A1),i===a.UNSIGNED_SHORT_4_4_4_4&&(l=a.RGB4),i===a.UNSIGNED_INT_5_9_9_9_REV&&(l=a.RGB9_E5),i===a.UNSIGNED_INT_10F_11F_11F_REV&&(l=a.R11F_G11F_B10F)}if(t===a.RGB_INTEGER&&(i===a.UNSIGNED_BYTE&&(l=a.RGB8UI),i===a.UNSIGNED_SHORT&&(l=a.RGB16UI),i===a.UNSIGNED_INT&&(l=a.RGB32UI),i===a.BYTE&&(l=a.RGB8I),i===a.SHORT&&(l=a.RGB16I),i===a.INT&&(l=a.RGB32I)),t===a.RGBA){const u=s?Kd:Ze.getTransfer(r);i===a.FLOAT&&(l=a.RGBA32F),i===a.HALF_FLOAT&&(l=a.RGBA16F),i===a.UNSIGNED_BYTE&&(l=a.RGBA8),i===a.UNSIGNED_SHORT&&(l=a.RGBA16),i===a.UNSIGNED_INT&&(l=a.RGBA32UI),i===a.BYTE&&(l=a.RGBA8I),i===a.SHORT&&(l=a.RGBA16I),i===a.INT&&(l=a.RGBA32I),i===a.UNSIGNED_BYTE&&(l=u===Re?a.SRGB8_ALPHA8:a.RGBA8),i===a.UNSIGNED_SHORT_4_4_4_4&&(l=a.RGBA4),i===a.UNSIGNED_SHORT_5_5_5_1&&(l=a.RGB5_A1)}return t===a.RGBA_INTEGER&&(i===a.UNSIGNED_BYTE&&(l=a.RGBA8UI),i===a.UNSIGNED_SHORT&&(l=a.RGBA16UI),i===a.UNSIGNED_INT&&(l=a.RGBA32UI),i===a.BYTE&&(l=a.RGBA8I),i===a.SHORT&&(l=a.RGBA16I),i===a.INT&&(l=a.RGBA32I)),t===a.DEPTH_COMPONENT&&(i===a.UNSIGNED_SHORT&&(l=a.DEPTH_COMPONENT16),i===a.UNSIGNED_INT&&(l=a.DEPTH_COMPONENT24),i===a.FLOAT&&(l=a.DEPTH_COMPONENT32F)),t===a.DEPTH_STENCIL&&i===a.UNSIGNED_INT_24_8&&(l=a.DEPTH24_STENCIL8),(l===a.R16F||l===a.R32F||l===a.RG16F||l===a.RG32F||l===a.RGBA16F||l===a.RGBA32F)&&o.get("EXT_color_buffer_float"),l}setTextureParameters(e,t){const{gl:i,extensions:r,backend:s}=this,a=Ze.getPrimaries(Ze.workingColorSpace),o=t.colorSpace===Or?null:Ze.getPrimaries(t.colorSpace),l=t.colorSpace===Or||a===o?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,t.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,l),i.texParameteri(e,i.TEXTURE_WRAP_S,Q_[t.wrapS]),i.texParameteri(e,i.TEXTURE_WRAP_T,Q_[t.wrapT]),(e===i.TEXTURE_3D||e===i.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||i.texParameteri(e,i.TEXTURE_WRAP_R,Q_[t.wrapR])),i.texParameteri(e,i.TEXTURE_MAG_FILTER,zx[t.magFilter]);const u=t.mipmaps!==void 0&&t.mipmaps.length>0,c=t.minFilter===wi&&u?Ir:t.minFilter;if(i.texParameteri(e,i.TEXTURE_MIN_FILTER,zx[c]),t.compareFunction&&(i.texParameteri(e,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(e,i.TEXTURE_COMPARE_FUNC,y2[t.compareFunction])),r.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===Ln||t.minFilter!==ko&&t.minFilter!==Ir||t.type===li&&r.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const h=r.get("EXT_texture_filter_anisotropic");i.texParameterf(e,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,s.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:i,defaultTextures:r}=this,s=this.getGLTextureType(e);let a=r[s];a===void 0&&(a=t.createTexture(),i.state.bindTexture(s,a),t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST),r[s]=a),i.set(e,{textureGPU:a,glTextureType:s,isDefault:!0})}createTexture(e,t){const{gl:i,backend:r}=this,{levels:s,width:a,height:o,depth:l}=t,u=r.utils.convert(e.format,e.colorSpace),c=r.utils.convert(e.type),h=this.getInternalFormat(e.internalFormat,u,c,e.colorSpace,e.isVideoTexture),d=i.createTexture(),f=this.getGLTextureType(e);r.state.bindTexture(f,d),this.setTextureParameters(f,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?i.texStorage3D(i.TEXTURE_2D_ARRAY,s,h,a,o,l):e.isData3DTexture?i.texStorage3D(i.TEXTURE_3D,s,h,a,o,l):e.isVideoTexture||i.texStorage2D(f,s,h,a,o),r.set(e,{textureGPU:d,glTextureType:f,glFormat:u,glType:c,glInternalFormat:h})}copyBufferToTexture(e,t){const{gl:i,backend:r}=this,{textureGPU:s,glTextureType:a,glFormat:o,glType:l}=r.get(t),{width:u,height:c}=t.source.data;i.bindBuffer(i.PIXEL_UNPACK_BUFFER,e),r.state.bindTexture(a,s),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.texSubImage2D(a,0,0,0,u,c,o,l,0),i.bindBuffer(i.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(e,t){const{gl:i}=this,{width:r,height:s}=t,{textureGPU:a,glTextureType:o,glFormat:l,glType:u,glInternalFormat:c}=this.backend.get(e);if(!(e.isRenderTargetTexture||a===void 0))if(this.backend.state.bindTexture(o,a),this.setTextureParameters(o,e),e.isCompressedTexture){const h=e.mipmaps,d=t.image;for(let f=0;f<h.length;f++){const m=h[f];e.isCompressedArrayTexture?e.format!==i.RGBA?l!==null?i.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,f,0,0,0,m.width,m.height,d.depth,l,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texSubImage3D(i.TEXTURE_2D_ARRAY,f,0,0,0,m.width,m.height,d.depth,l,u,m.data):l!==null?i.compressedTexSubImage2D(i.TEXTURE_2D,f,0,0,m.width,m.height,l,m.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const h=t.images,d=e.mipmaps;for(let f=0;f<6;f++){const m=Z_(h[f]);i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,0,0,r,s,l,u,m);for(let _=0;_<d.length;_++){const g=d[_],p=Z_(g.images[f]);i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+f,_+1,0,0,p.width,p.height,l,u,p)}}}else if(e.isDataArrayTexture||e.isArrayTexture){const h=t.image;if(e.layerUpdates.size>0){const d=pE(h.width,h.height,e.format,e.type);for(const f of e.layerUpdates){const m=h.data.subarray(f*d/h.data.BYTES_PER_ELEMENT,(f+1)*d/h.data.BYTES_PER_ELEMENT);i.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,f,h.width,h.height,1,l,u,m)}e.clearLayerUpdates()}else i.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,h.width,h.height,h.depth,l,u,h.data)}else if(e.isData3DTexture){const h=t.image;i.texSubImage3D(i.TEXTURE_3D,0,0,0,0,h.width,h.height,h.depth,l,u,h.data)}else if(e.isVideoTexture)e.update(),i.texImage2D(o,0,c,l,u,t.image);else{const h=e.mipmaps;if(h.length>0)for(let d=0,f=h.length;d<f;d++){const m=h[d],_=Z_(m);i.texSubImage2D(o,d,0,0,m.width,m.height,l,u,_)}else{const d=Z_(t.image);i.texSubImage2D(o,0,0,0,r,s,l,u,d)}}}generateMipmaps(e){const{gl:t,backend:i}=this,{textureGPU:r,glTextureType:s}=i.get(e);i.state.bindTexture(s,r),t.generateMipmap(s)}deallocateRenderBuffers(e){const{gl:t,backend:i}=this;if(e){const r=i.get(e);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(const s in r.framebuffers)t.deleteFramebuffer(r.framebuffers[s]);delete r.framebuffers}if(r.depthRenderbuffer&&(t.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(t.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(t.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let s=0;s<r.msaaRenderbuffers.length;s++)t.deleteRenderbuffer(r.msaaRenderbuffers[s]);delete r.msaaRenderbuffers}}}destroyTexture(e){const{gl:t,backend:i}=this,{textureGPU:r,renderTarget:s}=i.get(e);this.deallocateRenderBuffers(s),t.deleteTexture(r),i.delete(e)}copyTextureToTexture(e,t,i=null,r=null,s=0,a=0){const{gl:o,backend:l}=this,{state:u}=this.backend,{textureGPU:c,glTextureType:h,glType:d,glFormat:f}=l.get(t);u.bindTexture(h,c);let m,_,g,p,y,v,b,S,x;const T=e.isCompressedTexture?e.mipmaps[a]:e.image;if(i!==null)m=i.max.x-i.min.x,_=i.max.y-i.min.y,g=i.isBox3?i.max.z-i.min.z:1,p=i.min.x,y=i.min.y,v=i.isBox3?i.min.z:0;else{const P=Math.pow(2,-s);m=Math.floor(T.width*P),_=Math.floor(T.height*P),e.isDataArrayTexture||e.isArrayTexture?g=T.depth:e.isData3DTexture?g=Math.floor(T.depth*P):g=1,p=0,y=0,v=0}r!==null?(b=r.x,S=r.y,x=r.z):(b=0,S=0,x=0),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,t.unpackAlignment);const w=o.getParameter(o.UNPACK_ROW_LENGTH),E=o.getParameter(o.UNPACK_IMAGE_HEIGHT),M=o.getParameter(o.UNPACK_SKIP_PIXELS),N=o.getParameter(o.UNPACK_SKIP_ROWS),U=o.getParameter(o.UNPACK_SKIP_IMAGES);o.pixelStorei(o.UNPACK_ROW_LENGTH,T.width),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,T.height),o.pixelStorei(o.UNPACK_SKIP_PIXELS,p),o.pixelStorei(o.UNPACK_SKIP_ROWS,y),o.pixelStorei(o.UNPACK_SKIP_IMAGES,v);const k=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isRenderTargetTexture||e.isDepthTexture){const P=l.get(e),O=l.get(t),C=l.get(P.renderTarget),q=l.get(O.renderTarget),z=C.framebuffers[P.cacheKey],re=q.framebuffers[O.cacheKey];u.bindFramebuffer(o.READ_FRAMEBUFFER,z),u.bindFramebuffer(o.DRAW_FRAMEBUFFER,re);let X=o.COLOR_BUFFER_BIT;e.isDepthTexture&&(X=o.DEPTH_BUFFER_BIT),o.blitFramebuffer(p,y,m,_,b,S,m,_,X,o.NEAREST),u.bindFramebuffer(o.READ_FRAMEBUFFER,null),u.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else k?e.isDataTexture||e.isData3DTexture?o.texSubImage3D(h,a,b,S,x,m,_,g,f,d,T.data):t.isCompressedArrayTexture?o.compressedTexSubImage3D(h,a,b,S,x,m,_,g,f,T.data):o.texSubImage3D(h,a,b,S,x,m,_,g,f,d,T):e.isDataTexture?o.texSubImage2D(h,a,b,S,m,_,f,d,T.data):e.isCompressedTexture?o.compressedTexSubImage2D(h,a,b,S,T.width,T.height,f,T.data):o.texSubImage2D(h,a,b,S,m,_,f,d,T);o.pixelStorei(o.UNPACK_ROW_LENGTH,w),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,E),o.pixelStorei(o.UNPACK_SKIP_PIXELS,M),o.pixelStorei(o.UNPACK_SKIP_ROWS,N),o.pixelStorei(o.UNPACK_SKIP_IMAGES,U),a===0&&t.generateMipmaps&&o.generateMipmap(h),u.unbindTexture()}copyFramebufferToTexture(e,t,i){const{gl:r}=this,{state:s}=this.backend,{textureGPU:a}=this.backend.get(e),{x:o,y:l,z:u,w:c}=i,h=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,d=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(h){const f=o!==0||l!==0;let m,_;if(e.isDepthTexture===!0?(m=r.DEPTH_BUFFER_BIT,_=r.DEPTH_ATTACHMENT,t.stencil&&(m|=r.STENCIL_BUFFER_BIT)):(m=r.COLOR_BUFFER_BIT,_=r.COLOR_ATTACHMENT0),f){const g=this.backend.get(t.renderTarget),p=g.framebuffers[t.getCacheKey()],y=g.msaaFrameBuffer;s.bindFramebuffer(r.DRAW_FRAMEBUFFER,p),s.bindFramebuffer(r.READ_FRAMEBUFFER,y);const v=d-l-c;r.blitFramebuffer(o,v,o+u,v+c,o,v,o+u,v+c,m,r.NEAREST),s.bindFramebuffer(r.READ_FRAMEBUFFER,p),s.bindTexture(r.TEXTURE_2D,a),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,o,v,u,c),s.unbindTexture()}else{const g=r.createFramebuffer();s.bindFramebuffer(r.DRAW_FRAMEBUFFER,g),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,_,r.TEXTURE_2D,a,0),r.blitFramebuffer(0,0,u,c,0,0,u,c,m,r.NEAREST),r.deleteFramebuffer(g)}}else s.bindTexture(r.TEXTURE_2D,a),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,o,d-c-l,u,c),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,i,r=!1){const{gl:s}=this,a=t.renderTarget,{depthTexture:o,depthBuffer:l,stencilBuffer:u,width:c,height:h}=a;if(s.bindRenderbuffer(s.RENDERBUFFER,e),l&&!u){let d=s.DEPTH_COMPONENT24;r===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(s.RENDERBUFFER,a.samples,d,c,h):i>0?(o&&o.isDepthTexture&&o.type===s.FLOAT&&(d=s.DEPTH_COMPONENT32F),s.renderbufferStorageMultisample(s.RENDERBUFFER,i,d,c,h)):s.renderbufferStorage(s.RENDERBUFFER,d,c,h),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e)}else l&&u&&(i>0?s.renderbufferStorageMultisample(s.RENDERBUFFER,i,s.DEPTH24_STENCIL8,c,h):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,c,h),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e));s.bindRenderbuffer(s.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,i,r,s,a){const{backend:o,gl:l}=this,{textureGPU:u,glFormat:c,glType:h}=this.backend.get(e),d=l.createFramebuffer();l.bindFramebuffer(l.READ_FRAMEBUFFER,d);const f=e.isCubeTexture?l.TEXTURE_CUBE_MAP_POSITIVE_X+a:l.TEXTURE_2D;l.framebufferTexture2D(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,f,u,0);const m=this._getTypedArrayType(h),_=this._getBytesPerTexel(h,c),p=r*s*_,y=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,y),l.bufferData(l.PIXEL_PACK_BUFFER,p,l.STREAM_READ),l.readPixels(t,i,r,s,c,h,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),await o.utils._clientWaitAsync();const v=new m(p/m.BYTES_PER_ELEMENT);return l.bindBuffer(l.PIXEL_PACK_BUFFER,y),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,v),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.deleteFramebuffer(d),v}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:i}=this;let r=0;if(e===i.UNSIGNED_BYTE&&(r=1),(e===i.UNSIGNED_SHORT_4_4_4_4||e===i.UNSIGNED_SHORT_5_5_5_1||e===i.UNSIGNED_SHORT_5_6_5||e===i.UNSIGNED_SHORT||e===i.HALF_FLOAT)&&(r=2),(e===i.UNSIGNED_INT||e===i.FLOAT)&&(r=4),t===i.RGBA)return r*4;if(t===i.RGB)return r*3;if(t===i.ALPHA)return r}}function Z_(n){return n.isDataTexture?n.image.data:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?n:n.data}class yse{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class vse{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const i=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const v2={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class bse{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:i,mode:r,object:s,type:a,info:o,index:l}=this;l!==0?i.drawElements(r,t,a,e):i.drawArrays(r,e,t),o.update(s,t,1)}renderInstances(e,t,i){const{gl:r,mode:s,type:a,index:o,object:l,info:u}=this;i!==0&&(o!==0?r.drawElementsInstanced(s,t,a,e,i):r.drawArraysInstanced(s,e,t,i),u.update(l,t,i))}renderMultiDraw(e,t,i){const{extensions:r,mode:s,object:a,info:o}=this;if(i===0)return;const l=r.get("WEBGL_multi_draw");if(l===null)for(let u=0;u<i;u++)this.render(e[u],t[u]);else{this.index!==0?l.multiDrawElementsWEBGL(s,t,0,this.type,e,0,i):l.multiDrawArraysWEBGL(s,e,0,t,0,i);let u=0;for(let c=0;c<i;c++)u+=t[c];o.update(a,u,1)}}renderMultiDrawInstances(e,t,i,r){const{extensions:s,mode:a,object:o,info:l}=this;if(i===0)return;const u=s.get("WEBGL_multi_draw");if(u===null)for(let c=0;c<i;c++)this.renderInstances(e[c],t[c],r[c]);else{this.index!==0?u.multiDrawElementsInstancedWEBGL(a,t,0,this.type,e,0,r,0,i):u.multiDrawArraysInstancedWEBGL(a,e,0,t,0,r,0,i);let c=0;for(let h=0;h<i;h++)c+=t[h]*r[h];l.update(o,c,1)}}}class c3{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.pendingResolve=!1}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class Sse extends c3{constructor(e,t,i=2048){if(super(i),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){console.warn("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let r=0;r<this.maxQueries;r++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return vs(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t==null||this.activeQuery!==null)return;const i=this.queries[t];if(i)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,i),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(r){console.error("Error in beginQuery:",r),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(i){console.error("Error in endQuery:",i),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=[];for(const[r,s]of this.queryStates)if(s==="ended"){const a=this.queries[r];e.push(this.resolveQuery(a))}if(e.length===0)return this.lastValue;const i=(await Promise.all(e)).reduce((r,s)=>r+s,0);return this.lastValue=i,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,i}catch(e){return console.error("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let i,r=!1;const s=()=>{i&&(clearTimeout(i),i=null)},a=l=>{r||(r=!0,s(),t(l))},o=()=>{if(this.isDisposed){a(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){a(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){i=setTimeout(o,1);return}const c=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(c)/1e6)}catch(l){console.error("Error checking query:",l),t(this.lastValue)}};o()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class b2 extends u3{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,i={antialias:e.samples>0,alpha:!0,depth:e.depth,stencil:e.stencil},r=t.context!==void 0?t.context:e.domElement.getContext("webgl2",i);function s(a){a.preventDefault();const o={api:"WebGL",message:a.statusMessage||"Unknown reason",reason:null,originalEvent:a};e.onDeviceLost(o)}this._onContextLost=s,e.domElement.addEventListener("webglcontextlost",s,!1),this.gl=r,this.extensions=new yse(this),this.capabilities=new vse(this),this.attributeUtils=new pse(this),this.textureUtils=new _se(this),this.bufferRenderer=new bse(this),this.state=new mse(this),this.utils=new gse(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return br}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,i=null){const r=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:r.RGBA8}),i!==null){const s=e.stencilBuffer?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:i,glInternalFormat:s}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer===!0&&e.multiview===!1&&console.warn("THREE.WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new Sse(this.gl,e,2048));const i=this.timestampQueryPool[e];i.allocateQueriesForContext(t)!==null&&i.beginQuery(t)}prepareTimestampBuffer(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(e){const{state:t}=this,i=this.get(e);if(i.frameCalls=this.renderer.info.render.frameCalls,e.viewport)this.updateViewport(e);else{const{width:s,height:a}=this.getDrawingBufferSize();t.viewport(0,0,s,a)}if(e.scissor){const{x:s,y:a,width:o,height:l}=e.scissorValue;t.scissor(s,e.height-l-a,o,l)}this.initTimestampQuery(Bh.RENDER,this.getTimestampUID(e)),i.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const r=e.occlusionQueryCount;r>0&&(i.currentOcclusionQueries=i.occlusionQueries,i.currentOcclusionQueryObjects=i.occlusionQueryObjects,i.lastOcclusionObject=null,i.occlusionQueries=new Array(r),i.occlusionQueryObjects=new Array(r),i.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:i}=this,r=this.get(e),s=r.previousContext;i.resetVertexState();const a=e.occlusionQueryCount;a>0&&(a>r.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const o=e.textures;if(o!==null)for(let l=0;l<o.length;l++){const u=o[l];u.generateMipmaps&&this.generateMipmaps(u)}if(this._currentContext=s,this._resolveRenderTarget(e),s!==null)if(this._setFramebuffer(s),s.viewport)this.updateViewport(s);else{const{width:l,height:u}=this.getDrawingBufferSize();i.viewport(0,0,l,u)}this.prepareTimestampBuffer(Bh.RENDER,this.getTimestampUID(e))}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:i,currentOcclusionQueryObjects:r}=t;if(i&&r){const s=new WeakSet,{gl:a}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const o=()=>{let l=0;for(let u=0;u<i.length;u++){const c=i[u];c!==null&&a.getQueryParameter(c,a.QUERY_RESULT_AVAILABLE)&&(a.getQueryParameter(c,a.QUERY_RESULT)===0&&s.add(r[u]),i[u]=null,a.deleteQuery(c),l++)}l<i.length?requestAnimationFrame(o):t.occluded=s};o()}}isOccluded(e,t){const i=this.get(e);return i.occluded&&i.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:i,y:r,width:s,height:a}=e.viewportValue;t.viewport(i,e.height-a-r,s,a)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,i,r=null,s=!0,a=!0){const{gl:o,renderer:l}=this;r===null&&(r={textures:null,clearColorValue:this.getClearColor()});let u=0;if(e&&(u|=o.COLOR_BUFFER_BIT),t&&(u|=o.DEPTH_BUFFER_BIT),i&&(u|=o.STENCIL_BUFFER_BIT),u!==0){let c;r.clearColorValue?c=r.clearColorValue:c=this.getClearColor();const h=l.getClearDepth(),d=l.getClearStencil();if(t&&this.state.setDepthMask(!0),r.textures===null)o.clearColor(c.r,c.g,c.b,c.a),o.clear(u);else{if(s&&this._setFramebuffer(r),e)for(let f=0;f<r.textures.length;f++)f===0?o.clearBufferfv(o.COLOR,f,[c.r,c.g,c.b,c.a]):o.clearBufferfv(o.COLOR,f,[0,0,0,1]);t&&i?o.clearBufferfi(o.DEPTH_STENCIL,0,h,d):t?o.clearBufferfv(o.DEPTH,0,[h]):i&&o.clearBufferiv(o.STENCIL,0,[d]),s&&a&&this._resolveRenderTarget(r)}}}beginCompute(e){const{state:t,gl:i}=this,r=this.get(e);r.frameCalls=this.renderer.info.compute.frameCalls,t.bindFramebuffer(i.FRAMEBUFFER,null),this.initTimestampQuery(Bh.COMPUTE,this.getTimestampUID(e))}compute(e,t,i,r,s=null){const{state:a,gl:o}=this;this.discard===!1&&(o.enable(o.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:l,transformBuffers:u,attributes:c}=this.get(r),h=this._getVaoKey(c),d=this.vaoCache[h];d===void 0?this.vaoCache[h]=this._createVao(c):a.setVertexState(d),a.useProgram(l),this._bindUniforms(i);const f=this._getTransformFeedback(u);o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,f),o.beginTransformFeedback(o.POINTS),s=s!==null?s:t.count,Array.isArray(s)&&(vs("WebGLBackend.compute(): The count parameter must be a single number, not an array."),s=s[0]),c[0].isStorageInstancedBufferAttribute?o.drawArraysInstanced(o.POINTS,0,1,s):o.drawArrays(o.POINTS,0,s),o.endTransformFeedback(),o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null);for(let m=0;m<u.length;m++){const _=u[m];_.pbo&&this.has(_.pbo)&&this.textureUtils.copyBufferToTexture(_.transformBuffer,_.pbo),_.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(Bh.COMPUTE,this.getTimestampUID(e)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:i,material:r,context:s,hardwareClippingPlanes:a}=e,{programGPU:o}=this.get(i),{gl:l,state:u}=this,c=this.get(s),h=e.getDrawParameters();if(h===null)return;this._bindUniforms(e.getBindings());const d=t.isMesh&&t.matrixWorld.determinant()<0;u.setMaterial(r,d,a),u.useProgram(o);const f=e.getAttributes(),m=this.get(f);let _=m.vaoGPU;if(_===void 0){const w=this._getVaoKey(f);_=this.vaoCache[w],_===void 0&&(_=this._createVao(f),this.vaoCache[w]=_,m.vaoGPU=_)}const g=e.getIndex(),p=g!==null?this.get(g).bufferGPU:null;u.setVertexState(_,p);const y=c.lastOcclusionObject;if(y!==t&&y!==void 0){if(y!==null&&y.occlusionTest===!0&&(l.endQuery(l.ANY_SAMPLES_PASSED),c.occlusionQueryIndex++),t.occlusionTest===!0){const w=l.createQuery();l.beginQuery(l.ANY_SAMPLES_PASSED,w),c.occlusionQueries[c.occlusionQueryIndex]=w,c.occlusionQueryObjects[c.occlusionQueryIndex]=t}c.lastOcclusionObject=t}const v=this.bufferRenderer;t.isPoints?v.mode=l.POINTS:t.isLineSegments?v.mode=l.LINES:t.isLine?v.mode=l.LINE_STRIP:t.isLineLoop?v.mode=l.LINE_LOOP:r.wireframe===!0?(u.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),v.mode=l.LINES):v.mode=l.TRIANGLES;const{vertexCount:b,instanceCount:S}=h;let{firstVertex:x}=h;if(v.object=t,g!==null){x*=g.array.BYTES_PER_ELEMENT;const w=this.get(g);v.index=g.count,v.type=w.type}else v.index=0;const T=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(vs("THREE.WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),v.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?v.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):vs("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):S>1?v.renderInstances(x,b,S):v.render(x,b)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const w=this.get(e.camera),E=e.camera.cameras,M=e.getBindingGroup("cameraIndex").bindings[0];if(w.indexesGPU===void 0||w.indexesGPU.length!==E.length){const C=new Uint32Array([0,0,0,0]),q=[];for(let z=0,re=E.length;z<re;z++){const X=l.createBuffer();C[0]=z,l.bindBuffer(l.UNIFORM_BUFFER,X),l.bufferData(l.UNIFORM_BUFFER,C,l.STATIC_DRAW),q.push(X)}w.indexesGPU=q}const N=this.get(M),U=this.renderer.getPixelRatio(),k=this._currentContext.renderTarget,P=this._isRenderCameraDepthArray(this._currentContext),O=this._currentContext.activeCubeFace;if(P){const C=this.get(k.depthTexture);if(C.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){C.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:q}=k;for(let z=0,re=E.length;z<re;z++)this.renderer._activeCubeFace=z,this._currentContext.activeCubeFace=z,this._setFramebuffer(this._currentContext),this.clear(!1,!0,q,this._currentContext,!1,!1);this.renderer._activeCubeFace=O,this._currentContext.activeCubeFace=O}}for(let C=0,q=E.length;C<q;C++){const z=E[C];if(t.layers.test(z.layers)){P&&(this.renderer._activeCubeFace=C,this._currentContext.activeCubeFace=C,this._setFramebuffer(this._currentContext));const re=z.viewport;if(re!==void 0){const X=re.x*U,oe=re.y*U,be=re.width*U,Oe=re.height*U;u.viewport(Math.floor(X),Math.floor(e.context.height-Oe-oe),Math.floor(be),Math.floor(Oe))}u.bindBufferBase(l.UNIFORM_BUFFER,N.index,w.indexesGPU[C]),T()}this._currentContext.activeCubeFace=O,this.renderer._activeCubeFace=O}}else T()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,i,r,s,a){return this.textureUtils.copyTextureToBuffer(e,t,i,r,s,a)}createSampler(){}destroySampler(){}createNodeBuilder(e,t){return new hse(e,t)}createProgram(e){const t=this.gl,{stage:i,code:r}=e,s=i==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(s,r),t.compileShader(s),this.set(e,{shaderGPU:s})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const i=this.gl,r=e.pipeline,{fragmentProgram:s,vertexProgram:a}=r,o=i.createProgram(),l=this.get(s).shaderGPU,u=this.get(a).shaderGPU;if(i.attachShader(o,l),i.attachShader(o,u),i.linkProgram(o),this.set(r,{programGPU:o,fragmentShader:l,vertexShader:u}),t!==null&&this.parallel){const c=new Promise(h=>{const d=this.parallel,f=()=>{i.getProgramParameter(o,d.COMPLETION_STATUS_KHR)?(this._completeCompile(e,r),h()):requestAnimationFrame(f)};f()});t.push(c);return}this._completeCompile(e,r)}_handleSource(e,t){const i=e.split(`
`),r=[],s=Math.max(t-6,0),a=Math.min(t+6,i.length);for(let o=s;o<a;o++){const l=o+1;r.push(`${l===t?">":" "} ${l}: ${i[o]}`)}return r.join(`
`)}_getShaderErrors(e,t,i){const r=e.getShaderParameter(t,e.COMPILE_STATUS),a=(e.getShaderInfoLog(t)||"").trim();if(r&&a==="")return"";const o=/ERROR: 0:(\d+)/.exec(a);if(o){const l=parseInt(o[1]);return i.toUpperCase()+`

`+a+`

`+this._handleSource(e.getShaderSource(t),l)}else return a}_logProgramError(e,t,i){if(this.renderer.debug.checkShaderErrors){const r=this.gl,a=(r.getProgramInfoLog(e)||"").trim();if(r.getProgramParameter(e,r.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(r,e,i,t);else{const o=this._getShaderErrors(r,i,"vertex"),l=this._getShaderErrors(r,t,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(e,r.VALIDATE_STATUS)+`

Program Info Log: `+a+`
`+o+`
`+l)}else a!==""&&console.warn("THREE.WebGLProgram: Program Info Log:",a)}}_completeCompile(e,t){const{state:i,gl:r}=this,s=this.get(t),{programGPU:a,fragmentShader:o,vertexShader:l}=s;r.getProgramParameter(a,r.LINK_STATUS)===!1&&this._logProgramError(a,o,l),i.useProgram(a);const u=e.getBindings();this._setupBindings(u,a),this.set(t,{programGPU:a})}createComputePipeline(e,t){const{state:i,gl:r}=this,s={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(s);const{computeProgram:a}=e,o=r.createProgram(),l=this.get(s).shaderGPU,u=this.get(a).shaderGPU,c=a.transforms,h=[],d=[];for(let g=0;g<c.length;g++){const p=c[g];h.push(p.varyingName),d.push(p.attributeNode)}r.attachShader(o,l),r.attachShader(o,u),r.transformFeedbackVaryings(o,h,r.SEPARATE_ATTRIBS),r.linkProgram(o),r.getProgramParameter(o,r.LINK_STATUS)===!1&&this._logProgramError(o,l,u),i.useProgram(o),this._setupBindings(t,o);const f=a.attributes,m=[],_=[];for(let g=0;g<f.length;g++){const p=f[g].node.attribute;m.push(p),this.has(p)||this.attributeUtils.createAttribute(p,r.ARRAY_BUFFER)}for(let g=0;g<d.length;g++){const p=d[g].attribute;this.has(p)||this.attributeUtils.createAttribute(p,r.ARRAY_BUFFER);const y=this.get(p);_.push(y)}this.set(e,{programGPU:o,transformBuffers:_,attributes:m})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let i=0,r=0;for(const s of t){this.set(s,{textures:r,uniformBuffers:i});for(const a of s.bindings)a.isUniformBuffer&&i++,a.isSampledTexture&&r++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,i=this.get(e);let r=i.uniformBuffers,s=i.textures;for(const a of e.bindings){const o=this.get(a);if(a.isUniformsGroup||a.isUniformBuffer){const l=a.buffer;let{bufferGPU:u}=this.get(l);u===void 0?(u=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,u),t.bufferData(t.UNIFORM_BUFFER,l,t.DYNAMIC_DRAW),this.set(l,{bufferGPU:u})):(t.bindBuffer(t.UNIFORM_BUFFER,u),t.bufferSubData(t.UNIFORM_BUFFER,0,l)),o.index=r++,o.bufferGPU=u,this.set(a,o)}else if(a.isSampledTexture){const{textureGPU:l,glTextureType:u}=this.get(a.texture);o.index=s++,o.textureGPU=l,o.glTextureType=u,this.set(a,o)}}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const r=this.get(e).bufferGPU,s=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,r),t.bufferData(t.UNIFORM_BUFFER,s,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(v2).filter(r=>v2[r]===e),i=this.extensions;for(let r=0;r<t.length;r++)if(i.has(t[r]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,i=null,r=null,s=0,a=0){this.textureUtils.copyTextureToTexture(e,t,i,r,s,a)}copyFramebufferToTexture(e,t,i){this.textureUtils.copyFramebufferToTexture(e,t,i)}_setFramebuffer(e){const{gl:t,state:i}=this;let r=null;if(e.textures!==null){const s=e.renderTarget,a=this.get(s),{samples:o,depthBuffer:l,stencilBuffer:u}=s,c=s.isWebGLCubeRenderTarget===!0,h=s.isRenderTarget3D===!0,d=s.depth>1,f=s.isXRRenderTarget===!0,m=f===!0&&s._hasExternalTextures===!0;let _=a.msaaFrameBuffer,g=a.depthRenderbuffer;const p=this.extensions.get("WEBGL_multisampled_render_to_texture"),y=this.extensions.get("OVR_multiview2"),v=this._useMultisampledExtension(s),b=HF(e);let S;if(c?(a.cubeFramebuffers||(a.cubeFramebuffers={}),S=a.cubeFramebuffers[b]):f&&m===!1?S=this._xrFramebuffer:(a.framebuffers||(a.framebuffers={}),S=a.framebuffers[b]),S===void 0){S=t.createFramebuffer(),i.bindFramebuffer(t.FRAMEBUFFER,S);const x=e.textures,T=[];if(c){a.cubeFramebuffers[b]=S;const{textureGPU:E}=this.get(x[0]),M=this.renderer._activeCubeFace,N=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+M,E,N)}else{a.framebuffers[b]=S;for(let E=0;E<x.length;E++){const M=x[E],N=this.get(M);N.renderTarget=e.renderTarget,N.cacheKey=b;const U=t.COLOR_ATTACHMENT0+E;if(s.multiview)y.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,U,N.textureGPU,0,o,0,2);else if(h||d){const k=this.renderer._activeCubeFace,P=this.renderer._activeMipmapLevel;t.framebufferTextureLayer(t.FRAMEBUFFER,U,N.textureGPU,P,k)}else if(v)p.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,U,t.TEXTURE_2D,N.textureGPU,0,o);else{const k=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,U,t.TEXTURE_2D,N.textureGPU,k)}}}const w=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s._autoAllocateDepthBuffer===!0){const E=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(E,e,0,v),a.xrDepthRenderbuffer=E,T.push(u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,E),t.framebufferRenderbuffer(t.FRAMEBUFFER,w,t.RENDERBUFFER,E)}else if(e.depthTexture!==null){T.push(u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const E=this.get(e.depthTexture);if(E.renderTarget=e.renderTarget,E.cacheKey=b,s.multiview)y.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,w,E.textureGPU,0,o,0,2);else if(m&&v)p.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,w,t.TEXTURE_2D,E.textureGPU,0,o);else if(e.depthTexture.isArrayTexture){const M=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,w,E.textureGPU,0,M)}else t.framebufferTexture2D(t.FRAMEBUFFER,w,t.TEXTURE_2D,E.textureGPU,0)}a.depthInvalidationArray=T}else{if(this._isRenderCameraDepthArray(e)){i.bindFramebuffer(t.FRAMEBUFFER,S);const T=this.renderer._activeCubeFace,w=this.get(e.depthTexture),E=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,E,w.textureGPU,0,T)}if((f||v||s.multiview)&&s._isOpaqueFramebuffer!==!0){i.bindFramebuffer(t.FRAMEBUFFER,S);const T=this.get(e.textures[0]);s.multiview?y.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,T.textureGPU,0,o,0,2):v?p.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,T.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,T.textureGPU,0);const w=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s._autoAllocateDepthBuffer===!0){const E=a.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,E),t.framebufferRenderbuffer(t.FRAMEBUFFER,w,t.RENDERBUFFER,E)}else{const E=this.get(e.depthTexture);s.multiview?y.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,w,E.textureGPU,0,o,0,2):v?p.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,w,t.TEXTURE_2D,E.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,w,t.TEXTURE_2D,E.textureGPU,0)}}}if(o>0&&v===!1&&!s.multiview){if(_===void 0){const x=[];_=t.createFramebuffer(),i.bindFramebuffer(t.FRAMEBUFFER,_);const T=[],w=e.textures;for(let E=0;E<w.length;E++){T[E]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,T[E]),x.push(t.COLOR_ATTACHMENT0+E);const M=e.textures[E],N=this.get(M);t.renderbufferStorageMultisample(t.RENDERBUFFER,o,N.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+E,t.RENDERBUFFER,T[E])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),a.msaaFrameBuffer=_,a.msaaRenderbuffers=T,l&&g===void 0){g=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(g,e,o),a.depthRenderbuffer=g;const E=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;x.push(E)}a.invalidationArray=x}r=a.msaaFrameBuffer}else r=S;i.drawBuffers(e,S)}i.bindFramebuffer(t.FRAMEBUFFER,r)}_getVaoKey(e){let t="";for(let i=0;i<e.length;i++){const r=this.get(e[i]);t+=":"+r.id}return t}_createVao(e){const{gl:t}=this,i=t.createVertexArray();t.bindVertexArray(i);for(let r=0;r<e.length;r++){const s=e[r],a=this.get(s);t.bindBuffer(t.ARRAY_BUFFER,a.bufferGPU),t.enableVertexAttribArray(r);let o,l;s.isInterleavedBufferAttribute===!0?(o=s.data.stride*a.bytesPerElement,l=s.offset*a.bytesPerElement):(o=0,l=0),a.isInteger?t.vertexAttribIPointer(r,s.itemSize,a.type,o,l):t.vertexAttribPointer(r,s.itemSize,a.type,s.normalized,o,l),s.isInstancedBufferAttribute&&!s.isInterleavedBufferAttribute?t.vertexAttribDivisor(r,s.meshPerAttribute):s.isInterleavedBufferAttribute&&s.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(r,s.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),i}_getTransformFeedback(e){let t="";for(let s=0;s<e.length;s++)t+=":"+e[s].id;let i=this.transformFeedbackCache[t];if(i!==void 0)return i;const{gl:r}=this;i=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,i);for(let s=0;s<e.length;s++){const a=e[s];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,s,a.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=i,i}_setupBindings(e,t){const i=this.gl;for(const r of e)for(const s of r.bindings){const o=this.get(s).index;if(s.isUniformsGroup||s.isUniformBuffer){const l=i.getUniformBlockIndex(t,s.name);i.uniformBlockBinding(t,l,o)}else if(s.isSampledTexture){const l=i.getUniformLocation(t,s.name);i.uniform1i(l,o)}}}_bindUniforms(e){const{gl:t,state:i}=this;for(const r of e)for(const s of r.bindings){const a=this.get(s),o=a.index;s.isUniformsGroup||s.isUniformBuffer?i.bindBufferBase(t.UNIFORM_BUFFER,o,a.bufferGPU):s.isSampledTexture&&i.bindTexture(a.glTextureType,a.textureGPU,t.TEXTURE0+o)}}_resolveRenderTarget(e){const{gl:t,state:i}=this,r=e.renderTarget;if(e.textures!==null&&r){const s=this.get(r);if(r.samples>0&&this._useMultisampledExtension(r)===!1){const a=s.framebuffers[e.getCacheKey()];let o=t.COLOR_BUFFER_BIT;r.resolveDepthBuffer&&(r.depthBuffer&&(o|=t.DEPTH_BUFFER_BIT),r.stencilBuffer&&r.resolveStencilBuffer&&(o|=t.STENCIL_BUFFER_BIT));const l=s.msaaFrameBuffer,u=s.msaaRenderbuffers,c=e.textures,h=c.length>1;if(i.bindFramebuffer(t.READ_FRAMEBUFFER,l),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,a),h)for(let d=0;d<c.length;d++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+d,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+d,t.TEXTURE_2D,null,0);for(let d=0;d<c.length;d++){if(h){const{textureGPU:f}=this.get(c[d]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,u[d]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,f,0)}if(e.scissor){const{x:f,y:m,width:_,height:g}=e.scissorValue,p=e.height-g-m;t.blitFramebuffer(f,p,f+_,p+g,f,p,f+_,p+g,o,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,o,t.NEAREST)}if(h)for(let d=0;d<c.length;d++){const{textureGPU:f}=this.get(c[d]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+d,t.RENDERBUFFER,u[d]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+d,t.TEXTURE_2D,f,0)}this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,s.invalidationArray)}else if(r.resolveDepthBuffer===!1&&s.framebuffers){const a=s.framebuffers[e.getCacheKey()];i.bindFramebuffer(t.DRAW_FRAMEBUFFER,a),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,s.depthInvalidationArray)}}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer!==!1}dispose(){const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const Hh={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},zi={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},cr={Store:"store"},Zt={Load:"load",Clear:"clear"},S2={CCW:"ccw",CW:"cw"},x2={None:"none",Back:"back"},sf={Uint16:"uint16",Uint32:"uint32"},F={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},Gx={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},Yu={Linear:"linear",Nearest:"nearest"},It={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},Pu={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},T2={None:0,All:15},bl={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},Vx={Storage:"storage",ReadOnlyStorage:"read-only-storage"},Hx={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},E2={NonFiltering:"non-filtering",Comparison:"comparison"},Uu={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},M2={TwoD:"2d",ThreeD:"3d"},fi={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},xse={All:"all"},J_={Vertex:"vertex",Instance:"instance"},VE={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"};class Tse extends o3{constructor(e,t,i){super(e,t?t.value:null),this.textureNode=t,this.groupNode=i}update(){this.texture=this.textureNode.value}}class Ese extends i3{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let Mse=0;class wse extends Ese{constructor(e,t){super("StorageBuffer_"+Mse++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:Ba.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class Ase extends _u{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,i=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:Yu.Linear}),this.flipYSampler=e.createSampler({minFilter:Yu.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:i}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:r})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Hh.TriangleStrip,stripIndexFormat:sf.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Hh.TriangleStrip,stripIndexFormat:sf.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,i=0){const r=t.format,{width:s,height:a}=t.size,o=this.getTransferPipeline(r),l=this.getFlipYPipeline(r),u=this.device.createTexture({size:{width:s,height:a,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),c=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:fi.TwoD,baseArrayLayer:i}),h=u.createView({baseMipLevel:0,mipLevelCount:1,dimension:fi.TwoD,baseArrayLayer:0}),d=this.device.createCommandEncoder({}),f=(m,_,g)=>{const p=m.getBindGroupLayout(0),y=this.device.createBindGroup({layout:p,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:_}]}),v=d.beginRenderPass({colorAttachments:[{view:g,loadOp:Zt.Clear,storeOp:cr.Store,clearValue:[0,0,0,0]}]});v.setPipeline(m),v.setBindGroup(0,y),v.draw(4,1,0,0),v.end()};f(o,c,h),f(l,h,c),this.device.queue.submit([d.finish()]),u.destroy()}generateMipmaps(e,t,i=0){const r=this.get(e);r.useCount===void 0&&(r.useCount=0,r.layers=[]);const s=r.layers[i]||this._mipmapCreateBundles(e,t,i),a=this.device.createCommandEncoder({});this._mipmapRunBundles(a,s),this.device.queue.submit([a.finish()]),r.useCount!==0&&(r.layers[i]=s),r.useCount++}_mipmapCreateBundles(e,t,i){const r=this.getTransferPipeline(t.format),s=r.getBindGroupLayout(0);let a=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:fi.TwoD,baseArrayLayer:i});const o=[];for(let l=1;l<t.mipLevelCount;l++){const u=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:a}]}),c=e.createView({baseMipLevel:l,mipLevelCount:1,dimension:fi.TwoD,baseArrayLayer:i}),h={colorAttachments:[{view:c,loadOp:Zt.Clear,storeOp:cr.Store,clearValue:[0,0,0,0]}]},d=this.device.createRenderBundleEncoder({colorFormats:[t.format]});d.setPipeline(r),d.setBindGroup(0,u),d.draw(4,1,0,0),o.push({renderBundles:[d.finish()],passDescriptor:h}),a=c}return o}_mipmapRunBundles(e,t){const i=t.length;for(let r=0;r<i;r++){const s=t[r],a=e.beginRenderPass(s.passDescriptor);a.executeBundles(s.renderBundles),a.end()}}}const Rse={[Ow]:"never",[K0]:"less",[Iw]:"equal",[Q0]:"less-equal",[Bw]:"greater",[kw]:"greater-equal",[zw]:"always",[Fw]:"not-equal"},Nse=[0,1,3,2,4,5];class Cse{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new ks,this.depthTexture.name="depthBuffer"}createSampler(e){const t=this.backend,i=t.device,r=t.get(e),s={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};s.magFilter===Yu.Linear&&s.minFilter===Yu.Linear&&s.mipmapFilter===Yu.Linear&&(s.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(s.compare=Rse[e.compareFunction]),r.sampler=i.createSampler(s)}createDefaultTexture(e){let t;const i=HE(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(i):t=this._getDefaultTextureGPU(i),this.backend.get(e).texture=t}createTexture(e,t={}){const i=this.backend,r=i.get(e);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(e.isExternalTexture){r.texture=e.sourceTexture,r.initialized=!0;return}t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:s,height:a,depth:o,levels:l}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const u=this._getDimension(e),c=e.internalFormat||t.format||HE(e,i.device);r.format=c;const{samples:h,primarySamples:d,isMSAA:f}=i.utils.getTextureSampleData(e);let m=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(m|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&c!==F.RGB9E5UFloat&&(m|=GPUTextureUsage.RENDER_ATTACHMENT);const _={label:e.name,size:{width:s,height:a,depthOrArrayLayers:o},mipLevelCount:l,sampleCount:d,dimension:u,format:c,usage:m};if(c===void 0){console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}if(e.isCubeTexture&&(_.textureBindingViewDimension=fi.Cube),r.texture=i.device.createTexture(_),f){const g=Object.assign({},_);g.label=g.label+"-msaa",g.sampleCount=h,g.mipLevelCount=1,r.msaaTexture=i.device.createTexture(g)}r.initialized=!0,r.textureDescriptorGPU=_}destroyTexture(e){const t=this.backend,i=t.get(e);i.texture!==void 0&&i.texture.destroy(),i.msaaTexture!==void 0&&i.msaaTexture.destroy(),t.delete(e)}destroySampler(e){const i=this.backend.get(e);delete i.sampler}generateMipmaps(e){const t=this.backend.get(e);if(e.isCubeTexture)for(let i=0;i<6;i++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,i);else{const i=e.image.depth||1;for(let r=0;r<i;r++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,r)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:t,height:i}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:t,height:i,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,t=!1){const i=this.backend,{width:r,height:s}=i.getDrawingBufferSize(),a=this.depthTexture,o=i.get(a).texture;let l,u;if(t?(l=ys,u=gs):e&&(l=_s,u=wn),o!==void 0){if(a.image.width===r&&a.image.height===s&&a.format===l&&a.type===u)return o;this.destroyTexture(a)}return a.name="depthBuffer",a.format=l,a.type=u,a.image.width=r,a.image.height=s,this.createTexture(a,{width:r,height:s}),i.get(a).texture}updateTexture(e,t){const i=this.backend.get(e),r=e.mipmaps,{textureDescriptorGPU:s}=i;if(!(e.isRenderTargetTexture||s===void 0)){if(e.isDataTexture)if(r.length>0)for(let a=0,o=r.length;a<o;a++){const l=r[a];this._copyBufferToTexture(l,i.texture,s,0,e.flipY,0,a)}else this._copyBufferToTexture(t.image,i.texture,s,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let a=0;a<t.image.depth;a++)this._copyBufferToTexture(t.image,i.texture,s,a,e.flipY,a);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,i.texture,s);else if(e.isCubeTexture)this._copyCubeMapToTexture(e,i.texture,s);else if(r.length>0)for(let a=0,o=r.length;a<o;a++){const l=r[a];this._copyImageToTexture(l,i.texture,s,0,e.flipY,e.premultiplyAlpha,a)}else this._copyImageToTexture(t.image,i.texture,s,0,e.flipY,e.premultiplyAlpha);i.version=e.version}}async copyTextureToBuffer(e,t,i,r,s,a){const o=this.backend.device,l=this.backend.get(e),u=l.texture,c=l.textureDescriptorGPU.format,h=this._getBytesPerTexel(c);let d=r*h;d=Math.ceil(d/256)*256;const f=o.createBuffer({size:(s-1)*d+r*h,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),m=o.createCommandEncoder();m.copyTextureToBuffer({texture:u,origin:{x:t,y:i,z:a}},{buffer:f,bytesPerRow:d},{width:r,height:s});const _=this._getTypedArrayType(c);o.queue.submit([m.finish()]),await f.mapAsync(GPUMapMode.READ);const g=f.getMappedRange();return new _(g)}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const i=new _i;i.minFilter=Ln,i.magFilter=Ln,this.createTexture(i,{width:1,height:1,format:e}),this.defaultTexture[e]=t=i}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const i=new Mg;i.minFilter=Ln,i.magFilter=Ln,this.createTexture(i,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=i}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,i){const r=e.images,s=e.mipmaps;for(let a=0;a<6;a++){const o=r[a],l=e.flipY===!0?Nse[a]:a;o.isDataTexture?this._copyBufferToTexture(o.image,t,i,l,e.flipY):this._copyImageToTexture(o,t,i,l,e.flipY,e.premultiplyAlpha);for(let u=0;u<s.length;u++){const h=s[u].images[a];h.isDataTexture?this._copyBufferToTexture(h.image,t,i,l,e.flipY,0,u+1):this._copyImageToTexture(h,t,i,l,e.flipY,e.premultiplyAlpha,u+1)}}}_copyImageToTexture(e,t,i,r,s,a,o=0){const l=this.backend.device,u=o>0?e.width:i.size.width,c=o>0?e.height:i.size.height;l.queue.copyExternalImageToTexture({source:e,flipY:s},{texture:t,mipLevel:o,origin:{x:0,y:0,z:r},premultipliedAlpha:a},{width:u,height:c,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new Ase(this.backend.device)),e}_generateMipmaps(e,t,i=0){this._getPassUtils().generateMipmaps(e,t,i)}_flipY(e,t,i=0){this._getPassUtils().flipY(e,t,i)}_copyBufferToTexture(e,t,i,r,s,a=0,o=0){const l=this.backend.device,u=e.data,c=this._getBytesPerTexel(i.format),h=e.width*c;l.queue.writeTexture({texture:t,mipLevel:o,origin:{x:0,y:0,z:r}},u,{offset:e.width*e.height*c*a,bytesPerRow:h},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,i,r)}_copyCompressedBufferToTexture(e,t,i){const r=this.backend.device,s=this._getBlockData(i.format),a=i.size.depthOrArrayLayers>1;for(let o=0;o<e.length;o++){const l=e[o],u=l.width,c=l.height,h=a?i.size.depthOrArrayLayers:1,d=Math.ceil(u/s.width)*s.byteLength,f=d*Math.ceil(c/s.height);for(let m=0;m<h;m++)r.queue.writeTexture({texture:t,mipLevel:o,origin:{x:0,y:0,z:m}},l.data,{offset:m*f,bytesPerRow:d,rowsPerImage:Math.ceil(c/s.height)},{width:Math.ceil(u/s.width)*s.width,height:Math.ceil(c/s.height)*s.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===F.BC1RGBAUnorm||e===F.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===F.BC2RGBAUnorm||e===F.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===F.BC3RGBAUnorm||e===F.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===F.BC4RUnorm||e===F.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===F.BC5RGUnorm||e===F.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===F.BC6HRGBUFloat||e===F.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===F.BC7RGBAUnorm||e===F.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===F.ETC2RGB8Unorm||e===F.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===F.ETC2RGB8A1Unorm||e===F.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===F.ETC2RGBA8Unorm||e===F.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===F.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===F.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===F.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===F.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===F.ASTC4x4Unorm||e===F.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===F.ASTC5x4Unorm||e===F.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===F.ASTC5x5Unorm||e===F.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===F.ASTC6x5Unorm||e===F.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===F.ASTC6x6Unorm||e===F.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===F.ASTC8x5Unorm||e===F.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===F.ASTC8x6Unorm||e===F.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===F.ASTC8x8Unorm||e===F.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===F.ASTC10x5Unorm||e===F.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===F.ASTC10x6Unorm||e===F.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===F.ASTC10x8Unorm||e===F.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===F.ASTC10x10Unorm||e===F.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===F.ASTC12x10Unorm||e===F.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===F.ASTC12x12Unorm||e===F.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=Gx.ClampToEdge;return e===mc?t=Gx.Repeat:e===gc&&(t=Gx.MirrorRepeat),t}_convertFilterMode(e){let t=Yu.Linear;return(e===Ln||e===Pw||e===ko)&&(t=Yu.Nearest),t}_getBytesPerTexel(e){if(e===F.R8Unorm||e===F.R8Snorm||e===F.R8Uint||e===F.R8Sint)return 1;if(e===F.R16Uint||e===F.R16Sint||e===F.R16Float||e===F.RG8Unorm||e===F.RG8Snorm||e===F.RG8Uint||e===F.RG8Sint)return 2;if(e===F.R32Uint||e===F.R32Sint||e===F.R32Float||e===F.RG16Uint||e===F.RG16Sint||e===F.RG16Float||e===F.RGBA8Unorm||e===F.RGBA8UnormSRGB||e===F.RGBA8Snorm||e===F.RGBA8Uint||e===F.RGBA8Sint||e===F.BGRA8Unorm||e===F.BGRA8UnormSRGB||e===F.RGB9E5UFloat||e===F.RGB10A2Unorm||e===F.RG11B10UFloat||e===F.Depth32Float||e===F.Depth24Plus||e===F.Depth24PlusStencil8||e===F.Depth32FloatStencil8)return 4;if(e===F.RG32Uint||e===F.RG32Sint||e===F.RG32Float||e===F.RGBA16Uint||e===F.RGBA16Sint||e===F.RGBA16Float)return 8;if(e===F.RGBA32Uint||e===F.RGBA32Sint||e===F.RGBA32Float)return 16}_getTypedArrayType(e){if(e===F.R8Uint)return Uint8Array;if(e===F.R8Sint)return Int8Array;if(e===F.R8Unorm)return Uint8Array;if(e===F.R8Snorm)return Int8Array;if(e===F.RG8Uint)return Uint8Array;if(e===F.RG8Sint)return Int8Array;if(e===F.RG8Unorm)return Uint8Array;if(e===F.RG8Snorm)return Int8Array;if(e===F.RGBA8Uint)return Uint8Array;if(e===F.RGBA8Sint)return Int8Array;if(e===F.RGBA8Unorm||e===F.RGBA8UnormSRGB)return Uint8Array;if(e===F.RGBA8Snorm)return Int8Array;if(e===F.R16Uint)return Uint16Array;if(e===F.R16Sint)return Int16Array;if(e===F.RG16Uint)return Uint16Array;if(e===F.RG16Sint)return Int16Array;if(e===F.RGBA16Uint)return Uint16Array;if(e===F.RGBA16Sint)return Int16Array;if(e===F.R16Float||e===F.RG16Float||e===F.RGBA16Float)return Uint16Array;if(e===F.R32Uint)return Uint32Array;if(e===F.R32Sint)return Int32Array;if(e===F.R32Float)return Float32Array;if(e===F.RG32Uint)return Uint32Array;if(e===F.RG32Sint)return Int32Array;if(e===F.RG32Float)return Float32Array;if(e===F.RGBA32Uint)return Uint32Array;if(e===F.RGBA32Sint)return Int32Array;if(e===F.RGBA32Float)return Float32Array;if(e===F.BGRA8Unorm||e===F.BGRA8UnormSRGB)return Uint8Array;if(e===F.RGB10A2Unorm||e===F.RGB9E5UFloat||e===F.RG11B10UFloat)return Uint32Array;if(e===F.Depth32Float)return Float32Array;if(e===F.Depth24Plus||e===F.Depth24PlusStencil8)return Uint32Array;if(e===F.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.is3DTexture||e.isData3DTexture?t=M2.ThreeD:t=M2.TwoD,t}}function HE(n,e=null){const t=n.format,i=n.type,r=n.colorSpace,s=Ze.getTransfer(r);let a;if(n.isCompressedTexture===!0||n.isCompressedArrayTexture===!0)switch(t){case Xl:case Yl:a=s===Re?F.BC1RGBAUnormSRGB:F.BC1RGBAUnorm;break;case Kl:a=s===Re?F.BC2RGBAUnormSRGB:F.BC2RGBAUnorm;break;case Ql:a=s===Re?F.BC3RGBAUnormSRGB:F.BC3RGBAUnorm;break;case jd:a=F.BC4RUnorm;break;case qd:a=F.BC4RSnorm;break;case Xd:a=F.BC5RGUnorm;break;case Yd:a=F.BC5RGSnorm;break;case Wd:a=s===Re?F.BC7RGBAUnormSRGB:F.BC7RGBAUnorm;break;case Nd:case Rd:a=s===Re?F.ETC2RGB8UnormSRGB:F.ETC2RGB8Unorm;break;case Cd:a=s===Re?F.ETC2RGBA8UnormSRGB:F.ETC2RGBA8Unorm;break;case Dd:a=s===Re?F.ASTC4x4UnormSRGB:F.ASTC4x4Unorm;break;case Ld:a=s===Re?F.ASTC5x4UnormSRGB:F.ASTC5x4Unorm;break;case Pd:a=s===Re?F.ASTC5x5UnormSRGB:F.ASTC5x5Unorm;break;case Ud:a=s===Re?F.ASTC6x5UnormSRGB:F.ASTC6x5Unorm;break;case Od:a=s===Re?F.ASTC6x6UnormSRGB:F.ASTC6x6Unorm;break;case Id:a=s===Re?F.ASTC8x5UnormSRGB:F.ASTC8x5Unorm;break;case Bd:a=s===Re?F.ASTC8x6UnormSRGB:F.ASTC8x6Unorm;break;case Fd:a=s===Re?F.ASTC8x8UnormSRGB:F.ASTC8x8Unorm;break;case kd:a=s===Re?F.ASTC10x5UnormSRGB:F.ASTC10x5Unorm;break;case zd:a=s===Re?F.ASTC10x6UnormSRGB:F.ASTC10x6Unorm;break;case Gd:a=s===Re?F.ASTC10x8UnormSRGB:F.ASTC10x8Unorm;break;case Vd:a=s===Re?F.ASTC10x10UnormSRGB:F.ASTC10x10Unorm;break;case Hd:a=s===Re?F.ASTC12x10UnormSRGB:F.ASTC12x10Unorm;break;case $d:a=s===Re?F.ASTC12x12UnormSRGB:F.ASTC12x12Unorm;break;case ii:a=s===Re?F.RGBA8UnormSRGB:F.RGBA8Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case ii:switch(i){case sc:a=F.RGBA8Snorm;break;case ac:a=F.RGBA16Sint;break;case la:a=F.RGBA16Uint;break;case wn:a=F.RGBA32Uint;break;case Oi:a=F.RGBA32Sint;break;case Kn:a=s===Re?F.RGBA8UnormSRGB:F.RGBA8Unorm;break;case Fi:a=F.RGBA16Float;break;case li:a=F.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",i)}break;case xg:switch(i){case X0:a=F.RGB9E5UFloat;break;case Y0:a=F.RG11B10UFloat;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",i)}break;case Tg:switch(i){case sc:a=F.R8Snorm;break;case ac:a=F.R16Sint;break;case la:a=F.R16Uint;break;case wn:a=F.R32Uint;break;case Oi:a=F.R32Sint;break;case Kn:a=F.R8Unorm;break;case Fi:a=F.R16Float;break;case li:a=F.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",i)}break;case zo:switch(i){case sc:a=F.RG8Snorm;break;case ac:a=F.RG16Sint;break;case la:a=F.RG16Uint;break;case wn:a=F.RG32Uint;break;case Oi:a=F.RG32Sint;break;case Kn:a=F.RG8Unorm;break;case Fi:a=F.RG16Float;break;case li:a=F.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",i)}break;case _s:switch(i){case la:a=F.Depth16Unorm;break;case wn:a=F.Depth24Plus;break;case li:a=F.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",i)}break;case ys:switch(i){case gs:a=F.Depth24PlusStencil8;break;case li:e&&e.features.has(VE.Depth32FloatStencil8)===!1&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),a=F.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",i)}break;case Tf:switch(i){case Oi:a=F.R32Sint;break;case wn:a=F.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",i)}break;case Ef:switch(i){case Oi:a=F.RG32Sint;break;case wn:a=F.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",i)}break;case Mf:switch(i){case Oi:a=F.RGBA32Sint;break;case wn:a=F.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",i)}break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}return a}const Dse=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,Lse=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,w2={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},Pse=n=>{n=n.trim();const e=n.match(Dse);if(e!==null&&e.length===4){const t=e[2],i=[];let r=null;for(;(r=Lse.exec(t))!==null;)i.push({name:r[1],type:r[2]});const s=[];for(let c=0;c<i.length;c++){const{name:h,type:d}=i[c];let f=d;f.startsWith("ptr")?f="pointer":(f.startsWith("texture")&&(f=d.split("<")[0]),f=w2[f]),s.push(new qA(f,h))}const a=n.substring(e[0].length),o=e[3]||"void",l=e[1]!==void 0?e[1]:"";return{type:w2[o]||o,inputs:s,name:l,inputsCode:t,blockCode:a,outputType:o}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class Use extends YA{constructor(e){const{type:t,inputs:i,name:r,inputsCode:s,blockCode:a,outputType:o}=Pse(e);super(t,i,r),this.inputsCode=s,this.blockCode=a,this.outputType=o}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class Ose extends e3{parseFunction(e){return new Use(e)}}const oh=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},Ise={[Ba.READ_ONLY]:"read",[Ba.WRITE_ONLY]:"write",[Ba.READ_WRITE]:"read_write"},A2={[mc]:"repeat",[Ia]:"clamp",[gc]:"mirror"},ey={vertex:oh?oh.VERTEX:1,fragment:oh?oh.FRAGMENT:2,compute:oh?oh.COMPUTE:4},R2={instance:!0,swizzleAssign:!1,storageBuffer:!0},Bse={"^^":"tsl_xor"},Fse={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},N2={},mp={tsl_xor:new ur("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new ur("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new ur("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new ur("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new ur("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new ur("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new ur("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new ur("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new ur("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new ur("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new ur("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new ur("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new ur(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},kse={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};let h3="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(h3+=`diagnostic( off, derivative_uniformity );
`);class zse extends JF{constructor(e,t){super(e,t,new Ose),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(e,t,i,r,s,a=this.shaderStage){return a==="fragment"?r?s?`textureSample( ${t}, ${t}_sampler, ${i}, ${r}, ${s} )`:`textureSample( ${t}, ${t}_sampler, ${i}, ${r} )`:s?`textureSample( ${t}, ${t}_sampler, ${i}, ${s} )`:`textureSample( ${t}, ${t}_sampler, ${i} )`:this.generateTextureSampleLevel(e,t,i,"0",r)}generateTextureSampleLevel(e,t,i,r,s,a){return this.isUnfilterable(e)===!1?a?`textureSampleLevel( ${t}, ${t}_sampler, ${i}, ${r}, ${a} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${i}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,i,a,r):this.generateTextureLod(e,t,i,s,a,r)}generateWrapFunction(e){const t=`tsl_coord_${A2[e.wrapS]}S_${A2[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let i=N2[t];if(i===void 0){const r=[],s=e.isData3DTexture?"vec3f":"vec2f";let a=`fn ${t}( coord : ${s} ) -> ${s} {

	return ${s}(
`;const o=(l,u)=>{l===mc?(r.push(mp.repeatWrapping_float),a+=`		tsl_repeatWrapping_float( coord.${u} )`):l===Ia?(r.push(mp.clampWrapping_float),a+=`		tsl_clampWrapping_float( coord.${u} )`):l===gc?(r.push(mp.mirrorWrapping_float),a+=`		tsl_mirrorWrapping_float( coord.${u} )`):(a+=`		coord.${u}`,console.warn(`WebGPURenderer: Unsupported texture wrap type "${l}" for vertex shader.`))};o(e.wrapS,"x"),a+=`,
`,o(e.wrapT,"y"),e.isData3DTexture&&(a+=`,
`,o(e.wrapR,"z")),a+=`
	);

}
`,N2[t]=i=new ur(a,r)}return i.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,i){const r=this.getDataFromNode(e,this.shaderStage,this.globalCache);r.dimensionsSnippet===void 0&&(r.dimensionsSnippet={});let s=r.dimensionsSnippet[i];if(r.dimensionsSnippet[i]===void 0){let a,o;const{primarySamples:l}=this.renderer.backend.utils.getTextureSampleData(e),u=l>1;e.isData3DTexture?o="vec3<u32>":o="vec2<u32>",u||e.isStorageTexture?a=t:a=`${t}${i?`, u32( ${i} )`:""}`,s=new Ly(new Uy(`textureDimensions( ${a} )`,o)),r.dimensionsSnippet[i]=s,(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)&&(r.arrayLayerCount=new Ly(new Uy(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(r.cubeFaceCount=new Ly(new Uy("6u","u32")))}return s.build(this)}generateFilteredTexture(e,t,i,r,s="0u"){this._include("biquadraticTexture");const a=this.generateWrapFunction(e),o=this.generateTextureDimension(e,t,s);return r&&(i=`${i} + vec2<f32>(${r}) / ${o}`),`tsl_biquadraticTexture( ${t}, ${a}( ${i} ), ${o}, u32( ${s} ) )`}generateTextureLod(e,t,i,r,s,a="0u"){const o=this.generateWrapFunction(e),l=this.generateTextureDimension(e,t,a),u=e.isData3DTexture?"vec3":"vec2";s&&(i=`${i} + ${u}<f32>(${s}) / ${u}<f32>( ${l} )`);const c=`${u}<u32>( ${o}( ${i} ) * ${u}<f32>( ${l} ) )`;return this.generateTextureLoad(e,t,c,r,null,a)}generateTextureLoad(e,t,i,r,s,a="0u"){let o;return s&&(i=`${i} + ${s}`),r?o=`textureLoad( ${t}, ${i}, ${r}, u32( ${a} ) )`:(o=`textureLoad( ${t}, ${i}, u32( ${a} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(o+=".x")),o}generateTextureStore(e,t,i,r,s){let a;return r?a=`textureStore( ${t}, ${i}, ${r}, ${s} )`:a=`textureStore( ${t}, ${i}, ${s} )`,a}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===li||this.isSampleCompare(e)===!1&&e.minFilter===Ln&&e.magFilter===Ln||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,i,r,s,a=this.shaderStage){let o=null;return this.isUnfilterable(e)?o=this.generateTextureLod(e,t,i,r,s,"0",a):o=this._generateTextureSample(e,t,i,r,s,a),o}generateTextureGrad(e,t,i,r,s,a,o=this.shaderStage){if(o==="fragment")return a?`textureSampleGrad( ${t}, ${t}_sampler, ${i},  ${r[0]}, ${r[1]}, ${a} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${i},  ${r[0]}, ${r[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${o} shader.`)}generateTextureCompare(e,t,i,r,s,a,o=this.shaderStage){if(o==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?a?`textureSampleCompare( ${t}, ${t}_sampler, ${i}, ${s}, ${r}, ${a} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${i}, ${s}, ${r} )`:a?`textureSampleCompare( ${t}, ${t}_sampler, ${i}, ${r}, ${a} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${i}, ${r} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}generateTextureLevel(e,t,i,r,s,a){return this.isUnfilterable(e)===!1?a?`textureSampleLevel( ${t}, ${t}_sampler, ${i}, ${r}, ${a} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${i}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,i,a,r):this.generateTextureLod(e,t,i,s,a,r)}generateTextureBias(e,t,i,r,s,a,o=this.shaderStage){if(o==="fragment")return a?`textureSampleBias( ${t}, ${t}_sampler, ${i}, ${r}, ${a} )`:`textureSampleBias( ${t}, ${t}_sampler, ${i}, ${r} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${o} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const i=e.name,r=e.type;return r==="texture"||r==="cubeTexture"||r==="storageTexture"||r==="texture3D"?i:r==="buffer"||r==="storageBuffer"||r==="indirectStorageBuffer"?this.isCustomStruct(e)?i:i+".value":e.groupNode.name+"."+i}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=Bse[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?e.isAtomic===!0?(console.warn("WebGPURenderer: Atomic operations are only supported in compute shaders."),Ba.READ_WRITE):Ba.READ_ONLY:e.access}getStorageAccess(e,t){return Ise[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,i,r=null){const s=super.getUniformFromNode(e,t,i,r),a=this.getDataFromNode(e,i,this.globalCache);if(a.uniformGPU===void 0){let o;const l=e.groupNode,u=l.name,c=this.getBindGroupArray(u,i);if(t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"){let h=null;const d=this.getNodeAccess(e,i);if(t==="texture"||t==="storageTexture"?e.value.is3DTexture===!0?h=new GE(s.name,s.node,l,d):h=new vb(s.name,s.node,l,d):t==="cubeTexture"?h=new l3(s.name,s.node,l,d):t==="texture3D"&&(h=new GE(s.name,s.node,l,d)),h.store=e.isStorageTextureNode===!0,h.setVisibility(ey[i]),this.isUnfilterable(e.value)===!1&&h.store===!1){const f=new Tse(`${s.name}_sampler`,s.node,l);f.setVisibility(ey[i]),c.push(f,h),o=[f,h]}else c.push(h),o=[h]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const h=t==="buffer"?s3:wse,d=new h(e,l);d.setVisibility(ey[i]),c.push(d),o=d,s.name=r||"NodeBuffer_"+s.id}else{const h=this.uniformGroups[i]||(this.uniformGroups[i]={});let d=h[u];d===void 0&&(d=new a3(u,l),d.setVisibility(ey[i]),h[u]=d,c.push(d)),o=this.getNodeUniform(s,t),d.addUniform(o)}a.uniformGPU=o}return s}getBuiltin(e,t,i,r=this.shaderStage){const s=this.builtins[r]||(this.builtins[r]=new Map);return s.has(e)===!1&&s.set(e,{name:e,property:t,type:i}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,i=this.flowShaderNode(e),r=[];for(const a of t.inputs)r.push(a.name+" : "+this.getType(a.type));let s=`fn ${t.name}( ${r.join(", ")} ) -> ${this.getType(t.type)} {
${i.vars}
${i.code}
`;return i.result&&(s+=`	return ${i.result};
`),s+=`
}
`,s}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],i=this.directives[e];if(i!==void 0)for(const r of i)t.push(`enable ${r};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],i=this.builtins[e];if(i!==void 0)for(const{name:r,property:s,type:a}of i.values())t.push(`@builtin( ${r} ) ${s} : ${a}`);return t.join(`,
	`)}getScopedArray(e,t,i,r){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:i,bufferCount:r}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:i,scope:r,bufferType:s,bufferCount:a}of this.scopedArrays.values()){const o=this.getType(s);t.push(`var<${r}> ${i}: array< ${o}, ${a} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const i=this.getBuiltins("attribute");i&&t.push(i);const r=this.getAttributesArray();for(let s=0,a=r.length;s<a;s++){const o=r[s],l=o.name,u=this.getType(o.type);t.push(`@location( ${s} ) ${l} : ${u}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const i of e.members){const r=e.output?"@location( "+i.index+" ) ":"";let s=this.getType(i.type);i.atomic&&(s="atomic< "+s+" >"),t.push(`	${r+i.name} : ${s}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const i=this.structs[e];if(i.length>0){const r=[];for(const s of i){let a=`struct ${s.name} {
`;a+=this.getStructMembers(s),a+=`
};`,r.push(a)}t=`
`+r.join(`

`)+`
`}return t}getVar(e,t,i=null){let r=`var ${t} : `;return i!==null?r+=this.generateArrayDeclaration(e,i):r+=this.getType(e),r}getVars(e){const t=[],i=this.vars[e];if(i!==void 0)for(const r of i)t.push(`	${this.getVar(r.type,r.name,r.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const s=this.varyings,a=this.vars[e];for(let o=0;o<s.length;o++){const l=s[o];if(l.needsInterpolation){let u=`@location( ${o} )`;if(l.interpolationType){const c=l.interpolationSampling!==null?`, ${l.interpolationSampling} )`:" )";u+=` @interpolate( ${l.interpolationType}${c}`}else/^(int|uint|ivec|uvec)/.test(l.type)&&(u+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${u} ${l.name} : ${this.getType(l.type)}`)}else e==="vertex"&&a.includes(l)===!1&&a.push(l)}}const i=this.getBuiltins(e);i&&t.push(i);const r=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+r):r}isCustomStruct(e){const t=e.value,i=e.node,r=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&i.structTypeNode!==null,s=i.value&&i.value.array&&typeof i.value.itemSize=="number"&&i.value.array.length>i.value.itemSize;return r&&!s}getUniforms(e){const t=this.uniforms[e],i=[],r=[],s=[],a={};for(const l of t){const u=l.groupNode.name,c=this.bindingsIndexes[u];if(l.type==="texture"||l.type==="cubeTexture"||l.type==="storageTexture"||l.type==="texture3D"){const h=l.node.value;this.isUnfilterable(h)===!1&&l.node.isStorageTextureNode!==!0&&(this.isSampleCompare(h)?i.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var ${l.name}_sampler : sampler_comparison;`):i.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var ${l.name}_sampler : sampler;`));let d,f="";const{primarySamples:m}=this.renderer.backend.utils.getTextureSampleData(h);if(m>1&&(f="_multisampled"),h.isCubeTexture===!0)d="texture_cube<f32>";else if(h.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&h.compareFunction===null?d=`texture${f}_2d<f32>`:d=`texture_depth${f}_2d${h.isArrayTexture===!0?"_array":""}`;else if(l.node.isStorageTextureNode===!0){const _=HE(h),g=this.getStorageAccess(l.node,e),p=l.node.value.is3DTexture,y=l.node.value.isArrayTexture;d=`texture_storage_${p?"3d":`2d${y?"_array":""}`}<${_}, ${g}>`}else if(h.isArrayTexture===!0||h.isDataArrayTexture===!0||h.isCompressedArrayTexture===!0)d="texture_2d_array<f32>";else if(h.is3DTexture===!0||h.isData3DTexture===!0)d="texture_3d<f32>";else{const _=this.getComponentTypeFromTexture(h).charAt(0);d=`texture${f}_2d<${_}32>`}i.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var ${l.name} : ${d};`)}else if(l.type==="buffer"||l.type==="storageBuffer"||l.type==="indirectStorageBuffer"){const h=l.node,d=this.getType(h.getNodeType(this)),f=h.bufferCount,m=f>0&&l.type==="buffer"?", "+f:"",_=h.isStorageBufferNode?`storage, ${this.getStorageAccess(h,e)}`:"uniform";if(this.isCustomStruct(l))r.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var<${_}> ${l.name} : ${d};`);else{const p=`	value : array< ${h.isAtomic?`atomic<${d}>`:`${d}`}${m} >`;r.push(this._getWGSLStructBinding(l.name,p,_,c.binding++,c.group))}}else{const h=this.getType(this.getVectorType(l.type)),d=l.groupNode.name;(a[d]||(a[d]={index:c.binding++,id:c.group,snippets:[]})).snippets.push(`	${l.name} : ${h}`)}}for(const l in a){const u=a[l];s.push(this._getWGSLStructBinding(l,u.snippets.join(`,
`),"uniform",u.index,u.id))}let o=i.join(`
`);return o+=r.join(`
`),o+=s.join(`
`),o}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const i=e[t];i.uniforms=this.getUniforms(t),i.attributes=this.getAttributes(t),i.varyings=this.getVaryings(t),i.structs=this.getStructs(t),i.vars=this.getVars(t),i.codes=this.getCodes(t),i.directives=this.getDirectives(t),i.scopedArrays=this.getScopedArrays(t);let r=`// code

`;r+=this.flowCode[t];const s=this.flowNodes[t],a=s[s.length-1],o=a.outputNode,l=o!==void 0&&o.isOutputStructNode===!0;for(const u of s){const c=this.getFlowData(u),h=u.name;if(h&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${h}
`),r+=`${c.code}
	`,u===a&&t!=="compute"){if(r+=`// result

	`,t==="vertex")r+=`varyings.Vertex = ${c.result};`;else if(t==="fragment")if(l)i.returnType=o.getNodeType(this),i.structs+="var<private> output : "+i.returnType+";",r+=`return ${c.result};`;else{let d="	@location(0) color: vec4<f32>";const f=this.getBuiltins("output");f&&(d+=`,
	`+f),i.returnType="OutputStruct",i.structs+=this._getWGSLStruct("OutputStruct",d),i.structs+=`
var<private> output : OutputStruct;`,r+=`output.color = ${c.result};

	return output;`}}}i.flow=r}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment);else{const t=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(e.compute,t)}}getMethod(e,t=null){let i;return t!==null&&(i=this._getWGSLMethod(e+"_"+t)),i===void 0&&(i=this._getWGSLMethod(e)),i||e}getBitcastMethod(e){return`bitcast<${this.getType(e)}>`}getTernary(e,t,i){return`select( ${i}, ${t}, ${e} )`}getType(e){return Fse[e]||e}isAvailable(e){let t=R2[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),R2[e]=t),t}_getWGSLMethod(e){return mp[e]!==void 0&&this._include(e),kse[e]}_include(e){const t=mp[e];return t.build(this),this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${h3}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){const[i,r,s]=t;return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${i}, ${r}, ${s} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${i} * numWorkgroups.x )
		+ globalId.z * ( ${i} * numWorkgroups.x ) * ( ${r} * numWorkgroups.y );

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,i,r=0,s=0){const a=e+"Struct";return`${this._getWGSLStruct(a,t)}
@binding( ${r} ) @group( ${s} )
var<${i}> ${e} : ${a};`}}class Gse{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=F.Depth24PlusStencil8:e.depth&&(t=F.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const s=this.backend.renderer,a=s.getRenderTarget();t=a?a.samples:s.samples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const i=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:i?1:t,isMSAA:i}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return Hh.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return Hh.LineList;if(e.isLine)return Hh.LineStrip;if(e.isMesh)return Hh.TriangleList}getSampleCount(e){return e>=4?4:1}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(e===void 0)return navigator.gpu.getPreferredCanvasFormat();if(e===Kn)return F.BGRA8Unorm;if(e===Fi)return F.RGBA16Float;throw new Error("Unsupported outputType")}}const d3=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&d3.set(Float16Array,["float16"]);const Vse=new Map([[JO,["float16"]]]),Hse=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class $se{constructor(e){this.backend=e}createAttribute(e,t){const i=this._getBufferAttribute(e),r=this.backend,s=r.get(i);let a=s.buffer;if(a===void 0){const o=r.device;let l=i.array;if(e.normalized===!1){if(l.constructor===Int16Array||l.constructor===Int8Array)l=new Int32Array(l);else if((l.constructor===Uint16Array||l.constructor===Uint8Array)&&(l=new Uint32Array(l),t&GPUBufferUsage.INDEX))for(let h=0;h<l.length;h++)l[h]===65535&&(l[h]=4294967295)}if(i.array=l,(i.isStorageBufferAttribute||i.isStorageInstancedBufferAttribute)&&i.itemSize===3){l=new l.constructor(i.count*4);for(let h=0;h<i.count;h++)l.set(i.array.subarray(h*3,h*3+3),h*4);i.itemSize=4,i.array=l,s._force3to4BytesAlignment=!0}const u=l.byteLength,c=u+(4-u%4)%4;a=o.createBuffer({label:i.name,size:c,usage:t,mappedAtCreation:!0}),new l.constructor(a.getMappedRange()).set(l),a.unmap(),s.buffer=a}}updateAttribute(e){const t=this._getBufferAttribute(e),i=this.backend,r=i.device,s=i.get(t),a=i.get(t).buffer;let o=t.array;if(s._force3to4BytesAlignment===!0){o=new o.constructor(t.count*4);for(let c=0;c<t.count;c++)o.set(t.array.subarray(c*3,c*3+3),c*4);t.array=o}const l=this._isTypedArray(o),u=t.updateRanges;if(u.length===0)r.queue.writeBuffer(a,0,o,0);else{const c=l?1:o.BYTES_PER_ELEMENT;for(let h=0,d=u.length;h<d;h++){const f=u[h];let m,_;if(s._force3to4BytesAlignment===!0){const p=Math.floor(f.start/3),y=Math.ceil(f.count/3);m=p*4*c,_=y*4*c}else m=f.start*c,_=f.count*c;const g=m*(l?o.BYTES_PER_ELEMENT:1);r.queue.writeBuffer(a,g,o,m,_)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),i=new Map;for(let r=0;r<t.length;r++){const s=t[r],a=s.array.BYTES_PER_ELEMENT,o=this._getBufferAttribute(s);let l=i.get(o);if(l===void 0){let h,d;s.isInterleavedBufferAttribute===!0?(h=s.data.stride*a,d=s.data.isInstancedInterleavedBuffer?J_.Instance:J_.Vertex):(h=s.itemSize*a,d=s.isInstancedBufferAttribute?J_.Instance:J_.Vertex),s.normalized===!1&&(s.array.constructor===Int16Array||s.array.constructor===Uint16Array)&&(h=4),l={arrayStride:h,attributes:[],stepMode:d},i.set(o,l)}const u=this._getVertexFormat(s),c=s.isInterleavedBufferAttribute===!0?s.offset*a:0;l.attributes.push({shaderLocation:r,offset:c,format:u})}return Array.from(i.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,i=t.device,s=t.get(this._getBufferAttribute(e)).buffer,a=s.size,o=i.createBuffer({label:`${e.name}_readback`,size:a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),l=i.createCommandEncoder({label:`readback_encoder_${e.name}`});l.copyBufferToBuffer(s,0,o,0,a);const u=l.finish();i.queue.submit([u]),await o.mapAsync(GPUMapMode.READ);const c=o.getMappedRange(),h=new e.array.constructor(c.slice(0));return o.unmap(),h.buffer}_getVertexFormat(e){const{itemSize:t,normalized:i}=e,r=e.array.constructor,s=e.constructor;let a;if(t===1)a=Hse.get(r);else{const l=(Vse.get(s)||d3.get(r))[i?1:0];if(l){const u=r.BYTES_PER_ELEMENT*t,h=Math.floor((u+3)/4)*4/r.BYTES_PER_ELEMENT;if(h%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");a=`${l}x${h}`}}return a||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),a}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class Wse{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,i=t.device,r=[];let s=0;for(const a of e.bindings){const o={binding:s++,visibility:a.visibility};if(a.isUniformBuffer||a.isStorageBuffer){const l={};a.isStorageBuffer&&(a.visibility&4&&(a.access===Ba.READ_WRITE||a.access===Ba.WRITE_ONLY)?l.type=Vx.Storage:l.type=Vx.ReadOnlyStorage),o.buffer=l}else if(a.isSampledTexture&&a.store){const l={};l.format=this.backend.get(a.texture).texture.format;const u=a.access;u===Ba.READ_WRITE?l.access=Hx.ReadWrite:u===Ba.WRITE_ONLY?l.access=Hx.WriteOnly:l.access=Hx.ReadOnly,a.texture.isArrayTexture?l.viewDimension=fi.TwoDArray:a.texture.is3DTexture&&(l.viewDimension=fi.ThreeD),o.storageTexture=l}else if(a.isSampledTexture){const l={},{primarySamples:u}=t.utils.getTextureSampleData(a.texture);if(u>1&&(l.multisampled=!0,a.texture.isDepthTexture||(l.sampleType=Uu.UnfilterableFloat)),a.texture.isDepthTexture)t.compatibilityMode&&a.texture.compareFunction===null?l.sampleType=Uu.UnfilterableFloat:l.sampleType=Uu.Depth;else if(a.texture.isDataTexture||a.texture.isDataArrayTexture||a.texture.isData3DTexture){const c=a.texture.type;c===Oi?l.sampleType=Uu.SInt:c===wn?l.sampleType=Uu.UInt:c===li&&(this.backend.hasFeature("float32-filterable")?l.sampleType=Uu.Float:l.sampleType=Uu.UnfilterableFloat)}a.isSampledCubeTexture?l.viewDimension=fi.Cube:a.texture.isArrayTexture||a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?l.viewDimension=fi.TwoDArray:a.isSampledTexture3D&&(l.viewDimension=fi.ThreeD),o.texture=l}else if(a.isSampler){const l={};a.texture.isDepthTexture&&(a.texture.compareFunction!==null?l.type=E2.Comparison:t.compatibilityMode&&(l.type=E2.NonFiltering)),o.sampler=l}else console.error(`WebGPUBindingUtils: Unsupported binding "${a}".`);r.push(o)}return i.createBindGroupLayout({entries:r})}createBindings(e,t,i,r=0){const{backend:s,bindGroupLayoutCache:a}=this,o=s.get(e);let l=a.get(e.bindingsReference);l===void 0&&(l=this.createBindingsLayout(e),a.set(e.bindingsReference,l));let u;i>0&&(o.groups===void 0&&(o.groups=[],o.versions=[]),o.versions[i]===r&&(u=o.groups[i])),u===void 0&&(u=this.createBindGroup(e,l),i>0&&(o.groups[i]=u,o.versions[i]=r)),o.group=u,o.layout=l}updateBinding(e){const t=this.backend,i=t.device,r=e.buffer,s=t.get(e).buffer;i.queue.writeBuffer(s,0,r,0)}createBindGroupIndex(e,t){const r=this.backend.device,s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a=e[0],o=r.createBuffer({label:"bindingCameraIndex_"+a,size:16,usage:s});r.queue.writeBuffer(o,0,e,0);const l=[{binding:0,resource:{buffer:o}}];return r.createBindGroup({label:"bindGroupCameraIndex_"+a,layout:t,entries:l})}createBindGroup(e,t){const i=this.backend,r=i.device;let s=0;const a=[];for(const o of e.bindings){if(o.isUniformBuffer){const l=i.get(o);if(l.buffer===void 0){const u=o.byteLength,c=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,h=r.createBuffer({label:"bindingBuffer_"+o.name,size:u,usage:c});l.buffer=h}a.push({binding:s,resource:{buffer:l.buffer}})}else if(o.isStorageBuffer){const l=i.get(o);if(l.buffer===void 0){const u=o.attribute;l.buffer=i.get(u).buffer}a.push({binding:s,resource:{buffer:l.buffer}})}else if(o.isSampledTexture){const l=i.get(o.texture);let u;if(l.externalTexture!==void 0)u=r.importExternalTexture({source:l.externalTexture});else{const c=o.store?1:l.texture.mipLevelCount;let h=`view-${l.texture.width}-${l.texture.height}`;if(l.texture.depthOrArrayLayers>1&&(h+=`-${l.texture.depthOrArrayLayers}`),h+=`-${c}`,u=l[h],u===void 0){const d=xse.All;let f;o.isSampledCubeTexture?f=fi.Cube:o.isSampledTexture3D?f=fi.ThreeD:o.texture.isArrayTexture||o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?f=fi.TwoDArray:f=fi.TwoD,u=l[h]=l.texture.createView({aspect:d,dimension:f,mipLevelCount:c})}}a.push({binding:s,resource:u})}else if(o.isSampler){const l=i.get(o.texture);a.push({binding:s,resource:l.sampler})}s++}return r.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:a})}}class jse{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:i,material:r,geometry:s,pipeline:a}=e,{vertexProgram:o,fragmentProgram:l}=a,u=this.backend,c=u.device,h=u.utils,d=u.get(a),f=[];for(const k of e.getBindings()){const P=u.get(k);f.push(P.layout)}const m=u.attributeUtils.createShaderVertexBuffers(e);let _;r.blending!==kr&&(r.blending!==ms||r.transparent!==!1)&&(_=this._getBlending(r));let g={};r.stencilWrite===!0&&(g={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});const p=this._getColorWriteMask(r),y=[];if(e.context.textures!==null){const k=e.context.textures;for(let P=0;P<k.length;P++){const O=h.getTextureFormatGPU(k[P]);y.push({format:O,blend:_,writeMask:p})}}else{const k=h.getCurrentColorFormat(e.context);y.push({format:k,blend:_,writeMask:p})}const v=u.get(o).module,b=u.get(l).module,S=this._getPrimitiveState(i,s,r),x=this._getDepthCompare(r),T=h.getCurrentDepthStencilFormat(e.context),w=this._getSampleCount(e.context),E={label:`renderPipeline_${r.name||r.type}_${r.id}`,vertex:Object.assign({},v,{buffers:m}),fragment:Object.assign({},b,{targets:y}),primitive:S,multisample:{count:w,alphaToCoverageEnabled:r.alphaToCoverage&&w>1},layout:c.createPipelineLayout({bindGroupLayouts:f})},M={},N=e.context.depth,U=e.context.stencil;if((N===!0||U===!0)&&(N===!0&&(M.format=T,M.depthWriteEnabled=r.depthWrite,M.depthCompare=x),U===!0&&(M.stencilFront=g,M.stencilBack={},M.stencilReadMask=r.stencilFuncMask,M.stencilWriteMask=r.stencilWriteMask),r.polygonOffset===!0&&(M.depthBias=r.polygonOffsetUnits,M.depthBiasSlopeScale=r.polygonOffsetFactor,M.depthBiasClamp=0),E.depthStencil=M),t===null)d.pipeline=c.createRenderPipeline(E);else{const k=new Promise(P=>{c.createRenderPipelineAsync(E).then(O=>{d.pipeline=O,P()})});t.push(k)}}createBundleEncoder(e,t="renderBundleEncoder"){const i=this.backend,{utils:r,device:s}=i,a=r.getCurrentDepthStencilFormat(e),o=r.getCurrentColorFormat(e),l=this._getSampleCount(e),u={label:t,colorFormats:[o],depthStencilFormat:a,sampleCount:l};return s.createRenderBundleEncoder(u)}createComputePipeline(e,t){const i=this.backend,r=i.device,s=i.get(e.computeProgram).module,a=i.get(e),o=[];for(const l of t){const u=i.get(l);o.push(u.layout)}a.pipeline=r.createComputePipeline({compute:s,layout:r.createPipelineLayout({bindGroupLayouts:o})})}_getBlending(e){let t,i;const r=e.blending,s=e.blendSrc,a=e.blendDst,o=e.blendEquation;if(r===Jh){const l=e.blendSrcAlpha!==null?e.blendSrcAlpha:s,u=e.blendDstAlpha!==null?e.blendDstAlpha:a,c=e.blendEquationAlpha!==null?e.blendEquationAlpha:o;t={srcFactor:this._getBlendFactor(s),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(o)},i={srcFactor:this._getBlendFactor(l),dstFactor:this._getBlendFactor(u),operation:this._getBlendOperation(c)}}else{const l=e.premultipliedAlpha,u=(c,h,d,f)=>{t={srcFactor:c,dstFactor:h,operation:Pu.Add},i={srcFactor:d,dstFactor:f,operation:Pu.Add}};if(l)switch(r){case ms:u(It.One,It.OneMinusSrcAlpha,It.One,It.OneMinusSrcAlpha);break;case Td:u(It.One,It.One,It.One,It.One);break;case Ed:u(It.Zero,It.OneMinusSrc,It.Zero,It.One);break;case Md:u(It.Dst,It.OneMinusSrcAlpha,It.Zero,It.One);break}else switch(r){case ms:u(It.SrcAlpha,It.OneMinusSrcAlpha,It.One,It.OneMinusSrcAlpha);break;case Td:u(It.SrcAlpha,It.One,It.One,It.One);break;case Ed:console.error("THREE.WebGPURenderer: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Md:console.error("THREE.WebGPURenderer: MultiplyBlending requires material.premultipliedAlpha = true");break}}if(t!==void 0&&i!==void 0)return{color:t,alpha:i};console.error("THREE.WebGPURenderer: Invalid blending: ",r)}_getBlendFactor(e){let t;switch(e){case To:t=It.Zero;break;case Ew:t=It.One;break;case Mw:t=It.Src;break;case ww:t=It.OneMinusSrc;break;case Mm:t=It.SrcAlpha;break;case wm:t=It.OneMinusSrcAlpha;break;case Nw:t=It.Dst;break;case Cw:t=It.OneMinusDst;break;case Aw:t=It.DstAlpha;break;case Rw:t=It.OneMinusDstAlpha;break;case Dw:t=It.SrcAlphaSaturated;break;case Pne:t=It.Constant;break;case Une:t=It.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const i=e.stencilFunc;switch(i){case f8:t=zi.Never;break;case dE:t=zi.Always;break;case p8:t=zi.Less;break;case g8:t=zi.LessEqual;break;case m8:t=zi.Equal;break;case v8:t=zi.GreaterEqual;break;case _8:t=zi.Greater;break;case y8:t=zi.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",i)}return t}_getStencilOperation(e){let t;switch(e){case zu:t=bl.Keep;break;case a8:t=bl.Zero;break;case o8:t=bl.Replace;break;case d8:t=bl.Invert;break;case l8:t=bl.IncrementClamp;break;case u8:t=bl.DecrementClamp;break;case c8:t=bl.IncrementWrap;break;case h8:t=bl.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case Zi:t=Pu.Add;break;case xw:t=Pu.Subtract;break;case Tw:t=Pu.ReverseSubtract;break;case zO:t=Pu.Min;break;case GO:t=Pu.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,i){const r={},s=this.backend.utils;r.topology=s.getPrimitiveTopology(e,i),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(r.stripIndexFormat=t.index.array instanceof Uint16Array?sf.Uint16:sf.Uint32);let a=i.side===bn;return e.isMesh&&e.matrixWorld.determinant()<0&&(a=!a),r.frontFace=a===!0?S2.CW:S2.CCW,r.cullMode=i.side===Qi?x2.None:x2.Back,r}_getColorWriteMask(e){return e.colorWrite===!0?T2.All:T2.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=zi.Always;else{const i=e.depthFunc;switch(i){case Am:t=zi.Never;break;case Rm:t=zi.Always;break;case Nm:t=zi.Less;break;case iu:t=zi.LessEqual;break;case Cm:t=zi.Equal;break;case Dm:t=zi.GreaterEqual;break;case Lm:t=zi.Greater;break;case Pm:t=zi.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",i)}}return t}}class qse extends c3{constructor(e,t,i=2048){super(i),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const r=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return vs(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,i=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const r=this.device.createCommandEncoder();r.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),r.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,i);const s=r.finish();if(this.device.queue.submit([s]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,i),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const a=new BigUint64Array(this.resultBuffer.getMappedRange(0,i));let o=0;for(const[,l]of e){const u=a[l],c=a[l+1],h=Number(c-u)/1e6;o+=h}return this.resultBuffer.unmap(),this.lastValue=o,o}catch(e){return console.error("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){console.error("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){console.error("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class Xse extends u3{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new Gse(this),this.attributeUtils=new $se(this),this.bindingUtils=new Wse(this),this.pipelineUtils=new jse(this),this.textureUtils=new Cse(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let i;if(t.device===void 0){const o={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},l=typeof navigator<"u"?await navigator.gpu.requestAdapter(o):null;if(l===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const u=Object.values(VE),c=[];for(const d of u)l.features.has(d)&&c.push(d);const h={requiredFeatures:c,requiredLimits:t.requiredLimits};i=await l.requestDevice(h)}else i=t.device;i.lost.then(o=>{const l={api:"WebGPU",message:o.message||"Unknown reason",reason:o.reason||null,originalEvent:o};e.onDeviceLost(l)});const r=t.context!==void 0?t.context:e.domElement.getContext("webgpu");this.device=i,this.context=r;const s=t.alpha?"premultiplied":"opaque",a=Ze.getToneMappingMode(this.renderer.outputColorSpace);this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:s,toneMapping:{mode:a}}),this.trackTimestamp=this.trackTimestamp&&this.hasFeature(VE.TimestampQuery),this.updateSize()}get coordinateSystem(){return ru}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(e===null){const i=this.renderer;e={colorAttachments:[{view:null}]},(this.renderer.depth===!0||this.renderer.stencil===!0)&&(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(i.depth,i.stencil).createView()});const r=e.colorAttachments[0];this.renderer.samples>0?r.view=this.colorBuffer.createView():r.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const t=e.colorAttachments[0];return this.renderer.samples>0?t.resolveTarget=this.context.getCurrentTexture().createView():t.view=this.context.getCurrentTexture().createView(),e}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const i=e.renderTarget,r=this.get(i);let s=r.descriptors;(s===void 0||r.width!==i.width||r.height!==i.height||r.samples!==i.samples)&&(s={},r.descriptors=s);const a=e.getCacheKey();let o=s[a];if(o===void 0){const u=e.textures,c=[];let h;const d=this._isRenderCameraDepthArray(e);for(let f=0;f<u.length;f++){const m=this.get(u[f]),_={label:`colorAttachment_${f}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:fi.TwoD};if(i.isRenderTarget3D)h=e.activeCubeFace,_.baseArrayLayer=0,_.dimension=fi.ThreeD,_.depthOrArrayLayers=u[f].image.depth;else if(i.isRenderTarget&&u[f].image.depth>1)if(d===!0){const g=e.camera.cameras;for(let p=0;p<g.length;p++){const y={..._,baseArrayLayer:p,arrayLayerCount:1,dimension:fi.TwoD},v=m.texture.createView(y);c.push({view:v,resolveTarget:void 0,depthSlice:void 0})}}else _.dimension=fi.TwoDArray,_.depthOrArrayLayers=u[f].image.depth;if(d!==!0){const g=m.texture.createView(_);let p,y;m.msaaTexture!==void 0?(p=m.msaaTexture.createView(),y=g):(p=g,y=void 0),c.push({view:p,resolveTarget:y,depthSlice:h})}}if(o={textureViews:c},e.depth){const f=this.get(e.depthTexture),m={};e.depthTexture.isArrayTexture&&(m.dimension=fi.TwoD,m.arrayLayerCount=1,m.baseArrayLayer=e.activeCubeFace),o.depthStencilView=f.texture.createView(m)}s[a]=o,r.width=i.width,r.height=i.height,r.samples=i.samples,r.activeMipmapLevel=e.activeMipmapLevel,r.activeCubeFace=e.activeCubeFace}const l={colorAttachments:[]};for(let u=0;u<o.textureViews.length;u++){const c=o.textureViews[u];let h={r:0,g:0,b:0,a:1};u===0&&t.clearValue&&(h=t.clearValue),l.colorAttachments.push({view:c.view,depthSlice:c.depthSlice,resolveTarget:c.resolveTarget,loadOp:t.loadOp||Zt.Load,storeOp:t.storeOp||cr.Store,clearValue:h})}return o.depthStencilView&&(l.depthStencilAttachment={view:o.depthStencilView}),l}beginRender(e){const t=this.get(e);t.frameCalls=this.renderer.info.render.frameCalls;const i=this.device,r=e.occlusionQueryCount;let s;r>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,s=i.createQuerySet({type:"occlusion",count:r,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=s,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(r),t.lastOcclusionObject=null);let a;e.textures===null?a=this._getDefaultRenderPassDescriptor():a=this._getRenderPassDescriptor(e,{loadOp:Zt.Load}),this.initTimestampQuery(Bh.RENDER,this.getTimestampUID(e),a),a.occlusionQuerySet=s;const o=a.depthStencilAttachment;if(e.textures!==null){const u=a.colorAttachments;for(let c=0;c<u.length;c++){const h=u[c];e.clearColor?(h.clearValue=c===0?e.clearColorValue:{r:0,g:0,b:0,a:1},h.loadOp=Zt.Clear):h.loadOp=Zt.Load,h.storeOp=cr.Store}}else{const u=a.colorAttachments[0];e.clearColor?(u.clearValue=e.clearColorValue,u.loadOp=Zt.Clear):u.loadOp=Zt.Load,u.storeOp=cr.Store}e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=Zt.Clear):o.depthLoadOp=Zt.Load,o.depthStoreOp=cr.Store),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=Zt.Clear):o.stencilLoadOp=Zt.Load,o.stencilStoreOp=cr.Store);const l=i.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const u=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==u.length?this._createDepthLayerDescriptors(e,t,a,u):this._updateDepthLayerDescriptors(e,t,u),t.bundleEncoders=[],t.bundleSets=[];for(let c=0;c<u.length;c++){const h=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+c),d={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(h),t.bundleSets.push(d)}t.currentPass=null}else{const u=l.beginRenderPass(a);if(t.currentPass=u,e.viewport&&this.updateViewport(e),e.scissor){const{x:c,y:h,width:d,height:f}=e.scissorValue;u.setScissorRect(c,h,d,f)}}t.descriptor=a,t.encoder=l,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,i,r){const s=i.depthStencilAttachment;t.layerDescriptors=[];const a=this.get(e.depthTexture);a.viewCache||(a.viewCache=[]);for(let o=0;o<r.length;o++){const l={...i,colorAttachments:[{...i.colorAttachments[0],view:i.colorAttachments[o].view}]};if(i.depthStencilAttachment){const u=o;a.viewCache[u]||(a.viewCache[u]=a.texture.createView({dimension:fi.TwoD,baseArrayLayer:o,arrayLayerCount:1})),l.depthStencilAttachment={view:a.viewCache[u],depthLoadOp:s.depthLoadOp||Zt.Clear,depthStoreOp:s.depthStoreOp||cr.Store,depthClearValue:s.depthClearValue||1},e.stencil&&(l.depthStencilAttachment.stencilLoadOp=s.stencilLoadOp,l.depthStencilAttachment.stencilStoreOp=s.stencilStoreOp,l.depthStencilAttachment.stencilClearValue=s.stencilClearValue)}else l.depthStencilAttachment={...s};t.layerDescriptors.push(l)}}_updateDepthLayerDescriptors(e,t,i){for(let r=0;r<i.length;r++){const s=t.layerDescriptors[r];if(s.depthStencilAttachment){const a=s.depthStencilAttachment;e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=Zt.Clear):a.depthLoadOp=Zt.Load),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=Zt.Clear):a.stencilLoadOp=Zt.Load)}}}finishRender(e){const t=this.get(e),i=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),i>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const r=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const s=[];for(let a=0;a<t.bundleEncoders.length;a++){const o=t.bundleEncoders[a];s.push(o.finish())}for(let a=0;a<t.layerDescriptors.length;a++)if(a<s.length){const o=t.layerDescriptors[a],l=r.beginRenderPass(o);if(e.viewport){const{x:u,y:c,width:h,height:d,minDepth:f,maxDepth:m}=e.viewportValue;l.setViewport(u,c,h,d,f,m)}if(e.scissor){const{x:u,y:c,width:h,height:d}=e.scissorValue;l.setScissorRect(u,c,h,d)}l.executeBundles([s[a]]),l.end()}}else t.currentPass&&t.currentPass.end();if(i>0){const s=i*8;let a=this.occludedResolveCache.get(s);a===void 0&&(a=this.device.createBuffer({size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(s,a));const o=this.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,i,a,0),t.encoder.copyBufferToBuffer(a,0,o,0,s),t.occlusionQueryBuffer=o,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const s=e.textures;for(let a=0;a<s.length;a++){const o=s[a];o.generateMipmaps===!0&&this.textureUtils.generateMipmaps(o)}}}isOccluded(e,t){const i=this.get(e);return i.occluded&&i.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:i,currentOcclusionQueryObjects:r}=t;if(i&&r){const s=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await i.mapAsync(GPUMapMode.READ);const a=i.getMappedRange(),o=new BigUint64Array(a);for(let l=0;l<r.length;l++)o[l]===BigInt(0)&&s.add(r[l]);i.destroy(),t.occluded=s}}updateViewport(e){const{currentPass:t}=this.get(e),{x:i,y:r,width:s,height:a,minDepth:o,maxDepth:l}=e.viewportValue;t.setViewport(i,r,s,a,o,l)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,i,r=null){const s=this.device,a=this.renderer;let o=[],l,u,c,h;if(e){const m=this.getClearColor();u={r:m.r,g:m.g,b:m.b,a:m.a}}if(r===null){c=a.depth,h=a.stencil;const m=this._getDefaultRenderPassDescriptor();if(e){o=m.colorAttachments;const _=o[0];_.clearValue=u,_.loadOp=Zt.Clear,_.storeOp=cr.Store}(c||h)&&(l=m.depthStencilAttachment)}else{c=r.depth,h=r.stencil;const m={loadOp:e?Zt.Clear:Zt.Load,clearValue:e?u:void 0};c&&(m.depthLoadOp=t?Zt.Clear:Zt.Load,m.depthClearValue=t?a.getClearDepth():void 0,m.depthStoreOp=cr.Store),h&&(m.stencilLoadOp=i?Zt.Clear:Zt.Load,m.stencilClearValue=i?a.getClearStencil():void 0,m.stencilStoreOp=cr.Store);const _=this._getRenderPassDescriptor(r,m);o=_.colorAttachments,l=_.depthStencilAttachment}c&&l&&(t?(l.depthLoadOp=Zt.Clear,l.depthClearValue=a.getClearDepth(),l.depthStoreOp=cr.Store):(l.depthLoadOp=Zt.Load,l.depthStoreOp=cr.Store)),h&&l&&(i?(l.stencilLoadOp=Zt.Clear,l.stencilClearValue=a.getClearStencil(),l.stencilStoreOp=cr.Store):(l.stencilLoadOp=Zt.Load,l.stencilStoreOp=cr.Store));const d=s.createCommandEncoder({label:"clear"});d.beginRenderPass({colorAttachments:o,depthStencilAttachment:l}).end(),s.queue.submit([d.finish()])}beginCompute(e){const t=this.get(e);t.frameCalls=this.renderer.info.compute.frameCalls;const i={label:"computeGroup_"+e.id};this.initTimestampQuery(Bh.COMPUTE,this.getTimestampUID(e),i),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(i)}compute(e,t,i,r,s=null){const a=this.get(t),{passEncoderGPU:o}=this.get(e),l=this.get(r).pipeline;this.pipelineUtils.setPipeline(o,l);for(let c=0,h=i.length;c<h;c++){const d=i[c],f=this.get(d);o.setBindGroup(c,f.group)}let u;if(s===null&&(s=t.count),typeof s=="number"){const c=s;if(a.dispatchSize===void 0||a.count!==c){a.dispatchSize=[0,1,1],a.count=c;const h=t.workgroupSize;let d=h[0];for(let _=1;_<h.length;_++)d*=h[_];const f=Math.ceil(c/d),m=this.device.limits.maxComputeWorkgroupsPerDimension;u=[f,1,1],f>m&&(u[0]=Math.min(f,m),u[1]=Math.ceil(f/m)),a.dispatchSize=u}u=a.dispatchSize}else u=s;o.dispatchWorkgroups(u[0],u[1]||1,u[2]||1)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,t){const{object:i,material:r,context:s,pipeline:a}=e,o=e.getBindings(),l=this.get(s),u=this.get(a).pipeline,c=e.getIndex(),h=c!==null,d=e.getDrawParameters();if(d===null)return;const f=(_,g)=>{this.pipelineUtils.setPipeline(_,u),g.pipeline=u;const p=g.bindingGroups;for(let v=0,b=o.length;v<b;v++){const S=o[v],x=this.get(S);p[S.index]!==S.id&&(_.setBindGroup(S.index,x.group),p[S.index]=S.id)}if(h===!0&&g.index!==c){const v=this.get(c).buffer,b=c.array instanceof Uint16Array?sf.Uint16:sf.Uint32;_.setIndexBuffer(v,b),g.index=c}const y=e.getVertexBuffers();for(let v=0,b=y.length;v<b;v++){const S=y[v];if(g.attributes[v]!==S){const x=this.get(S).buffer;_.setVertexBuffer(v,x),g.attributes[v]=S}}s.stencil===!0&&r.stencilWrite===!0&&l.currentStencilRef!==r.stencilRef&&(_.setStencilReference(r.stencilRef),l.currentStencilRef=r.stencilRef)},m=(_,g)=>{if(f(_,g),i.isBatchedMesh===!0){const p=i._multiDrawStarts,y=i._multiDrawCounts,v=i._multiDrawCount,b=i._multiDrawInstances;b!==null&&vs("THREE.WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let S=0;S<v;S++){const x=b?b[S]:1,T=x>1?0:S;h===!0?_.drawIndexed(y[S],x,p[S]/c.array.BYTES_PER_ELEMENT,0,T):_.draw(y[S],x,p[S],T),t.update(i,y[S],x)}}else if(h===!0){const{vertexCount:p,instanceCount:y,firstVertex:v}=d,b=e.getIndirect();if(b!==null){const S=this.get(b).buffer;_.drawIndexedIndirect(S,0)}else _.drawIndexed(p,y,v,0,0);t.update(i,p,y)}else{const{vertexCount:p,instanceCount:y,firstVertex:v}=d,b=e.getIndirect();if(b!==null){const S=this.get(b).buffer;_.drawIndirect(S,0)}else _.draw(p,y,v,0);t.update(i,p,y)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const _=this.get(e.camera),g=e.camera.cameras,p=e.getBindingGroup("cameraIndex");if(_.indexesGPU===void 0||_.indexesGPU.length!==g.length){const v=this.get(p),b=[],S=new Uint32Array([0,0,0,0]);for(let x=0,T=g.length;x<T;x++){S[0]=x;const w=this.bindingUtils.createBindGroupIndex(S,v.layout);b.push(w)}_.indexesGPU=b}const y=this.renderer.getPixelRatio();for(let v=0,b=g.length;v<b;v++){const S=g[v];if(i.layers.test(S.layers)){const x=S.viewport;let T=l.currentPass,w=l.currentSets;if(l.bundleEncoders){const E=l.bundleEncoders[v],M=l.bundleSets[v];T=E,w=M}x&&T.setViewport(Math.floor(x.x*y),Math.floor(x.y*y),Math.floor(x.width*y),Math.floor(x.height*y),s.viewportValue.minDepth,s.viewportValue.maxDepth),p&&_.indexesGPU&&(T.setBindGroup(p.index,_.indexesGPU[v]),w.bindingGroups[p.index]=p.id),m(T,w)}}}else if(l.currentPass){if(l.occlusionQuerySet!==void 0){const _=l.lastOcclusionObject;_!==i&&(_!==null&&_.occlusionTest===!0&&(l.currentPass.endOcclusionQuery(),l.occlusionQueryIndex++),i.occlusionTest===!0&&(l.currentPass.beginOcclusionQuery(l.occlusionQueryIndex),l.occlusionQueryObjects[l.occlusionQueryIndex]=i),l.lastOcclusionObject=i)}m(l.currentPass,l.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:i,material:r}=e,s=this.utils,a=s.getSampleCountRenderContext(e.context),o=s.getCurrentColorSpace(e.context),l=s.getCurrentColorFormat(e.context),u=s.getCurrentDepthStencilFormat(e.context),c=s.getPrimitiveTopology(i,r);let h=!1;return(t.material!==r||t.materialVersion!==r.version||t.transparent!==r.transparent||t.blending!==r.blending||t.premultipliedAlpha!==r.premultipliedAlpha||t.blendSrc!==r.blendSrc||t.blendDst!==r.blendDst||t.blendEquation!==r.blendEquation||t.blendSrcAlpha!==r.blendSrcAlpha||t.blendDstAlpha!==r.blendDstAlpha||t.blendEquationAlpha!==r.blendEquationAlpha||t.colorWrite!==r.colorWrite||t.depthWrite!==r.depthWrite||t.depthTest!==r.depthTest||t.depthFunc!==r.depthFunc||t.stencilWrite!==r.stencilWrite||t.stencilFunc!==r.stencilFunc||t.stencilFail!==r.stencilFail||t.stencilZFail!==r.stencilZFail||t.stencilZPass!==r.stencilZPass||t.stencilFuncMask!==r.stencilFuncMask||t.stencilWriteMask!==r.stencilWriteMask||t.side!==r.side||t.alphaToCoverage!==r.alphaToCoverage||t.sampleCount!==a||t.colorSpace!==o||t.colorFormat!==l||t.depthStencilFormat!==u||t.primitiveTopology!==c||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=r,t.materialVersion=r.version,t.transparent=r.transparent,t.blending=r.blending,t.premultipliedAlpha=r.premultipliedAlpha,t.blendSrc=r.blendSrc,t.blendDst=r.blendDst,t.blendEquation=r.blendEquation,t.blendSrcAlpha=r.blendSrcAlpha,t.blendDstAlpha=r.blendDstAlpha,t.blendEquationAlpha=r.blendEquationAlpha,t.colorWrite=r.colorWrite,t.depthWrite=r.depthWrite,t.depthTest=r.depthTest,t.depthFunc=r.depthFunc,t.stencilWrite=r.stencilWrite,t.stencilFunc=r.stencilFunc,t.stencilFail=r.stencilFail,t.stencilZFail=r.stencilZFail,t.stencilZPass=r.stencilZPass,t.stencilFuncMask=r.stencilFuncMask,t.stencilWriteMask=r.stencilWriteMask,t.side=r.side,t.alphaToCoverage=r.alphaToCoverage,t.sampleCount=a,t.colorSpace=o,t.colorFormat=l,t.depthStencilFormat=u,t.primitiveTopology=c,t.clippingContextCacheKey=e.clippingContextCacheKey,h=!0),h}getRenderCacheKey(e){const{object:t,material:i}=e,r=this.utils,s=e.context,a=t.isMesh&&t.matrixWorld.determinant()<0;return[i.transparent,i.blending,i.premultipliedAlpha,i.blendSrc,i.blendDst,i.blendEquation,i.blendSrcAlpha,i.blendDstAlpha,i.blendEquationAlpha,i.colorWrite,i.depthWrite,i.depthTest,i.depthFunc,i.stencilWrite,i.stencilFunc,i.stencilFail,i.stencilZFail,i.stencilZPass,i.stencilFuncMask,i.stencilWriteMask,i.side,a,r.getSampleCountRenderContext(s),r.getCurrentColorSpace(s),r.getCurrentColorFormat(s),r.getCurrentDepthStencilFormat(s),r.getPrimitiveTopology(t,i),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,i,r,s,a){return this.textureUtils.copyTextureToBuffer(e,t,i,r,s,a)}initTimestampQuery(e,t,i){if(!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new qse(this.device,e,2048));const r=this.timestampQueryPool[e],s=r.allocateQueriesForContext(t);i.timestampWrites={querySet:r.querySet,beginningOfPassWriteIndex:s,endOfPassWriteIndex:s+1}}createNodeBuilder(e,t){return new zse(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const i=this.get(e),s=i.currentPass.finish();this.get(t).bundleGPU=s,i.currentSets=i._currentSets,i.currentPass=i._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,i,r){this.bindingUtils.createBindings(e,t,i,r)}updateBindings(e,t,i,r){this.bindingUtils.createBindings(e,t,i,r)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,t,i=null,r=null,s=0,a=0){let o=0,l=0,u=0,c=0,h=0,d=0,f=e.image.width,m=e.image.height,_=1;i!==null&&(i.isBox3===!0?(c=i.min.x,h=i.min.y,d=i.min.z,f=i.max.x-i.min.x,m=i.max.y-i.min.y,_=i.max.z-i.min.z):(c=i.min.x,h=i.min.y,f=i.max.x-i.min.x,m=i.max.y-i.min.y,_=1)),r!==null&&(o=r.x,l=r.y,u=r.z||0);const g=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),p=this.get(e).texture,y=this.get(t).texture;g.copyTextureToTexture({texture:p,mipLevel:s,origin:{x:c,y:h,z:d}},{texture:y,mipLevel:a,origin:{x:o,y:l,z:u}},[f,m,_]),this.device.queue.submit([g.finish()]),a===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,i){const r=this.get(t);let s=null;t.renderTarget?e.isDepthTexture?s=this.get(t.depthTexture).texture:s=this.get(t.textures[0]).texture:e.isDepthTexture?s=this.textureUtils.getDepthBuffer(t.depth,t.stencil):s=this.context.getCurrentTexture();const a=this.get(e).texture;if(s.format!==a.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",s.format,a.format);return}let o;if(r.currentPass?(r.currentPass.end(),o=r.encoder):o=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),o.copyTextureToTexture({texture:s,origin:[i.x,i.y,0]},{texture:a},[i.z,i.w]),r.currentPass){const{descriptor:l}=r;for(let u=0;u<l.colorAttachments.length;u++)l.colorAttachments[u].loadOp=Zt.Load;if(t.depth&&(l.depthStencilAttachment.depthLoadOp=Zt.Load),t.stencil&&(l.depthStencilAttachment.stencilLoadOp=Zt.Load),r.currentPass=o.beginRenderPass(l),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor){const{x:u,y:c,width:h,height:d}=t.scissorValue;r.currentPass.setScissorRect(u,c,h,d)}}else this.device.queue.submit([o.finish()]);e.generateMipmaps&&this.textureUtils.generateMipmaps(e)}}class Yse extends iA{constructor(e,t,i,r,s,a){super(e,t,i,r,s,a),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class Kse extends iA{constructor(e,t,i,r,s,a){super(e,t,i,r,s,a),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class Qse extends t3{constructor(){super(),this.addMaterial(yte,"MeshPhongMaterial"),this.addMaterial(FF,"MeshStandardMaterial"),this.addMaterial(hne,"MeshPhysicalMaterial"),this.addMaterial(mne,"MeshToonMaterial"),this.addMaterial(hte,"MeshBasicMaterial"),this.addMaterial(gte,"MeshLambertMaterial"),this.addMaterial(ate,"MeshNormalMaterial"),this.addMaterial(yne,"MeshMatcapMaterial"),this.addMaterial(tte,"LineBasicMaterial"),this.addMaterial(ite,"LineDashedMaterial"),this.addMaterial(Tne,"PointsMaterial"),this.addMaterial(zF,"SpriteMaterial"),this.addMaterial(Ane,"ShadowMaterial"),this.addLight(nre,$5),this.addLight(Nre,cI),this.addLight(Cre,j5),this.addLight(XA,iA),this.addLight(Ure,hI),this.addLight(Ore,G5),this.addLight(Ire,X5),this.addLight(Dre,Yse),this.addLight(Pre,Kse),this.addToneMapping(cie,$O),this.addToneMapping(hie,WO),this.addToneMapping(die,jO),this.addToneMapping(pie,qO),this.addToneMapping(yie,XO),this.addToneMapping(vie,YO)}}class Zse extends tse{constructor(e={}){let t;e.forceWebGL?t=b2:(t=Xse,e.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new b2(e)));const i=new t(e);super(i,e),this.library=new Qse,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}const $x={type:"change"},KA={type:"start"},QA={type:"end"},C2=1e-6,Jt={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},ty=new fe,Sl=new fe,Jse=new D,ny=new D,Wx=new D,lh=new da,D2=new D,iy=new D,jx=new D,ry=new D;class eae extends nb{constructor(e,t=null){super(e,t),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:Hi.ROTATE,MIDDLE:Hi.DOLLY,RIGHT:Hi.PAN},this.target=new D,this.state=Jt.NONE,this.keyState=Jt.NONE,this._lastPosition=new D,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new D,this._movePrev=new fe,this._moveCurr=new fe,this._lastAxis=new D,this._zoomStart=new fe,this._zoomEnd=new fe,this._panStart=new fe,this._panEnd=new fe,this._pointers=[],this._pointerPositions={},this._onPointerMove=nae.bind(this),this._onPointerDown=tae.bind(this),this._onPointerUp=iae.bind(this),this._onPointerCancel=rae.bind(this),this._onContextMenu=hae.bind(this),this._onMouseWheel=cae.bind(this),this._onKeyDown=aae.bind(this),this._onKeyUp=sae.bind(this),this._onTouchStart=dae.bind(this),this._onTouchMove=fae.bind(this),this._onTouchEnd=pae.bind(this),this._onMouseDown=oae.bind(this),this._onMouseMove=lae.bind(this),this._onMouseUp=uae.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,t!==null&&(this.connect(t),this.handleResize()),this.update()}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>C2&&(this.dispatchEvent($x),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>C2||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent($x),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=Jt.NONE,this.keyState=Jt.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent($x),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Sl.copy(this._panEnd).sub(this._panStart),Sl.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Sl.x*=e,Sl.y*=t}Sl.multiplyScalar(this._eye.length()*this.panSpeed),ny.copy(this._eye).cross(this.object.up).setLength(Sl.x),ny.add(Jse.copy(this.object.up).setLength(Sl.y)),this.object.position.add(ny),this.target.add(ny),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Sl.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){ry.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=ry.length();e?(this._eye.copy(this.object.position).sub(this.target),D2.copy(this._eye).normalize(),iy.copy(this.object.up).normalize(),jx.crossVectors(iy,D2).normalize(),iy.setLength(this._moveCurr.y-this._movePrev.y),jx.setLength(this._moveCurr.x-this._movePrev.x),ry.copy(iy.add(jx)),Wx.crossVectors(ry,this._eye).normalize(),e*=this.rotateSpeed,lh.setFromAxisAngle(Wx,e),this._eye.applyQuaternion(lh),this.object.up.applyQuaternion(lh),this._lastAxis.copy(Wx),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),lh.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(lh),this.object.up.applyQuaternion(lh)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===Jt.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=Av.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=Av.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return ty.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),ty}_getMouseOnCircle(e,t){return ty.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width),ty}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId){this._pointers.splice(t,1);return}}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new fe,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function tae(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n))}function nae(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function iae(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchEnd(n):this._onMouseUp(),this._removePointer(n),this._pointers.length===0&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function rae(n){this._removePointer(n)}function sae(){this.enabled!==!1&&(this.keyState=Jt.NONE,window.addEventListener("keydown",this._onKeyDown))}function aae(n){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===Jt.NONE&&(n.code===this.keys[Jt.ROTATE]&&!this.noRotate?this.keyState=Jt.ROTATE:n.code===this.keys[Jt.ZOOM]&&!this.noZoom?this.keyState=Jt.ZOOM:n.code===this.keys[Jt.PAN]&&!this.noPan&&(this.keyState=Jt.PAN)))}function oae(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Hi.DOLLY:this.state=Jt.ZOOM;break;case Hi.ROTATE:this.state=Jt.ROTATE;break;case Hi.PAN:this.state=Jt.PAN;break;default:this.state=Jt.NONE}const t=this.keyState!==Jt.NONE?this.keyState:this.state;t===Jt.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr)):t===Jt.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._zoomEnd.copy(this._zoomStart)):t===Jt.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(KA)}function lae(n){const e=this.keyState!==Jt.NONE?this.keyState:this.state;e===Jt.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY))):e===Jt.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY)):e===Jt.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY))}function uae(){this.state=Jt.NONE,this.dispatchEvent(QA)}function cae(n){if(this.enabled!==!1&&this.noZoom!==!0){switch(n.preventDefault(),n.deltaMode){case 2:this._zoomStart.y-=n.deltaY*.025;break;case 1:this._zoomStart.y-=n.deltaY*.01;break;default:this._zoomStart.y-=n.deltaY*25e-5;break}this.dispatchEvent(KA),this.dispatchEvent(QA)}}function hae(n){this.enabled!==!1&&n.preventDefault()}function dae(n){switch(this._trackPointer(n),this._pointers.length){case 1:this.state=Jt.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=Jt.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const i=(this._pointers[0].pageX+this._pointers[1].pageX)/2,r=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(i,r)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(KA)}function fae(n){switch(this._trackPointer(n),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY));break;default:const e=this._getSecondPointerPosition(n),t=n.pageX-e.x,i=n.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(t*t+i*i);const r=(n.pageX+e.x)/2,s=(n.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(r,s));break}}function pae(n){switch(this._pointers.length){case 0:this.state=Jt.NONE;break;case 1:this.state=Jt.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=Jt.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==n.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(QA)}const L2={type:"change"},ZA={type:"start"},f3={type:"end"},sy=new Z0,P2=new ia,mae=Math.cos(70*Av.DEG2RAD),Si=new D,Rr=2*Math.PI,vn={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},qx=1e-6;class gae extends nb{constructor(e,t=null){super(e,t),this.state=vn.NONE,this.target=new D,this.cursor=new D,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Hi.ROTATE,MIDDLE:Hi.DOLLY,RIGHT:Hi.PAN},this.touches={ONE:Fo.ROTATE,TWO:Fo.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new D,this._lastQuaternion=new da,this._lastTargetPosition=new D,this._quat=new da().setFromUnitVectors(e.up,new D(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new qN,this._sphericalDelta=new qN,this._scale=1,this._panOffset=new D,this._rotateStart=new fe,this._rotateEnd=new fe,this._rotateDelta=new fe,this._panStart=new fe,this._panEnd=new fe,this._panDelta=new fe,this._dollyStart=new fe,this._dollyEnd=new fe,this._dollyDelta=new fe,this._dollyDirection=new D,this._mouse=new fe,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=yae.bind(this),this._onPointerDown=_ae.bind(this),this._onPointerUp=vae.bind(this),this._onContextMenu=wae.bind(this),this._onMouseWheel=xae.bind(this),this._onKeyDown=Tae.bind(this),this._onTouchStart=Eae.bind(this),this._onTouchMove=Mae.bind(this),this._onMouseDown=bae.bind(this),this._onMouseMove=Sae.bind(this),this._interceptControlDown=Aae.bind(this),this._interceptControlUp=Rae.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(L2),this.update(),this.state=vn.NONE}update(e=null){const t=this.object.position;Si.copy(t).sub(this.target),Si.applyQuaternion(this._quat),this._spherical.setFromVector3(Si),this.autoRotate&&this.state===vn.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(i)&&isFinite(r)&&(i<-Math.PI?i+=Rr:i>Math.PI&&(i-=Rr),r<-Math.PI?r+=Rr:r>Math.PI&&(r-=Rr),i<=r?this._spherical.theta=Math.max(i,Math.min(r,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+r)/2?Math.max(i,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const a=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=a!=this._spherical.radius}if(Si.setFromSpherical(this._spherical),Si.applyQuaternion(this._quatInverse),t.copy(this.target).add(Si),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let a=null;if(this.object.isPerspectiveCamera){const o=Si.length();a=this._clampDistance(o*this._scale);const l=o-a;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),s=!!l}else if(this.object.isOrthographicCamera){const o=new D(this._mouse.x,this._mouse.y,0);o.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=l!==this.object.zoom;const u=new D(this._mouse.x,this._mouse.y,0);u.unproject(this.object),this.object.position.sub(u).add(o),this.object.updateMatrixWorld(),a=Si.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;a!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(a).add(this.object.position):(sy.origin.copy(this.object.position),sy.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(sy.direction))<mae?this.object.lookAt(this.target):(P2.setFromNormalAndCoplanarPoint(this.object.up,this.target),sy.intersectPlane(P2,this.target))))}else if(this.object.isOrthographicCamera){const a=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),a!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>qx||8*(1-this._lastQuaternion.dot(this.object.quaternion))>qx||this._lastTargetPosition.distanceToSquared(this.target)>qx?(this.dispatchEvent(L2),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Rr/60*this.autoRotateSpeed*e:Rr/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){Si.setFromMatrixColumn(t,0),Si.multiplyScalar(-e),this._panOffset.add(Si)}_panUp(e,t){this.screenSpacePanning===!0?Si.setFromMatrixColumn(t,1):(Si.setFromMatrixColumn(t,0),Si.crossVectors(this.object.up,Si)),Si.multiplyScalar(e),this._panOffset.add(Si)}_pan(e,t){const i=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;Si.copy(r).sub(this.target);let s=Si.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/i.clientHeight,this.object.matrix),this._panUp(2*t*s/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),r=e-i.left,s=t-i.top,a=i.width,o=i.height;this._mouse.x=r/a*2-1,this._mouse.y=-(s/o)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Rr*this._rotateDelta.x/t.clientHeight),this._rotateUp(Rr*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Rr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Rr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Rr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Rr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._rotateStart.set(i,r)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panStart.set(i,r)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(i*i+r*r);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),r=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._rotateEnd.set(r,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Rr*this._rotateDelta.x/t.clientHeight),this._rotateUp(Rr*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panEnd.set(i,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(i*i+r*r);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const a=(e.pageX+t.x)*.5,o=(e.pageY+t.y)*.5;this._updateZoomParameters(a,o)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new fe,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function _ae(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function yae(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function vae(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(f3),this.state=vn.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function bae(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Hi.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=vn.DOLLY;break;case Hi.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=vn.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=vn.ROTATE}break;case Hi.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=vn.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=vn.PAN}break;default:this.state=vn.NONE}this.state!==vn.NONE&&this.dispatchEvent(ZA)}function Sae(n){switch(this.state){case vn.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case vn.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case vn.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function xae(n){this.enabled===!1||this.enableZoom===!1||this.state!==vn.NONE||(n.preventDefault(),this.dispatchEvent(ZA),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(f3))}function Tae(n){this.enabled!==!1&&this._handleKeyDown(n)}function Eae(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case Fo.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=vn.TOUCH_ROTATE;break;case Fo.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=vn.TOUCH_PAN;break;default:this.state=vn.NONE}break;case 2:switch(this.touches.TWO){case Fo.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=vn.TOUCH_DOLLY_PAN;break;case Fo.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=vn.TOUCH_DOLLY_ROTATE;break;default:this.state=vn.NONE}break;default:this.state=vn.NONE}this.state!==vn.NONE&&this.dispatchEvent(ZA)}function Mae(n){switch(this._trackPointer(n),this.state){case vn.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case vn.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case vn.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case vn.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=vn.NONE}}function wae(n){this.enabled!==!1&&n.preventDefault()}function Aae(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Rae(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const Nae={type:"change"},U2=1e-6,O2=new da;class Cae extends nb{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new D(0,0,0),this._rotationVector=new D(0,0,0),this._lastQuaternion=new da,this._lastPosition=new D,this._status=0,this._onKeyDown=Dae.bind(this),this._onKeyUp=Lae.bind(this),this._onPointerMove=Uae.bind(this),this._onPointerDown=Pae.bind(this),this._onPointerUp=Oae.bind(this),this._onPointerCancel=Iae.bind(this),this._onContextMenu=Bae.bind(this),t!==null&&this.connect(t)}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const t=this.object,i=e*this.movementSpeed,r=e*this.rollSpeed;t.translateX(this._moveVector.x*i),t.translateY(this._moveVector.y*i),t.translateZ(this._moveVector.z*i),O2.set(this._rotationVector.x*r,this._rotationVector.y*r,this._rotationVector.z*r,1).normalize(),t.quaternion.multiply(O2),(this._lastPosition.distanceToSquared(t.position)>U2||8*(1-this._lastQuaternion.dot(t.quaternion))>U2)&&(this.dispatchEvent(Nae),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function Dae(n){if(!(n.altKey||this.enabled===!1)){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function Lae(n){if(this.enabled!==!1){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function Pae(n){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(n.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function Uae(n){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),t=e.size[0]/2,i=e.size[1]/2;this._moveState.yawLeft=-(n.pageX-e.offset[0]-t)/t,this._moveState.pitchDown=(n.pageY-e.offset[1]-i)/i,this._updateRotationVector()}}function Oae(n){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(n.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function Iae(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function Bae(n){this.enabled!==!1&&n.preventDefault()}const Fae={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class bb{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const kae=new Cg(-1,1,1,-1,0,1);class zae extends Er{constructor(){super(),this.setAttribute("position",new hi([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new hi([0,2,0,0,2,0],2))}}const Gae=new zae;class Vae{constructor(e){this._mesh=new mi(Gae,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,kae)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Hae extends bb{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof Xa?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=tI.clone(e.uniforms),this.material=new Xa({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new Vae(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class I2 extends bb{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const r=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let a,o;this.inverse?(a=0,o=1):(a=1,o=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),s.buffers.stencil.setFunc(r.ALWAYS,a,4294967295),s.buffers.stencil.setClear(o),s.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(r.EQUAL,1,4294967295),s.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),s.buffers.stencil.setLocked(!0)}}class $ae extends bb{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class Wae{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const i=e.getSize(new fe);this._width=i.width,this._height=i.height,t=new su(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Fi}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Hae(Fae),this.copyPass.material.blending=kr,this.clock=new fI}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let r=0,s=this.passes.length;r<s;r++){const a=this.passes[r];if(a.enabled!==!1){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),a.needsSwap){if(i){const o=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}I2!==void 0&&(a instanceof I2?i=!0:a instanceof $ae&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new fe);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(i,r),this.renderTarget2.setSize(i,r);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(i,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class jae extends bb{constructor(e,t,i=null,r=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=r,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Ve}render(e,t,i){const r=e.autoClear;e.autoClear=!1;let s,a;this.overrideMaterial!==null&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(s),this.overrideMaterial!==null&&(this.scene.overrideMaterial=a),e.autoClear=r}}function $r(){return $r=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},$r.apply(null,arguments)}function qae(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function qm(n,e){return qm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},qm(n,e)}function Xae(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,qm(n,e)}function $E(n){return $E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},$E(n)}function Yae(n){try{return Function.toString.call(n).indexOf("[native code]")!==-1}catch{return typeof n=="function"}}function p3(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(p3=function(){return!!n})()}function Kae(n,e,t){if(p3())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,e);var r=new(n.bind.apply(n,i));return t&&qm(r,t.prototype),r}function WE(n){var e=typeof Map=="function"?new Map:void 0;return WE=function(i){if(i===null||!Yae(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(i))return e.get(i);e.set(i,r)}function r(){return Kae(i,arguments,$E(this).constructor)}return r.prototype=Object.create(i.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),qm(r,i)},WE(n)}var Fa=function(n){Xae(e,n);function e(t){var i;return i=n.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this,qae(i)}return e}(WE(Error));function Xx(n){return Math.round(n*255)}function Qae(n,e,t){return Xx(n)+","+Xx(e)+","+Xx(t)}function Wv(n,e,t,i){if(i===void 0&&(i=Qae),e===0)return i(t,t,t);var r=(n%360+360)%360/60,s=(1-Math.abs(2*t-1))*e,a=s*(1-Math.abs(r%2-1)),o=0,l=0,u=0;r>=0&&r<1?(o=s,l=a):r>=1&&r<2?(o=a,l=s):r>=2&&r<3?(l=s,u=a):r>=3&&r<4?(l=a,u=s):r>=4&&r<5?(o=a,u=s):r>=5&&r<6&&(o=s,u=a);var c=t-s/2,h=o+c,d=l+c,f=u+c;return i(h,d,f)}var B2={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function Zae(n){if(typeof n!="string")return n;var e=n.toLowerCase();return B2[e]?"#"+B2[e]:n}var Jae=/^#[a-fA-F0-9]{6}$/,eoe=/^#[a-fA-F0-9]{8}$/,toe=/^#[a-fA-F0-9]{3}$/,noe=/^#[a-fA-F0-9]{4}$/,Yx=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,ioe=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,roe=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,soe=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function af(n){if(typeof n!="string")throw new Fa(3);var e=Zae(n);if(e.match(Jae))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(eoe)){var t=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:t}}if(e.match(toe))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(noe)){var i=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:i}}var r=Yx.exec(e);if(r)return{red:parseInt(""+r[1],10),green:parseInt(""+r[2],10),blue:parseInt(""+r[3],10)};var s=ioe.exec(e.substring(0,50));if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10),alpha:parseFloat(""+s[4])>1?parseFloat(""+s[4])/100:parseFloat(""+s[4])};var a=roe.exec(e);if(a){var o=parseInt(""+a[1],10),l=parseInt(""+a[2],10)/100,u=parseInt(""+a[3],10)/100,c="rgb("+Wv(o,l,u)+")",h=Yx.exec(c);if(!h)throw new Fa(4,e,c);return{red:parseInt(""+h[1],10),green:parseInt(""+h[2],10),blue:parseInt(""+h[3],10)}}var d=soe.exec(e.substring(0,50));if(d){var f=parseInt(""+d[1],10),m=parseInt(""+d[2],10)/100,_=parseInt(""+d[3],10)/100,g="rgb("+Wv(f,m,_)+")",p=Yx.exec(g);if(!p)throw new Fa(4,e,g);return{red:parseInt(""+p[1],10),green:parseInt(""+p[2],10),blue:parseInt(""+p[3],10),alpha:parseFloat(""+d[4])>1?parseFloat(""+d[4])/100:parseFloat(""+d[4])}}throw new Fa(5)}function aoe(n){var e=n.red/255,t=n.green/255,i=n.blue/255,r=Math.max(e,t,i),s=Math.min(e,t,i),a=(r+s)/2;if(r===s)return n.alpha!==void 0?{hue:0,saturation:0,lightness:a,alpha:n.alpha}:{hue:0,saturation:0,lightness:a};var o,l=r-s,u=a>.5?l/(2-r-s):l/(r+s);switch(r){case e:o=(t-i)/l+(t<i?6:0);break;case t:o=(i-e)/l+2;break;default:o=(e-t)/l+4;break}return o*=60,n.alpha!==void 0?{hue:o,saturation:u,lightness:a,alpha:n.alpha}:{hue:o,saturation:u,lightness:a}}function vu(n){return aoe(af(n))}var ooe=function(e){return e.length===7&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e},jE=ooe;function $u(n){var e=n.toString(16);return e.length===1?"0"+e:e}function Kx(n){return $u(Math.round(n*255))}function loe(n,e,t){return jE("#"+Kx(n)+Kx(e)+Kx(t))}function m3(n,e,t){return Wv(n,e,t,loe)}function uoe(n,e,t){if(typeof n=="object"&&e===void 0&&t===void 0)return m3(n.hue,n.saturation,n.lightness);throw new Fa(1)}function coe(n,e,t,i){if(typeof n=="object"&&e===void 0&&t===void 0&&i===void 0)return n.alpha>=1?m3(n.hue,n.saturation,n.lightness):"rgba("+Wv(n.hue,n.saturation,n.lightness)+","+n.alpha+")";throw new Fa(2)}function g3(n,e,t){if(typeof n=="number"&&typeof e=="number"&&typeof t=="number")return jE("#"+$u(n)+$u(e)+$u(t));if(typeof n=="object"&&e===void 0&&t===void 0)return jE("#"+$u(n.red)+$u(n.green)+$u(n.blue));throw new Fa(6)}function Sb(n,e,t,i){if(typeof n=="object"&&e===void 0&&t===void 0&&i===void 0)return n.alpha>=1?g3(n.red,n.green,n.blue):"rgba("+n.red+","+n.green+","+n.blue+","+n.alpha+")";throw new Fa(7)}var hoe=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},doe=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&typeof e.alpha=="number"},foe=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},poe=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&typeof e.alpha=="number"};function bu(n){if(typeof n!="object")throw new Fa(8);if(doe(n))return Sb(n);if(hoe(n))return g3(n);if(poe(n))return coe(n);if(foe(n))return uoe(n);throw new Fa(8)}function _3(n,e,t){return function(){var r=t.concat(Array.prototype.slice.call(arguments));return r.length>=e?n.apply(this,r):_3(n,e,r)}}function xs(n){return _3(n,n.length,[])}function moe(n,e){if(e==="transparent")return e;var t=vu(e);return bu($r({},t,{hue:t.hue+parseFloat(n)}))}xs(moe);function Lf(n,e,t){return Math.max(n,Math.min(e,t))}function goe(n,e){if(e==="transparent")return e;var t=vu(e);return bu($r({},t,{lightness:Lf(0,1,t.lightness-parseFloat(n))}))}xs(goe);function _oe(n,e){if(e==="transparent")return e;var t=vu(e);return bu($r({},t,{saturation:Lf(0,1,t.saturation-parseFloat(n))}))}xs(_oe);function yoe(n,e){if(e==="transparent")return e;var t=vu(e);return bu($r({},t,{lightness:Lf(0,1,t.lightness+parseFloat(n))}))}xs(yoe);function voe(n,e,t){if(e==="transparent")return t;if(t==="transparent")return e;if(n===0)return t;var i=af(e),r=$r({},i,{alpha:typeof i.alpha=="number"?i.alpha:1}),s=af(t),a=$r({},s,{alpha:typeof s.alpha=="number"?s.alpha:1}),o=r.alpha-a.alpha,l=parseFloat(n)*2-1,u=l*o===-1?l:l+o,c=1+l*o,h=(u/c+1)/2,d=1-h,f={red:Math.floor(r.red*h+a.red*d),green:Math.floor(r.green*h+a.green*d),blue:Math.floor(r.blue*h+a.blue*d),alpha:r.alpha*parseFloat(n)+a.alpha*(1-parseFloat(n))};return Sb(f)}var boe=xs(voe),y3=boe;function Soe(n,e){if(e==="transparent")return e;var t=af(e),i=typeof t.alpha=="number"?t.alpha:1,r=$r({},t,{alpha:Lf(0,1,(i*100+parseFloat(n)*100)/100)});return Sb(r)}var xoe=xs(Soe),Toe=xoe;function Eoe(n,e){if(e==="transparent")return e;var t=vu(e);return bu($r({},t,{saturation:Lf(0,1,t.saturation+parseFloat(n))}))}xs(Eoe);function Moe(n,e){return e==="transparent"?e:bu($r({},vu(e),{hue:parseFloat(n)}))}xs(Moe);function woe(n,e){return e==="transparent"?e:bu($r({},vu(e),{lightness:parseFloat(n)}))}xs(woe);function Aoe(n,e){return e==="transparent"?e:bu($r({},vu(e),{saturation:parseFloat(n)}))}xs(Aoe);function Roe(n,e){return e==="transparent"?e:y3(parseFloat(n),"rgb(0, 0, 0)",e)}xs(Roe);function Noe(n,e){return e==="transparent"?e:y3(parseFloat(n),"rgb(255, 255, 255)",e)}xs(Noe);function Coe(n,e){if(e==="transparent")return e;var t=af(e),i=typeof t.alpha=="number"?t.alpha:1,r=$r({},t,{alpha:Lf(0,1,+(i*100-parseFloat(n)*100).toFixed(2)/100)});return Sb(r)}xs(Coe);var lc=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return n},Out:function(n){return n},InOut:function(n){return n}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var e=1.70158;return n===1?1:n*n*((e+1)*n-e)},Out:function(n){var e=1.70158;return n===0?0:--n*n*((e+1)*n+e)+1},InOut:function(n){var e=2.5949095;return(n*=2)<1?.5*(n*n*((e+1)*n-e)):.5*((n-=2)*n*((e+1)*n+e)+2)}}),Bounce:Object.freeze({In:function(n){return 1-lc.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?lc.Bounce.In(n*2)*.5:lc.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(e){return Math.pow(e,n)},Out:function(e){return 1-Math.pow(1-e,n)},InOut:function(e){return e<.5?Math.pow(e*2,n)/2:(1-Math.pow(2-e*2,n))/2+.5}}}}),Rp=function(){return performance.now()},v3=function(){function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];for(var r=0,s=t;r<s.length;r++){var a=s[r];(e=a._group)===null||e===void 0||e.remove(a),a._group=this,this._tweens[a.getId()]=a,this._tweensAddedDuringUpdate[a.getId()]=a}},n.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=0,r=e;i<r.length;i++){var s=r[i];s._group=void 0,delete this._tweens[s.getId()],delete this._tweensAddedDuringUpdate[s.getId()]}},n.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},n.prototype.update=function(e,t){e===void 0&&(e=Rp()),t===void 0&&(t=!0);var i=Object.keys(this._tweens);if(i.length!==0)for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var s=this._tweens[i[r]],a=!t;s&&s.update(e,a)===!1&&!t&&this.remove(s)}i=Object.keys(this._tweensAddedDuringUpdate)}},n}(),qE={Linear:function(n,e){var t=n.length-1,i=t*e,r=Math.floor(i),s=qE.Utils.Linear;return e<0?s(n[0],n[1],i):e>1?s(n[t],n[t-1],t-i):s(n[r],n[r+1>t?t:r+1],i-r)},Utils:{Linear:function(n,e,t){return(e-n)*t+n}}},b3=function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n}(),XE=new v3,F2=function(){function n(e,t){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=lc.Linear.None,this._interpolationFunction=qE.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=b3.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,typeof t=="object"?(this._group=t,t.add(this)):t===!0&&(this._group=XE,XE.add(this))}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.getDuration=function(){return this._duration},n.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},n.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},n.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},n.prototype.start=function(e,t){if(e===void 0&&(e=Rp()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var i in this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var s in this._valuesEnd)r[s]=this._valuesEnd[s];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},n.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},n.prototype._setupProperties=function(e,t,i,r,s){for(var a in i){var o=e[a],l=Array.isArray(o),u=l?"array":typeof o,c=!l&&Array.isArray(i[a]);if(!(u==="undefined"||u==="function")){if(c){var h=i[a];if(h.length===0)continue;for(var d=[o],f=0,m=h.length;f<m;f+=1){var _=this._handleRelativeValue(o,h[f]);if(isNaN(_)){c=!1,console.warn("Found invalid interpolation list. Skipping.");break}d.push(_)}c&&(i[a]=d)}if((u==="object"||l)&&o&&!c){t[a]=l?[]:{};var g=o;for(var p in g)t[a][p]=g[p];r[a]=l?[]:{};var h=i[a];if(!this._isDynamic){var y={};for(var p in h)y[p]=h[p];i[a]=h=y}this._setupProperties(g,t[a],h,r[a],s)}else(typeof t[a]>"u"||s)&&(t[a]=o),l||(t[a]*=1),c?r[a]=i[a].slice().reverse():r[a]=t[a]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},n.prototype.pause=function(e){return e===void 0&&(e=Rp()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this)},n.prototype.resume=function(e){return e===void 0&&(e=Rp()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this)},n.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},n.prototype.remove=function(){var e;return(e=this._group)===null||e===void 0||e.remove(this),this},n.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},n.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},n.prototype.easing=function(e){return e===void 0&&(e=lc.Linear.None),this._easingFunction=e,this},n.prototype.interpolation=function(e){return e===void 0&&(e=qE.Linear),this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,t){var i=this,r;if(e===void 0&&(e=Rp()),t===void 0&&(t=n.autoStartOnUpdate),this._isPaused)return!0;var s;if(!this._goToEnd&&!this._isPlaying)if(t)this.start(e,!0);else return!1;if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var a=e-this._startTime,o=this._duration+((r=this._repeatDelayTime)!==null&&r!==void 0?r:this._delayTime),l=this._duration+this._repeat*o,u=function(){if(i._duration===0||a>l)return 1;var _=Math.trunc(a/o),g=a-_*o,p=Math.min(g/i._duration,1);return p===0&&a===i._duration?1:p},c=u(),h=this._easingFunction(c);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,h),this._onUpdateCallback&&this._onUpdateCallback(this._object,c),this._duration===0||a>=this._duration)if(this._repeat>0){var d=Math.min(Math.trunc((a-this._duration)/o)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=d);for(s in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=o*d,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var f=0,m=this._chainedTweens.length;f<m;f++)this._chainedTweens[f].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,t,i,r){for(var s in i)if(t[s]!==void 0){var a=t[s]||0,o=i[s],l=Array.isArray(e[s]),u=Array.isArray(o),c=!l&&u;c?e[s]=this._interpolationFunction(o,r):typeof o=="object"&&o?this._updateProperties(e[s],a,o,r):(o=this._handleRelativeValue(a,o),typeof o=="number"&&(e[s]=a+(o-a)*r))}},n.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},n.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],i=this._valuesEnd[e];typeof i=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(i):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},n.autoStartOnUpdate=!1,n}();b3.nextId;var Qa=XE;Qa.getAll.bind(Qa);Qa.removeAll.bind(Qa);Qa.add.bind(Qa);Qa.remove.bind(Qa);Qa.update.bind(Qa);var YE="http://www.w3.org/1999/xhtml";const k2={svg:"http://www.w3.org/2000/svg",xhtml:YE,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function S3(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),k2.hasOwnProperty(e)?{space:k2[e],local:n}:n}function Doe(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===YE&&e.documentElement.namespaceURI===YE?e.createElement(n):e.createElementNS(t,n)}}function Loe(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function x3(n){var e=S3(n);return(e.local?Loe:Doe)(e)}function Poe(){}function T3(n){return n==null?Poe:function(){return this.querySelector(n)}}function Uoe(n){typeof n!="function"&&(n=T3(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var s=e[r],a=s.length,o=i[r]=new Array(a),l,u,c=0;c<a;++c)(l=s[c])&&(u=n.call(l,l.__data__,c,s))&&("__data__"in l&&(u.__data__=l.__data__),o[c]=u);return new Ws(i,this._parents)}function Ooe(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function Ioe(){return[]}function Boe(n){return n==null?Ioe:function(){return this.querySelectorAll(n)}}function Foe(n){return function(){return Ooe(n.apply(this,arguments))}}function koe(n){typeof n=="function"?n=Foe(n):n=Boe(n);for(var e=this._groups,t=e.length,i=[],r=[],s=0;s<t;++s)for(var a=e[s],o=a.length,l,u=0;u<o;++u)(l=a[u])&&(i.push(n.call(l,l.__data__,u,a)),r.push(l));return new Ws(i,r)}function zoe(n){return function(){return this.matches(n)}}function E3(n){return function(e){return e.matches(n)}}var Goe=Array.prototype.find;function Voe(n){return function(){return Goe.call(this.children,n)}}function Hoe(){return this.firstElementChild}function $oe(n){return this.select(n==null?Hoe:Voe(typeof n=="function"?n:E3(n)))}var Woe=Array.prototype.filter;function joe(){return Array.from(this.children)}function qoe(n){return function(){return Woe.call(this.children,n)}}function Xoe(n){return this.selectAll(n==null?joe:qoe(typeof n=="function"?n:E3(n)))}function Yoe(n){typeof n!="function"&&(n=zoe(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var s=e[r],a=s.length,o=i[r]=[],l,u=0;u<a;++u)(l=s[u])&&n.call(l,l.__data__,u,s)&&o.push(l);return new Ws(i,this._parents)}function M3(n){return new Array(n.length)}function Koe(){return new Ws(this._enter||this._groups.map(M3),this._parents)}function jv(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}jv.prototype={constructor:jv,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function Qoe(n){return function(){return n}}function Zoe(n,e,t,i,r,s){for(var a=0,o,l=e.length,u=s.length;a<u;++a)(o=e[a])?(o.__data__=s[a],i[a]=o):t[a]=new jv(n,s[a]);for(;a<l;++a)(o=e[a])&&(r[a]=o)}function Joe(n,e,t,i,r,s,a){var o,l,u=new Map,c=e.length,h=s.length,d=new Array(c),f;for(o=0;o<c;++o)(l=e[o])&&(d[o]=f=a.call(l,l.__data__,o,e)+"",u.has(f)?r[o]=l:u.set(f,l));for(o=0;o<h;++o)f=a.call(n,s[o],o,s)+"",(l=u.get(f))?(i[o]=l,l.__data__=s[o],u.delete(f)):t[o]=new jv(n,s[o]);for(o=0;o<c;++o)(l=e[o])&&u.get(d[o])===l&&(r[o]=l)}function ele(n){return n.__data__}function tle(n,e){if(!arguments.length)return Array.from(this,ele);var t=e?Joe:Zoe,i=this._parents,r=this._groups;typeof n!="function"&&(n=Qoe(n));for(var s=r.length,a=new Array(s),o=new Array(s),l=new Array(s),u=0;u<s;++u){var c=i[u],h=r[u],d=h.length,f=nle(n.call(c,c&&c.__data__,u,i)),m=f.length,_=o[u]=new Array(m),g=a[u]=new Array(m),p=l[u]=new Array(d);t(c,h,_,g,p,f,e);for(var y=0,v=0,b,S;y<m;++y)if(b=_[y]){for(y>=v&&(v=y+1);!(S=g[v])&&++v<m;);b._next=S||null}}return a=new Ws(a,i),a._enter=o,a._exit=l,a}function nle(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function ile(){return new Ws(this._exit||this._groups.map(M3),this._parents)}function rle(n,e,t){var i=this.enter(),r=this,s=this.exit();return typeof n=="function"?(i=n(i),i&&(i=i.selection())):i=i.append(n+""),e!=null&&(r=e(r),r&&(r=r.selection())),t==null?s.remove():t(s),i&&r?i.merge(r).order():r}function sle(n){for(var e=n.selection?n.selection():n,t=this._groups,i=e._groups,r=t.length,s=i.length,a=Math.min(r,s),o=new Array(r),l=0;l<a;++l)for(var u=t[l],c=i[l],h=u.length,d=o[l]=new Array(h),f,m=0;m<h;++m)(f=u[m]||c[m])&&(d[m]=f);for(;l<r;++l)o[l]=t[l];return new Ws(o,this._parents)}function ale(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var i=n[e],r=i.length-1,s=i[r],a;--r>=0;)(a=i[r])&&(s&&a.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(a,s),s=a);return this}function ole(n){n||(n=lle);function e(h,d){return h&&d?n(h.__data__,d.__data__):!h-!d}for(var t=this._groups,i=t.length,r=new Array(i),s=0;s<i;++s){for(var a=t[s],o=a.length,l=r[s]=new Array(o),u,c=0;c<o;++c)(u=a[c])&&(l[c]=u);l.sort(e)}return new Ws(r,this._parents).order()}function lle(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function ule(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function cle(){return Array.from(this)}function hle(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],r=0,s=i.length;r<s;++r){var a=i[r];if(a)return a}return null}function dle(){let n=0;for(const e of this)++n;return n}function fle(){return!this.node()}function ple(n){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var r=e[t],s=0,a=r.length,o;s<a;++s)(o=r[s])&&n.call(o,o.__data__,s,r);return this}function mle(n){return function(){this.removeAttribute(n)}}function gle(n){return function(){this.removeAttributeNS(n.space,n.local)}}function _le(n,e){return function(){this.setAttribute(n,e)}}function yle(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function vle(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function ble(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function Sle(n,e){var t=S3(n);if(arguments.length<2){var i=this.node();return t.local?i.getAttributeNS(t.space,t.local):i.getAttribute(t)}return this.each((e==null?t.local?gle:mle:typeof e=="function"?t.local?ble:vle:t.local?yle:_le)(t,e))}function w3(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function xle(n){return function(){this.style.removeProperty(n)}}function Tle(n,e,t){return function(){this.style.setProperty(n,e,t)}}function Ele(n,e,t){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(n):this.style.setProperty(n,i,t)}}function Mle(n,e,t){return arguments.length>1?this.each((e==null?xle:typeof e=="function"?Ele:Tle)(n,e,t??"")):wle(this.node(),n)}function wle(n,e){return n.style.getPropertyValue(e)||w3(n).getComputedStyle(n,null).getPropertyValue(e)}function Ale(n){return function(){delete this[n]}}function Rle(n,e){return function(){this[n]=e}}function Nle(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function Cle(n,e){return arguments.length>1?this.each((e==null?Ale:typeof e=="function"?Nle:Rle)(n,e)):this.node()[n]}function A3(n){return n.trim().split(/^|\s+/)}function JA(n){return n.classList||new R3(n)}function R3(n){this._node=n,this._names=A3(n.getAttribute("class")||"")}R3.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function N3(n,e){for(var t=JA(n),i=-1,r=e.length;++i<r;)t.add(e[i])}function C3(n,e){for(var t=JA(n),i=-1,r=e.length;++i<r;)t.remove(e[i])}function Dle(n){return function(){N3(this,n)}}function Lle(n){return function(){C3(this,n)}}function Ple(n,e){return function(){(e.apply(this,arguments)?N3:C3)(this,n)}}function Ule(n,e){var t=A3(n+"");if(arguments.length<2){for(var i=JA(this.node()),r=-1,s=t.length;++r<s;)if(!i.contains(t[r]))return!1;return!0}return this.each((typeof e=="function"?Ple:e?Dle:Lle)(t,e))}function Ole(){this.textContent=""}function Ile(n){return function(){this.textContent=n}}function Ble(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function Fle(n){return arguments.length?this.each(n==null?Ole:(typeof n=="function"?Ble:Ile)(n)):this.node().textContent}function kle(){this.innerHTML=""}function zle(n){return function(){this.innerHTML=n}}function Gle(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function Vle(n){return arguments.length?this.each(n==null?kle:(typeof n=="function"?Gle:zle)(n)):this.node().innerHTML}function Hle(){this.nextSibling&&this.parentNode.appendChild(this)}function $le(){return this.each(Hle)}function Wle(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function jle(){return this.each(Wle)}function qle(n){var e=typeof n=="function"?n:x3(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Xle(){return null}function Yle(n,e){var t=typeof n=="function"?n:x3(n),i=e==null?Xle:typeof e=="function"?e:T3(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),i.apply(this,arguments)||null)})}function Kle(){var n=this.parentNode;n&&n.removeChild(this)}function Qle(){return this.each(Kle)}function Zle(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function Jle(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function eue(n){return this.select(n?Jle:Zle)}function tue(n){return arguments.length?this.property("__data__",n):this.node().__data__}function nue(n){return function(e){n.call(this,e,this.__data__)}}function iue(n){return n.trim().split(/^|\s+/).map(function(e){var t="",i=e.indexOf(".");return i>=0&&(t=e.slice(i+1),e=e.slice(0,i)),{type:e,name:t}})}function rue(n){return function(){var e=this.__on;if(e){for(var t=0,i=-1,r=e.length,s;t<r;++t)s=e[t],(!n.type||s.type===n.type)&&s.name===n.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function sue(n,e,t){return function(){var i=this.__on,r,s=nue(e);if(i){for(var a=0,o=i.length;a<o;++a)if((r=i[a]).type===n.type&&r.name===n.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=t),r.value=e;return}}this.addEventListener(n.type,s,t),r={type:n.type,name:n.name,value:e,listener:s,options:t},i?i.push(r):this.__on=[r]}}function aue(n,e,t){var i=iue(n+""),r,s=i.length,a;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,u=o.length,c;l<u;++l)for(r=0,c=o[l];r<s;++r)if((a=i[r]).type===c.type&&a.name===c.name)return c.value}return}for(o=e?sue:rue,r=0;r<s;++r)this.each(o(i[r],e,t));return this}function D3(n,e,t){var i=w3(n),r=i.CustomEvent;typeof r=="function"?r=new r(e,t):(r=i.document.createEvent("Event"),t?(r.initEvent(e,t.bubbles,t.cancelable),r.detail=t.detail):r.initEvent(e,!1,!1)),n.dispatchEvent(r)}function oue(n,e){return function(){return D3(this,n,e)}}function lue(n,e){return function(){return D3(this,n,e.apply(this,arguments))}}function uue(n,e){return this.each((typeof e=="function"?lue:oue)(n,e))}function*cue(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],r=0,s=i.length,a;r<s;++r)(a=i[r])&&(yield a)}var hue=[null];function Ws(n,e){this._groups=n,this._parents=e}function due(){return this}Ws.prototype={constructor:Ws,select:Uoe,selectAll:koe,selectChild:$oe,selectChildren:Xoe,filter:Yoe,data:tle,enter:Koe,exit:ile,join:rle,merge:sle,selection:due,order:ale,sort:ole,call:ule,nodes:cle,node:hle,size:dle,empty:fle,each:ple,attr:Sle,style:Mle,property:Cle,classed:Ule,text:Fle,html:Vle,raise:$le,lower:jle,append:qle,insert:Yle,remove:Qle,clone:eue,datum:tue,on:aue,dispatch:uue,[Symbol.iterator]:cue};function fue(n){return typeof n=="string"?new Ws([[document.querySelector(n)]],[document.documentElement]):new Ws([[n]],hue)}function pue(n){let e;for(;e=n.sourceEvent;)n=e;return n}function mue(n,e){if(n=pue(n),e===void 0&&(e=n.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var i=t.createSVGPoint();return i.x=n.clientX,i.y=n.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[n.clientX-r.left-e.clientLeft,n.clientY-r.top-e.clientTop]}}return[n.pageX,n.pageY]}var Bg,$n,L3,P3,Ku,z2,U3,O3,I3,eR,KE,QE,Xm={},B3=[],gue=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,xb=Array.isArray;function ka(n,e){for(var t in e)n[t]=e[t];return n}function tR(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function _ue(n,e,t){var i,r,s,a={};for(s in e)s=="key"?i=e[s]:s=="ref"?r=e[s]:a[s]=e[s];if(arguments.length>2&&(a.children=arguments.length>3?Bg.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(s in n.defaultProps)a[s]===void 0&&(a[s]=n.defaultProps[s]);return lm(n,a,i,r,null)}function lm(n,e,t,i,r){var s={type:n,props:e,key:t,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++L3,__i:-1,__u:0};return r==null&&$n.vnode!=null&&$n.vnode(s),s}function Tb(n){return n.children}function Iy(n,e){this.props=n,this.context=e}function of(n,e){if(e==null)return n.__?of(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?of(n):null}function F3(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return F3(n)}}function G2(n){(!n.__d&&(n.__d=!0)&&Ku.push(n)&&!qv.__r++||z2!=$n.debounceRendering)&&((z2=$n.debounceRendering)||U3)(qv)}function qv(){for(var n,e,t,i,r,s,a,o=1;Ku.length;)Ku.length>o&&Ku.sort(O3),n=Ku.shift(),o=Ku.length,n.__d&&(t=void 0,r=(i=(e=n).__v).__e,s=[],a=[],e.__P&&((t=ka({},i)).__v=i.__v+1,$n.vnode&&$n.vnode(t),nR(e.__P,t,i,e.__n,e.__P.namespaceURI,32&i.__u?[r]:null,s,r??of(i),!!(32&i.__u),a),t.__v=i.__v,t.__.__k[t.__i]=t,G3(s,t,a),t.__e!=r&&F3(t)));qv.__r=0}function k3(n,e,t,i,r,s,a,o,l,u,c){var h,d,f,m,_,g,p,y=i&&i.__k||B3,v=e.length;for(l=yue(t,e,y,l,v),h=0;h<v;h++)(f=t.__k[h])!=null&&(d=f.__i==-1?Xm:y[f.__i]||Xm,f.__i=h,g=nR(n,f,d,r,s,a,o,l,u,c),m=f.__e,f.ref&&d.ref!=f.ref&&(d.ref&&iR(d.ref,null,f),c.push(f.ref,f.__c||m,f)),_==null&&m!=null&&(_=m),(p=!!(4&f.__u))||d.__k===f.__k?l=z3(f,l,n,p):typeof f.type=="function"&&g!==void 0?l=g:m&&(l=m.nextSibling),f.__u&=-7);return t.__e=_,l}function yue(n,e,t,i,r){var s,a,o,l,u,c=t.length,h=c,d=0;for(n.__k=new Array(r),s=0;s<r;s++)(a=e[s])!=null&&typeof a!="boolean"&&typeof a!="function"?(l=s+d,(a=n.__k[s]=typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?lm(null,a,null,null,null):xb(a)?lm(Tb,{children:a},null,null,null):a.constructor==null&&a.__b>0?lm(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):a).__=n,a.__b=n.__b+1,o=null,(u=a.__i=vue(a,t,l,h))!=-1&&(h--,(o=t[u])&&(o.__u|=2)),o==null||o.__v==null?(u==-1&&(r>c?d--:r<c&&d++),typeof a.type!="function"&&(a.__u|=4)):u!=l&&(u==l-1?d--:u==l+1?d++:(u>l?d--:d++,a.__u|=4))):n.__k[s]=null;if(h)for(s=0;s<c;s++)(o=t[s])!=null&&!(2&o.__u)&&(o.__e==i&&(i=of(o)),H3(o,o));return i}function z3(n,e,t,i){var r,s;if(typeof n.type=="function"){for(r=n.__k,s=0;r&&s<r.length;s++)r[s]&&(r[s].__=n,e=z3(r[s],e,t,i));return e}n.__e!=e&&(i&&(e&&n.type&&!e.parentNode&&(e=of(n)),t.insertBefore(n.__e,e||null)),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function vue(n,e,t,i){var r,s,a,o=n.key,l=n.type,u=e[t],c=u!=null&&(2&u.__u)==0;if(u===null&&n.key==null||c&&o==u.key&&l==u.type)return t;if(i>(c?1:0)){for(r=t-1,s=t+1;r>=0||s<e.length;)if((u=e[a=r>=0?r--:s++])!=null&&!(2&u.__u)&&o==u.key&&l==u.type)return a}return-1}function V2(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||gue.test(e)?t:t+"px"}function ay(n,e,t,i,r){var s,a;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof i=="string"&&(n.style.cssText=i=""),i)for(e in i)t&&e in t||V2(n.style,e,"");if(t)for(e in t)i&&t[e]==i[e]||V2(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(I3,"$1")),a=e.toLowerCase(),e=a in n||e=="onFocusOut"||e=="onFocusIn"?a.slice(2):e.slice(2),n.l||(n.l={}),n.l[e+s]=t,t?i?t.u=i.u:(t.u=eR,n.addEventListener(e,s?QE:KE,s)):n.removeEventListener(e,s?QE:KE,s);else{if(r=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function H2(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=eR++;else if(e.t<t.u)return;return t($n.event?$n.event(e):e)}}}function nR(n,e,t,i,r,s,a,o,l,u){var c,h,d,f,m,_,g,p,y,v,b,S,x,T,w,E,M,N=e.type;if(e.constructor!=null)return null;128&t.__u&&(l=!!(32&t.__u),s=[o=e.__e=t.__e]),(c=$n.__b)&&c(e);e:if(typeof N=="function")try{if(p=e.props,y="prototype"in N&&N.prototype.render,v=(c=N.contextType)&&i[c.__c],b=c?v?v.props.value:c.__:i,t.__c?g=(h=e.__c=t.__c).__=h.__E:(y?e.__c=h=new N(p,b):(e.__c=h=new Iy(p,b),h.constructor=N,h.render=Sue),v&&v.sub(h),h.props=p,h.state||(h.state={}),h.context=b,h.__n=i,d=h.__d=!0,h.__h=[],h._sb=[]),y&&h.__s==null&&(h.__s=h.state),y&&N.getDerivedStateFromProps!=null&&(h.__s==h.state&&(h.__s=ka({},h.__s)),ka(h.__s,N.getDerivedStateFromProps(p,h.__s))),f=h.props,m=h.state,h.__v=e,d)y&&N.getDerivedStateFromProps==null&&h.componentWillMount!=null&&h.componentWillMount(),y&&h.componentDidMount!=null&&h.__h.push(h.componentDidMount);else{if(y&&N.getDerivedStateFromProps==null&&p!==f&&h.componentWillReceiveProps!=null&&h.componentWillReceiveProps(p,b),!h.__e&&h.shouldComponentUpdate!=null&&h.shouldComponentUpdate(p,h.__s,b)===!1||e.__v==t.__v){for(e.__v!=t.__v&&(h.props=p,h.state=h.__s,h.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(U){U&&(U.__=e)}),S=0;S<h._sb.length;S++)h.__h.push(h._sb[S]);h._sb=[],h.__h.length&&a.push(h);break e}h.componentWillUpdate!=null&&h.componentWillUpdate(p,h.__s,b),y&&h.componentDidUpdate!=null&&h.__h.push(function(){h.componentDidUpdate(f,m,_)})}if(h.context=b,h.props=p,h.__P=n,h.__e=!1,x=$n.__r,T=0,y){for(h.state=h.__s,h.__d=!1,x&&x(e),c=h.render(h.props,h.state,h.context),w=0;w<h._sb.length;w++)h.__h.push(h._sb[w]);h._sb=[]}else do h.__d=!1,x&&x(e),c=h.render(h.props,h.state,h.context),h.state=h.__s;while(h.__d&&++T<25);h.state=h.__s,h.getChildContext!=null&&(i=ka(ka({},i),h.getChildContext())),y&&!d&&h.getSnapshotBeforeUpdate!=null&&(_=h.getSnapshotBeforeUpdate(f,m)),E=c,c!=null&&c.type===Tb&&c.key==null&&(E=V3(c.props.children)),o=k3(n,xb(E)?E:[E],e,t,i,r,s,a,o,l,u),h.base=e.__e,e.__u&=-161,h.__h.length&&a.push(h),g&&(h.__E=h.__=null)}catch(U){if(e.__v=null,l||s!=null)if(U.then){for(e.__u|=l?160:128;o&&o.nodeType==8&&o.nextSibling;)o=o.nextSibling;s[s.indexOf(o)]=null,e.__e=o}else{for(M=s.length;M--;)tR(s[M]);ZE(e)}else e.__e=t.__e,e.__k=t.__k,U.then||ZE(e);$n.__e(U,e,t)}else s==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):o=e.__e=bue(t.__e,e,t,i,r,s,a,l,u);return(c=$n.diffed)&&c(e),128&e.__u?void 0:o}function ZE(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(ZE)}function G3(n,e,t){for(var i=0;i<t.length;i++)iR(t[i],t[++i],t[++i]);$n.__c&&$n.__c(e,n),n.some(function(r){try{n=r.__h,r.__h=[],n.some(function(s){s.call(r)})}catch(s){$n.__e(s,r.__v)}})}function V3(n){return typeof n!="object"||n==null||n.__b&&n.__b>0?n:xb(n)?n.map(V3):ka({},n)}function bue(n,e,t,i,r,s,a,o,l){var u,c,h,d,f,m,_,g=t.props,p=e.props,y=e.type;if(y=="svg"?r="http://www.w3.org/2000/svg":y=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),s!=null){for(u=0;u<s.length;u++)if((f=s[u])&&"setAttribute"in f==!!y&&(y?f.localName==y:f.nodeType==3)){n=f,s[u]=null;break}}if(n==null){if(y==null)return document.createTextNode(p);n=document.createElementNS(r,y,p.is&&p),o&&($n.__m&&$n.__m(e,s),o=!1),s=null}if(y==null)g===p||o&&n.data==p||(n.data=p);else{if(s=s&&Bg.call(n.childNodes),g=t.props||Xm,!o&&s!=null)for(g={},u=0;u<n.attributes.length;u++)g[(f=n.attributes[u]).name]=f.value;for(u in g)if(f=g[u],u!="children"){if(u=="dangerouslySetInnerHTML")h=f;else if(!(u in p)){if(u=="value"&&"defaultValue"in p||u=="checked"&&"defaultChecked"in p)continue;ay(n,u,null,f,r)}}for(u in p)f=p[u],u=="children"?d=f:u=="dangerouslySetInnerHTML"?c=f:u=="value"?m=f:u=="checked"?_=f:o&&typeof f!="function"||g[u]===f||ay(n,u,f,g[u],r);if(c)o||h&&(c.__html==h.__html||c.__html==n.innerHTML)||(n.innerHTML=c.__html),e.__k=[];else if(h&&(n.innerHTML=""),k3(e.type=="template"?n.content:n,xb(d)?d:[d],e,t,i,y=="foreignObject"?"http://www.w3.org/1999/xhtml":r,s,a,s?s[0]:t.__k&&of(t,0),o,l),s!=null)for(u=s.length;u--;)tR(s[u]);o||(u="value",y=="progress"&&m==null?n.removeAttribute("value"):m!=null&&(m!==n[u]||y=="progress"&&!m||y=="option"&&m!=g[u])&&ay(n,u,m,g[u],r),u="checked",_!=null&&_!=n[u]&&ay(n,u,_,g[u],r))}return n}function iR(n,e,t){try{if(typeof n=="function"){var i=typeof n.__u=="function";i&&n.__u(),i&&e==null||(n.__u=n(e))}else n.current=e}catch(r){$n.__e(r,t)}}function H3(n,e,t){var i,r;if($n.unmount&&$n.unmount(n),(i=n.ref)&&(i.current&&i.current!=n.__e||iR(i,null,e)),(i=n.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(s){$n.__e(s,e)}i.base=i.__P=null}if(i=n.__k)for(r=0;r<i.length;r++)i[r]&&H3(i[r],e,t||typeof n.type!="function");t||tR(n.__e),n.__c=n.__=n.__e=void 0}function Sue(n,e,t){return this.constructor(n,t)}function xue(n,e,t){var i,r,s,a;e==document&&(e=document.documentElement),$n.__&&$n.__(n,e),r=(i=!1)?null:e.__k,s=[],a=[],nR(e,n=e.__k=_ue(Tb,null,[n]),r||Xm,Xm,e.namespaceURI,r?null:e.firstChild?Bg.call(e.childNodes):null,s,r?r.__e:e.firstChild,i,a),G3(s,n,a)}function $3(n,e,t){var i,r,s,a,o=ka({},n.props);for(s in n.type&&n.type.defaultProps&&(a=n.type.defaultProps),e)s=="key"?i=e[s]:s=="ref"?r=e[s]:o[s]=e[s]===void 0&&a!=null?a[s]:e[s];return arguments.length>2&&(o.children=arguments.length>3?Bg.call(arguments,2):t),lm(n.type,o,i||n.key,r||n.ref,null)}Bg=B3.slice,$n={__e:function(n,e,t,i){for(var r,s,a;e=e.__;)if((r=e.__c)&&!r.__)try{if((s=r.constructor)&&s.getDerivedStateFromError!=null&&(r.setState(s.getDerivedStateFromError(n)),a=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(n,i||{}),a=r.__d),a)return r.__E=r}catch(o){n=o}throw n}},L3=0,P3=function(n){return n!=null&&n.constructor==null},Iy.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=ka({},this.state),typeof n=="function"&&(n=n(ka({},t),this.props)),n&&ka(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),G2(this))},Iy.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),G2(this))},Iy.prototype.render=Tb,Ku=[],U3=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,O3=function(n,e){return n.__v.__b-e.__v.__b},qv.__r=0,I3=/(PointerCapture)$|Capture$/i,eR=0,KE=H2(!1),QE=H2(!0);function $2(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function Tue(n){if(Array.isArray(n))return n}function Eue(n,e,t){return(e=Cue(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Mue(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(i=s.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}function wue(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function W2(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function Aue(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?W2(Object(t),!0).forEach(function(i){Eue(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):W2(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function Rue(n,e){return Tue(n)||Mue(n,e)||Due(n,e)||wue()}function Nue(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Cue(n){var e=Nue(n,"string");return typeof e=="symbol"?e:e+""}function Xv(n){"@babel/helpers - typeof";return Xv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xv(n)}function Due(n,e){if(n){if(typeof n=="string")return $2(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?$2(n,e):void 0}}var JE=function(e){if(Xv(e)!=="object")return e;var t=$3(e);if(t.props){var i;t.props=Aue({},t.props),t!=null&&(i=t.props)!==null&&i!==void 0&&i.children&&(t.props.children=Array.isArray(t.props.children)?t.props.children.map(JE):JE(t.props.children))}return t},Lue=function(e){return P3($3(e))},Pue=function(e,t){delete t.__k,xue(JE(e),t)};function Uue(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}var Oue=`.float-tooltip-kap {
  position: absolute;
  width: max-content; /* prevent shrinking near right edge */
  max-width: max(50%, 150px);
  padding: 3px 5px;
  border-radius: 3px;
  font: 12px sans-serif;
  color: #eee;
  background: rgba(0,0,0,0.6);
  pointer-events: none;
}
`;Uue(Oue);var Iue=sb({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=i.style,s=r===void 0?{}:r,a=!!e&&Xv(e)==="object"&&!!e.node&&typeof e.node=="function",o=fue(a?e.node():e);o.style("position")==="static"&&o.style("position","relative"),t.tooltipEl=o.append("div").attr("class","float-tooltip-kap"),Object.entries(s).forEach(function(u){var c=Rue(u,2),h=c[0],d=c[1];return t.tooltipEl.style(h,d)}),t.tooltipEl.style("left","-10000px").style("display","none");var l="tooltip-".concat(Math.round(Math.random()*1e12));t.mouseInside=!1,o.on("mousemove.".concat(l),function(u){t.mouseInside=!0;var c=mue(u),h=o.node(),d=h.offsetWidth,f=h.offsetHeight,m=[t.offsetX===null||t.offsetX===void 0?"-".concat(c[0]/d*100,"%"):typeof t.offsetX=="number"?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,t.offsetY===null||t.offsetY===void 0?f>130&&f-c[1]<100?"calc(-100% - 6px)":"21px":typeof t.offsetY=="number"?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",c[0]+"px").style("top",c[1]+"px").style("transform","translate(".concat(m.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),o.on("mouseover.".concat(l),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),o.on("mouseout.".concat(l),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):typeof e.content=="string"?e.tooltipEl.html(e.content):Lue(e.content)?(e.tooltipEl.text(""),Pue(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function Bue(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}var Fue=`.scene-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;Bue(Fue);function eM(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function kue(n){if(Array.isArray(n))return n}function zue(n){if(Array.isArray(n))return eM(n)}function Gue(n,e,t){return(e=Xue(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Vue(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function Hue(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(i=s.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}function $ue(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jue(n,e){return kue(n)||Hue(n,e)||W3(n,e)||$ue()}function Ou(n){return zue(n)||Vue(n)||W3(n)||Wue()}function que(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Xue(n){var e=que(n,"string");return typeof e=="symbol"?e:e+""}function W3(n,e){if(n){if(typeof n=="string")return eM(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?eM(n,e):void 0}}var kn=window.THREE?window.THREE:{WebGLRenderer:Lq,Scene:J0,PerspectiveCamera:Ii,Raycaster:pI,SRGBColorSpace:hr,TextureLoader:z5,Vector2:fe,Vector3:D,Box3:Cc,Color:Ve,Mesh:mi,SphereGeometry:Ng,MeshBasicMaterial:Da,BackSide:bn,Clock:fI},j3=sb({props:{width:{default:window.innerWidth,onChange:function(e,t,i){isNaN(e)&&(t.width=i)}},height:{default:window.innerHeight,onChange:function(e,t,i){isNaN(e)&&(t.height=i)}},viewOffset:{default:[0,0]},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},pointerRaycasterThrottleMs:{default:50,triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){e.controls.enabled&&e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(a){return a.render(e.scene,e.camera)});var t=+new Date;if(e.enablePointerInteraction&&t-e.lastRaycasterCheck>=e.pointerRaycasterThrottleMs){e.lastRaycasterCheck=t;var i=null;if(e.hoverDuringDrag||!e.isPointerDragging){var r=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&r.sort(function(a,o){return e.hoverOrderComparator(a.object,o.object)});var s=r.find(function(a){return e.hoverFilter(a.object)})||null;i=s?s.object:null,e.intersection=s||null}i!==e.hoverObj&&(e.onHover(i,e.hoverObj,e.intersection),e.tooltip.content(i&&Bt(e.tooltipContent)(i,e.intersection)||null),e.hoverObj=i)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos,i=t.x,r=t.y;return{x:i,y:r}},cameraPosition:function(e,t,i,r){var s=e.camera;if(t&&e.initialised){var a=t,o=i||{x:0,y:0,z:0};if(!r)c(a),h(o);else{var l=Object.assign({},s.position),u=d();e.tweenGroup.add(new F2(l).to(a,r).easing(lc.Quadratic.Out).onUpdate(c).start()),e.tweenGroup.add(new F2(u).to(o,r/3).easing(lc.Quadratic.Out).onUpdate(h).start())}return this}return Object.assign({},s.position,{lookAt:d()});function c(f){var m=f.x,_=f.y,g=f.z;m!==void 0&&(s.position.x=m),_!==void 0&&(s.position.y=_),g!==void 0&&(s.position.z=g)}function h(f){var m=new kn.Vector3(f.x,f.y,f.z);e.controls.enabled&&e.controls.target?e.controls.target=m:s.lookAt(m)}function d(){return Object.assign(new kn.Vector3(0,0,-1e3).applyQuaternion(s.quaternion).add(s.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,r=arguments.length,s=new Array(r>3?r-3:0),a=3;a<r;a++)s[a-3]=arguments[a];return this.fitToBbox(this.getBbox.apply(this,s),t,i)},fitToBbox:function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,s=e.camera;if(t){var a=new kn.Vector3(0,0,0),o=Math.max.apply(Math,Ou(Object.entries(t).map(function(f){var m=jue(f,2),_=m[0],g=m[1];return Math.max.apply(Math,Ou(g.map(function(p){return Math.abs(a[_]-p)})))})))*2,l=(1-r*2/e.height)*s.fov,u=o/Math.atan(l*Math.PI/180),c=u/s.aspect,h=Math.max(u,c);if(h>0){var d=a.clone().sub(s.position).normalize().multiplyScalar(-h);this.cameraPosition(d,a,i)}}return this},getBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},i=new kn.Box3(new kn.Vector3(0,0,0),new kn.Vector3(0,0,0)),r=e.objects.filter(t);return r.length?(r.forEach(function(s){return i.expandByObject(s)}),Object.assign.apply(Object,Ou(["x","y","z"].map(function(s){return Gue({},s,[i.min[s],i.max[s]])})))):null},getScreenCoords:function(e,t,i,r){var s=new kn.Vector3(t,i,r);return s.project(this.camera()),{x:(s.x+1)*e.width/2,y:-(s.y-1)*e.height/2}},getSceneCoords:function(e,t,i){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=new kn.Vector2(t/e.width*2-1,-(i/e.height)*2+1),a=new kn.Raycaster;return a.setFromCamera(s,e.camera),Object.assign({},a.ray.at(r,new kn.Vector3))},intersectingObjects:function(e,t,i){var r=new kn.Vector2(t/e.width*2-1,-(i/e.height)*2+1),s=new kn.Raycaster;return s.params.Line.threshold=e.lineHoverPrecision,s.params.Points.threshold=e.pointsHoverPrecision,s.setFromCamera(r,e.camera),s.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new kn.Scene,camera:new kn.PerspectiveCamera,clock:new kn.Clock,tweenGroup:new v3,lastRaycasterCheck:0}},init:function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=i.controlType,s=r===void 0?"trackball":r,a=i.useWebGPU,o=a===void 0?!1:a,l=i.rendererConfig,u=l===void 0?{}:l,c=i.extraRenderers,h=c===void 0?[]:c,d=i.waitForLoadComplete,f=d===void 0?!0:d;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[s]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new Iue(t.container),t.pointerPos=new kn.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(m){return t.container.addEventListener(m,function(_){if(m==="pointerdown"&&(t.isPointerPressed=!0),!t.isPointerDragging&&_.type==="pointermove"&&(_.pressure>0||t.isPointerPressed)&&(_.pointerType==="mouse"||_.movementX===void 0||[_.movementX,_.movementY].some(function(y){return Math.abs(y)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var g=p(t.container);t.pointerPos.x=_.pageX-g.left,t.pointerPos.y=_.pageY-g.top}function p(y){var v=y.getBoundingClientRect(),b=window.pageXOffset||document.documentElement.scrollLeft,S=window.pageYOffset||document.documentElement.scrollTop;return{top:v.top+S,left:v.left+b}}},{passive:!0})}),t.container.addEventListener("pointerup",function(m){t.isPointerPressed&&(t.isPointerPressed=!1,!(t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag))&&requestAnimationFrame(function(){m.button===0&&t.onClick(t.hoverObj||null,m,t.intersection),m.button===2&&t.onRightClick&&t.onRightClick(t.hoverObj||null,m,t.intersection)}))},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(m){t.onRightClick&&m.preventDefault()}),t.renderer=new(o?Zse:kn.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},u)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=h,t.extraRenderers.forEach(function(m){m.domElement.style.position="absolute",m.domElement.style.top="0px",m.domElement.style.pointerEvents="none",t.container.appendChild(m.domElement)}),t.postProcessingComposer=new Wae(t.renderer),t.postProcessingComposer.addPass(new jae(t.scene,t.camera)),t.controls=new{trackball:eae,orbit:gae,fly:Cae}[s](t.camera,t.renderer.domElement),s==="fly"&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),(s==="trackball"||s==="orbit")&&(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(Ou(t.extraRenderers)).forEach(function(m){return m.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new kn.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!f,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))){var i,r=e.width,s=e.height;e.container.style.width="".concat(r,"px"),e.container.style.height="".concat(s,"px"),[e.renderer,e.postProcessingComposer].concat(Ou(e.extraRenderers)).forEach(function(f){return f.setSize(r,s)}),e.camera.aspect=r/s;var a=e.viewOffset.slice(0,2);a.some(function(f){return f})&&(i=e.camera).setViewOffset.apply(i,[r,s].concat(Ou(a),[r,s])),e.camera.updateProjectionMatrix()}if(t.hasOwnProperty("viewOffset")){var o,l=e.width,u=e.height,c=e.viewOffset.slice(0,2);c.some(function(f){return f})?(o=e.camera).setViewOffset.apply(o,[l,u].concat(Ou(c),[l,u])):e.camera.clearViewOffset()}if(t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=e.skyRadius*2.5,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new kn.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var h=af(e.backgroundColor).alpha;h===void 0&&(h=1),e.renderer.setClearColor(new kn.Color(Toe(1,e.backgroundColor)),h)}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?new kn.TextureLoader().load(e.backgroundImageUrl,function(f){f.colorSpace=kn.SRGBColorSpace,e.skysphere.material=new kn.MeshBasicMaterial({map:f,side:kn.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&d()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&d())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(f){return e.scene.remove(f)}),e.lights.forEach(function(f){return e.scene.add(f)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(f){return e.scene.remove(f)}),e.objects.forEach(function(f){return e.scene.add(f)}));function d(){e.loadComplete=e.scene.visible=!0}}});function Yue(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}var Kue=`.graph-info-msg {
  top: 50%;
  width: 100%;
  text-align: center;
  color: lavender;
  opacity: 0.7;
  font-size: 22px;
  position: absolute;
  font-family: Sans-serif;
}

.scene-container .clickable {
  cursor: pointer;
}

.scene-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.scene-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}`;Yue(Kue);function tM(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function Que(n){if(Array.isArray(n))return tM(n)}function Fg(n,e,t){return(e=tce(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Zue(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function Jue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function j2(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function oy(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?j2(Object(t),!0).forEach(function(i){Fg(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):j2(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function Eb(n){return Que(n)||Zue(n)||nce(n)||Jue()}function ece(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function tce(n){var e=ece(n,"string");return typeof e=="symbol"?e:e+""}function nce(n,e){if(n){if(typeof n=="string")return tM(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?tM(n,e):void 0}}function q3(n,e){var t=new e;return t._destructor&&t._destructor(),{linkProp:function(r){return{default:t[r](),onChange:function(a,o){o[n][r](a)},triggerUpdate:!1}},linkMethod:function(r){return function(s){for(var a=s[n],o=arguments.length,l=new Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];var c=a[r].apply(a,l);return c===a?this:c}}}}var Qx=window.THREE?window.THREE:{AmbientLight:hI,DirectionalLight:cI,REVISION:xf},ice=170,X3=q3("forceGraph",mB),rce=Object.assign.apply(Object,Eb(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","nodePositionUpdate","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleOffset","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","linkDirectionalParticleThreeObject","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(n){return Fg({},n,X3.linkProp(n))}))),sce=Object.assign.apply(Object,Eb(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map(function(n){return Fg({},n,X3.linkMethod(n))}))),By=q3("renderObjs",j3),ace=Object.assign.apply(Object,Eb(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map(function(n){return Fg({},n,By.linkProp(n))}))),oce=Object.assign.apply(Object,Eb(["lights","cameraPosition","postProcessingComposer"].map(function(n){return Fg({},n,By.linkMethod(n))})).concat([{graph2ScreenCoords:By.linkMethod("getScreenCoords"),screen2GraphCoords:By.linkMethod("getSceneCoords")}])),lce=sb({props:oy(oy({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(e,t){return t.renderObjs.lineHoverPrecision(e)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(e,t){var i=t.renderObjs.controls();i&&(i.enabled=e,e&&i.domElement&&i.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1},showPointerCursor:{default:!0,triggerUpdate:!1}},rce),ace),methods:oy(oy({zoomToFit:function(e,t,i){for(var r,s=arguments.length,a=new Array(s>3?s-3:0),o=3;o<s;o++)a[o-3]=arguments[o];return e.renderObjs.fitToBbox((r=e.forceGraph).getGraphBbox.apply(r,a),t,i),this},pauseAnimation:function(e){return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return e.animationFrameRequestId===null&&this._animationCycle(),this},_animationCycle:function(e){e.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),e.forceGraph.tickFrame(),e.renderObjs.tick(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},tbControls:function(e){return e.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},sce),oce),stateInit:function(e){var t=e.controlType,i=e.rendererConfig,r=e.extraRenderers,s=new mB;return{forceGraph:s,renderObjs:j3({controlType:t,rendererConfig:i,extraRenderers:r}).objects([s]).lights([new Qx.AmbientLight(13421772,Math.PI),new Qx.DirectionalLight(16777215,.6*Math.PI)])}},init:function(e,t){e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var i=document.createElement("div");t.container.appendChild(i),t.renderObjs(i);var r=t.renderObjs.camera(),s=t.renderObjs.renderer(),a=t.renderObjs.controls();a.enabled=!!t.enableNavigationControls,t.lastSetCameraZ=r.position.z;var o;t.container.appendChild(o=document.createElement("div")),o.className="graph-info-msg",o.textContent="",t.forceGraph.onLoading(function(){o.textContent="Loading..."}).onFinishLoading(function(){o.textContent=""}).onUpdate(function(){t.graphData=t.forceGraph.graphData(),r.position.x===0&&r.position.y===0&&r.position.z===t.lastSetCameraZ&&t.graphData.nodes.length&&(r.lookAt(t.forceGraph.position),t.lastSetCameraZ=r.position.z=Math.cbrt(t.graphData.nodes.length)*ice)}).onFinishUpdate(function(){if(t._dragControls){var l=t.graphData.nodes.find(function(c){return c.__initialFixedPos&&!c.__disposeControlsAfterDrag});l?l.__disposeControlsAfterDrag=!0:t._dragControls.dispose(),t._dragControls=void 0}if(t.enableNodeDrag&&t.enablePointerInteraction&&t.forceEngine==="d3"){var u=t._dragControls=new Pq(t.graphData.nodes.map(function(c){return c.__threeObj}).filter(function(c){return c}),r,s.domElement);u.addEventListener("dragstart",function(c){var h=yo(c.object);if(h){a.enabled=!1,c.object.__initialPos=c.object.position.clone(),c.object.__prevPos=c.object.position.clone();var d=h.__data;!d.__initialFixedPos&&(d.__initialFixedPos={fx:d.fx,fy:d.fy,fz:d.fz}),!d.__initialPos&&(d.__initialPos={x:d.x,y:d.y,z:d.z}),["x","y","z"].forEach(function(f){return d["f".concat(f)]=d[f]}),s.domElement.classList.add("grabbable")}}),u.addEventListener("drag",function(c){var h=yo(c.object);if(h){if(!c.object.hasOwnProperty("__graphObjType")){var d=c.object.__initialPos,f=c.object.__prevPos,m=c.object.position;h.position.add(m.clone().sub(f)),f.copy(m),m.copy(d)}var _=h.__data,g=h.position,p={x:g.x-_.x,y:g.y-_.y,z:g.z-_.z};["x","y","z"].forEach(function(y){return _["f".concat(y)]=_[y]=g[y]}),t.forceGraph.d3AlphaTarget(.3).resetCountdown(),_.__dragged=!0,t.onNodeDrag(_,p)}}),u.addEventListener("dragend",function(c){var h=yo(c.object);if(h){delete c.object.__initialPos,delete c.object.__prevPos;var d=h.__data;d.__disposeControlsAfterDrag&&(u.dispose(),delete d.__disposeControlsAfterDrag);var f=d.__initialFixedPos,m=d.__initialPos,_={x:m.x-d.x,y:m.y-d.y,z:m.z-d.z};if(f&&(["x","y","z"].forEach(function(p){var y="f".concat(p);f[y]===void 0&&delete d[y]}),delete d.__initialFixedPos,delete d.__initialPos,d.__dragged&&(delete d.__dragged,t.onNodeDragEnd(d,_))),t.forceGraph.d3AlphaTarget(0).resetCountdown(),t.enableNavigationControls){var g;a.enabled=!0,a._status&&((g=a._onPointerCancel)===null||g===void 0||g.call(a)),a.domElement&&a.domElement.ownerDocument&&a.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))}s.domElement.classList.remove("grabbable")}})}}),Qx.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverOrderComparator(function(l,u){var c=yo(l);if(!c)return 1;var h=yo(u);if(!h)return-1;var d=function(m){return m.__graphObjType==="node"};return d(h)-d(c)}).tooltipContent(function(l){var u=yo(l);return u&&Bt(t["".concat(u.__graphObjType,"Label")])(u.__data)||""}).hoverDuringDrag(!1).onHover(function(l){var u=yo(l);if(u!==t.hoverObj){var c=t.hoverObj?t.hoverObj.__graphObjType:null,h=t.hoverObj?t.hoverObj.__data:null,d=u?u.__graphObjType:null,f=u?u.__data:null;if(c&&c!==d){var m=t["on".concat(c==="node"?"Node":"Link","Hover")];m&&m(null,h)}if(d){var _=t["on".concat(d==="node"?"Node":"Link","Hover")];_&&_(f,c===d?h:null)}s.domElement.classList[(u&&t["on".concat(d==="node"?"Node":"Link","Click")]||!u&&t.onBackgroundClick)&&Bt(t.showPointerCursor)(f)?"add":"remove"]("clickable"),t.hoverObj=u}}).clickAfterDrag(!1).onClick(function(l,u){var c=yo(l);if(c){var h=t["on".concat(c.__graphObjType==="node"?"Node":"Link","Click")];h&&h(c.__data,u)}else t.onBackgroundClick&&t.onBackgroundClick(u)}).onRightClick(function(l,u){var c=yo(l);if(c){var h=t["on".concat(c.__graphObjType==="node"?"Node":"Link","RightClick")];h&&h(c.__data,u)}else t.onBackgroundRightClick&&t.onBackgroundRightClick(u)}),this._animationCycle()}});function yo(n){for(var e=n;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}var Y3={exports:{}},uce="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",cce=uce,hce=cce;function K3(){}function Q3(){}Q3.resetWarningCache=K3;var dce=function(){function n(i,r,s,a,o,l){if(l!==hce){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}n.isRequired=n;function e(){return n}var t={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:e,element:n,elementType:n,instanceOf:e,node:n,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:Q3,resetWarningCache:K3};return t.PropTypes=t,t};Y3.exports=dce();var fce=Y3.exports;const G=tg(fce),Mb={width:G.number,height:G.number,graphData:G.shape({nodes:G.arrayOf(G.object).isRequired,links:G.arrayOf(G.object).isRequired}),backgroundColor:G.string,nodeRelSize:G.number,nodeId:G.string,nodeLabel:G.oneOfType([G.string,G.func]),nodeVal:G.oneOfType([G.number,G.string,G.func]),nodeVisibility:G.oneOfType([G.bool,G.string,G.func]),nodeColor:G.oneOfType([G.string,G.func]),nodeAutoColorBy:G.oneOfType([G.string,G.func]),onNodeHover:G.func,onNodeClick:G.func,linkSource:G.string,linkTarget:G.string,linkLabel:G.oneOfType([G.string,G.func]),linkVisibility:G.oneOfType([G.bool,G.string,G.func]),linkColor:G.oneOfType([G.string,G.func]),linkAutoColorBy:G.oneOfType([G.string,G.func]),linkWidth:G.oneOfType([G.number,G.string,G.func]),linkCurvature:G.oneOfType([G.number,G.string,G.func]),linkDirectionalArrowLength:G.oneOfType([G.number,G.string,G.func]),linkDirectionalArrowColor:G.oneOfType([G.string,G.func]),linkDirectionalArrowRelPos:G.oneOfType([G.number,G.string,G.func]),linkDirectionalParticles:G.oneOfType([G.number,G.string,G.func]),linkDirectionalParticleSpeed:G.oneOfType([G.number,G.string,G.func]),linkDirectionalParticleOffset:G.oneOfType([G.number,G.string,G.func]),linkDirectionalParticleWidth:G.oneOfType([G.number,G.string,G.func]),linkDirectionalParticleColor:G.oneOfType([G.string,G.func]),onLinkHover:G.func,onLinkClick:G.func,dagMode:G.oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:G.number,dagNodeFilter:G.func,onDagError:G.func,d3AlphaMin:G.number,d3AlphaDecay:G.number,d3VelocityDecay:G.number,warmupTicks:G.number,cooldownTicks:G.number,cooldownTime:G.number,onEngineTick:G.func,onEngineStop:G.func,getGraphBbox:G.func},Z3={zoomToFit:G.func,onNodeRightClick:G.func,onNodeDrag:G.func,onNodeDragEnd:G.func,onLinkRightClick:G.func,linkHoverPrecision:G.number,onBackgroundClick:G.func,onBackgroundRightClick:G.func,showPointerCursor:G.oneOfType([G.bool,G.func]),enablePointerInteraction:G.bool,enableNodeDrag:G.bool},rR={showNavInfo:G.bool,nodeOpacity:G.number,nodeResolution:G.number,nodeThreeObject:G.oneOfType([G.object,G.string,G.func]),nodeThreeObjectExtend:G.oneOfType([G.bool,G.string,G.func]),nodePositionUpdate:G.func,linkOpacity:G.number,linkResolution:G.number,linkCurveRotation:G.oneOfType([G.number,G.string,G.func]),linkMaterial:G.oneOfType([G.object,G.string,G.func]),linkThreeObject:G.oneOfType([G.object,G.string,G.func]),linkThreeObjectExtend:G.oneOfType([G.bool,G.string,G.func]),linkPositionUpdate:G.func,linkDirectionalArrowResolution:G.number,linkDirectionalParticleResolution:G.number,linkDirectionalParticleThreeObject:G.oneOfType([G.object,G.string,G.func]),forceEngine:G.oneOf(["d3","ngraph"]),ngraphPhysics:G.object,numDimensions:G.oneOf([1,2,3])};Object.assign({},Mb,Z3,{linkLineDash:G.oneOfType([G.arrayOf(G.number),G.string,G.func]),nodeCanvasObjectMode:G.oneOfType([G.string,G.func]),nodeCanvasObject:G.func,nodePointerAreaPaint:G.func,linkCanvasObjectMode:G.oneOfType([G.string,G.func]),linkCanvasObject:G.func,linkPointerAreaPaint:G.func,linkDirectionalParticleCanvasObject:G.func,autoPauseRedraw:G.bool,minZoom:G.number,maxZoom:G.number,enableZoomInteraction:G.oneOfType([G.bool,G.func]),enablePanInteraction:G.oneOfType([G.bool,G.func]),onZoom:G.func,onZoomEnd:G.func,onRenderFramePre:G.func,onRenderFramePost:G.func});const pce=Object.assign({},Mb,Z3,rR,{enableNavigationControls:G.bool,controlType:G.oneOf(["trackball","orbit","fly"]),rendererConfig:G.object,extraRenderers:G.arrayOf(G.shape({render:G.func.isRequired}))});Object.assign({},Mb,rR,{nodeDesc:G.oneOfType([G.string,G.func]),linkDesc:G.oneOfType([G.string,G.func])});Object.assign({},Mb,rR,{markerAttrs:G.object,yOffset:G.number,glScale:G.number});const sR=Y6(lce,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","cameraPosition","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords","postProcessingComposer","lights","scene","camera","renderer","controls","refresh"],initPropNames:["controlType","rendererConfig","extraRenderers"]});sR.displayName="ForceGraph3D";sR.propTypes=pce;function mce({nodes:n}){const e={nodes:n,links:[]};return Tt.jsx("div",{className:"h-[80vh] rounded-2xl overflow-hidden ring-1 ring-zinc-800",children:Tt.jsx(sR,{graphData:e,nodeId:"id",nodeVal:t=>t.val,nodeAutoColorBy:"topic",nodeLabel:t=>{const i=t;return`${i.title??"(no title)"}
${i.published_at??""}`},onNodeClick:t=>window.open(t.url,"_blank"),backgroundColor:"#0b1020"})})}function bt(n,e,t,i){function r(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(c){try{u(i.next(c))}catch(h){a(h)}}function l(c){try{u(i.throw(c))}catch(h){a(h)}}function u(c){c.done?s(c.value):r(c.value).then(o,l)}u((i=i.apply(n,e||[])).next())})}function q2(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function At(n){return this instanceof At?(this.v=n,this):new At(n)}function za(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),r,s=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",a),r[Symbol.asyncIterator]=function(){return this},r;function a(f){return function(m){return Promise.resolve(m).then(f,h)}}function o(f,m){i[f]&&(r[f]=function(_){return new Promise(function(g,p){s.push([f,_,g,p])>1||l(f,_)})},m&&(r[f]=m(r[f])))}function l(f,m){try{u(i[f](m))}catch(_){d(s[0][3],_)}}function u(f){f.value instanceof At?Promise.resolve(f.value.v).then(c,h):d(s[0][2],f)}function c(f){l("next",f)}function h(f){l("throw",f)}function d(f,m){f(m),s.shift(),s.length&&l(s[0][0],s[0][1])}}function Fy(n){var e,t;return e={},i("next"),i("throw",function(r){throw r}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(r,s){e[r]=n[r]?function(a){return(t=!t)?{value:At(n[r](a)),done:!1}:s?s(a):a}:s}}function uc(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof q2=="function"?q2(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(a){return new Promise(function(o,l){a=n[s](a),r(o,l,a.done,a.value)})}}function r(s,a,o,l){Promise.resolve(l).then(function(u){s({value:u,done:o})},a)}}const gce=new TextDecoder("utf-8"),nM=n=>gce.decode(n),_ce=new TextEncoder,aR=n=>_ce.encode(n),yce=n=>typeof n=="number",J3=n=>typeof n=="boolean",Ti=n=>typeof n=="function",Wr=n=>n!=null&&Object(n)===n,xc=n=>Wr(n)&&Ti(n.then),kg=n=>Wr(n)&&Ti(n[Symbol.iterator]),Pf=n=>Wr(n)&&Ti(n[Symbol.asyncIterator]),iM=n=>Wr(n)&&Wr(n.schema),ek=n=>Wr(n)&&"done"in n&&"value"in n,tk=n=>Wr(n)&&Ti(n.stat)&&yce(n.fd),nk=n=>Wr(n)&&oR(n.body),wb=n=>"_getDOMStream"in n&&"_getNodeStream"in n,vce=n=>Wr(n)&&Ti(n.abort)&&Ti(n.getWriter)&&!wb(n),oR=n=>Wr(n)&&Ti(n.cancel)&&Ti(n.getReader)&&!wb(n),bce=n=>Wr(n)&&Ti(n.end)&&Ti(n.write)&&J3(n.writable)&&!wb(n),ik=n=>Wr(n)&&Ti(n.read)&&Ti(n.pipe)&&J3(n.readable)&&!wb(n),Sce=n=>Wr(n)&&Ti(n.clear)&&Ti(n.bytes)&&Ti(n.position)&&Ti(n.setPosition)&&Ti(n.capacity)&&Ti(n.getBufferIdentifier)&&Ti(n.createLong),lR=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:ArrayBuffer;function xce(n){const e=n[0]?[n[0]]:[];let t,i,r,s;for(let a,o,l=0,u=0,c=n.length;++l<c;){if(a=e[u],o=n[l],!a||!o||a.buffer!==o.buffer||o.byteOffset<a.byteOffset){o&&(e[++u]=o);continue}if({byteOffset:t,byteLength:r}=a,{byteOffset:i,byteLength:s}=o,t+r<i||i+s<t){o&&(e[++u]=o);continue}e[u]=new Uint8Array(a.buffer,t,i-t+s)}return e}function X2(n,e,t=0,i=e.byteLength){const r=n.byteLength,s=new Uint8Array(n.buffer,n.byteOffset,r),a=new Uint8Array(e.buffer,e.byteOffset,Math.min(i,r));return s.set(a,t),n}function Za(n,e){const t=xce(n),i=t.reduce((c,h)=>c+h.byteLength,0);let r,s,a,o=0,l=-1;const u=Math.min(e||Number.POSITIVE_INFINITY,i);for(const c=t.length;++l<c;){if(r=t[l],s=r.subarray(0,Math.min(r.length,u-o)),u<=o+s.length){s.length<r.length?t[l]=r.subarray(s.length):s.length===r.length&&l++,a?X2(a,s,o):a=s;break}X2(a||(a=new Uint8Array(u)),s,o),o+=s.length}return[a||new Uint8Array(0),t.slice(l),i-(a?a.byteLength:0)]}function dn(n,e){let t=ek(e)?e.value:e;return t instanceof n?n===Uint8Array?new n(t.buffer,t.byteOffset,t.byteLength):t:t?(typeof t=="string"&&(t=aR(t)),t instanceof ArrayBuffer?new n(t):t instanceof lR?new n(t):Sce(t)?dn(n,t.bytes()):ArrayBuffer.isView(t)?t.byteLength<=0?new n(0):new n(t.buffer,t.byteOffset,t.byteLength/n.BYTES_PER_ELEMENT):n.from(t)):new n(0)}const gp=n=>dn(Int32Array,n),Y2=n=>dn(BigInt64Array,n),Vt=n=>dn(Uint8Array,n),rM=n=>(n.next(),n);function*Tce(n,e){const t=function*(r){yield r},i=typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof lR?t(e):kg(e)?e:t(e);return yield*rM(function*(r){let s=null;do s=r.next(yield dn(n,s));while(!s.done)}(i[Symbol.iterator]())),new n}const Ece=n=>Tce(Uint8Array,n);function rk(n,e){return za(this,arguments,function*(){if(xc(e))return yield At(yield At(yield*Fy(uc(rk(n,yield At(e))))));const i=function(a){return za(this,arguments,function*(){yield yield At(yield At(a))})},r=function(a){return za(this,arguments,function*(){yield At(yield*Fy(uc(rM(function*(o){let l=null;do l=o.next(yield l==null?void 0:l.value);while(!l.done)}(a[Symbol.iterator]())))))})},s=typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof lR?i(e):kg(e)?r(e):Pf(e)?e:i(e);return yield At(yield*Fy(uc(rM(function(a){return za(this,arguments,function*(){let o=null;do o=yield At(a.next(yield yield At(dn(n,o))));while(!o.done)})}(s[Symbol.asyncIterator]()))))),yield At(new n)})}const Mce=n=>rk(Uint8Array,n);function sk(n,e,t){if(n!==0){t=t.slice(0,e);for(let i=-1,r=t.length;++i<r;)t[i]+=n}return t.subarray(0,e)}function wce(n,e){let t=0;const i=n.length;if(i!==e.length)return!1;if(i>0)do if(n[t]!==e[t])return!1;while(++t<i);return!0}const Rs={fromIterable(n){return ly(Ace(n))},fromAsyncIterable(n){return ly(Rce(n))},fromDOMStream(n){return ly(Nce(n))},fromNodeStream(n){return ly(Dce(n))},toDOMStream(n,e){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(n,e){throw new Error('"toNodeStream" not available in this environment')}},ly=n=>(n.next(),n);function*Ace(n){let e,t=!1,i=[],r,s,a,o=0;function l(){return s==="peek"?Za(i,a)[0]:([r,i,o]=Za(i,a),r)}({cmd:s,size:a}=(yield null)||{cmd:"read",size:0});const u=Ece(n)[Symbol.iterator]();try{do if({done:e,value:r}=Number.isNaN(a-o)?u.next():u.next(a-o),!e&&r.byteLength>0&&(i.push(r),o+=r.byteLength),e||a<=o)do({cmd:s,size:a}=yield l());while(a<o);while(!e)}catch(c){(t=!0)&&typeof u.throw=="function"&&u.throw(c)}finally{t===!1&&typeof u.return=="function"&&u.return(null)}return null}function Rce(n){return za(this,arguments,function*(){let t,i=!1,r=[],s,a,o,l=0;function u(){return a==="peek"?Za(r,o)[0]:([s,r,l]=Za(r,o),s)}({cmd:a,size:o}=(yield yield At(null))||{cmd:"read",size:0});const c=Mce(n)[Symbol.asyncIterator]();try{do if({done:t,value:s}=Number.isNaN(o-l)?yield At(c.next()):yield At(c.next(o-l)),!t&&s.byteLength>0&&(r.push(s),l+=s.byteLength),t||o<=l)do({cmd:a,size:o}=yield yield At(u()));while(o<l);while(!t)}catch(h){(i=!0)&&typeof c.throw=="function"&&(yield At(c.throw(h)))}finally{i===!1&&typeof c.return=="function"&&(yield At(c.return(new Uint8Array(0))))}return yield At(null)})}function Nce(n){return za(this,arguments,function*(){let t=!1,i=!1,r=[],s,a,o,l=0;function u(){return a==="peek"?Za(r,o)[0]:([s,r,l]=Za(r,o),s)}({cmd:a,size:o}=(yield yield At(null))||{cmd:"read",size:0});const c=new Cce(n);try{do if({done:t,value:s}=Number.isNaN(o-l)?yield At(c.read()):yield At(c.read(o-l)),!t&&s.byteLength>0&&(r.push(Vt(s)),l+=s.byteLength),t||o<=l)do({cmd:a,size:o}=yield yield At(u()));while(o<l);while(!t)}catch(h){(i=!0)&&(yield At(c.cancel(h)))}finally{i===!1?yield At(c.cancel()):n.locked&&c.releaseLock()}return yield At(null)})}class Cce{constructor(e){this.source=e,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(e){return bt(this,void 0,void 0,function*(){const{reader:t,source:i}=this;t&&(yield t.cancel(e).catch(()=>{})),i&&i.locked&&this.releaseLock()})}read(e){return bt(this,void 0,void 0,function*(){if(e===0)return{done:this.reader==null,value:new Uint8Array(0)};const t=yield this.reader.read();return!t.done&&(t.value=Vt(t)),t})}}const Zx=(n,e)=>{const t=r=>i([e,r]);let i;return[e,t,new Promise(r=>(i=r)&&n.once(e,t))]};function Dce(n){return za(this,arguments,function*(){const t=[];let i="error",r=!1,s=null,a,o,l=0,u=[],c;function h(){return a==="peek"?Za(u,o)[0]:([c,u,l]=Za(u,o),c)}if({cmd:a,size:o}=(yield yield At(null))||{cmd:"read",size:0},n.isTTY)return yield yield At(new Uint8Array(0)),yield At(null);try{t[0]=Zx(n,"end"),t[1]=Zx(n,"error");do{if(t[2]=Zx(n,"readable"),[i,s]=yield At(Promise.race(t.map(f=>f[2]))),i==="error")break;if((r=i==="end")||(Number.isFinite(o-l)?(c=Vt(n.read(o-l)),c.byteLength<o-l&&(c=Vt(n.read()))):c=Vt(n.read()),c.byteLength>0&&(u.push(c),l+=c.byteLength)),r||o<=l)do({cmd:a,size:o}=yield yield At(h()));while(o<l)}while(!r)}finally{yield At(d(t,i==="error"?s:null))}return yield At(null);function d(f,m){return c=u=null,new Promise((_,g)=>{for(const[p,y]of f)n.off(p,y);try{const p=n.destroy;p&&p.call(n,m),m=void 0}catch(p){m=p||m}finally{m!=null?g(m):_()}})}})}var ci;(function(n){n[n.V1=0]="V1",n[n.V2=1]="V2",n[n.V3=2]="V3",n[n.V4=3]="V4",n[n.V5=4]="V5"})(ci||(ci={}));var sr;(function(n){n[n.Sparse=0]="Sparse",n[n.Dense=1]="Dense"})(sr||(sr={}));var nr;(function(n){n[n.HALF=0]="HALF",n[n.SINGLE=1]="SINGLE",n[n.DOUBLE=2]="DOUBLE"})(nr||(nr={}));var js;(function(n){n[n.DAY=0]="DAY",n[n.MILLISECOND=1]="MILLISECOND"})(js||(js={}));var ot;(function(n){n[n.SECOND=0]="SECOND",n[n.MILLISECOND=1]="MILLISECOND",n[n.MICROSECOND=2]="MICROSECOND",n[n.NANOSECOND=3]="NANOSECOND"})(ot||(ot={}));var Ja;(function(n){n[n.YEAR_MONTH=0]="YEAR_MONTH",n[n.DAY_TIME=1]="DAY_TIME",n[n.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(Ja||(Ja={}));const Jx=2,La=4,Do=4,ln=4,Rl=new Int32Array(2),K2=new Float32Array(Rl.buffer),Q2=new Float64Array(Rl.buffer),uy=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var sM;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(sM||(sM={}));let lf=class ak{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new ak(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return Rl[0]=this.readInt32(e),K2[0]}readFloat64(e){return Rl[uy?0:1]=this.readInt32(e),Rl[uy?1:0]=this.readInt32(e+4),Q2[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){K2[0]=t,this.writeInt32(e,Rl[0])}writeFloat64(e,t){Q2[0]=t,this.writeInt32(e,Rl[uy?0:1]),this.writeInt32(e+4,Rl[uy?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+La+Do)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<Do;t++)e+=String.fromCharCode(this.readInt8(this.position_+La+t));return e}__offset(e,t){const i=e-this.readInt32(e);return t<this.readInt16(i)?this.readInt16(i+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const i=this.readInt32(e);e+=La;const r=this.bytes_.subarray(e,e+i);return t===sM.UTF8_BYTES?r:this.text_decoder_.decode(r)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+La}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Do)throw new Error("FlatBuffers: file identifier must be length "+Do);for(let t=0;t<Do;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+La+t))return!1;return!0}createScalarList(e,t){const i=[];for(let r=0;r<t;++r){const s=e(r);s!==null&&i.push(s)}return i}createObjList(e,t){const i=[];for(let r=0;r<t;++r){const s=e(r);s!==null&&i.push(s.unpack())}return i}},ok=class lk{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let t;e?t=e:t=1024,this.bb=lf.allocate(t),this.space=t}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,t){e>this.minalign&&(this.minalign=e);const i=~(this.bb.capacity()-this.space+t)+1&e-1;for(;this.space<i+e+t;){const r=this.bb.capacity();this.bb=lk.growByteBuffer(this.bb),this.space+=this.bb.capacity()-r}this.pad(i)}pad(e){for(let t=0;t<e;t++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,t,i){(this.force_defaults||t!=i)&&(this.addInt8(t),this.slot(e))}addFieldInt16(e,t,i){(this.force_defaults||t!=i)&&(this.addInt16(t),this.slot(e))}addFieldInt32(e,t,i){(this.force_defaults||t!=i)&&(this.addInt32(t),this.slot(e))}addFieldInt64(e,t,i){(this.force_defaults||t!==i)&&(this.addInt64(t),this.slot(e))}addFieldFloat32(e,t,i){(this.force_defaults||t!=i)&&(this.addFloat32(t),this.slot(e))}addFieldFloat64(e,t,i){(this.force_defaults||t!=i)&&(this.addFloat64(t),this.slot(e))}addFieldOffset(e,t,i){(this.force_defaults||t!=i)&&(this.addOffset(t),this.slot(e))}addFieldStruct(e,t,i){t!=i&&(this.nested(t),this.slot(e))}nested(e){if(e!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const t=e.capacity();if(t&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const i=t<<1,r=lf.allocate(i);return r.setPosition(i-t),r.bytes().set(e.bytes(),i-t),r}addOffset(e){this.prep(La,0),this.writeInt32(this.offset()-e+La)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let t=0;t<e;t++)this.vtable[t]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let t=this.vtable_in_use-1;for(;t>=0&&this.vtable[t]==0;t--);const i=t+1;for(;t>=0;t--)this.addInt16(this.vtable[t]!=0?e-this.vtable[t]:0);const r=2;this.addInt16(e-this.object_start);const s=(i+r)*Jx;this.addInt16(s);let a=0;const o=this.space;e:for(t=0;t<this.vtables.length;t++){const l=this.bb.capacity()-this.vtables[t];if(s==this.bb.readInt16(l)){for(let u=Jx;u<s;u+=Jx)if(this.bb.readInt16(o+u)!=this.bb.readInt16(l+u))continue e;a=this.vtables[t];break}}return a?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,a-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,t,i){const r=i?ln:0;if(t){const s=t;if(this.prep(this.minalign,La+Do+r),s.length!=Do)throw new TypeError("FlatBuffers: file identifier must be length "+Do);for(let a=Do-1;a>=0;a--)this.writeInt8(s.charCodeAt(a))}this.prep(this.minalign,La+r),this.addOffset(e),r&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,t){this.finish(e,t,!0)}requiredField(e,t){const i=this.bb.capacity()-e,r=i-this.bb.readInt32(i);if(!(t<this.bb.readInt16(r)&&this.bb.readInt16(r+t)!=0))throw new TypeError("FlatBuffers: field "+t+" must be set")}startVector(e,t,i){this.notNested(),this.vector_num_elems=t,this.prep(La,e*t),this.prep(i,e*t)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const t=this.createString(e);return this.string_maps.set(e,t),t}createString(e){if(e==null)return 0;let t;return e instanceof Uint8Array?t=e:t=this.text_encoder.encode(e),this.addInt8(0),this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),this.bb.bytes().set(t,this.space),this.endVector()}createByteVector(e){return e==null?0:(this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length),this.bb.bytes().set(e,this.space),this.endVector())}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const t=[];for(let i=0;i<e.length;++i){const r=e[i];if(r!==null)t.push(this.createObjectOffset(r));else throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return t}createStructOffsetList(e,t){return t(this,e.length),this.createObjectOffsetList(e.slice().reverse()),this.endVector()}};var Yv;(function(n){n[n.BUFFER=0]="BUFFER"})(Yv||(Yv={}));var Kv;(function(n){n[n.LZ4_FRAME=0]="LZ4_FRAME",n[n.ZSTD=1]="ZSTD"})(Kv||(Kv={}));class Nl{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsBodyCompression(e,t){return(t||new Nl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBodyCompression(e,t){return e.setPosition(e.position()+ln),(t||new Nl).__init(e.readInt32(e.position())+e.position(),e)}codec(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt8(this.bb_pos+e):Kv.LZ4_FRAME}method(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt8(this.bb_pos+e):Yv.BUFFER}static startBodyCompression(e){e.startObject(2)}static addCodec(e,t){e.addFieldInt8(0,t,Kv.LZ4_FRAME)}static addMethod(e,t){e.addFieldInt8(1,t,Yv.BUFFER)}static endBodyCompression(e){return e.endObject()}static createBodyCompression(e,t,i){return Nl.startBodyCompression(e),Nl.addCodec(e,t),Nl.addMethod(e,i),Nl.endBodyCompression(e)}}class uk{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(e,t,i){return e.prep(8,16),e.writeInt64(BigInt(i??0)),e.writeInt64(BigInt(t??0)),e.offset()}}let ck=class{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(e,t,i){return e.prep(8,16),e.writeInt64(BigInt(i??0)),e.writeInt64(BigInt(t??0)),e.offset()}},bo=class aM{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsRecordBatch(e,t){return(t||new aM).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsRecordBatch(e,t){return e.setPosition(e.position()+ln),(t||new aM).__init(e.readInt32(e.position())+e.position(),e)}length(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}nodes(e,t){const i=this.bb.__offset(this.bb_pos,6);return i?(t||new ck).__init(this.bb.__vector(this.bb_pos+i)+e*16,this.bb):null}nodesLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}buffers(e,t){const i=this.bb.__offset(this.bb_pos,8);return i?(t||new uk).__init(this.bb.__vector(this.bb_pos+i)+e*16,this.bb):null}buffersLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}compression(e){const t=this.bb.__offset(this.bb_pos,10);return t?(e||new Nl).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}static startRecordBatch(e){e.startObject(4)}static addLength(e,t){e.addFieldInt64(0,t,BigInt("0"))}static addNodes(e,t){e.addFieldOffset(1,t,0)}static startNodesVector(e,t){e.startVector(16,t,8)}static addBuffers(e,t){e.addFieldOffset(2,t,0)}static startBuffersVector(e,t){e.startVector(16,t,8)}static addCompression(e,t){e.addFieldOffset(3,t,0)}static endRecordBatch(e){return e.endObject()}},ph=class oM{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDictionaryBatch(e,t){return(t||new oM).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryBatch(e,t){return e.setPosition(e.position()+ln),(t||new oM).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}data(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new bo).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}isDelta(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startDictionaryBatch(e){e.startObject(3)}static addId(e,t){e.addFieldInt64(0,t,BigInt("0"))}static addData(e,t){e.addFieldOffset(1,t,0)}static addIsDelta(e,t){e.addFieldInt8(2,+t,0)}static endDictionaryBatch(e){return e.endObject()}};var uf;(function(n){n[n.Little=0]="Little",n[n.Big=1]="Big"})(uf||(uf={}));var Qv;(function(n){n[n.DenseArray=0]="DenseArray"})(Qv||(Qv={}));class ls{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsInt(e,t){return(t||new ls).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInt(e,t){return e.setPosition(e.position()+ln),(t||new ls).__init(e.readInt32(e.position())+e.position(),e)}bitWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}isSigned(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startInt(e){e.startObject(2)}static addBitWidth(e,t){e.addFieldInt32(0,t,0)}static addIsSigned(e,t){e.addFieldInt8(1,+t,0)}static endInt(e){return e.endObject()}static createInt(e,t,i){return ls.startInt(e),ls.addBitWidth(e,t),ls.addIsSigned(e,i),ls.endInt(e)}}class Lo{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDictionaryEncoding(e,t){return(t||new Lo).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryEncoding(e,t){return e.setPosition(e.position()+ln),(t||new Lo).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}indexType(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new ls).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}isOrdered(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}dictionaryKind(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt16(this.bb_pos+e):Qv.DenseArray}static startDictionaryEncoding(e){e.startObject(4)}static addId(e,t){e.addFieldInt64(0,t,BigInt("0"))}static addIndexType(e,t){e.addFieldOffset(1,t,0)}static addIsOrdered(e,t){e.addFieldInt8(2,+t,0)}static addDictionaryKind(e,t){e.addFieldInt16(3,t,Qv.DenseArray)}static endDictionaryEncoding(e){return e.endObject()}}class Ei{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsKeyValue(e,t){return(t||new Ei).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsKeyValue(e,t){return e.setPosition(e.position()+ln),(t||new Ei).__init(e.readInt32(e.position())+e.position(),e)}key(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}value(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}static startKeyValue(e){e.startObject(2)}static addKey(e,t){e.addFieldOffset(0,t,0)}static addValue(e,t){e.addFieldOffset(1,t,0)}static endKeyValue(e){return e.endObject()}static createKeyValue(e,t,i){return Ei.startKeyValue(e),Ei.addKey(e,t),Ei.addValue(e,i),Ei.endKeyValue(e)}}let Z2=class Np{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsBinary(e,t){return(t||new Np).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBinary(e,t){return e.setPosition(e.position()+ln),(t||new Np).__init(e.readInt32(e.position())+e.position(),e)}static startBinary(e){e.startObject(0)}static endBinary(e){return e.endObject()}static createBinary(e){return Np.startBinary(e),Np.endBinary(e)}},J2=class Cp{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsBool(e,t){return(t||new Cp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBool(e,t){return e.setPosition(e.position()+ln),(t||new Cp).__init(e.readInt32(e.position())+e.position(),e)}static startBool(e){e.startObject(0)}static endBool(e){return e.endObject()}static createBool(e){return Cp.startBool(e),Cp.endBool(e)}},ky=class mh{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDate(e,t){return(t||new mh).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDate(e,t){return e.setPosition(e.position()+ln),(t||new mh).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):js.MILLISECOND}static startDate(e){e.startObject(1)}static addUnit(e,t){e.addFieldInt16(0,t,js.MILLISECOND)}static endDate(e){return e.endObject()}static createDate(e,t){return mh.startDate(e),mh.addUnit(e,t),mh.endDate(e)}},gh=class El{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDecimal(e,t){return(t||new El).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDecimal(e,t){return e.setPosition(e.position()+ln),(t||new El).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}scale(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}bitWidth(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readInt32(this.bb_pos+e):128}static startDecimal(e){e.startObject(3)}static addPrecision(e,t){e.addFieldInt32(0,t,0)}static addScale(e,t){e.addFieldInt32(1,t,0)}static addBitWidth(e,t){e.addFieldInt32(2,t,128)}static endDecimal(e){return e.endObject()}static createDecimal(e,t,i,r){return El.startDecimal(e),El.addPrecision(e,t),El.addScale(e,i),El.addBitWidth(e,r),El.endDecimal(e)}},zy=class _h{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDuration(e,t){return(t||new _h).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDuration(e,t){return e.setPosition(e.position()+ln),(t||new _h).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):ot.MILLISECOND}static startDuration(e){e.startObject(1)}static addUnit(e,t){e.addFieldInt16(0,t,ot.MILLISECOND)}static endDuration(e){return e.endObject()}static createDuration(e,t){return _h.startDuration(e),_h.addUnit(e,t),_h.endDuration(e)}},Gy=class yh{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFixedSizeBinary(e,t){return(t||new yh).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFixedSizeBinary(e,t){return e.setPosition(e.position()+ln),(t||new yh).__init(e.readInt32(e.position())+e.position(),e)}byteWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeBinary(e){e.startObject(1)}static addByteWidth(e,t){e.addFieldInt32(0,t,0)}static endFixedSizeBinary(e){return e.endObject()}static createFixedSizeBinary(e,t){return yh.startFixedSizeBinary(e),yh.addByteWidth(e,t),yh.endFixedSizeBinary(e)}},Vy=class vh{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFixedSizeList(e,t){return(t||new vh).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFixedSizeList(e,t){return e.setPosition(e.position()+ln),(t||new vh).__init(e.readInt32(e.position())+e.position(),e)}listSize(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeList(e){e.startObject(1)}static addListSize(e,t){e.addFieldInt32(0,t,0)}static endFixedSizeList(e){return e.endObject()}static createFixedSizeList(e,t){return vh.startFixedSizeList(e),vh.addListSize(e,t),vh.endFixedSizeList(e)}};class Pa{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFloatingPoint(e,t){return(t||new Pa).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFloatingPoint(e,t){return e.setPosition(e.position()+ln),(t||new Pa).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):nr.HALF}static startFloatingPoint(e){e.startObject(1)}static addPrecision(e,t){e.addFieldInt16(0,t,nr.HALF)}static endFloatingPoint(e){return e.endObject()}static createFloatingPoint(e,t){return Pa.startFloatingPoint(e),Pa.addPrecision(e,t),Pa.endFloatingPoint(e)}}class Ua{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsInterval(e,t){return(t||new Ua).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInterval(e,t){return e.setPosition(e.position()+ln),(t||new Ua).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Ja.YEAR_MONTH}static startInterval(e){e.startObject(1)}static addUnit(e,t){e.addFieldInt16(0,t,Ja.YEAR_MONTH)}static endInterval(e){return e.endObject()}static createInterval(e,t){return Ua.startInterval(e),Ua.addUnit(e,t),Ua.endInterval(e)}}let eL=class Dp{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsLargeBinary(e,t){return(t||new Dp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsLargeBinary(e,t){return e.setPosition(e.position()+ln),(t||new Dp).__init(e.readInt32(e.position())+e.position(),e)}static startLargeBinary(e){e.startObject(0)}static endLargeBinary(e){return e.endObject()}static createLargeBinary(e){return Dp.startLargeBinary(e),Dp.endLargeBinary(e)}},tL=class Lp{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsLargeUtf8(e,t){return(t||new Lp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsLargeUtf8(e,t){return e.setPosition(e.position()+ln),(t||new Lp).__init(e.readInt32(e.position())+e.position(),e)}static startLargeUtf8(e){e.startObject(0)}static endLargeUtf8(e){return e.endObject()}static createLargeUtf8(e){return Lp.startLargeUtf8(e),Lp.endLargeUtf8(e)}},nL=class Pp{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsList(e,t){return(t||new Pp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsList(e,t){return e.setPosition(e.position()+ln),(t||new Pp).__init(e.readInt32(e.position())+e.position(),e)}static startList(e){e.startObject(0)}static endList(e){return e.endObject()}static createList(e){return Pp.startList(e),Pp.endList(e)}},Hy=class bh{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsMap(e,t){return(t||new bh).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMap(e,t){return e.setPosition(e.position()+ln),(t||new bh).__init(e.readInt32(e.position())+e.position(),e)}keysSorted(){const e=this.bb.__offset(this.bb_pos,4);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startMap(e){e.startObject(1)}static addKeysSorted(e,t){e.addFieldInt8(0,+t,0)}static endMap(e){return e.endObject()}static createMap(e,t){return bh.startMap(e),bh.addKeysSorted(e,t),bh.endMap(e)}},iL=class Up{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsNull(e,t){return(t||new Up).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsNull(e,t){return e.setPosition(e.position()+ln),(t||new Up).__init(e.readInt32(e.position())+e.position(),e)}static startNull(e){e.startObject(0)}static endNull(e){return e.endObject()}static createNull(e){return Up.startNull(e),Up.endNull(e)}};class Qu{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsStruct_(e,t){return(t||new Qu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsStruct_(e,t){return e.setPosition(e.position()+ln),(t||new Qu).__init(e.readInt32(e.position())+e.position(),e)}static startStruct_(e){e.startObject(0)}static endStruct_(e){return e.endObject()}static createStruct_(e){return Qu.startStruct_(e),Qu.endStruct_(e)}}class Ps{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsTime(e,t){return(t||new Ps).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTime(e,t){return e.setPosition(e.position()+ln),(t||new Ps).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):ot.MILLISECOND}bitWidth(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):32}static startTime(e){e.startObject(2)}static addUnit(e,t){e.addFieldInt16(0,t,ot.MILLISECOND)}static addBitWidth(e,t){e.addFieldInt32(1,t,32)}static endTime(e){return e.endObject()}static createTime(e,t,i){return Ps.startTime(e),Ps.addUnit(e,t),Ps.addBitWidth(e,i),Ps.endTime(e)}}class Us{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsTimestamp(e,t){return(t||new Us).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTimestamp(e,t){return e.setPosition(e.position()+ln),(t||new Us).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):ot.SECOND}timezone(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}static startTimestamp(e){e.startObject(2)}static addUnit(e,t){e.addFieldInt16(0,t,ot.SECOND)}static addTimezone(e,t){e.addFieldOffset(1,t,0)}static endTimestamp(e){return e.endObject()}static createTimestamp(e,t,i){return Us.startTimestamp(e),Us.addUnit(e,t),Us.addTimezone(e,i),Us.endTimestamp(e)}}class Pr{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsUnion(e,t){return(t||new Pr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUnion(e,t){return e.setPosition(e.position()+ln),(t||new Pr).__init(e.readInt32(e.position())+e.position(),e)}mode(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):sr.Sparse}typeIds(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb.__vector(this.bb_pos+t)+e*4):0}typeIdsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}typeIdsArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}static startUnion(e){e.startObject(2)}static addMode(e,t){e.addFieldInt16(0,t,sr.Sparse)}static addTypeIds(e,t){e.addFieldOffset(1,t,0)}static createTypeIdsVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addInt32(t[i]);return e.endVector()}static startTypeIdsVector(e,t){e.startVector(4,t,4)}static endUnion(e){return e.endObject()}static createUnion(e,t,i){return Pr.startUnion(e),Pr.addMode(e,t),Pr.addTypeIds(e,i),Pr.endUnion(e)}}let rL=class Op{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsUtf8(e,t){return(t||new Op).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUtf8(e,t){return e.setPosition(e.position()+ln),(t||new Op).__init(e.readInt32(e.position())+e.position(),e)}static startUtf8(e){e.startObject(0)}static endUtf8(e){return e.endObject()}static createUtf8(e){return Op.startUtf8(e),Op.endUtf8(e)}};var Cn;(function(n){n[n.NONE=0]="NONE",n[n.Null=1]="Null",n[n.Int=2]="Int",n[n.FloatingPoint=3]="FloatingPoint",n[n.Binary=4]="Binary",n[n.Utf8=5]="Utf8",n[n.Bool=6]="Bool",n[n.Decimal=7]="Decimal",n[n.Date=8]="Date",n[n.Time=9]="Time",n[n.Timestamp=10]="Timestamp",n[n.Interval=11]="Interval",n[n.List=12]="List",n[n.Struct_=13]="Struct_",n[n.Union=14]="Union",n[n.FixedSizeBinary=15]="FixedSizeBinary",n[n.FixedSizeList=16]="FixedSizeList",n[n.Map=17]="Map",n[n.Duration=18]="Duration",n[n.LargeBinary=19]="LargeBinary",n[n.LargeUtf8=20]="LargeUtf8",n[n.LargeList=21]="LargeList",n[n.RunEndEncoded=22]="RunEndEncoded"})(Cn||(Cn={}));let ws=class $y{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsField(e,t){return(t||new $y).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsField(e,t){return e.setPosition(e.position()+ln),(t||new $y).__init(e.readInt32(e.position())+e.position(),e)}name(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}nullable(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}typeType(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):Cn.NONE}type(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__union(e,this.bb_pos+t):null}dictionary(e){const t=this.bb.__offset(this.bb_pos,12);return t?(e||new Lo).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}children(e,t){const i=this.bb.__offset(this.bb_pos,14);return i?(t||new $y).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}childrenLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,t){const i=this.bb.__offset(this.bb_pos,16);return i?(t||new Ei).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__vector_len(this.bb_pos+e):0}static startField(e){e.startObject(7)}static addName(e,t){e.addFieldOffset(0,t,0)}static addNullable(e,t){e.addFieldInt8(1,+t,0)}static addTypeType(e,t){e.addFieldInt8(2,t,Cn.NONE)}static addType(e,t){e.addFieldOffset(3,t,0)}static addDictionary(e,t){e.addFieldOffset(4,t,0)}static addChildren(e,t){e.addFieldOffset(5,t,0)}static createChildrenVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startChildrenVector(e,t){e.startVector(4,t,4)}static addCustomMetadata(e,t){e.addFieldOffset(6,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static endField(e){return e.endObject()}},Aa=class vo{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSchema(e,t){return(t||new vo).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSchema(e,t){return e.setPosition(e.position()+ln),(t||new vo).__init(e.readInt32(e.position())+e.position(),e)}endianness(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):uf.Little}fields(e,t){const i=this.bb.__offset(this.bb_pos,6);return i?(t||new ws).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}fieldsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,t){const i=this.bb.__offset(this.bb_pos,8);return i?(t||new Ei).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}features(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb.__vector(this.bb_pos+t)+e*8):BigInt(0)}featuresLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}static startSchema(e){e.startObject(4)}static addEndianness(e,t){e.addFieldInt16(0,t,uf.Little)}static addFields(e,t){e.addFieldOffset(1,t,0)}static createFieldsVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startFieldsVector(e,t){e.startVector(4,t,4)}static addCustomMetadata(e,t){e.addFieldOffset(2,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static addFeatures(e,t){e.addFieldOffset(3,t,0)}static createFeaturesVector(e,t){e.startVector(8,t.length,8);for(let i=t.length-1;i>=0;i--)e.addInt64(t[i]);return e.endVector()}static startFeaturesVector(e,t){e.startVector(8,t,8)}static endSchema(e){return e.endObject()}static finishSchemaBuffer(e,t){e.finish(t)}static finishSizePrefixedSchemaBuffer(e,t){e.finish(t,void 0,!0)}static createSchema(e,t,i,r,s){return vo.startSchema(e),vo.addEndianness(e,t),vo.addFields(e,i),vo.addCustomMetadata(e,r),vo.addFeatures(e,s),vo.endSchema(e)}};var Qt;(function(n){n[n.NONE=0]="NONE",n[n.Schema=1]="Schema",n[n.DictionaryBatch=2]="DictionaryBatch",n[n.RecordBatch=3]="RecordBatch",n[n.Tensor=4]="Tensor",n[n.SparseTensor=5]="SparseTensor"})(Qt||(Qt={}));var B;(function(n){n[n.NONE=0]="NONE",n[n.Null=1]="Null",n[n.Int=2]="Int",n[n.Float=3]="Float",n[n.Binary=4]="Binary",n[n.Utf8=5]="Utf8",n[n.Bool=6]="Bool",n[n.Decimal=7]="Decimal",n[n.Date=8]="Date",n[n.Time=9]="Time",n[n.Timestamp=10]="Timestamp",n[n.Interval=11]="Interval",n[n.List=12]="List",n[n.Struct=13]="Struct",n[n.Union=14]="Union",n[n.FixedSizeBinary=15]="FixedSizeBinary",n[n.FixedSizeList=16]="FixedSizeList",n[n.Map=17]="Map",n[n.Duration=18]="Duration",n[n.LargeBinary=19]="LargeBinary",n[n.LargeUtf8=20]="LargeUtf8",n[n.Dictionary=-1]="Dictionary",n[n.Int8=-2]="Int8",n[n.Int16=-3]="Int16",n[n.Int32=-4]="Int32",n[n.Int64=-5]="Int64",n[n.Uint8=-6]="Uint8",n[n.Uint16=-7]="Uint16",n[n.Uint32=-8]="Uint32",n[n.Uint64=-9]="Uint64",n[n.Float16=-10]="Float16",n[n.Float32=-11]="Float32",n[n.Float64=-12]="Float64",n[n.DateDay=-13]="DateDay",n[n.DateMillisecond=-14]="DateMillisecond",n[n.TimestampSecond=-15]="TimestampSecond",n[n.TimestampMillisecond=-16]="TimestampMillisecond",n[n.TimestampMicrosecond=-17]="TimestampMicrosecond",n[n.TimestampNanosecond=-18]="TimestampNanosecond",n[n.TimeSecond=-19]="TimeSecond",n[n.TimeMillisecond=-20]="TimeMillisecond",n[n.TimeMicrosecond=-21]="TimeMicrosecond",n[n.TimeNanosecond=-22]="TimeNanosecond",n[n.DenseUnion=-23]="DenseUnion",n[n.SparseUnion=-24]="SparseUnion",n[n.IntervalDayTime=-25]="IntervalDayTime",n[n.IntervalYearMonth=-26]="IntervalYearMonth",n[n.DurationSecond=-27]="DurationSecond",n[n.DurationMillisecond=-28]="DurationMillisecond",n[n.DurationMicrosecond=-29]="DurationMicrosecond",n[n.DurationNanosecond=-30]="DurationNanosecond"})(B||(B={}));var So;(function(n){n[n.OFFSET=0]="OFFSET",n[n.DATA=1]="DATA",n[n.VALIDITY=2]="VALIDITY",n[n.TYPE=3]="TYPE"})(So||(So={}));const Lce=void 0;function Ym(n){if(n===null)return"null";if(n===Lce)return"undefined";switch(typeof n){case"number":return`${n}`;case"bigint":return`${n}`;case"string":return`"${n}"`}return typeof n[Symbol.toPrimitive]=="function"?n[Symbol.toPrimitive]("string"):ArrayBuffer.isView(n)?n instanceof BigInt64Array||n instanceof BigUint64Array?`[${[...n].map(e=>Ym(e))}]`:`[${n}]`:ArrayBuffer.isView(n)?`[${n}]`:JSON.stringify(n,(e,t)=>typeof t=="bigint"?`${t}`:t)}function Rn(n){if(typeof n=="bigint"&&(n<Number.MIN_SAFE_INTEGER||n>Number.MAX_SAFE_INTEGER))throw new TypeError(`${n} is not safe to convert to a number.`);return Number(n)}function hk(n,e){return Rn(n/e)+Rn(n%e)/Rn(e)}const Pce=Symbol.for("isArrowBigNum");function ma(n,...e){return e.length===0?Object.setPrototypeOf(dn(this.TypedArray,n),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(n,...e),this.constructor.prototype)}ma.prototype[Pce]=!0;ma.prototype.toJSON=function(){return`"${Qm(this)}"`};ma.prototype.valueOf=function(n){return dk(this,n)};ma.prototype.toString=function(){return Qm(this)};ma.prototype[Symbol.toPrimitive]=function(n="default"){switch(n){case"number":return dk(this);case"string":return Qm(this);case"default":return Ice(this)}return Qm(this)};function ld(...n){return ma.apply(this,n)}function ud(...n){return ma.apply(this,n)}function Km(...n){return ma.apply(this,n)}Object.setPrototypeOf(ld.prototype,Object.create(Int32Array.prototype));Object.setPrototypeOf(ud.prototype,Object.create(Uint32Array.prototype));Object.setPrototypeOf(Km.prototype,Object.create(Uint32Array.prototype));Object.assign(ld.prototype,ma.prototype,{constructor:ld,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array});Object.assign(ud.prototype,ma.prototype,{constructor:ud,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array});Object.assign(Km.prototype,ma.prototype,{constructor:Km,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});const Uce=BigInt(4294967296)*BigInt(4294967296),Oce=Uce-BigInt(1);function dk(n,e){const{buffer:t,byteOffset:i,byteLength:r,signed:s}=n,a=new BigUint64Array(t,i,r/8),o=s&&a.at(-1)&BigInt(1)<<BigInt(63);let l=BigInt(0),u=0;if(o){for(const c of a)l|=(c^Oce)*(BigInt(1)<<BigInt(64*u++));l*=BigInt(-1),l-=BigInt(1)}else for(const c of a)l|=c*(BigInt(1)<<BigInt(64*u++));if(typeof e=="number"){const c=BigInt(Math.pow(10,e)),h=l/c,d=l%c;return Rn(h)+Rn(d)/Rn(c)}return Rn(l)}function Qm(n){if(n.byteLength===8)return`${new n.BigIntArray(n.buffer,n.byteOffset,1)[0]}`;if(!n.signed)return eT(n);let e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2);if(new Int16Array([e.at(-1)])[0]>=0)return eT(n);e=e.slice();let i=1;for(let s=0;s<e.length;s++){const a=e[s],o=~a+i;e[s]=o,i&=a===0?1:0}return`-${eT(e)}`}function Ice(n){return n.byteLength===8?new n.BigIntArray(n.buffer,n.byteOffset,1)[0]:Qm(n)}function eT(n){let e="";const t=new Uint32Array(2);let i=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2);const r=new Uint32Array((i=new Uint16Array(i).reverse()).buffer);let s=-1;const a=i.length-1;do{for(t[0]=i[s=0];s<a;)i[s++]=t[1]=t[0]/10,t[0]=(t[0]-t[1]*10<<16)+i[s];i[s]=t[1]=t[0]/10,t[0]=t[0]-t[1]*10,e=`${t[0]}${e}`}while(r[0]||r[1]||r[2]||r[3]);return e??"0"}class uR{static new(e,t){switch(t){case!0:return new ld(e);case!1:return new ud(e)}switch(e.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new ld(e)}return e.byteLength===16?new Km(e):new ud(e)}static signed(e){return new ld(e)}static unsigned(e){return new ud(e)}static decimal(e){return new Km(e)}constructor(e,t){return uR.new(e,t)}}var fk,pk,mk,gk,_k,yk,vk,bk,Sk,xk,Tk,Ek,Mk,wk,Ak,Rk,Nk,Ck,Dk,Lk,Pk,Uk;class Ge{static isNull(e){return(e==null?void 0:e.typeId)===B.Null}static isInt(e){return(e==null?void 0:e.typeId)===B.Int}static isFloat(e){return(e==null?void 0:e.typeId)===B.Float}static isBinary(e){return(e==null?void 0:e.typeId)===B.Binary}static isLargeBinary(e){return(e==null?void 0:e.typeId)===B.LargeBinary}static isUtf8(e){return(e==null?void 0:e.typeId)===B.Utf8}static isLargeUtf8(e){return(e==null?void 0:e.typeId)===B.LargeUtf8}static isBool(e){return(e==null?void 0:e.typeId)===B.Bool}static isDecimal(e){return(e==null?void 0:e.typeId)===B.Decimal}static isDate(e){return(e==null?void 0:e.typeId)===B.Date}static isTime(e){return(e==null?void 0:e.typeId)===B.Time}static isTimestamp(e){return(e==null?void 0:e.typeId)===B.Timestamp}static isInterval(e){return(e==null?void 0:e.typeId)===B.Interval}static isDuration(e){return(e==null?void 0:e.typeId)===B.Duration}static isList(e){return(e==null?void 0:e.typeId)===B.List}static isStruct(e){return(e==null?void 0:e.typeId)===B.Struct}static isUnion(e){return(e==null?void 0:e.typeId)===B.Union}static isFixedSizeBinary(e){return(e==null?void 0:e.typeId)===B.FixedSizeBinary}static isFixedSizeList(e){return(e==null?void 0:e.typeId)===B.FixedSizeList}static isMap(e){return(e==null?void 0:e.typeId)===B.Map}static isDictionary(e){return(e==null?void 0:e.typeId)===B.Dictionary}static isDenseUnion(e){return Ge.isUnion(e)&&e.mode===sr.Dense}static isSparseUnion(e){return Ge.isUnion(e)&&e.mode===sr.Sparse}constructor(e){this.typeId=e}}fk=Symbol.toStringTag;Ge[fk]=(n=>(n.children=null,n.ArrayType=Array,n.OffsetArrayType=Int32Array,n[Symbol.toStringTag]="DataType"))(Ge.prototype);class lu extends Ge{constructor(){super(B.Null)}toString(){return"Null"}}pk=Symbol.toStringTag;lu[pk]=(n=>n[Symbol.toStringTag]="Null")(lu.prototype);class Tc extends Ge{constructor(e,t){super(B.Int),this.isSigned=e,this.bitWidth=t}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}mk=Symbol.toStringTag;Tc[mk]=(n=>(n.isSigned=null,n.bitWidth=null,n[Symbol.toStringTag]="Int"))(Tc.prototype);class Zm extends Tc{constructor(){super(!0,32)}get ArrayType(){return Int32Array}}Object.defineProperty(Zm.prototype,"ArrayType",{value:Int32Array});class Zv extends Ge{constructor(e){super(B.Float),this.precision=e}get ArrayType(){switch(this.precision){case nr.HALF:return Uint16Array;case nr.SINGLE:return Float32Array;case nr.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}}gk=Symbol.toStringTag;Zv[gk]=(n=>(n.precision=null,n[Symbol.toStringTag]="Float"))(Zv.prototype);class Jv extends Ge{constructor(){super(B.Binary)}toString(){return"Binary"}}_k=Symbol.toStringTag;Jv[_k]=(n=>(n.ArrayType=Uint8Array,n[Symbol.toStringTag]="Binary"))(Jv.prototype);class e0 extends Ge{constructor(){super(B.LargeBinary)}toString(){return"LargeBinary"}}yk=Symbol.toStringTag;e0[yk]=(n=>(n.ArrayType=Uint8Array,n.OffsetArrayType=BigInt64Array,n[Symbol.toStringTag]="LargeBinary"))(e0.prototype);class t0 extends Ge{constructor(){super(B.Utf8)}toString(){return"Utf8"}}vk=Symbol.toStringTag;t0[vk]=(n=>(n.ArrayType=Uint8Array,n[Symbol.toStringTag]="Utf8"))(t0.prototype);class n0 extends Ge{constructor(){super(B.LargeUtf8)}toString(){return"LargeUtf8"}}bk=Symbol.toStringTag;n0[bk]=(n=>(n.ArrayType=Uint8Array,n.OffsetArrayType=BigInt64Array,n[Symbol.toStringTag]="LargeUtf8"))(n0.prototype);class i0 extends Ge{constructor(){super(B.Bool)}toString(){return"Bool"}}Sk=Symbol.toStringTag;i0[Sk]=(n=>(n.ArrayType=Uint8Array,n[Symbol.toStringTag]="Bool"))(i0.prototype);class r0 extends Ge{constructor(e,t,i=128){super(B.Decimal),this.scale=e,this.precision=t,this.bitWidth=i}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}}xk=Symbol.toStringTag;r0[xk]=(n=>(n.scale=null,n.precision=null,n.ArrayType=Uint32Array,n[Symbol.toStringTag]="Decimal"))(r0.prototype);class s0 extends Ge{constructor(e){super(B.Date),this.unit=e}toString(){return`Date${(this.unit+1)*32}<${js[this.unit]}>`}get ArrayType(){return this.unit===js.DAY?Int32Array:BigInt64Array}}Tk=Symbol.toStringTag;s0[Tk]=(n=>(n.unit=null,n[Symbol.toStringTag]="Date"))(s0.prototype);class a0 extends Ge{constructor(e,t){super(B.Time),this.unit=e,this.bitWidth=t}toString(){return`Time${this.bitWidth}<${ot[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}}Ek=Symbol.toStringTag;a0[Ek]=(n=>(n.unit=null,n.bitWidth=null,n[Symbol.toStringTag]="Time"))(a0.prototype);class o0 extends Ge{constructor(e,t){super(B.Timestamp),this.unit=e,this.timezone=t}toString(){return`Timestamp<${ot[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}}Mk=Symbol.toStringTag;o0[Mk]=(n=>(n.unit=null,n.timezone=null,n.ArrayType=BigInt64Array,n[Symbol.toStringTag]="Timestamp"))(o0.prototype);class l0 extends Ge{constructor(e){super(B.Interval),this.unit=e}toString(){return`Interval<${Ja[this.unit]}>`}}wk=Symbol.toStringTag;l0[wk]=(n=>(n.unit=null,n.ArrayType=Int32Array,n[Symbol.toStringTag]="Interval"))(l0.prototype);class u0 extends Ge{constructor(e){super(B.Duration),this.unit=e}toString(){return`Duration<${ot[this.unit]}>`}}Ak=Symbol.toStringTag;u0[Ak]=(n=>(n.unit=null,n.ArrayType=BigInt64Array,n[Symbol.toStringTag]="Duration"))(u0.prototype);class c0 extends Ge{constructor(e){super(B.List),this.children=[e]}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}}Rk=Symbol.toStringTag;c0[Rk]=(n=>(n.children=null,n[Symbol.toStringTag]="List"))(c0.prototype);class _r extends Ge{constructor(e){super(B.Struct),this.children=e}toString(){return`Struct<{${this.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}Nk=Symbol.toStringTag;_r[Nk]=(n=>(n.children=null,n[Symbol.toStringTag]="Struct"))(_r.prototype);class h0 extends Ge{constructor(e,t,i){super(B.Union),this.mode=e,this.children=i,this.typeIds=t=Int32Array.from(t),this.typeIdToChildIndex=t.reduce((r,s,a)=>(r[s]=a)&&r||r,Object.create(null))}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(e=>`${e.type}`).join(" | ")}>`}}Ck=Symbol.toStringTag;h0[Ck]=(n=>(n.mode=null,n.typeIds=null,n.children=null,n.typeIdToChildIndex=null,n.ArrayType=Int8Array,n[Symbol.toStringTag]="Union"))(h0.prototype);class d0 extends Ge{constructor(e){super(B.FixedSizeBinary),this.byteWidth=e}toString(){return`FixedSizeBinary[${this.byteWidth}]`}}Dk=Symbol.toStringTag;d0[Dk]=(n=>(n.byteWidth=null,n.ArrayType=Uint8Array,n[Symbol.toStringTag]="FixedSizeBinary"))(d0.prototype);class f0 extends Ge{constructor(e,t){super(B.FixedSizeList),this.listSize=e,this.children=[t]}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}}Lk=Symbol.toStringTag;f0[Lk]=(n=>(n.children=null,n.listSize=null,n[Symbol.toStringTag]="FixedSizeList"))(f0.prototype);class p0 extends Ge{constructor(e,t=!1){var i,r,s;if(super(B.Map),this.children=[e],this.keysSorted=t,e&&(e.name="entries",!((i=e==null?void 0:e.type)===null||i===void 0)&&i.children)){const a=(r=e==null?void 0:e.type)===null||r===void 0?void 0:r.children[0];a&&(a.name="key");const o=(s=e==null?void 0:e.type)===null||s===void 0?void 0:s.children[1];o&&(o.name="value")}}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}Pk=Symbol.toStringTag;p0[Pk]=(n=>(n.children=null,n.keysSorted=null,n[Symbol.toStringTag]="Map_"))(p0.prototype);const Bce=(n=>()=>++n)(-1);class cf extends Ge{constructor(e,t,i,r){super(B.Dictionary),this.indices=t,this.dictionary=e,this.isOrdered=r||!1,this.id=i==null?Bce():Rn(i)}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}}Uk=Symbol.toStringTag;cf[Uk]=(n=>(n.id=null,n.indices=null,n.isOrdered=null,n.dictionary=null,n[Symbol.toStringTag]="Dictionary"))(cf.prototype);function xo(n){const e=n;switch(n.typeId){case B.Decimal:return n.bitWidth/32;case B.Interval:return 1+e.unit;case B.FixedSizeList:return e.listSize;case B.FixedSizeBinary:return e.byteWidth;default:return 1}}class Ut{visitMany(e,...t){return e.map((i,r)=>this.visit(i,...t.map(s=>s[r])))}visit(...e){return this.getVisitFn(e[0],!1).apply(this,e)}getVisitFn(e,t=!0){return Fce(this,e,t)}getVisitFnByTypeId(e,t=!0){return Sh(this,e,t)}visitNull(e,...t){return null}visitBool(e,...t){return null}visitInt(e,...t){return null}visitFloat(e,...t){return null}visitUtf8(e,...t){return null}visitLargeUtf8(e,...t){return null}visitBinary(e,...t){return null}visitLargeBinary(e,...t){return null}visitFixedSizeBinary(e,...t){return null}visitDate(e,...t){return null}visitTimestamp(e,...t){return null}visitTime(e,...t){return null}visitDecimal(e,...t){return null}visitList(e,...t){return null}visitStruct(e,...t){return null}visitUnion(e,...t){return null}visitDictionary(e,...t){return null}visitInterval(e,...t){return null}visitDuration(e,...t){return null}visitFixedSizeList(e,...t){return null}visitMap(e,...t){return null}}function Fce(n,e,t=!0){return typeof e=="number"?Sh(n,e,t):typeof e=="string"&&e in B?Sh(n,B[e],t):e&&e instanceof Ge?Sh(n,sL(e),t):e!=null&&e.type&&e.type instanceof Ge?Sh(n,sL(e.type),t):Sh(n,B.NONE,t)}function Sh(n,e,t=!0){let i=null;switch(e){case B.Null:i=n.visitNull;break;case B.Bool:i=n.visitBool;break;case B.Int:i=n.visitInt;break;case B.Int8:i=n.visitInt8||n.visitInt;break;case B.Int16:i=n.visitInt16||n.visitInt;break;case B.Int32:i=n.visitInt32||n.visitInt;break;case B.Int64:i=n.visitInt64||n.visitInt;break;case B.Uint8:i=n.visitUint8||n.visitInt;break;case B.Uint16:i=n.visitUint16||n.visitInt;break;case B.Uint32:i=n.visitUint32||n.visitInt;break;case B.Uint64:i=n.visitUint64||n.visitInt;break;case B.Float:i=n.visitFloat;break;case B.Float16:i=n.visitFloat16||n.visitFloat;break;case B.Float32:i=n.visitFloat32||n.visitFloat;break;case B.Float64:i=n.visitFloat64||n.visitFloat;break;case B.Utf8:i=n.visitUtf8;break;case B.LargeUtf8:i=n.visitLargeUtf8;break;case B.Binary:i=n.visitBinary;break;case B.LargeBinary:i=n.visitLargeBinary;break;case B.FixedSizeBinary:i=n.visitFixedSizeBinary;break;case B.Date:i=n.visitDate;break;case B.DateDay:i=n.visitDateDay||n.visitDate;break;case B.DateMillisecond:i=n.visitDateMillisecond||n.visitDate;break;case B.Timestamp:i=n.visitTimestamp;break;case B.TimestampSecond:i=n.visitTimestampSecond||n.visitTimestamp;break;case B.TimestampMillisecond:i=n.visitTimestampMillisecond||n.visitTimestamp;break;case B.TimestampMicrosecond:i=n.visitTimestampMicrosecond||n.visitTimestamp;break;case B.TimestampNanosecond:i=n.visitTimestampNanosecond||n.visitTimestamp;break;case B.Time:i=n.visitTime;break;case B.TimeSecond:i=n.visitTimeSecond||n.visitTime;break;case B.TimeMillisecond:i=n.visitTimeMillisecond||n.visitTime;break;case B.TimeMicrosecond:i=n.visitTimeMicrosecond||n.visitTime;break;case B.TimeNanosecond:i=n.visitTimeNanosecond||n.visitTime;break;case B.Decimal:i=n.visitDecimal;break;case B.List:i=n.visitList;break;case B.Struct:i=n.visitStruct;break;case B.Union:i=n.visitUnion;break;case B.DenseUnion:i=n.visitDenseUnion||n.visitUnion;break;case B.SparseUnion:i=n.visitSparseUnion||n.visitUnion;break;case B.Dictionary:i=n.visitDictionary;break;case B.Interval:i=n.visitInterval;break;case B.IntervalDayTime:i=n.visitIntervalDayTime||n.visitInterval;break;case B.IntervalYearMonth:i=n.visitIntervalYearMonth||n.visitInterval;break;case B.Duration:i=n.visitDuration;break;case B.DurationSecond:i=n.visitDurationSecond||n.visitDuration;break;case B.DurationMillisecond:i=n.visitDurationMillisecond||n.visitDuration;break;case B.DurationMicrosecond:i=n.visitDurationMicrosecond||n.visitDuration;break;case B.DurationNanosecond:i=n.visitDurationNanosecond||n.visitDuration;break;case B.FixedSizeList:i=n.visitFixedSizeList;break;case B.Map:i=n.visitMap;break}if(typeof i=="function")return i;if(!t)return()=>null;throw new Error(`Unrecognized type '${B[e]}'`)}function sL(n){switch(n.typeId){case B.Null:return B.Null;case B.Int:{const{bitWidth:e,isSigned:t}=n;switch(e){case 8:return t?B.Int8:B.Uint8;case 16:return t?B.Int16:B.Uint16;case 32:return t?B.Int32:B.Uint32;case 64:return t?B.Int64:B.Uint64}return B.Int}case B.Float:switch(n.precision){case nr.HALF:return B.Float16;case nr.SINGLE:return B.Float32;case nr.DOUBLE:return B.Float64}return B.Float;case B.Binary:return B.Binary;case B.LargeBinary:return B.LargeBinary;case B.Utf8:return B.Utf8;case B.LargeUtf8:return B.LargeUtf8;case B.Bool:return B.Bool;case B.Decimal:return B.Decimal;case B.Time:switch(n.unit){case ot.SECOND:return B.TimeSecond;case ot.MILLISECOND:return B.TimeMillisecond;case ot.MICROSECOND:return B.TimeMicrosecond;case ot.NANOSECOND:return B.TimeNanosecond}return B.Time;case B.Timestamp:switch(n.unit){case ot.SECOND:return B.TimestampSecond;case ot.MILLISECOND:return B.TimestampMillisecond;case ot.MICROSECOND:return B.TimestampMicrosecond;case ot.NANOSECOND:return B.TimestampNanosecond}return B.Timestamp;case B.Date:switch(n.unit){case js.DAY:return B.DateDay;case js.MILLISECOND:return B.DateMillisecond}return B.Date;case B.Interval:switch(n.unit){case Ja.DAY_TIME:return B.IntervalDayTime;case Ja.YEAR_MONTH:return B.IntervalYearMonth}return B.Interval;case B.Duration:switch(n.unit){case ot.SECOND:return B.DurationSecond;case ot.MILLISECOND:return B.DurationMillisecond;case ot.MICROSECOND:return B.DurationMicrosecond;case ot.NANOSECOND:return B.DurationNanosecond}return B.Duration;case B.Map:return B.Map;case B.List:return B.List;case B.Struct:return B.Struct;case B.Union:switch(n.mode){case sr.Dense:return B.DenseUnion;case sr.Sparse:return B.SparseUnion}return B.Union;case B.FixedSizeBinary:return B.FixedSizeBinary;case B.FixedSizeList:return B.FixedSizeList;case B.Dictionary:return B.Dictionary}throw new Error(`Unrecognized type '${B[n.typeId]}'`)}Ut.prototype.visitInt8=null;Ut.prototype.visitInt16=null;Ut.prototype.visitInt32=null;Ut.prototype.visitInt64=null;Ut.prototype.visitUint8=null;Ut.prototype.visitUint16=null;Ut.prototype.visitUint32=null;Ut.prototype.visitUint64=null;Ut.prototype.visitFloat16=null;Ut.prototype.visitFloat32=null;Ut.prototype.visitFloat64=null;Ut.prototype.visitDateDay=null;Ut.prototype.visitDateMillisecond=null;Ut.prototype.visitTimestampSecond=null;Ut.prototype.visitTimestampMillisecond=null;Ut.prototype.visitTimestampMicrosecond=null;Ut.prototype.visitTimestampNanosecond=null;Ut.prototype.visitTimeSecond=null;Ut.prototype.visitTimeMillisecond=null;Ut.prototype.visitTimeMicrosecond=null;Ut.prototype.visitTimeNanosecond=null;Ut.prototype.visitDenseUnion=null;Ut.prototype.visitSparseUnion=null;Ut.prototype.visitIntervalDayTime=null;Ut.prototype.visitIntervalYearMonth=null;Ut.prototype.visitDuration=null;Ut.prototype.visitDurationSecond=null;Ut.prototype.visitDurationMillisecond=null;Ut.prototype.visitDurationMicrosecond=null;Ut.prototype.visitDurationNanosecond=null;const Ok=new Float64Array(1),uh=new Uint32Array(Ok.buffer);function Ik(n){const e=(n&31744)>>10,t=(n&1023)/1024,i=Math.pow(-1,(n&32768)>>15);switch(e){case 31:return i*(t?Number.NaN:1/0);case 0:return i*(t?6103515625e-14*t:0)}return i*Math.pow(2,e-15)*(1+t)}function kce(n){if(n!==n)return 32256;Ok[0]=n;const e=(uh[1]&2147483648)>>16&65535;let t=uh[1]&2146435072,i=0;return t>=1089470464?uh[0]>0?t=31744:(t=(t&2080374784)>>16,i=(uh[1]&1048575)>>10):t<=1056964608?(i=1048576+(uh[1]&1048575),i=1048576+(i<<(t>>20)-998)>>21,t=0):(t=t-1056964608>>10,i=(uh[1]&1048575)+512>>10),e|t|i&65535}class ut extends Ut{}function ft(n){return(e,t,i)=>{if(e.setValid(t,i!=null))return n(e,t,i)}}const zce=(n,e,t)=>{n[e]=Math.floor(t/864e5)},Bk=(n,e,t,i)=>{if(t+1<e.length){const r=Rn(e[t]),s=Rn(e[t+1]);n.set(i.subarray(0,s-r),r)}},Gce=({offset:n,values:e},t,i)=>{const r=n+t;i?e[r>>3]|=1<<r%8:e[r>>3]&=~(1<<r%8)},ll=({values:n},e,t)=>{n[e]=t},cR=({values:n},e,t)=>{n[e]=t},Fk=({values:n},e,t)=>{n[e]=kce(t)},Vce=(n,e,t)=>{switch(n.type.precision){case nr.HALF:return Fk(n,e,t);case nr.SINGLE:case nr.DOUBLE:return cR(n,e,t)}},kk=({values:n},e,t)=>{zce(n,e,t.valueOf())},zk=({values:n},e,t)=>{n[e]=BigInt(t)},Hce=({stride:n,values:e},t,i)=>{e.set(i.subarray(0,n),n*t)},Gk=({values:n,valueOffsets:e},t,i)=>Bk(n,e,t,i),Vk=({values:n,valueOffsets:e},t,i)=>Bk(n,e,t,aR(i)),$ce=(n,e,t)=>{n.type.unit===js.DAY?kk(n,e,t):zk(n,e,t)},Hk=({values:n},e,t)=>{n[e]=BigInt(t/1e3)},$k=({values:n},e,t)=>{n[e]=BigInt(t)},Wk=({values:n},e,t)=>{n[e]=BigInt(t*1e3)},jk=({values:n},e,t)=>{n[e]=BigInt(t*1e6)},Wce=(n,e,t)=>{switch(n.type.unit){case ot.SECOND:return Hk(n,e,t);case ot.MILLISECOND:return $k(n,e,t);case ot.MICROSECOND:return Wk(n,e,t);case ot.NANOSECOND:return jk(n,e,t)}},qk=({values:n},e,t)=>{n[e]=t},Xk=({values:n},e,t)=>{n[e]=t},Yk=({values:n},e,t)=>{n[e]=t},Kk=({values:n},e,t)=>{n[e]=t},jce=(n,e,t)=>{switch(n.type.unit){case ot.SECOND:return qk(n,e,t);case ot.MILLISECOND:return Xk(n,e,t);case ot.MICROSECOND:return Yk(n,e,t);case ot.NANOSECOND:return Kk(n,e,t)}},qce=({values:n,stride:e},t,i)=>{n.set(i.subarray(0,e),e*t)},Xce=(n,e,t)=>{const i=n.children[0],r=n.valueOffsets,s=qs.getVisitFn(i);if(Array.isArray(t))for(let a=-1,o=r[e],l=r[e+1];o<l;)s(i,o++,t[++a]);else for(let a=-1,o=r[e],l=r[e+1];o<l;)s(i,o++,t.get(++a))},Yce=(n,e,t)=>{const i=n.children[0],{valueOffsets:r}=n,s=qs.getVisitFn(i);let{[e]:a,[e+1]:o}=r;const l=t instanceof Map?t.entries():Object.entries(t);for(const u of l)if(s(i,a,u),++a>=o)break},Kce=(n,e)=>(t,i,r,s)=>i&&t(i,n,e[s]),Qce=(n,e)=>(t,i,r,s)=>i&&t(i,n,e.get(s)),Zce=(n,e)=>(t,i,r,s)=>i&&t(i,n,e.get(r.name)),Jce=(n,e)=>(t,i,r,s)=>i&&t(i,n,e[r.name]),ehe=(n,e,t)=>{const i=n.type.children.map(s=>qs.getVisitFn(s.type)),r=t instanceof Map?Zce(e,t):t instanceof sn?Qce(e,t):Array.isArray(t)?Kce(e,t):Jce(e,t);n.type.children.forEach((s,a)=>r(i[a],n.children[a],s,a))},the=(n,e,t)=>{n.type.mode===sr.Dense?Qk(n,e,t):Zk(n,e,t)},Qk=(n,e,t)=>{const i=n.type.typeIdToChildIndex[n.typeIds[e]],r=n.children[i];qs.visit(r,n.valueOffsets[e],t)},Zk=(n,e,t)=>{const i=n.type.typeIdToChildIndex[n.typeIds[e]],r=n.children[i];qs.visit(r,e,t)},nhe=(n,e,t)=>{var i;(i=n.dictionary)===null||i===void 0||i.set(n.values[e],t)},ihe=(n,e,t)=>{n.type.unit===Ja.DAY_TIME?Jk(n,e,t):ez(n,e,t)},Jk=({values:n},e,t)=>{n.set(t.subarray(0,2),2*e)},ez=({values:n},e,t)=>{n[e]=t[0]*12+t[1]%12},tz=({values:n},e,t)=>{n[e]=t},nz=({values:n},e,t)=>{n[e]=t},iz=({values:n},e,t)=>{n[e]=t},rz=({values:n},e,t)=>{n[e]=t},rhe=(n,e,t)=>{switch(n.type.unit){case ot.SECOND:return tz(n,e,t);case ot.MILLISECOND:return nz(n,e,t);case ot.MICROSECOND:return iz(n,e,t);case ot.NANOSECOND:return rz(n,e,t)}},she=(n,e,t)=>{const{stride:i}=n,r=n.children[0],s=qs.getVisitFn(r);if(Array.isArray(t))for(let a=-1,o=e*i;++a<i;)s(r,o+a,t[a]);else for(let a=-1,o=e*i;++a<i;)s(r,o+a,t.get(a))};ut.prototype.visitBool=ft(Gce);ut.prototype.visitInt=ft(ll);ut.prototype.visitInt8=ft(ll);ut.prototype.visitInt16=ft(ll);ut.prototype.visitInt32=ft(ll);ut.prototype.visitInt64=ft(ll);ut.prototype.visitUint8=ft(ll);ut.prototype.visitUint16=ft(ll);ut.prototype.visitUint32=ft(ll);ut.prototype.visitUint64=ft(ll);ut.prototype.visitFloat=ft(Vce);ut.prototype.visitFloat16=ft(Fk);ut.prototype.visitFloat32=ft(cR);ut.prototype.visitFloat64=ft(cR);ut.prototype.visitUtf8=ft(Vk);ut.prototype.visitLargeUtf8=ft(Vk);ut.prototype.visitBinary=ft(Gk);ut.prototype.visitLargeBinary=ft(Gk);ut.prototype.visitFixedSizeBinary=ft(Hce);ut.prototype.visitDate=ft($ce);ut.prototype.visitDateDay=ft(kk);ut.prototype.visitDateMillisecond=ft(zk);ut.prototype.visitTimestamp=ft(Wce);ut.prototype.visitTimestampSecond=ft(Hk);ut.prototype.visitTimestampMillisecond=ft($k);ut.prototype.visitTimestampMicrosecond=ft(Wk);ut.prototype.visitTimestampNanosecond=ft(jk);ut.prototype.visitTime=ft(jce);ut.prototype.visitTimeSecond=ft(qk);ut.prototype.visitTimeMillisecond=ft(Xk);ut.prototype.visitTimeMicrosecond=ft(Yk);ut.prototype.visitTimeNanosecond=ft(Kk);ut.prototype.visitDecimal=ft(qce);ut.prototype.visitList=ft(Xce);ut.prototype.visitStruct=ft(ehe);ut.prototype.visitUnion=ft(the);ut.prototype.visitDenseUnion=ft(Qk);ut.prototype.visitSparseUnion=ft(Zk);ut.prototype.visitDictionary=ft(nhe);ut.prototype.visitInterval=ft(ihe);ut.prototype.visitIntervalDayTime=ft(Jk);ut.prototype.visitIntervalYearMonth=ft(ez);ut.prototype.visitDuration=ft(rhe);ut.prototype.visitDurationSecond=ft(tz);ut.prototype.visitDurationMillisecond=ft(nz);ut.prototype.visitDurationMicrosecond=ft(iz);ut.prototype.visitDurationNanosecond=ft(rz);ut.prototype.visitFixedSizeList=ft(she);ut.prototype.visitMap=ft(Yce);const qs=new ut,na=Symbol.for("parent"),cd=Symbol.for("rowIndex");class hR{constructor(e,t){return this[na]=e,this[cd]=t,new Proxy(this,new ohe)}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[cd],t=this[na],i=t.type.children,r={};for(let s=-1,a=i.length;++s<a;)r[i[s].name]=jr.visit(t.children[s],e);return r}toString(){return`{${[...this].map(([e,t])=>`${Ym(e)}: ${Ym(t)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new ahe(this[na],this[cd])}}class ahe{constructor(e,t){this.childIndex=0,this.children=e.children,this.rowIndex=t,this.childFields=e.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const e=this.childIndex;return e<this.numChildren?(this.childIndex=e+1,{done:!1,value:[this.childFields[e].name,jr.visit(this.children[e],this.rowIndex)]}):{done:!0,value:null}}}Object.defineProperties(hR.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[na]:{writable:!0,enumerable:!1,configurable:!1,value:null},[cd]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});class ohe{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[na].type.children.map(t=>t.name)}has(e,t){return e[na].type.children.findIndex(i=>i.name===t)!==-1}getOwnPropertyDescriptor(e,t){if(e[na].type.children.findIndex(i=>i.name===t)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(e,t){if(Reflect.has(e,t))return e[t];const i=e[na].type.children.findIndex(r=>r.name===t);if(i!==-1){const r=jr.visit(e[na].children[i],e[cd]);return Reflect.set(e,t,r),r}}set(e,t,i){const r=e[na].type.children.findIndex(s=>s.name===t);return r!==-1?(qs.visit(e[na].children[r],e[cd],i),Reflect.set(e,t,i)):Reflect.has(e,t)||typeof t=="symbol"?Reflect.set(e,t,i):!1}}class tt extends Ut{}function ct(n){return(e,t)=>e.getValid(t)?n(e,t):null}const lhe=(n,e)=>864e5*n[e],uhe=(n,e)=>null,sz=(n,e,t)=>{if(t+1>=e.length)return null;const i=Rn(e[t]),r=Rn(e[t+1]);return n.subarray(i,r)},che=({offset:n,values:e},t)=>{const i=n+t;return(e[i>>3]&1<<i%8)!==0},az=({values:n},e)=>lhe(n,e),oz=({values:n},e)=>Rn(n[e]),Su=({stride:n,values:e},t)=>e[n*t],hhe=({stride:n,values:e},t)=>Ik(e[n*t]),lz=({values:n},e)=>n[e],dhe=({stride:n,values:e},t)=>e.subarray(n*t,n*(t+1)),uz=({values:n,valueOffsets:e},t)=>sz(n,e,t),cz=({values:n,valueOffsets:e},t)=>{const i=sz(n,e,t);return i!==null?nM(i):null},fhe=({values:n},e)=>n[e],phe=({type:n,values:e},t)=>n.precision!==nr.HALF?e[t]:Ik(e[t]),mhe=(n,e)=>n.type.unit===js.DAY?az(n,e):oz(n,e),hz=({values:n},e)=>1e3*Rn(n[e]),dz=({values:n},e)=>Rn(n[e]),fz=({values:n},e)=>hk(n[e],BigInt(1e3)),pz=({values:n},e)=>hk(n[e],BigInt(1e6)),ghe=(n,e)=>{switch(n.type.unit){case ot.SECOND:return hz(n,e);case ot.MILLISECOND:return dz(n,e);case ot.MICROSECOND:return fz(n,e);case ot.NANOSECOND:return pz(n,e)}},mz=({values:n},e)=>n[e],gz=({values:n},e)=>n[e],_z=({values:n},e)=>n[e],yz=({values:n},e)=>n[e],_he=(n,e)=>{switch(n.type.unit){case ot.SECOND:return mz(n,e);case ot.MILLISECOND:return gz(n,e);case ot.MICROSECOND:return _z(n,e);case ot.NANOSECOND:return yz(n,e)}},yhe=({values:n,stride:e},t)=>uR.decimal(n.subarray(e*t,e*(t+1))),vhe=(n,e)=>{const{valueOffsets:t,stride:i,children:r}=n,{[e*i]:s,[e*i+1]:a}=t,l=r[0].slice(s,a-s);return new sn([l])},bhe=(n,e)=>{const{valueOffsets:t,children:i}=n,{[e]:r,[e+1]:s}=t,a=i[0];return new dR(a.slice(r,s-r))},She=(n,e)=>new hR(n,e),xhe=(n,e)=>n.type.mode===sr.Dense?vz(n,e):bz(n,e),vz=(n,e)=>{const t=n.type.typeIdToChildIndex[n.typeIds[e]],i=n.children[t];return jr.visit(i,n.valueOffsets[e])},bz=(n,e)=>{const t=n.type.typeIdToChildIndex[n.typeIds[e]],i=n.children[t];return jr.visit(i,e)},The=(n,e)=>{var t;return(t=n.dictionary)===null||t===void 0?void 0:t.get(n.values[e])},Ehe=(n,e)=>n.type.unit===Ja.DAY_TIME?Sz(n,e):xz(n,e),Sz=({values:n},e)=>n.subarray(2*e,2*(e+1)),xz=({values:n},e)=>{const t=n[e],i=new Int32Array(2);return i[0]=Math.trunc(t/12),i[1]=Math.trunc(t%12),i},Tz=({values:n},e)=>n[e],Ez=({values:n},e)=>n[e],Mz=({values:n},e)=>n[e],wz=({values:n},e)=>n[e],Mhe=(n,e)=>{switch(n.type.unit){case ot.SECOND:return Tz(n,e);case ot.MILLISECOND:return Ez(n,e);case ot.MICROSECOND:return Mz(n,e);case ot.NANOSECOND:return wz(n,e)}},whe=(n,e)=>{const{stride:t,children:i}=n,s=i[0].slice(e*t,t);return new sn([s])};tt.prototype.visitNull=ct(uhe);tt.prototype.visitBool=ct(che);tt.prototype.visitInt=ct(fhe);tt.prototype.visitInt8=ct(Su);tt.prototype.visitInt16=ct(Su);tt.prototype.visitInt32=ct(Su);tt.prototype.visitInt64=ct(lz);tt.prototype.visitUint8=ct(Su);tt.prototype.visitUint16=ct(Su);tt.prototype.visitUint32=ct(Su);tt.prototype.visitUint64=ct(lz);tt.prototype.visitFloat=ct(phe);tt.prototype.visitFloat16=ct(hhe);tt.prototype.visitFloat32=ct(Su);tt.prototype.visitFloat64=ct(Su);tt.prototype.visitUtf8=ct(cz);tt.prototype.visitLargeUtf8=ct(cz);tt.prototype.visitBinary=ct(uz);tt.prototype.visitLargeBinary=ct(uz);tt.prototype.visitFixedSizeBinary=ct(dhe);tt.prototype.visitDate=ct(mhe);tt.prototype.visitDateDay=ct(az);tt.prototype.visitDateMillisecond=ct(oz);tt.prototype.visitTimestamp=ct(ghe);tt.prototype.visitTimestampSecond=ct(hz);tt.prototype.visitTimestampMillisecond=ct(dz);tt.prototype.visitTimestampMicrosecond=ct(fz);tt.prototype.visitTimestampNanosecond=ct(pz);tt.prototype.visitTime=ct(_he);tt.prototype.visitTimeSecond=ct(mz);tt.prototype.visitTimeMillisecond=ct(gz);tt.prototype.visitTimeMicrosecond=ct(_z);tt.prototype.visitTimeNanosecond=ct(yz);tt.prototype.visitDecimal=ct(yhe);tt.prototype.visitList=ct(vhe);tt.prototype.visitStruct=ct(She);tt.prototype.visitUnion=ct(xhe);tt.prototype.visitDenseUnion=ct(vz);tt.prototype.visitSparseUnion=ct(bz);tt.prototype.visitDictionary=ct(The);tt.prototype.visitInterval=ct(Ehe);tt.prototype.visitIntervalDayTime=ct(Sz);tt.prototype.visitIntervalYearMonth=ct(xz);tt.prototype.visitDuration=ct(Mhe);tt.prototype.visitDurationSecond=ct(Tz);tt.prototype.visitDurationMillisecond=ct(Ez);tt.prototype.visitDurationMicrosecond=ct(Mz);tt.prototype.visitDurationNanosecond=ct(wz);tt.prototype.visitFixedSizeList=ct(whe);tt.prototype.visitMap=ct(bhe);const jr=new tt,xh=Symbol.for("keys"),hd=Symbol.for("vals"),Th=Symbol.for("kKeysAsStrings"),lM=Symbol.for("_kKeysAsStrings");class dR{constructor(e){return this[xh]=new sn([e.children[0]]).memoize(),this[hd]=e.children[1],new Proxy(this,new Rhe)}get[Th](){return this[lM]||(this[lM]=Array.from(this[xh].toArray(),String))}[Symbol.iterator](){return new Ahe(this[xh],this[hd])}get size(){return this[xh].length}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[xh],t=this[hd],i={};for(let r=-1,s=e.length;++r<s;)i[e.get(r)]=jr.visit(t,r);return i}toString(){return`{${[...this].map(([e,t])=>`${Ym(e)}: ${Ym(t)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}class Ahe{constructor(e,t){this.keys=e,this.vals=t,this.keyIndex=0,this.numKeys=e.length}[Symbol.iterator](){return this}next(){const e=this.keyIndex;return e===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(e),jr.visit(this.vals,e)]})}}class Rhe{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[Th]}has(e,t){return e[Th].includes(t)}getOwnPropertyDescriptor(e,t){if(e[Th].indexOf(t)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(e,t){if(Reflect.has(e,t))return e[t];const i=e[Th].indexOf(t);if(i!==-1){const r=jr.visit(Reflect.get(e,hd),i);return Reflect.set(e,t,r),r}}set(e,t,i){const r=e[Th].indexOf(t);return r!==-1?(qs.visit(Reflect.get(e,hd),r,i),Reflect.set(e,t,i)):Reflect.has(e,t)?Reflect.set(e,t,i):!1}}Object.defineProperties(dR.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[xh]:{writable:!0,enumerable:!1,configurable:!1,value:null},[hd]:{writable:!0,enumerable:!1,configurable:!1,value:null},[lM]:{writable:!0,enumerable:!1,configurable:!1,value:null}});let aL;function Az(n,e,t,i){const{length:r=0}=n;let s=typeof e!="number"?0:e,a=typeof t!="number"?r:t;return s<0&&(s=(s%r+r)%r),a<0&&(a=(a%r+r)%r),a<s&&(aL=s,s=a,a=aL),a>r&&(a=r),i?i(n,s,a):[s,a]}const fR=(n,e)=>n<0?e+n:n,oL=n=>n!==n;function Uf(n){if(typeof n!=="object"||n===null)return oL(n)?oL:t=>t===n;if(n instanceof Date){const t=n.valueOf();return i=>i instanceof Date?i.valueOf()===t:!1}return ArrayBuffer.isView(n)?t=>t?wce(n,t):!1:n instanceof Map?Che(n):Array.isArray(n)?Nhe(n):n instanceof sn?Dhe(n):Lhe(n,!0)}function Nhe(n){const e=[];for(let t=-1,i=n.length;++t<i;)e[t]=Uf(n[t]);return Ab(e)}function Che(n){let e=-1;const t=[];for(const i of n.values())t[++e]=Uf(i);return Ab(t)}function Dhe(n){const e=[];for(let t=-1,i=n.length;++t<i;)e[t]=Uf(n.get(t));return Ab(e)}function Lhe(n,e=!1){const t=Object.keys(n);if(!e&&t.length===0)return()=>!1;const i=[];for(let r=-1,s=t.length;++r<s;)i[r]=Uf(n[t[r]]);return Ab(i,t)}function Ab(n,e){return t=>{if(!t||typeof t!="object")return!1;switch(t.constructor){case Array:return Phe(n,t);case Map:return lL(n,t,t.keys());case dR:case hR:case Object:case void 0:return lL(n,t,e||Object.keys(t))}return t instanceof sn?Uhe(n,t):!1}}function Phe(n,e){const t=n.length;if(e.length!==t)return!1;for(let i=-1;++i<t;)if(!n[i](e[i]))return!1;return!0}function Uhe(n,e){const t=n.length;if(e.length!==t)return!1;for(let i=-1;++i<t;)if(!n[i](e.get(i)))return!1;return!0}function lL(n,e,t){const i=t[Symbol.iterator](),r=e instanceof Map?e.keys():Object.keys(e)[Symbol.iterator](),s=e instanceof Map?e.values():Object.values(e)[Symbol.iterator]();let a=0;const o=n.length;let l=s.next(),u=i.next(),c=r.next();for(;a<o&&!u.done&&!c.done&&!l.done&&!(u.value!==c.value||!n[a](l.value));++a,u=i.next(),c=r.next(),l=s.next());return a===o&&u.done&&c.done&&l.done?!0:(i.return&&i.return(),r.return&&r.return(),s.return&&s.return(),!1)}function Rz(n,e,t,i){return(t&1<<i)!==0}function Ohe(n,e,t,i){return(t&1<<i)>>i}function m0(n,e,t){const i=t.byteLength+7&-8;if(n>0||t.byteLength<i){const r=new Uint8Array(i);return r.set(n%8===0?t.subarray(n>>3):g0(new pR(t,n,e,null,Rz)).subarray(0,i)),r}return t}function g0(n){const e=[];let t=0,i=0,r=0;for(const a of n)a&&(r|=1<<i),++i===8&&(e[t++]=r,r=i=0);(t===0||i>0)&&(e[t++]=r);const s=new Uint8Array(e.length+7&-8);return s.set(e),s}class pR{constructor(e,t,i,r,s){this.bytes=e,this.length=i,this.context=r,this.get=s,this.bit=t%8,this.byteIndex=t>>3,this.byte=e[this.byteIndex++],this.index=0}next(){return this.index<this.length?(this.bit===8&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}}function uM(n,e,t){if(t-e<=0)return 0;if(t-e<8){let s=0;for(const a of new pR(n,e,t-e,n,Ohe))s+=a;return s}const i=t>>3<<3,r=e+(e%8===0?0:8-e%8);return uM(n,e,r)+uM(n,i,t)+Ihe(n,r>>3,i-r>>3)}function Ihe(n,e,t){let i=0,r=Math.trunc(e);const s=new DataView(n.buffer,n.byteOffset,n.byteLength),a=t===void 0?n.byteLength:r+t;for(;a-r>=4;)i+=tT(s.getUint32(r)),r+=4;for(;a-r>=2;)i+=tT(s.getUint16(r)),r+=2;for(;a-r>=1;)i+=tT(s.getUint8(r)),r+=1;return i}function tT(n){let e=Math.trunc(n);return e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),(e+(e>>>4)&252645135)*16843009>>>24}const Bhe=-1;class un{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get nullable(){if(this._nullCount!==0){const{type:e}=this;return Ge.isSparseUnion(e)?this.children.some(t=>t.nullable):Ge.isDenseUnion(e)?this.children.some(t=>t.nullable):this.nullBitmap&&this.nullBitmap.byteLength>0}return!0}get byteLength(){let e=0;const{valueOffsets:t,values:i,nullBitmap:r,typeIds:s}=this;return t&&(e+=t.byteLength),i&&(e+=i.byteLength),r&&(e+=r.byteLength),s&&(e+=s.byteLength),this.children.reduce((a,o)=>a+o.byteLength,e)}get nullCount(){if(Ge.isUnion(this.type))return this.children.reduce((i,r)=>i+r.nullCount,0);let e=this._nullCount,t;return e<=Bhe&&(t=this.nullBitmap)&&(this._nullCount=e=t.length===0?0:this.length-uM(t,this.offset,this.offset+this.length)),e}constructor(e,t,i,r,s,a=[],o){this.type=e,this.children=a,this.dictionary=o,this.offset=Math.floor(Math.max(t||0,0)),this.length=Math.floor(Math.max(i||0,0)),this._nullCount=Math.floor(Math.max(r||0,-1));let l;s instanceof un?(this.stride=s.stride,this.values=s.values,this.typeIds=s.typeIds,this.nullBitmap=s.nullBitmap,this.valueOffsets=s.valueOffsets):(this.stride=xo(e),s&&((l=s[0])&&(this.valueOffsets=l),(l=s[1])&&(this.values=l),(l=s[2])&&(this.nullBitmap=l),(l=s[3])&&(this.typeIds=l)))}getValid(e){const{type:t}=this;if(Ge.isUnion(t)){const i=t,r=this.children[i.typeIdToChildIndex[this.typeIds[e]]],s=i.mode===sr.Dense?this.valueOffsets[e]:e;return r.getValid(s)}if(this.nullable&&this.nullCount>0){const i=this.offset+e;return(this.nullBitmap[i>>3]&1<<i%8)!==0}return!0}setValid(e,t){let i;const{type:r}=this;if(Ge.isUnion(r)){const s=r,a=this.children[s.typeIdToChildIndex[this.typeIds[e]]],o=s.mode===sr.Dense?this.valueOffsets[e]:e;i=a.getValid(o),a.setValid(o,t)}else{let{nullBitmap:s}=this;const{offset:a,length:o}=this,l=a+e,u=1<<l%8,c=l>>3;(!s||s.byteLength<=c)&&(s=new Uint8Array((a+o+63&-64)>>3).fill(255),this.nullCount>0?(s.set(m0(a,o,this.nullBitmap),0),Object.assign(this,{nullBitmap:s})):Object.assign(this,{nullBitmap:s,_nullCount:0}));const h=s[c];i=(h&u)!==0,s[c]=t?h|u:h&~u}return i!==!!t&&(this._nullCount=this.nullCount+(t?-1:1)),t}clone(e=this.type,t=this.offset,i=this.length,r=this._nullCount,s=this,a=this.children){return new un(e,t,i,r,s,a,this.dictionary)}slice(e,t){const{stride:i,typeId:r,children:s}=this,a=+(this._nullCount===0)-1,o=r===16?i:1,l=this._sliceBuffers(e,t,i,r);return this.clone(this.type,this.offset+e,t,a,l,s.length===0||this.valueOffsets?s:this._sliceChildren(s,o*e,o*t))}_changeLengthAndBackfillNullBitmap(e){if(this.typeId===B.Null)return this.clone(this.type,0,e,0);const{length:t,nullCount:i}=this,r=new Uint8Array((e+63&-64)>>3).fill(255,0,t>>3);r[t>>3]=(1<<t-(t&-8))-1,i>0&&r.set(m0(this.offset,t,this.nullBitmap),0);const s=this.buffers;return s[So.VALIDITY]=r,this.clone(this.type,0,e,i+(e-t),s)}_sliceBuffers(e,t,i,r){let s;const{buffers:a}=this;return(s=a[So.TYPE])&&(a[So.TYPE]=s.subarray(e,e+t)),(s=a[So.OFFSET])&&(a[So.OFFSET]=s.subarray(e,e+t+1))||(s=a[So.DATA])&&(a[So.DATA]=r===6?s:s.subarray(i*e,i*(e+t))),a}_sliceChildren(e,t,i){return e.map(r=>r.slice(t,i))}}un.prototype.children=Object.freeze([]);class um extends Ut{visit(e){return this.getVisitFn(e.type).call(this,e)}visitNull(e){const{["type"]:t,["offset"]:i=0,["length"]:r=0}=e;return new un(t,i,r,r)}visitBool(e){const{["type"]:t,["offset"]:i=0}=e,r=Vt(e.nullBitmap),s=dn(t.ArrayType,e.data),{["length"]:a=s.length>>3,["nullCount"]:o=e.nullBitmap?-1:0}=e;return new un(t,i,a,o,[void 0,s,r])}visitInt(e){const{["type"]:t,["offset"]:i=0}=e,r=Vt(e.nullBitmap),s=dn(t.ArrayType,e.data),{["length"]:a=s.length,["nullCount"]:o=e.nullBitmap?-1:0}=e;return new un(t,i,a,o,[void 0,s,r])}visitFloat(e){const{["type"]:t,["offset"]:i=0}=e,r=Vt(e.nullBitmap),s=dn(t.ArrayType,e.data),{["length"]:a=s.length,["nullCount"]:o=e.nullBitmap?-1:0}=e;return new un(t,i,a,o,[void 0,s,r])}visitUtf8(e){const{["type"]:t,["offset"]:i=0}=e,r=Vt(e.data),s=Vt(e.nullBitmap),a=gp(e.valueOffsets),{["length"]:o=a.length-1,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new un(t,i,o,l,[a,r,s])}visitLargeUtf8(e){const{["type"]:t,["offset"]:i=0}=e,r=Vt(e.data),s=Vt(e.nullBitmap),a=Y2(e.valueOffsets),{["length"]:o=a.length-1,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new un(t,i,o,l,[a,r,s])}visitBinary(e){const{["type"]:t,["offset"]:i=0}=e,r=Vt(e.data),s=Vt(e.nullBitmap),a=gp(e.valueOffsets),{["length"]:o=a.length-1,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new un(t,i,o,l,[a,r,s])}visitLargeBinary(e){const{["type"]:t,["offset"]:i=0}=e,r=Vt(e.data),s=Vt(e.nullBitmap),a=Y2(e.valueOffsets),{["length"]:o=a.length-1,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new un(t,i,o,l,[a,r,s])}visitFixedSizeBinary(e){const{["type"]:t,["offset"]:i=0}=e,r=Vt(e.nullBitmap),s=dn(t.ArrayType,e.data),{["length"]:a=s.length/xo(t),["nullCount"]:o=e.nullBitmap?-1:0}=e;return new un(t,i,a,o,[void 0,s,r])}visitDate(e){const{["type"]:t,["offset"]:i=0}=e,r=Vt(e.nullBitmap),s=dn(t.ArrayType,e.data),{["length"]:a=s.length/xo(t),["nullCount"]:o=e.nullBitmap?-1:0}=e;return new un(t,i,a,o,[void 0,s,r])}visitTimestamp(e){const{["type"]:t,["offset"]:i=0}=e,r=Vt(e.nullBitmap),s=dn(t.ArrayType,e.data),{["length"]:a=s.length/xo(t),["nullCount"]:o=e.nullBitmap?-1:0}=e;return new un(t,i,a,o,[void 0,s,r])}visitTime(e){const{["type"]:t,["offset"]:i=0}=e,r=Vt(e.nullBitmap),s=dn(t.ArrayType,e.data),{["length"]:a=s.length/xo(t),["nullCount"]:o=e.nullBitmap?-1:0}=e;return new un(t,i,a,o,[void 0,s,r])}visitDecimal(e){const{["type"]:t,["offset"]:i=0}=e,r=Vt(e.nullBitmap),s=dn(t.ArrayType,e.data),{["length"]:a=s.length/xo(t),["nullCount"]:o=e.nullBitmap?-1:0}=e;return new un(t,i,a,o,[void 0,s,r])}visitList(e){const{["type"]:t,["offset"]:i=0,["child"]:r}=e,s=Vt(e.nullBitmap),a=gp(e.valueOffsets),{["length"]:o=a.length-1,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new un(t,i,o,l,[a,void 0,s],[r])}visitStruct(e){const{["type"]:t,["offset"]:i=0,["children"]:r=[]}=e,s=Vt(e.nullBitmap),{length:a=r.reduce((l,{length:u})=>Math.max(l,u),0),nullCount:o=e.nullBitmap?-1:0}=e;return new un(t,i,a,o,[void 0,void 0,s],r)}visitUnion(e){const{["type"]:t,["offset"]:i=0,["children"]:r=[]}=e,s=dn(t.ArrayType,e.typeIds),{["length"]:a=s.length,["nullCount"]:o=-1}=e;if(Ge.isSparseUnion(t))return new un(t,i,a,o,[void 0,void 0,void 0,s],r);const l=gp(e.valueOffsets);return new un(t,i,a,o,[l,void 0,void 0,s],r)}visitDictionary(e){const{["type"]:t,["offset"]:i=0}=e,r=Vt(e.nullBitmap),s=dn(t.indices.ArrayType,e.data),{["dictionary"]:a=new sn([new um().visit({type:t.dictionary})])}=e,{["length"]:o=s.length,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new un(t,i,o,l,[void 0,s,r],[],a)}visitInterval(e){const{["type"]:t,["offset"]:i=0}=e,r=Vt(e.nullBitmap),s=dn(t.ArrayType,e.data),{["length"]:a=s.length/xo(t),["nullCount"]:o=e.nullBitmap?-1:0}=e;return new un(t,i,a,o,[void 0,s,r])}visitDuration(e){const{["type"]:t,["offset"]:i=0}=e,r=Vt(e.nullBitmap),s=dn(t.ArrayType,e.data),{["length"]:a=s.length,["nullCount"]:o=e.nullBitmap?-1:0}=e;return new un(t,i,a,o,[void 0,s,r])}visitFixedSizeList(e){const{["type"]:t,["offset"]:i=0,["child"]:r=new um().visit({type:t.valueType})}=e,s=Vt(e.nullBitmap),{["length"]:a=r.length/xo(t),["nullCount"]:o=e.nullBitmap?-1:0}=e;return new un(t,i,a,o,[void 0,void 0,s],[r])}visitMap(e){const{["type"]:t,["offset"]:i=0,["child"]:r=new um().visit({type:t.childType})}=e,s=Vt(e.nullBitmap),a=gp(e.valueOffsets),{["length"]:o=a.length-1,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new un(t,i,o,l,[a,void 0,s],[r])}}const Fhe=new um;function Ot(n){return Fhe.visit(n)}class uL{constructor(e=0,t){this.numChunks=e,this.getChunkIterator=t,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const e=this.chunkIterator.next();if(!e.done)return e;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}}function khe(n){return n.some(e=>e.nullable)}function Nz(n){return n.reduce((e,t)=>e+t.nullCount,0)}function Cz(n){return n.reduce((e,t,i)=>(e[i+1]=e[i]+t.length,e),new Uint32Array(n.length+1))}function Dz(n,e,t,i){const r=[];for(let s=-1,a=n.length;++s<a;){const o=n[s],l=e[s],{length:u}=o;if(l>=i)break;if(t>=l+u)continue;if(l>=t&&l+u<=i){r.push(o);continue}const c=Math.max(0,t-l),h=Math.min(i-l,u);r.push(o.slice(c,h-c))}return r.length===0&&r.push(n[0].slice(0,0)),r}function mR(n,e,t,i){let r=0,s=0,a=e.length-1;do{if(r>=a-1)return t<e[a]?i(n,r,t-e[r]):null;s=r+Math.trunc((a-r)*.5),t<e[s]?a=s:r=s}while(r<a)}function gR(n,e){return n.getValid(e)}function _0(n){function e(t,i,r){return n(t[i],r)}return function(t){const i=this.data;return mR(i,this._offsets,t,e)}}function Lz(n){let e;function t(i,r,s){return n(i[r],s,e)}return function(i,r){const s=this.data;e=r;const a=mR(s,this._offsets,i,t);return e=void 0,a}}function Pz(n){let e;function t(i,r,s){let a=s,o=0,l=0;for(let u=r-1,c=i.length;++u<c;){const h=i[u];if(~(o=n(h,e,a)))return l+o;a=0,l+=h.length}return-1}return function(i,r){e=i;const s=this.data,a=typeof r!="number"?t(s,0,0):mR(s,this._offsets,r,t);return e=void 0,a}}class nt extends Ut{}function zhe(n,e){return e===null&&n.length>0?0:-1}function Ghe(n,e){const{nullBitmap:t}=n;if(!t||n.nullCount<=0)return-1;let i=0;for(const r of new pR(t,n.offset+(e||0),n.length,t,Rz)){if(!r)return i;++i}return-1}function yt(n,e,t){if(e===void 0)return-1;if(e===null)switch(n.typeId){case B.Union:break;case B.Dictionary:break;default:return Ghe(n,t)}const i=jr.getVisitFn(n),r=Uf(e);for(let s=(t||0)-1,a=n.length;++s<a;)if(r(i(n,s)))return s;return-1}function Uz(n,e,t){const i=jr.getVisitFn(n),r=Uf(e);for(let s=(t||0)-1,a=n.length;++s<a;)if(r(i(n,s)))return s;return-1}nt.prototype.visitNull=zhe;nt.prototype.visitBool=yt;nt.prototype.visitInt=yt;nt.prototype.visitInt8=yt;nt.prototype.visitInt16=yt;nt.prototype.visitInt32=yt;nt.prototype.visitInt64=yt;nt.prototype.visitUint8=yt;nt.prototype.visitUint16=yt;nt.prototype.visitUint32=yt;nt.prototype.visitUint64=yt;nt.prototype.visitFloat=yt;nt.prototype.visitFloat16=yt;nt.prototype.visitFloat32=yt;nt.prototype.visitFloat64=yt;nt.prototype.visitUtf8=yt;nt.prototype.visitLargeUtf8=yt;nt.prototype.visitBinary=yt;nt.prototype.visitLargeBinary=yt;nt.prototype.visitFixedSizeBinary=yt;nt.prototype.visitDate=yt;nt.prototype.visitDateDay=yt;nt.prototype.visitDateMillisecond=yt;nt.prototype.visitTimestamp=yt;nt.prototype.visitTimestampSecond=yt;nt.prototype.visitTimestampMillisecond=yt;nt.prototype.visitTimestampMicrosecond=yt;nt.prototype.visitTimestampNanosecond=yt;nt.prototype.visitTime=yt;nt.prototype.visitTimeSecond=yt;nt.prototype.visitTimeMillisecond=yt;nt.prototype.visitTimeMicrosecond=yt;nt.prototype.visitTimeNanosecond=yt;nt.prototype.visitDecimal=yt;nt.prototype.visitList=yt;nt.prototype.visitStruct=yt;nt.prototype.visitUnion=yt;nt.prototype.visitDenseUnion=Uz;nt.prototype.visitSparseUnion=Uz;nt.prototype.visitDictionary=yt;nt.prototype.visitInterval=yt;nt.prototype.visitIntervalDayTime=yt;nt.prototype.visitIntervalYearMonth=yt;nt.prototype.visitDuration=yt;nt.prototype.visitDurationSecond=yt;nt.prototype.visitDurationMillisecond=yt;nt.prototype.visitDurationMicrosecond=yt;nt.prototype.visitDurationNanosecond=yt;nt.prototype.visitFixedSizeList=yt;nt.prototype.visitMap=yt;const y0=new nt;class it extends Ut{}function ht(n){const{type:e}=n;if(n.nullCount===0&&n.stride===1&&(Ge.isInt(e)&&e.bitWidth!==64||Ge.isTime(e)&&e.bitWidth!==64||Ge.isFloat(e)&&e.precision!==nr.HALF))return new uL(n.data.length,i=>{const r=n.data[i];return r.values.subarray(0,r.length)[Symbol.iterator]()});let t=0;return new uL(n.data.length,i=>{const s=n.data[i].length,a=n.slice(t,t+s);return t+=s,new Vhe(a)})}class Vhe{constructor(e){this.vector=e,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}}it.prototype.visitNull=ht;it.prototype.visitBool=ht;it.prototype.visitInt=ht;it.prototype.visitInt8=ht;it.prototype.visitInt16=ht;it.prototype.visitInt32=ht;it.prototype.visitInt64=ht;it.prototype.visitUint8=ht;it.prototype.visitUint16=ht;it.prototype.visitUint32=ht;it.prototype.visitUint64=ht;it.prototype.visitFloat=ht;it.prototype.visitFloat16=ht;it.prototype.visitFloat32=ht;it.prototype.visitFloat64=ht;it.prototype.visitUtf8=ht;it.prototype.visitLargeUtf8=ht;it.prototype.visitBinary=ht;it.prototype.visitLargeBinary=ht;it.prototype.visitFixedSizeBinary=ht;it.prototype.visitDate=ht;it.prototype.visitDateDay=ht;it.prototype.visitDateMillisecond=ht;it.prototype.visitTimestamp=ht;it.prototype.visitTimestampSecond=ht;it.prototype.visitTimestampMillisecond=ht;it.prototype.visitTimestampMicrosecond=ht;it.prototype.visitTimestampNanosecond=ht;it.prototype.visitTime=ht;it.prototype.visitTimeSecond=ht;it.prototype.visitTimeMillisecond=ht;it.prototype.visitTimeMicrosecond=ht;it.prototype.visitTimeNanosecond=ht;it.prototype.visitDecimal=ht;it.prototype.visitList=ht;it.prototype.visitStruct=ht;it.prototype.visitUnion=ht;it.prototype.visitDenseUnion=ht;it.prototype.visitSparseUnion=ht;it.prototype.visitDictionary=ht;it.prototype.visitInterval=ht;it.prototype.visitIntervalDayTime=ht;it.prototype.visitIntervalYearMonth=ht;it.prototype.visitDuration=ht;it.prototype.visitDurationSecond=ht;it.prototype.visitDurationMillisecond=ht;it.prototype.visitDurationMicrosecond=ht;it.prototype.visitDurationNanosecond=ht;it.prototype.visitFixedSizeList=ht;it.prototype.visitMap=ht;const _R=new it;var Oz;const Iz={},Bz={};class sn{constructor(e){var t,i,r;const s=e[0]instanceof sn?e.flatMap(o=>o.data):e;if(s.length===0||s.some(o=>!(o instanceof un)))throw new TypeError("Vector constructor expects an Array of Data instances.");const a=(t=s[0])===null||t===void 0?void 0:t.type;switch(s.length){case 0:this._offsets=[0];break;case 1:{const{get:o,set:l,indexOf:u}=Iz[a.typeId],c=s[0];this.isValid=h=>gR(c,h),this.get=h=>o(c,h),this.set=(h,d)=>l(c,h,d),this.indexOf=h=>u(c,h),this._offsets=[0,c.length];break}default:Object.setPrototypeOf(this,Bz[a.typeId]),this._offsets=Cz(s);break}this.data=s,this.type=a,this.stride=xo(a),this.numChildren=(r=(i=a.children)===null||i===void 0?void 0:i.length)!==null&&r!==void 0?r:0,this.length=this._offsets.at(-1)}get byteLength(){return this.data.reduce((e,t)=>e+t.byteLength,0)}get nullable(){return khe(this.data)}get nullCount(){return Nz(this.data)}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${B[this.type.typeId]}Vector`}isValid(e){return!1}get(e){return null}at(e){return this.get(fR(e,this.length))}set(e,t){}indexOf(e,t){return-1}includes(e,t){return this.indexOf(e,t)>-1}[Symbol.iterator](){return _R.visit(this)}concat(...e){return new sn(this.data.concat(e.flatMap(t=>t.data).flat(Number.POSITIVE_INFINITY)))}slice(e,t){return new sn(Az(this,e,t,({data:i,_offsets:r},s,a)=>Dz(i,r,s,a)))}toJSON(){return[...this]}toArray(){const{type:e,data:t,length:i,stride:r,ArrayType:s}=this;switch(e.typeId){case B.Int:case B.Float:case B.Decimal:case B.Time:case B.Timestamp:switch(t.length){case 0:return new s;case 1:return t[0].values.subarray(0,i*r);default:return t.reduce((a,{values:o,length:l})=>(a.array.set(o.subarray(0,l*r),a.offset),a.offset+=l*r,a),{array:new s(i*r),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(e){var t;return this.getChildAt((t=this.type.children)===null||t===void 0?void 0:t.findIndex(i=>i.name===e))}getChildAt(e){return e>-1&&e<this.numChildren?new sn(this.data.map(({children:t})=>t[e])):null}get isMemoized(){return Ge.isDictionary(this.type)?this.data[0].dictionary.isMemoized:!1}memoize(){if(Ge.isDictionary(this.type)){const e=new v0(this.data[0].dictionary),t=this.data.map(i=>{const r=i.clone();return r.dictionary=e,r});return new sn(t)}return new v0(this)}unmemoize(){if(Ge.isDictionary(this.type)&&this.isMemoized){const e=this.data[0].dictionary.unmemoize(),t=this.data.map(i=>{const r=i.clone();return r.dictionary=e,r});return new sn(t)}return this}}Oz=Symbol.toStringTag;sn[Oz]=(n=>{n.type=Ge.prototype,n.data=[],n.length=0,n.stride=1,n.numChildren=0,n._offsets=new Uint32Array([0]),n[Symbol.isConcatSpreadable]=!0;const e=Object.keys(B).map(t=>B[t]).filter(t=>typeof t=="number"&&t!==B.NONE);for(const t of e){const i=jr.getVisitFnByTypeId(t),r=qs.getVisitFnByTypeId(t),s=y0.getVisitFnByTypeId(t);Iz[t]={get:i,set:r,indexOf:s},Bz[t]=Object.create(n,{isValid:{value:_0(gR)},get:{value:_0(jr.getVisitFnByTypeId(t))},set:{value:Lz(qs.getVisitFnByTypeId(t))},indexOf:{value:Pz(y0.getVisitFnByTypeId(t))}})}return"Vector"})(sn.prototype);class v0 extends sn{constructor(e){super(e.data);const t=this.get,i=this.set,r=this.slice,s=new Array(this.length);Object.defineProperty(this,"get",{value(a){const o=s[a];if(o!==void 0)return o;const l=t.call(this,a);return s[a]=l,l}}),Object.defineProperty(this,"set",{value(a,o){i.call(this,a,o),s[a]=o}}),Object.defineProperty(this,"slice",{value:(a,o)=>new v0(r.call(this,a,o))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new sn(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}}class cM{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(e,t,i,r){return e.prep(8,24),e.writeInt64(BigInt(r??0)),e.pad(4),e.writeInt32(i),e.writeInt64(BigInt(t??0)),e.offset()}}class rs{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFooter(e,t){return(t||new rs).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFooter(e,t){return e.setPosition(e.position()+ln),(t||new rs).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):ci.V1}schema(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new Aa).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}dictionaries(e,t){const i=this.bb.__offset(this.bb_pos,8);return i?(t||new cM).__init(this.bb.__vector(this.bb_pos+i)+e*24,this.bb):null}dictionariesLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}recordBatches(e,t){const i=this.bb.__offset(this.bb_pos,10);return i?(t||new cM).__init(this.bb.__vector(this.bb_pos+i)+e*24,this.bb):null}recordBatchesLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,t){const i=this.bb.__offset(this.bb_pos,12);return i?(t||new Ei).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFooter(e){e.startObject(5)}static addVersion(e,t){e.addFieldInt16(0,t,ci.V1)}static addSchema(e,t){e.addFieldOffset(1,t,0)}static addDictionaries(e,t){e.addFieldOffset(2,t,0)}static startDictionariesVector(e,t){e.startVector(24,t,8)}static addRecordBatches(e,t){e.addFieldOffset(3,t,0)}static startRecordBatchesVector(e,t){e.startVector(24,t,8)}static addCustomMetadata(e,t){e.addFieldOffset(4,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static endFooter(e){return e.endObject()}static finishFooterBuffer(e,t){e.finish(t)}static finishSizePrefixedFooterBuffer(e,t){e.finish(t,void 0,!0)}}class an{constructor(e=[],t,i,r=ci.V5){this.fields=e||[],this.metadata=t||new Map,i||(i=hM(this.fields)),this.dictionaries=i,this.metadataVersion=r}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(e=>e.name)}toString(){return`Schema<{ ${this.fields.map((e,t)=>`${t}: ${e}`).join(", ")} }>`}select(e){const t=new Set(e),i=this.fields.filter(r=>t.has(r.name));return new an(i,this.metadata)}selectAt(e){const t=e.map(i=>this.fields[i]).filter(Boolean);return new an(t,this.metadata)}assign(...e){const t=e[0]instanceof an?e[0]:Array.isArray(e[0])?new an(e[0]):new an(e),i=[...this.fields],r=cy(cy(new Map,this.metadata),t.metadata),s=t.fields.filter(o=>{const l=i.findIndex(u=>u.name===o.name);return~l?(i[l]=o.clone({metadata:cy(cy(new Map,i[l].metadata),o.metadata)}))&&!1:!0}),a=hM(s,new Map);return new an([...i,...s],r,new Map([...this.dictionaries,...a]))}}an.prototype.fields=null;an.prototype.metadata=null;an.prototype.dictionaries=null;class Bn{static new(...e){let[t,i,r,s]=e;return e[0]&&typeof e[0]=="object"&&({name:t}=e[0],i===void 0&&(i=e[0].type),r===void 0&&(r=e[0].nullable),s===void 0&&(s=e[0].metadata)),new Bn(`${t}`,i,r,s)}constructor(e,t,i=!1,r){this.name=e,this.type=t,this.nullable=i,this.metadata=r||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...e){let[t,i,r,s]=e;return!e[0]||typeof e[0]!="object"?[t=this.name,i=this.type,r=this.nullable,s=this.metadata]=e:{name:t=this.name,type:i=this.type,nullable:r=this.nullable,metadata:s=this.metadata}=e[0],Bn.new(t,i,r,s)}}Bn.prototype.type=null;Bn.prototype.name=null;Bn.prototype.nullable=null;Bn.prototype.metadata=null;function cy(n,e){return new Map([...n||new Map,...e||new Map])}function hM(n,e=new Map){for(let t=-1,i=n.length;++t<i;){const s=n[t].type;if(Ge.isDictionary(s)){if(!e.has(s.id))e.set(s.id,s.dictionary);else if(e.get(s.id)!==s.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}s.children&&s.children.length>0&&hM(s.children,e)}return e}var Hhe=ok,$he=lf;class Jm{static decode(e){e=new $he(Vt(e));const t=rs.getRootAsFooter(e),i=an.decode(t.schema(),new Map,t.version());return new Whe(i,t)}static encode(e){const t=new Hhe,i=an.encode(t,e.schema);rs.startRecordBatchesVector(t,e.numRecordBatches);for(const a of[...e.recordBatches()].slice().reverse())uu.encode(t,a);const r=t.endVector();rs.startDictionariesVector(t,e.numDictionaries);for(const a of[...e.dictionaryBatches()].slice().reverse())uu.encode(t,a);const s=t.endVector();return rs.startFooter(t),rs.addSchema(t,i),rs.addVersion(t,ci.V5),rs.addRecordBatches(t,r),rs.addDictionaries(t,s),rs.finishFooterBuffer(t,rs.endFooter(t)),t.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(e,t=ci.V5,i,r){this.schema=e,this.version=t,i&&(this._recordBatches=i),r&&(this._dictionaryBatches=r)}*recordBatches(){for(let e,t=-1,i=this.numRecordBatches;++t<i;)(e=this.getRecordBatch(t))&&(yield e)}*dictionaryBatches(){for(let e,t=-1,i=this.numDictionaries;++t<i;)(e=this.getDictionaryBatch(t))&&(yield e)}getRecordBatch(e){return e>=0&&e<this.numRecordBatches&&this._recordBatches[e]||null}getDictionaryBatch(e){return e>=0&&e<this.numDictionaries&&this._dictionaryBatches[e]||null}}class Whe extends Jm{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(e,t){super(e,t.version()),this._footer=t}getRecordBatch(e){if(e>=0&&e<this.numRecordBatches){const t=this._footer.recordBatches(e);if(t)return uu.decode(t)}return null}getDictionaryBatch(e){if(e>=0&&e<this.numDictionaries){const t=this._footer.dictionaries(e);if(t)return uu.decode(t)}return null}}class uu{static decode(e){return new uu(e.metaDataLength(),e.bodyLength(),e.offset())}static encode(e,t){const{metaDataLength:i}=t,r=BigInt(t.offset),s=BigInt(t.bodyLength);return cM.createBlock(e,r,i,s)}constructor(e,t,i){this.metaDataLength=e,this.offset=Rn(i),this.bodyLength=Rn(t)}}const Qn=Object.freeze({done:!0,value:void 0});class cL{constructor(e){this._json=e}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class yR{tee(){return this._getDOMStream().tee()}pipe(e,t){return this._getNodeStream().pipe(e,t)}pipeTo(e,t){return this._getDOMStream().pipeTo(e,t)}pipeThrough(e,t){return this._getDOMStream().pipeThrough(e,t)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class jhe extends yR{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(e=>this._closedPromiseResolve=e)}get closed(){return this._closedPromise}cancel(e){return bt(this,void 0,void 0,function*(){yield this.return(e)})}write(e){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(e):this.resolvers.shift().resolve({done:!1,value:e}))}abort(e){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:e}:this.resolvers.shift().reject({done:!0,value:e}))}close(){if(this._closedPromiseResolve){const{resolvers:e}=this;for(;e.length>0;)e.shift().resolve(Qn);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(e){return Rs.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,e)}toNodeStream(e){return Rs.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,e)}throw(e){return bt(this,void 0,void 0,function*(){return yield this.abort(e),Qn})}return(e){return bt(this,void 0,void 0,function*(){return yield this.close(),Qn})}read(e){return bt(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return bt(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(...e){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((t,i)=>{this.resolvers.push({resolve:t,reject:i})}):Promise.resolve(Qn)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class Wy extends jhe{write(e){if((e=Vt(e)).byteLength>0)return super.write(e)}toString(e=!1){return e?nM(this.toUint8Array(!0)):this.toUint8Array(!1).then(nM)}toUint8Array(e=!1){return e?Za(this._values)[0]:bt(this,void 0,void 0,function*(){var t,i,r,s;const a=[];let o=0;try{for(var l=!0,u=uc(this),c;c=yield u.next(),t=c.done,!t;l=!0){s=c.value,l=!1;const h=s;a.push(h),o+=h.byteLength}}catch(h){i={error:h}}finally{try{!l&&!t&&(r=u.return)&&(yield r.call(u))}finally{if(i)throw i.error}}return Za(a,o)[0]})}}class b0{constructor(e){e&&(this.source=new qhe(Rs.fromIterable(e)))}[Symbol.iterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class hf{constructor(e){e instanceof hf?this.source=e.source:e instanceof Wy?this.source=new Iu(Rs.fromAsyncIterable(e)):ik(e)?this.source=new Iu(Rs.fromNodeStream(e)):oR(e)?this.source=new Iu(Rs.fromDOMStream(e)):nk(e)?this.source=new Iu(Rs.fromDOMStream(e.body)):kg(e)?this.source=new Iu(Rs.fromIterable(e)):xc(e)?this.source=new Iu(Rs.fromAsyncIterable(e)):Pf(e)&&(this.source=new Iu(Rs.fromAsyncIterable(e)))}[Symbol.asyncIterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}get closed(){return this.source.closed}cancel(e){return this.source.cancel(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class qhe{constructor(e){this.source=e}cancel(e){this.return(e)}peek(e){return this.next(e,"peek").value}read(e){return this.next(e,"read").value}next(e,t="read"){return this.source.next({cmd:t,size:e})}throw(e){return Object.create(this.source.throw&&this.source.throw(e)||Qn)}return(e){return Object.create(this.source.return&&this.source.return(e)||Qn)}}class Iu{constructor(e){this.source=e,this._closedPromise=new Promise(t=>this._closedPromiseResolve=t)}cancel(e){return bt(this,void 0,void 0,function*(){yield this.return(e)})}get closed(){return this._closedPromise}read(e){return bt(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return bt(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(e){return bt(this,arguments,void 0,function*(t,i="read"){return yield this.source.next({cmd:i,size:t})})}throw(e){return bt(this,void 0,void 0,function*(){const t=this.source.throw&&(yield this.source.throw(e))||Qn;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(t)})}return(e){return bt(this,void 0,void 0,function*(){const t=this.source.return&&(yield this.source.return(e))||Qn;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(t)})}}class hL extends b0{constructor(e,t){super(),this.position=0,this.buffer=Vt(e),this.size=t===void 0?this.buffer.byteLength:t}readInt32(e){const{buffer:t,byteOffset:i}=this.readAt(e,4);return new DataView(t,i).getInt32(0,!0)}seek(e){return this.position=Math.min(e,this.size),e<this.size}read(e){const{buffer:t,size:i,position:r}=this;return t&&r<i?(typeof e!="number"&&(e=Number.POSITIVE_INFINITY),this.position=Math.min(i,r+Math.min(i-r,e)),t.subarray(r,this.position)):null}readAt(e,t){const i=this.buffer,r=Math.min(this.size,e+t);return i?i.subarray(e,r):new Uint8Array(t)}close(){this.buffer&&(this.buffer=null)}throw(e){return this.close(),{done:!0,value:e}}return(e){return this.close(),{done:!0,value:e}}}class S0 extends hf{constructor(e,t){super(),this.position=0,this._handle=e,typeof t=="number"?this.size=t:this._pending=bt(this,void 0,void 0,function*(){this.size=(yield e.stat()).size,delete this._pending})}readInt32(e){return bt(this,void 0,void 0,function*(){const{buffer:t,byteOffset:i}=yield this.readAt(e,4);return new DataView(t,i).getInt32(0,!0)})}seek(e){return bt(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(e,this.size),e<this.size})}read(e){return bt(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:t,size:i,position:r}=this;if(t&&r<i){typeof e!="number"&&(e=Number.POSITIVE_INFINITY);let s=r,a=0,o=0;const l=Math.min(i,s+Math.min(i-s,e)),u=new Uint8Array(Math.max(0,(this.position=l)-s));for(;(s+=o)<l&&(a+=o)<u.byteLength;)({bytesRead:o}=yield t.read(u,a,u.byteLength-a,s));return u}return null})}readAt(e,t){return bt(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:i,size:r}=this;if(i&&e+t<r){const s=Math.min(r,e+t),a=new Uint8Array(s-e);return(yield i.read(a,0,t,e)).buffer}return new Uint8Array(t)})}close(){return bt(this,void 0,void 0,function*(){const e=this._handle;this._handle=null,e&&(yield e.close())})}throw(e){return bt(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}return(e){return bt(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}}const Xhe=65536;function $h(n){return n<0&&(n=4294967295+n+1),`0x${n.toString(16)}`}const df=8,vR=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class Fz{constructor(e){this.buffer=e}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(e){const t=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),i=new Uint32Array([e.buffer[1]>>>16,e.buffer[1]&65535,e.buffer[0]>>>16,e.buffer[0]&65535]);let r=t[3]*i[3];this.buffer[0]=r&65535;let s=r>>>16;return r=t[2]*i[3],s+=r,r=t[3]*i[2]>>>0,s+=r,this.buffer[0]+=s<<16,this.buffer[1]=s>>>0<r?Xhe:0,this.buffer[1]+=s>>>16,this.buffer[1]+=t[1]*i[3]+t[2]*i[2]+t[3]*i[1],this.buffer[1]+=t[0]*i[3]+t[1]*i[2]+t[2]*i[1]+t[3]*i[0]<<16,this}_plus(e){const t=this.buffer[0]+e.buffer[0]>>>0;this.buffer[1]+=e.buffer[1],t<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=t}lessThan(e){return this.buffer[1]<e.buffer[1]||this.buffer[1]===e.buffer[1]&&this.buffer[0]<e.buffer[0]}equals(e){return this.buffer[1]===e.buffer[1]&&this.buffer[0]==e.buffer[0]}greaterThan(e){return e.lessThan(this)}hex(){return`${$h(this.buffer[1])} ${$h(this.buffer[0])}`}}class cn extends Fz{times(e){return this._times(e),this}plus(e){return this._plus(e),this}static from(e,t=new Uint32Array(2)){return cn.fromString(typeof e=="string"?e:e.toString(),t)}static fromNumber(e,t=new Uint32Array(2)){return cn.fromString(e.toString(),t)}static fromString(e,t=new Uint32Array(2)){const i=e.length,r=new cn(t);for(let s=0;s<i;){const a=df<i-s?df:i-s,o=new cn(new Uint32Array([Number.parseInt(e.slice(s,s+a),10),0])),l=new cn(new Uint32Array([vR[a],0]));r.times(l),r.plus(o),s+=a}return r}static convertArray(e){const t=new Uint32Array(e.length*2);for(let i=-1,r=e.length;++i<r;)cn.from(e[i],new Uint32Array(t.buffer,t.byteOffset+2*i*4,2));return t}static multiply(e,t){return new cn(new Uint32Array(e.buffer)).times(t)}static add(e,t){return new cn(new Uint32Array(e.buffer)).plus(t)}}class Lr extends Fz{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(e){return this._times(e),this}plus(e){return this._plus(e),this}lessThan(e){const t=this.buffer[1]<<0,i=e.buffer[1]<<0;return t<i||t===i&&this.buffer[0]<e.buffer[0]}static from(e,t=new Uint32Array(2)){return Lr.fromString(typeof e=="string"?e:e.toString(),t)}static fromNumber(e,t=new Uint32Array(2)){return Lr.fromString(e.toString(),t)}static fromString(e,t=new Uint32Array(2)){const i=e.startsWith("-"),r=e.length,s=new Lr(t);for(let a=i?1:0;a<r;){const o=df<r-a?df:r-a,l=new Lr(new Uint32Array([Number.parseInt(e.slice(a,a+o),10),0])),u=new Lr(new Uint32Array([vR[o],0]));s.times(u),s.plus(l),a+=o}return i?s.negate():s}static convertArray(e){const t=new Uint32Array(e.length*2);for(let i=-1,r=e.length;++i<r;)Lr.from(e[i],new Uint32Array(t.buffer,t.byteOffset+2*i*4,2));return t}static multiply(e,t){return new Lr(new Uint32Array(e.buffer)).times(t)}static add(e,t){return new Lr(new Uint32Array(e.buffer)).plus(t)}}class Ra{constructor(e){this.buffer=e}high(){return new Lr(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new Lr(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(e){const t=new cn(new Uint32Array([this.buffer[3],0])),i=new cn(new Uint32Array([this.buffer[2],0])),r=new cn(new Uint32Array([this.buffer[1],0])),s=new cn(new Uint32Array([this.buffer[0],0])),a=new cn(new Uint32Array([e.buffer[3],0])),o=new cn(new Uint32Array([e.buffer[2],0])),l=new cn(new Uint32Array([e.buffer[1],0])),u=new cn(new Uint32Array([e.buffer[0],0]));let c=cn.multiply(s,u);this.buffer[0]=c.low();const h=new cn(new Uint32Array([c.high(),0]));return c=cn.multiply(r,u),h.plus(c),c=cn.multiply(s,l),h.plus(c),this.buffer[1]=h.low(),this.buffer[3]=h.lessThan(c)?1:0,this.buffer[2]=h.high(),new cn(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(cn.multiply(i,u)).plus(cn.multiply(r,l)).plus(cn.multiply(s,o)),this.buffer[3]+=cn.multiply(t,u).plus(cn.multiply(i,l)).plus(cn.multiply(r,o)).plus(cn.multiply(s,a)).low(),this}plus(e){const t=new Uint32Array(4);return t[3]=this.buffer[3]+e.buffer[3]>>>0,t[2]=this.buffer[2]+e.buffer[2]>>>0,t[1]=this.buffer[1]+e.buffer[1]>>>0,t[0]=this.buffer[0]+e.buffer[0]>>>0,t[0]<this.buffer[0]>>>0&&++t[1],t[1]<this.buffer[1]>>>0&&++t[2],t[2]<this.buffer[2]>>>0&&++t[3],this.buffer[3]=t[3],this.buffer[2]=t[2],this.buffer[1]=t[1],this.buffer[0]=t[0],this}hex(){return`${$h(this.buffer[3])} ${$h(this.buffer[2])} ${$h(this.buffer[1])} ${$h(this.buffer[0])}`}static multiply(e,t){return new Ra(new Uint32Array(e.buffer)).times(t)}static add(e,t){return new Ra(new Uint32Array(e.buffer)).plus(t)}static from(e,t=new Uint32Array(4)){return Ra.fromString(typeof e=="string"?e:e.toString(),t)}static fromNumber(e,t=new Uint32Array(4)){return Ra.fromString(e.toString(),t)}static fromString(e,t=new Uint32Array(4)){const i=e.startsWith("-"),r=e.length,s=new Ra(t);for(let a=i?1:0;a<r;){const o=df<r-a?df:r-a,l=new Ra(new Uint32Array([Number.parseInt(e.slice(a,a+o),10),0,0,0])),u=new Ra(new Uint32Array([vR[o],0,0,0]));s.times(u),s.plus(l),a+=o}return i?s.negate():s}static convertArray(e){const t=new Uint32Array(e.length*4);for(let i=-1,r=e.length;++i<r;)Ra.from(e[i],new Uint32Array(t.buffer,t.byteOffset+4*4*i,4));return t}}class kz extends Ut{constructor(e,t,i,r,s=ci.V5){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=e,this.nodes=t,this.buffers=i,this.dictionaries=r,this.metadataVersion=s}visit(e){return super.visit(e instanceof Bn?e.type:e)}visitNull(e,{length:t}=this.nextFieldNode()){return Ot({type:e,length:t})}visitBool(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitInt(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitFloat(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitUtf8(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitLargeUtf8(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitBinary(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitLargeBinary(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitFixedSizeBinary(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitDate(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitTimestamp(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitTime(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitDecimal(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitList(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}visitStruct(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),children:this.visitMany(e.children)})}visitUnion(e,{length:t,nullCount:i}=this.nextFieldNode()){return this.metadataVersion<ci.V5&&this.readNullBitmap(e,i),e.mode===sr.Sparse?this.visitSparseUnion(e,{length:t,nullCount:i}):this.visitDenseUnion(e,{length:t,nullCount:i})}visitDenseUnion(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,typeIds:this.readTypeIds(e),valueOffsets:this.readOffsets(e),children:this.visitMany(e.children)})}visitSparseUnion(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,typeIds:this.readTypeIds(e),children:this.visitMany(e.children)})}visitDictionary(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e.indices),dictionary:this.readDictionary(e)})}visitInterval(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitDuration(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitFixedSizeList(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),child:this.visit(e.children[0])})}visitMap(e,{length:t,nullCount:i}=this.nextFieldNode()){return Ot({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(e,t,i=this.nextBufferRange()){return t>0&&this.readData(e,i)||new Uint8Array(0)}readOffsets(e,t){return this.readData(e,t)}readTypeIds(e,t){return this.readData(e,t)}readData(e,{length:t,offset:i}=this.nextBufferRange()){return this.bytes.subarray(i,i+t)}readDictionary(e){return this.dictionaries.get(e.id)}}class Yhe extends kz{constructor(e,t,i,r,s){super(new Uint8Array(0),t,i,r,s),this.sources=e}readNullBitmap(e,t,{offset:i}=this.nextBufferRange()){return t<=0?new Uint8Array(0):g0(this.sources[i])}readOffsets(e,{offset:t}=this.nextBufferRange()){return dn(Uint8Array,dn(e.OffsetArrayType,this.sources[t]))}readTypeIds(e,{offset:t}=this.nextBufferRange()){return dn(Uint8Array,dn(e.ArrayType,this.sources[t]))}readData(e,{offset:t}=this.nextBufferRange()){const{sources:i}=this;return Ge.isTimestamp(e)||(Ge.isInt(e)||Ge.isTime(e))&&e.bitWidth===64||Ge.isDuration(e)||Ge.isDate(e)&&e.unit===js.MILLISECOND?dn(Uint8Array,Lr.convertArray(i[t])):Ge.isDecimal(e)?dn(Uint8Array,Ra.convertArray(i[t])):Ge.isBinary(e)||Ge.isLargeBinary(e)||Ge.isFixedSizeBinary(e)?Khe(i[t]):Ge.isBool(e)?g0(i[t]):Ge.isUtf8(e)||Ge.isLargeUtf8(e)?aR(i[t].join("")):dn(Uint8Array,dn(e.ArrayType,i[t].map(r=>+r)))}}function Khe(n){const e=n.join(""),t=new Uint8Array(e.length/2);for(let i=0;i<e.length;i+=2)t[i>>1]=Number.parseInt(e.slice(i,i+2),16);return t}class rt extends Ut{compareSchemas(e,t){return e===t||t instanceof e.constructor&&this.compareManyFields(e.fields,t.fields)}compareManyFields(e,t){return e===t||Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every((i,r)=>this.compareFields(i,t[r]))}compareFields(e,t){return e===t||t instanceof e.constructor&&e.name===t.name&&e.nullable===t.nullable&&this.visit(e.type,t.type)}}function wr(n,e){return e instanceof n.constructor}function Uc(n,e){return n===e||wr(n,e)}function ul(n,e){return n===e||wr(n,e)&&n.bitWidth===e.bitWidth&&n.isSigned===e.isSigned}function Rb(n,e){return n===e||wr(n,e)&&n.precision===e.precision}function Qhe(n,e){return n===e||wr(n,e)&&n.byteWidth===e.byteWidth}function bR(n,e){return n===e||wr(n,e)&&n.unit===e.unit}function zg(n,e){return n===e||wr(n,e)&&n.unit===e.unit&&n.timezone===e.timezone}function Gg(n,e){return n===e||wr(n,e)&&n.unit===e.unit&&n.bitWidth===e.bitWidth}function Zhe(n,e){return n===e||wr(n,e)&&n.children.length===e.children.length&&cu.compareManyFields(n.children,e.children)}function Jhe(n,e){return n===e||wr(n,e)&&n.children.length===e.children.length&&cu.compareManyFields(n.children,e.children)}function SR(n,e){return n===e||wr(n,e)&&n.mode===e.mode&&n.typeIds.every((t,i)=>t===e.typeIds[i])&&cu.compareManyFields(n.children,e.children)}function ede(n,e){return n===e||wr(n,e)&&n.id===e.id&&n.isOrdered===e.isOrdered&&cu.visit(n.indices,e.indices)&&cu.visit(n.dictionary,e.dictionary)}function xR(n,e){return n===e||wr(n,e)&&n.unit===e.unit}function Vg(n,e){return n===e||wr(n,e)&&n.unit===e.unit}function tde(n,e){return n===e||wr(n,e)&&n.listSize===e.listSize&&n.children.length===e.children.length&&cu.compareManyFields(n.children,e.children)}function nde(n,e){return n===e||wr(n,e)&&n.keysSorted===e.keysSorted&&n.children.length===e.children.length&&cu.compareManyFields(n.children,e.children)}rt.prototype.visitNull=Uc;rt.prototype.visitBool=Uc;rt.prototype.visitInt=ul;rt.prototype.visitInt8=ul;rt.prototype.visitInt16=ul;rt.prototype.visitInt32=ul;rt.prototype.visitInt64=ul;rt.prototype.visitUint8=ul;rt.prototype.visitUint16=ul;rt.prototype.visitUint32=ul;rt.prototype.visitUint64=ul;rt.prototype.visitFloat=Rb;rt.prototype.visitFloat16=Rb;rt.prototype.visitFloat32=Rb;rt.prototype.visitFloat64=Rb;rt.prototype.visitUtf8=Uc;rt.prototype.visitLargeUtf8=Uc;rt.prototype.visitBinary=Uc;rt.prototype.visitLargeBinary=Uc;rt.prototype.visitFixedSizeBinary=Qhe;rt.prototype.visitDate=bR;rt.prototype.visitDateDay=bR;rt.prototype.visitDateMillisecond=bR;rt.prototype.visitTimestamp=zg;rt.prototype.visitTimestampSecond=zg;rt.prototype.visitTimestampMillisecond=zg;rt.prototype.visitTimestampMicrosecond=zg;rt.prototype.visitTimestampNanosecond=zg;rt.prototype.visitTime=Gg;rt.prototype.visitTimeSecond=Gg;rt.prototype.visitTimeMillisecond=Gg;rt.prototype.visitTimeMicrosecond=Gg;rt.prototype.visitTimeNanosecond=Gg;rt.prototype.visitDecimal=Uc;rt.prototype.visitList=Zhe;rt.prototype.visitStruct=Jhe;rt.prototype.visitUnion=SR;rt.prototype.visitDenseUnion=SR;rt.prototype.visitSparseUnion=SR;rt.prototype.visitDictionary=ede;rt.prototype.visitInterval=xR;rt.prototype.visitIntervalDayTime=xR;rt.prototype.visitIntervalYearMonth=xR;rt.prototype.visitDuration=Vg;rt.prototype.visitDurationSecond=Vg;rt.prototype.visitDurationMillisecond=Vg;rt.prototype.visitDurationMicrosecond=Vg;rt.prototype.visitDurationNanosecond=Vg;rt.prototype.visitFixedSizeList=tde;rt.prototype.visitMap=nde;const cu=new rt;function dM(n,e){return cu.compareSchemas(n,e)}function nT(n,e){return ide(n,e.map(t=>t.data.concat()))}function ide(n,e){const t=[...n.fields],i=[],r={numBatches:e.reduce((h,d)=>Math.max(h,d.length),0)};let s=0,a=0,o=-1;const l=e.length;let u,c=[];for(;r.numBatches-- >0;){for(a=Number.POSITIVE_INFINITY,o=-1;++o<l;)c[o]=u=e[o].shift(),a=Math.min(a,u?u.length:a);Number.isFinite(a)&&(c=rde(t,a,c,e,r),a>0&&(i[s++]=Ot({type:new _r(t),length:a,nullCount:0,children:c.slice()})))}return[n=n.assign(t),i.map(h=>new Ur(n,h))]}function rde(n,e,t,i,r){var s;const a=(e+63&-64)>>3;for(let o=-1,l=i.length;++o<l;){const u=t[o],c=u==null?void 0:u.length;if(c>=e)c===e?t[o]=u:(t[o]=u.slice(0,e),r.numBatches=Math.max(r.numBatches,i[o].unshift(u.slice(e,c-e))));else{const h=n[o];n[o]=h.clone({nullable:!0}),t[o]=(s=u==null?void 0:u._changeLengthAndBackfillNullBitmap(e))!==null&&s!==void 0?s:Ot({type:h.type,length:e,nullCount:e,nullBitmap:new Uint8Array(a)})}}return t}var zz;class fr{constructor(...e){var t,i;if(e.length===0)return this.batches=[],this.schema=new an([]),this._offsets=[0],this;let r,s;e[0]instanceof an&&(r=e.shift()),e.at(-1)instanceof Uint32Array&&(s=e.pop());const a=l=>{if(l){if(l instanceof Ur)return[l];if(l instanceof fr)return l.batches;if(l instanceof un){if(l.type instanceof _r)return[new Ur(new an(l.type.children),l)]}else{if(Array.isArray(l))return l.flatMap(u=>a(u));if(typeof l[Symbol.iterator]=="function")return[...l].flatMap(u=>a(u));if(typeof l=="object"){const u=Object.keys(l),c=u.map(f=>new sn([l[f]])),h=r??new an(u.map((f,m)=>new Bn(String(f),c[m].type,c[m].nullable))),[,d]=nT(h,c);return d.length===0?[new Ur(l)]:d}}}return[]},o=e.flatMap(l=>a(l));if(r=(i=r??((t=o[0])===null||t===void 0?void 0:t.schema))!==null&&i!==void 0?i:new an([]),!(r instanceof an))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const l of o){if(!(l instanceof Ur))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!dM(r,l.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=r,this.batches=o,this._offsets=s??Cz(this.data)}get data(){return this.batches.map(({data:e})=>e)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((e,t)=>e+t.length,0)}get nullCount(){return this._nullCount===-1&&(this._nullCount=Nz(this.data)),this._nullCount}isValid(e){return!1}get(e){return null}at(e){return this.get(fR(e,this.numRows))}set(e,t){}indexOf(e,t){return-1}[Symbol.iterator](){return this.batches.length>0?_R.visit(new sn(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[
  ${this.toArray().join(`,
  `)}
]`}concat(...e){const t=this.schema,i=this.data.concat(e.flatMap(({data:r})=>r));return new fr(t,i.map(r=>new Ur(t,r)))}slice(e,t){const i=this.schema;[e,t]=Az({length:this.numRows},e,t);const r=Dz(this.data,this._offsets,e,t);return new fr(i,r.map(s=>new Ur(i,s)))}getChild(e){return this.getChildAt(this.schema.fields.findIndex(t=>t.name===e))}getChildAt(e){if(e>-1&&e<this.schema.fields.length){const t=this.data.map(i=>i.children[e]);if(t.length===0){const{type:i}=this.schema.fields[e],r=Ot({type:i,length:0,nullCount:0});t.push(r._changeLengthAndBackfillNullBitmap(this.numRows))}return new sn(t)}return null}setChild(e,t){var i;return this.setChildAt((i=this.schema.fields)===null||i===void 0?void 0:i.findIndex(r=>r.name===e),t)}setChildAt(e,t){let i=this.schema,r=[...this.batches];if(e>-1&&e<this.numCols){t||(t=new sn([Ot({type:new lu,length:this.numRows})]));const s=i.fields.slice(),a=s[e].clone({type:t.type}),o=this.schema.fields.map((l,u)=>this.getChildAt(u));[s[e],o[e]]=[a,t],[i,r]=nT(i,o)}return new fr(i,r)}select(e){const t=this.schema.fields.reduce((i,r,s)=>i.set(r.name,s),new Map);return this.selectAt(e.map(i=>t.get(i)).filter(i=>i>-1))}selectAt(e){const t=this.schema.selectAt(e),i=this.batches.map(r=>r.selectAt(e));return new fr(t,i)}assign(e){const t=this.schema.fields,[i,r]=e.schema.fields.reduce((o,l,u)=>{const[c,h]=o,d=t.findIndex(f=>f.name===l.name);return~d?h[d]=u:c.push(u),o},[[],[]]),s=this.schema.assign(e.schema),a=[...t.map((o,l)=>[l,r[l]]).map(([o,l])=>l===void 0?this.getChildAt(o):e.getChildAt(l)),...i.map(o=>e.getChildAt(o))].filter(Boolean);return new fr(...nT(s,a))}}zz=Symbol.toStringTag;fr[zz]=(n=>(n.schema=null,n.batches=[],n._offsets=new Uint32Array([0]),n._nullCount=-1,n[Symbol.isConcatSpreadable]=!0,n.isValid=_0(gR),n.get=_0(jr.getVisitFn(B.Struct)),n.set=Lz(qs.getVisitFn(B.Struct)),n.indexOf=Pz(y0.getVisitFn(B.Struct)),"Table"))(fr.prototype);var Gz;let Ur=class Ip{constructor(...e){switch(e.length){case 2:{if([this.schema]=e,!(this.schema instanceof an))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=Ot({nullCount:0,type:new _r(this.schema.fields),children:this.schema.fields.map(t=>Ot({type:t.type,nullCount:0}))})]=e,!(this.data instanceof un))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=dL(this.schema,this.data.children);break}case 1:{const[t]=e,{fields:i,children:r,length:s}=Object.keys(t).reduce((l,u,c)=>(l.children[c]=t[u],l.length=Math.max(l.length,t[u].length),l.fields[c]=Bn.new({name:u,type:t[u].type,nullable:!0}),l),{length:0,fields:new Array,children:new Array}),a=new an(i),o=Ot({type:new _r(i),length:s,children:r,nullCount:0});[this.schema,this.data]=dL(a,o.children,s);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=Vz(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(e){return this.data.getValid(e)}get(e){return jr.visit(this.data,e)}at(e){return this.get(fR(e,this.numRows))}set(e,t){return qs.visit(this.data,e,t)}indexOf(e,t){return y0.visit(this.data,e,t)}[Symbol.iterator](){return _R.visit(new sn([this.data]))}toArray(){return[...this]}concat(...e){return new fr(this.schema,[this,...e])}slice(e,t){const[i]=new sn([this.data]).slice(e,t).data;return new Ip(this.schema,i)}getChild(e){var t;return this.getChildAt((t=this.schema.fields)===null||t===void 0?void 0:t.findIndex(i=>i.name===e))}getChildAt(e){return e>-1&&e<this.schema.fields.length?new sn([this.data.children[e]]):null}setChild(e,t){var i;return this.setChildAt((i=this.schema.fields)===null||i===void 0?void 0:i.findIndex(r=>r.name===e),t)}setChildAt(e,t){let i=this.schema,r=this.data;if(e>-1&&e<this.numCols){t||(t=new sn([Ot({type:new lu,length:this.numRows})]));const s=i.fields.slice(),a=r.children.slice(),o=s[e].clone({type:t.type});[s[e],a[e]]=[o,t.data[0]],i=new an(s,new Map(this.schema.metadata)),r=Ot({type:new _r(s),children:a})}return new Ip(i,r)}select(e){const t=this.schema.select(e),i=new _r(t.fields),r=[];for(const s of e){const a=this.schema.fields.findIndex(o=>o.name===s);~a&&(r[a]=this.data.children[a])}return new Ip(t,Ot({type:i,length:this.numRows,children:r}))}selectAt(e){const t=this.schema.selectAt(e),i=e.map(s=>this.data.children[s]).filter(Boolean),r=Ot({type:new _r(t.fields),length:this.numRows,children:i});return new Ip(t,r)}};Gz=Symbol.toStringTag;Ur[Gz]=(n=>(n._nullCount=-1,n[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(Ur.prototype);function dL(n,e,t=e.reduce((i,r)=>Math.max(i,r.length),0)){var i;const r=[...n.fields],s=[...e],a=(t+63&-64)>>3;for(const[o,l]of n.fields.entries()){const u=e[o];(!u||u.length!==t)&&(r[o]=l.clone({nullable:!0}),s[o]=(i=u==null?void 0:u._changeLengthAndBackfillNullBitmap(t))!==null&&i!==void 0?i:Ot({type:l.type,length:t,nullCount:t,nullBitmap:new Uint8Array(a)}))}return[n.assign(r),Ot({type:new _r(r),length:t,children:s})]}function Vz(n,e,t=new Map){var i,r;if(((i=n==null?void 0:n.length)!==null&&i!==void 0?i:0)>0&&(n==null?void 0:n.length)===(e==null?void 0:e.length))for(let s=-1,a=n.length;++s<a;){const{type:o}=n[s],l=e[s];for(const u of[l,...((r=l==null?void 0:l.dictionary)===null||r===void 0?void 0:r.data)||[]])Vz(o.children,u==null?void 0:u.children,t);if(Ge.isDictionary(o)){const{id:u}=o;if(!t.has(u))l!=null&&l.dictionary&&t.set(u,l.dictionary);else if(t.get(u)!==l.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}}return t}class TR extends Ur{constructor(e){const t=e.fields.map(r=>Ot({type:r.type})),i=Ot({type:new _r(e.fields),nullCount:0,children:t});super(e,i)}}let xl=class wa{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsMessage(e,t){return(t||new wa).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMessage(e,t){return e.setPosition(e.position()+ln),(t||new wa).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):ci.V1}headerType(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):Qt.NONE}header(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__union(e,this.bb_pos+t):null}bodyLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}customMetadata(e,t){const i=this.bb.__offset(this.bb_pos,12);return i?(t||new Ei).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startMessage(e){e.startObject(5)}static addVersion(e,t){e.addFieldInt16(0,t,ci.V1)}static addHeaderType(e,t){e.addFieldInt8(1,t,Qt.NONE)}static addHeader(e,t){e.addFieldOffset(2,t,0)}static addBodyLength(e,t){e.addFieldInt64(3,t,BigInt("0"))}static addCustomMetadata(e,t){e.addFieldOffset(4,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static endMessage(e){return e.endObject()}static finishMessageBuffer(e,t){e.finish(t)}static finishSizePrefixedMessageBuffer(e,t){e.finish(t,void 0,!0)}static createMessage(e,t,i,r,s,a){return wa.startMessage(e),wa.addVersion(e,t),wa.addHeaderType(e,i),wa.addHeader(e,r),wa.addBodyLength(e,s),wa.addCustomMetadata(e,a),wa.endMessage(e)}};class sde extends Ut{visit(e,t){return e==null||t==null?void 0:super.visit(e,t)}visitNull(e,t){return iL.startNull(t),iL.endNull(t)}visitInt(e,t){return ls.startInt(t),ls.addBitWidth(t,e.bitWidth),ls.addIsSigned(t,e.isSigned),ls.endInt(t)}visitFloat(e,t){return Pa.startFloatingPoint(t),Pa.addPrecision(t,e.precision),Pa.endFloatingPoint(t)}visitBinary(e,t){return Z2.startBinary(t),Z2.endBinary(t)}visitLargeBinary(e,t){return eL.startLargeBinary(t),eL.endLargeBinary(t)}visitBool(e,t){return J2.startBool(t),J2.endBool(t)}visitUtf8(e,t){return rL.startUtf8(t),rL.endUtf8(t)}visitLargeUtf8(e,t){return tL.startLargeUtf8(t),tL.endLargeUtf8(t)}visitDecimal(e,t){return gh.startDecimal(t),gh.addScale(t,e.scale),gh.addPrecision(t,e.precision),gh.addBitWidth(t,e.bitWidth),gh.endDecimal(t)}visitDate(e,t){return ky.startDate(t),ky.addUnit(t,e.unit),ky.endDate(t)}visitTime(e,t){return Ps.startTime(t),Ps.addUnit(t,e.unit),Ps.addBitWidth(t,e.bitWidth),Ps.endTime(t)}visitTimestamp(e,t){const i=e.timezone&&t.createString(e.timezone)||void 0;return Us.startTimestamp(t),Us.addUnit(t,e.unit),i!==void 0&&Us.addTimezone(t,i),Us.endTimestamp(t)}visitInterval(e,t){return Ua.startInterval(t),Ua.addUnit(t,e.unit),Ua.endInterval(t)}visitDuration(e,t){return zy.startDuration(t),zy.addUnit(t,e.unit),zy.endDuration(t)}visitList(e,t){return nL.startList(t),nL.endList(t)}visitStruct(e,t){return Qu.startStruct_(t),Qu.endStruct_(t)}visitUnion(e,t){Pr.startTypeIdsVector(t,e.typeIds.length);const i=Pr.createTypeIdsVector(t,e.typeIds);return Pr.startUnion(t),Pr.addMode(t,e.mode),Pr.addTypeIds(t,i),Pr.endUnion(t)}visitDictionary(e,t){const i=this.visit(e.indices,t);return Lo.startDictionaryEncoding(t),Lo.addId(t,BigInt(e.id)),Lo.addIsOrdered(t,e.isOrdered),i!==void 0&&Lo.addIndexType(t,i),Lo.endDictionaryEncoding(t)}visitFixedSizeBinary(e,t){return Gy.startFixedSizeBinary(t),Gy.addByteWidth(t,e.byteWidth),Gy.endFixedSizeBinary(t)}visitFixedSizeList(e,t){return Vy.startFixedSizeList(t),Vy.addListSize(t,e.listSize),Vy.endFixedSizeList(t)}visitMap(e,t){return Hy.startMap(t),Hy.addKeysSorted(t,e.keysSorted),Hy.endMap(t)}}const iT=new sde;function ade(n,e=new Map){return new an(lde(n,e),jy(n.metadata),e)}function Hz(n){return new Ss(n.count,$z(n.columns),Wz(n.columns))}function ode(n){return new eo(Hz(n.data),n.id,n.isDelta)}function lde(n,e){return(n.fields||[]).filter(Boolean).map(t=>Bn.fromJSON(t,e))}function fL(n,e){return(n.children||[]).filter(Boolean).map(t=>Bn.fromJSON(t,e))}function $z(n){return(n||[]).reduce((e,t)=>[...e,new hu(t.count,ude(t.VALIDITY)),...$z(t.children)],[])}function Wz(n,e=[]){for(let t=-1,i=(n||[]).length;++t<i;){const r=n[t];r.VALIDITY&&e.push(new Ga(e.length,r.VALIDITY.length)),r.TYPE_ID&&e.push(new Ga(e.length,r.TYPE_ID.length)),r.OFFSET&&e.push(new Ga(e.length,r.OFFSET.length)),r.DATA&&e.push(new Ga(e.length,r.DATA.length)),e=Wz(r.children,e)}return e}function ude(n){return(n||[]).reduce((e,t)=>e+ +(t===0),0)}function cde(n,e){let t,i,r,s,a,o;return!e||!(s=n.dictionary)?(a=mL(n,fL(n,e)),r=new Bn(n.name,a,n.nullable,jy(n.metadata))):e.has(t=s.id)?(i=(i=s.indexType)?pL(i):new Zm,o=new cf(e.get(t),i,t,s.isOrdered),r=new Bn(n.name,o,n.nullable,jy(n.metadata))):(i=(i=s.indexType)?pL(i):new Zm,e.set(t,a=mL(n,fL(n,e))),o=new cf(a,i,t,s.isOrdered),r=new Bn(n.name,o,n.nullable,jy(n.metadata))),r||null}function jy(n=[]){return new Map(n.map(({key:e,value:t})=>[e,t]))}function pL(n){return new Tc(n.isSigned,n.bitWidth)}function mL(n,e){const t=n.type.name;switch(t){case"NONE":return new lu;case"null":return new lu;case"binary":return new Jv;case"largebinary":return new e0;case"utf8":return new t0;case"largeutf8":return new n0;case"bool":return new i0;case"list":return new c0((e||[])[0]);case"struct":return new _r(e||[]);case"struct_":return new _r(e||[])}switch(t){case"int":{const i=n.type;return new Tc(i.isSigned,i.bitWidth)}case"floatingpoint":{const i=n.type;return new Zv(nr[i.precision])}case"decimal":{const i=n.type;return new r0(i.scale,i.precision,i.bitWidth)}case"date":{const i=n.type;return new s0(js[i.unit])}case"time":{const i=n.type;return new a0(ot[i.unit],i.bitWidth)}case"timestamp":{const i=n.type;return new o0(ot[i.unit],i.timezone)}case"interval":{const i=n.type;return new l0(Ja[i.unit])}case"duration":{const i=n.type;return new u0(ot[i.unit])}case"union":{const i=n.type,[r,...s]=(i.mode+"").toLowerCase(),a=r.toUpperCase()+s.join("");return new h0(sr[a],i.typeIds||[],e||[])}case"fixedsizebinary":{const i=n.type;return new d0(i.byteWidth)}case"fixedsizelist":{const i=n.type;return new f0(i.listSize,(e||[])[0])}case"map":{const i=n.type;return new p0((e||[])[0],i.keysSorted)}}throw new Error(`Unrecognized type: "${t}"`)}var hde=ok,dde=lf;class yr{static fromJSON(e,t){const i=new yr(0,ci.V5,t);return i._createHeader=fde(e,t),i}static decode(e){e=new dde(Vt(e));const t=xl.getRootAsMessage(e),i=t.bodyLength(),r=t.version(),s=t.headerType(),a=new yr(i,r,s);return a._createHeader=pde(t,s),a}static encode(e){const t=new hde;let i=-1;return e.isSchema()?i=an.encode(t,e.header()):e.isRecordBatch()?i=Ss.encode(t,e.header()):e.isDictionaryBatch()&&(i=eo.encode(t,e.header())),xl.startMessage(t),xl.addVersion(t,ci.V5),xl.addHeader(t,i),xl.addHeaderType(t,e.headerType),xl.addBodyLength(t,BigInt(e.bodyLength)),xl.finishMessageBuffer(t,xl.endMessage(t)),t.asUint8Array()}static from(e,t=0){if(e instanceof an)return new yr(0,ci.V5,Qt.Schema,e);if(e instanceof Ss)return new yr(t,ci.V5,Qt.RecordBatch,e);if(e instanceof eo)return new yr(t,ci.V5,Qt.DictionaryBatch,e);throw new Error(`Unrecognized Message header: ${e}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===Qt.Schema}isRecordBatch(){return this.headerType===Qt.RecordBatch}isDictionaryBatch(){return this.headerType===Qt.DictionaryBatch}constructor(e,t,i,r){this._version=t,this._headerType=i,this.body=new Uint8Array(0),r&&(this._createHeader=()=>r),this._bodyLength=Rn(e)}}class Ss{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}constructor(e,t,i){this._nodes=t,this._buffers=i,this._length=Rn(e)}}class eo{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(e,t,i=!1){this._data=e,this._isDelta=i,this._id=Rn(t)}}class Ga{constructor(e,t){this.offset=Rn(e),this.length=Rn(t)}}class hu{constructor(e,t){this.length=Rn(e),this.nullCount=Rn(t)}}function fde(n,e){return()=>{switch(e){case Qt.Schema:return an.fromJSON(n);case Qt.RecordBatch:return Ss.fromJSON(n);case Qt.DictionaryBatch:return eo.fromJSON(n)}throw new Error(`Unrecognized Message type: { name: ${Qt[e]}, type: ${e} }`)}}function pde(n,e){return()=>{switch(e){case Qt.Schema:return an.decode(n.header(new Aa),new Map,n.version());case Qt.RecordBatch:return Ss.decode(n.header(new bo),n.version());case Qt.DictionaryBatch:return eo.decode(n.header(new ph),n.version())}throw new Error(`Unrecognized Message type: { name: ${Qt[e]}, type: ${e} }`)}}Bn.encode=Mde;Bn.decode=Tde;Bn.fromJSON=cde;an.encode=Ede;an.decode=mde;an.fromJSON=ade;Ss.encode=wde;Ss.decode=gde;Ss.fromJSON=Hz;eo.encode=Ade;eo.decode=_de;eo.fromJSON=ode;hu.encode=Rde;hu.decode=vde;Ga.encode=Nde;Ga.decode=yde;function mde(n,e=new Map,t=ci.V5){const i=xde(n,e);return new an(i,qy(n),e,t)}function gde(n,e=ci.V5){if(n.compression()!==null)throw new Error("Record batch compression not implemented");return new Ss(n.length(),bde(n),Sde(n,e))}function _de(n,e=ci.V5){return new eo(Ss.decode(n.data(),e),n.id(),n.isDelta())}function yde(n){return new Ga(n.offset(),n.length())}function vde(n){return new hu(n.length(),n.nullCount())}function bde(n){const e=[];for(let t,i=-1,r=-1,s=n.nodesLength();++i<s;)(t=n.nodes(i))&&(e[++r]=hu.decode(t));return e}function Sde(n,e){const t=[];for(let i,r=-1,s=-1,a=n.buffersLength();++r<a;)(i=n.buffers(r))&&(e<ci.V4&&(i.bb_pos+=8*(r+1)),t[++s]=Ga.decode(i));return t}function xde(n,e){const t=[];for(let i,r=-1,s=-1,a=n.fieldsLength();++r<a;)(i=n.fields(r))&&(t[++s]=Bn.decode(i,e));return t}function gL(n,e){const t=[];for(let i,r=-1,s=-1,a=n.childrenLength();++r<a;)(i=n.children(r))&&(t[++s]=Bn.decode(i,e));return t}function Tde(n,e){let t,i,r,s,a,o;return!e||!(o=n.dictionary())?(r=yL(n,gL(n,e)),i=new Bn(n.name(),r,n.nullable(),qy(n))):e.has(t=Rn(o.id()))?(s=(s=o.indexType())?_L(s):new Zm,a=new cf(e.get(t),s,t,o.isOrdered()),i=new Bn(n.name(),a,n.nullable(),qy(n))):(s=(s=o.indexType())?_L(s):new Zm,e.set(t,r=yL(n,gL(n,e))),a=new cf(r,s,t,o.isOrdered()),i=new Bn(n.name(),a,n.nullable(),qy(n))),i||null}function qy(n){const e=new Map;if(n)for(let t,i,r=-1,s=Math.trunc(n.customMetadataLength());++r<s;)(t=n.customMetadata(r))&&(i=t.key())!=null&&e.set(i,t.value());return e}function _L(n){return new Tc(n.isSigned(),n.bitWidth())}function yL(n,e){const t=n.typeType();switch(t){case Cn.NONE:return new lu;case Cn.Null:return new lu;case Cn.Binary:return new Jv;case Cn.LargeBinary:return new e0;case Cn.Utf8:return new t0;case Cn.LargeUtf8:return new n0;case Cn.Bool:return new i0;case Cn.List:return new c0((e||[])[0]);case Cn.Struct_:return new _r(e||[])}switch(t){case Cn.Int:{const i=n.type(new ls);return new Tc(i.isSigned(),i.bitWidth())}case Cn.FloatingPoint:{const i=n.type(new Pa);return new Zv(i.precision())}case Cn.Decimal:{const i=n.type(new gh);return new r0(i.scale(),i.precision(),i.bitWidth())}case Cn.Date:{const i=n.type(new ky);return new s0(i.unit())}case Cn.Time:{const i=n.type(new Ps);return new a0(i.unit(),i.bitWidth())}case Cn.Timestamp:{const i=n.type(new Us);return new o0(i.unit(),i.timezone())}case Cn.Interval:{const i=n.type(new Ua);return new l0(i.unit())}case Cn.Duration:{const i=n.type(new zy);return new u0(i.unit())}case Cn.Union:{const i=n.type(new Pr);return new h0(i.mode(),i.typeIdsArray()||[],e||[])}case Cn.FixedSizeBinary:{const i=n.type(new Gy);return new d0(i.byteWidth())}case Cn.FixedSizeList:{const i=n.type(new Vy);return new f0(i.listSize(),(e||[])[0])}case Cn.Map:{const i=n.type(new Hy);return new p0((e||[])[0],i.keysSorted())}}throw new Error(`Unrecognized type: "${Cn[t]}" (${t})`)}function Ede(n,e){const t=e.fields.map(s=>Bn.encode(n,s));Aa.startFieldsVector(n,t.length);const i=Aa.createFieldsVector(n,t),r=e.metadata&&e.metadata.size>0?Aa.createCustomMetadataVector(n,[...e.metadata].map(([s,a])=>{const o=n.createString(`${s}`),l=n.createString(`${a}`);return Ei.startKeyValue(n),Ei.addKey(n,o),Ei.addValue(n,l),Ei.endKeyValue(n)})):-1;return Aa.startSchema(n),Aa.addFields(n,i),Aa.addEndianness(n,Cde?uf.Little:uf.Big),r!==-1&&Aa.addCustomMetadata(n,r),Aa.endSchema(n)}function Mde(n,e){let t=-1,i=-1,r=-1;const s=e.type;let a=e.typeId;Ge.isDictionary(s)?(a=s.dictionary.typeId,r=iT.visit(s,n),i=iT.visit(s.dictionary,n)):i=iT.visit(s,n);const o=(s.children||[]).map(c=>Bn.encode(n,c)),l=ws.createChildrenVector(n,o),u=e.metadata&&e.metadata.size>0?ws.createCustomMetadataVector(n,[...e.metadata].map(([c,h])=>{const d=n.createString(`${c}`),f=n.createString(`${h}`);return Ei.startKeyValue(n),Ei.addKey(n,d),Ei.addValue(n,f),Ei.endKeyValue(n)})):-1;return e.name&&(t=n.createString(e.name)),ws.startField(n),ws.addType(n,i),ws.addTypeType(n,a),ws.addChildren(n,l),ws.addNullable(n,!!e.nullable),t!==-1&&ws.addName(n,t),r!==-1&&ws.addDictionary(n,r),u!==-1&&ws.addCustomMetadata(n,u),ws.endField(n)}function wde(n,e){const t=e.nodes||[],i=e.buffers||[];bo.startNodesVector(n,t.length);for(const a of t.slice().reverse())hu.encode(n,a);const r=n.endVector();bo.startBuffersVector(n,i.length);for(const a of i.slice().reverse())Ga.encode(n,a);const s=n.endVector();return bo.startRecordBatch(n),bo.addLength(n,BigInt(e.length)),bo.addNodes(n,r),bo.addBuffers(n,s),bo.endRecordBatch(n)}function Ade(n,e){const t=Ss.encode(n,e.data);return ph.startDictionaryBatch(n),ph.addId(n,BigInt(e.id)),ph.addIsDelta(n,e.isDelta),ph.addData(n,t),ph.endDictionaryBatch(n)}function Rde(n,e){return ck.createFieldNode(n,BigInt(e.length),BigInt(e.nullCount))}function Nde(n,e){return uk.createBuffer(n,BigInt(e.offset),BigInt(e.length))}const Cde=(()=>{const n=new ArrayBuffer(2);return new DataView(n).setInt16(0,256,!0),new Int16Array(n)[0]===256})(),ER=n=>`Expected ${Qt[n]} Message in stream, but was null or length 0.`,MR=n=>`Header pointer of flatbuffer-encoded ${Qt[n]} Message is null or length 0.`,jz=(n,e)=>`Expected to read ${n} metadata bytes, but only read ${e}.`,qz=(n,e)=>`Expected to read ${n} bytes for message body, but only read ${e}.`;class Xz{constructor(e){this.source=e instanceof b0?e:new b0(e)}[Symbol.iterator](){return this}next(){let e;return(e=this.readMetadataLength()).done||e.value===-1&&(e=this.readMetadataLength()).done||(e=this.readMetadata(e.value)).done?Qn:e}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}readMessage(e){let t;if((t=this.next()).done)return null;if(e!=null&&t.value.headerType!==e)throw new Error(ER(e));return t.value}readMessageBody(e){if(e<=0)return new Uint8Array(0);const t=Vt(this.source.read(e));if(t.byteLength<e)throw new Error(qz(e,t.byteLength));return t.byteOffset%8===0&&t.byteOffset+t.byteLength<=t.buffer.byteLength?t:t.slice()}readSchema(e=!1){const t=Qt.Schema,i=this.readMessage(t),r=i==null?void 0:i.header();if(e&&!r)throw new Error(MR(t));return r}readMetadataLength(){const e=this.source.read(Nb),t=e&&new lf(e),i=(t==null?void 0:t.readInt32(0))||0;return{done:i===0,value:i}}readMetadata(e){const t=this.source.read(e);if(!t)return Qn;if(t.byteLength<e)throw new Error(jz(e,t.byteLength));return{done:!1,value:yr.decode(t)}}}class Dde{constructor(e,t){this.source=e instanceof hf?e:tk(e)?new S0(e,t):new hf(e)}[Symbol.asyncIterator](){return this}next(){return bt(this,void 0,void 0,function*(){let e;return(e=yield this.readMetadataLength()).done||e.value===-1&&(e=yield this.readMetadataLength()).done||(e=yield this.readMetadata(e.value)).done?Qn:e})}throw(e){return bt(this,void 0,void 0,function*(){return yield this.source.throw(e)})}return(e){return bt(this,void 0,void 0,function*(){return yield this.source.return(e)})}readMessage(e){return bt(this,void 0,void 0,function*(){let t;if((t=yield this.next()).done)return null;if(e!=null&&t.value.headerType!==e)throw new Error(ER(e));return t.value})}readMessageBody(e){return bt(this,void 0,void 0,function*(){if(e<=0)return new Uint8Array(0);const t=Vt(yield this.source.read(e));if(t.byteLength<e)throw new Error(qz(e,t.byteLength));return t.byteOffset%8===0&&t.byteOffset+t.byteLength<=t.buffer.byteLength?t:t.slice()})}readSchema(){return bt(this,arguments,void 0,function*(e=!1){const t=Qt.Schema,i=yield this.readMessage(t),r=i==null?void 0:i.header();if(e&&!r)throw new Error(MR(t));return r})}readMetadataLength(){return bt(this,void 0,void 0,function*(){const e=yield this.source.read(Nb),t=e&&new lf(e),i=(t==null?void 0:t.readInt32(0))||0;return{done:i===0,value:i}})}readMetadata(e){return bt(this,void 0,void 0,function*(){const t=yield this.source.read(e);if(!t)return Qn;if(t.byteLength<e)throw new Error(jz(e,t.byteLength));return{done:!1,value:yr.decode(t)}})}}class Lde extends Xz{constructor(e){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=e instanceof cL?e:new cL(e)}next(){const{_json:e}=this;if(!this._schema)return this._schema=!0,{done:!1,value:yr.fromJSON(e.schema,Qt.Schema)};if(this._dictionaryIndex<e.dictionaries.length){const t=e.dictionaries[this._dictionaryIndex++];return this._body=t.data.columns,{done:!1,value:yr.fromJSON(t,Qt.DictionaryBatch)}}if(this._batchIndex<e.batches.length){const t=e.batches[this._batchIndex++];return this._body=t.columns,{done:!1,value:yr.fromJSON(t,Qt.RecordBatch)}}return this._body=[],Qn}readMessageBody(e){return t(this._body);function t(i){return(i||[]).reduce((r,s)=>[...r,...s.VALIDITY&&[s.VALIDITY]||[],...s.TYPE_ID&&[s.TYPE_ID]||[],...s.OFFSET&&[s.OFFSET]||[],...s.DATA&&[s.DATA]||[],...t(s.children)],[])}}readMessage(e){let t;if((t=this.next()).done)return null;if(e!=null&&t.value.headerType!==e)throw new Error(ER(e));return t.value}readSchema(){const e=Qt.Schema,t=this.readMessage(e),i=t==null?void 0:t.header();if(!t||!i)throw new Error(MR(e));return i}}const Nb=4,fM="ARROW1",eg=new Uint8Array(fM.length);for(let n=0;n<fM.length;n+=1)eg[n]=fM.codePointAt(n);function wR(n,e=0){for(let t=-1,i=eg.length;++t<i;)if(eg[t]!==n[e+t])return!1;return!0}const Hg=eg.length,Yz=Hg+Nb,Pde=Hg*2+Nb;class Gs extends yR{constructor(e){super(),this._impl=e}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(e){return this._impl.throw(e)}return(e){return this._impl.return(e)}cancel(){return this._impl.cancel()}reset(e){return this._impl.reset(e),this._DOMStream=void 0,this._nodeStream=void 0,this}open(e){const t=this._impl.open(e);return xc(t)?t.then(()=>this):this}readRecordBatch(e){return this._impl.isFile()?this._impl.readRecordBatch(e):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return Rs.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return Rs.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,t){throw new Error('"throughDOM" not available in this environment')}static from(e){return e instanceof Gs?e:iM(e)?Bde(e):tk(e)?zde(e):xc(e)?bt(this,void 0,void 0,function*(){return yield Gs.from(yield e)}):nk(e)||oR(e)||ik(e)||Pf(e)?kde(new hf(e)):Fde(new b0(e))}static readAll(e){return e instanceof Gs?e.isSync()?vL(e):bL(e):iM(e)||ArrayBuffer.isView(e)||kg(e)||ek(e)?vL(e):bL(e)}}class x0 extends Gs{constructor(e){super(e),this._impl=e}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return za(this,arguments,function*(){yield At(yield*Fy(uc(this[Symbol.iterator]())))})}}class T0 extends Gs{constructor(e){super(e),this._impl=e}readAll(){return bt(this,void 0,void 0,function*(){var e,t,i,r;const s=new Array;try{for(var a=!0,o=uc(this),l;l=yield o.next(),e=l.done,!e;a=!0){r=l.value,a=!1;const u=r;s.push(u)}}catch(u){t={error:u}}finally{try{!a&&!e&&(i=o.return)&&(yield i.call(o))}finally{if(t)throw t.error}}return s})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class Kz extends x0{constructor(e){super(e),this._impl=e}}class Ude extends T0{constructor(e){super(e),this._impl=e}}class Qz{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(e=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=e}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(e){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=e,this.dictionaries=new Map,this}_loadRecordBatch(e,t){const i=this._loadVectors(e,t,this.schema.fields),r=Ot({type:new _r(this.schema.fields),length:e.length,children:i});return new Ur(this.schema,r)}_loadDictionaryBatch(e,t){const{id:i,isDelta:r}=e,{dictionaries:s,schema:a}=this,o=s.get(i),l=a.dictionaries.get(i),u=this._loadVectors(e.data,t,[l]);return(o&&r?o.concat(new sn(u)):new sn(u)).memoize()}_loadVectors(e,t,i){return new kz(t,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(i)}}class E0 extends Qz{constructor(e,t){super(t),this._reader=iM(e)?new Lde(this._handle=e):new Xz(this._handle=e)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(e){return this.closed||(this.autoDestroy=Jz(this,e),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(e):Qn}return(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(e):Qn}next(){if(this.closed)return Qn;let e;const{_reader:t}=this;for(;e=this._readNextMessageAndValidate();)if(e.isSchema())this.reset(e.header());else if(e.isRecordBatch()){this._recordBatchIndex++;const i=e.header(),r=t.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(i,r)}}else if(e.isDictionaryBatch()){this._dictionaryIndex++;const i=e.header(),r=t.readMessageBody(e.bodyLength),s=this._loadDictionaryBatch(i,r);this.dictionaries.set(i.id,s)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new TR(this.schema)}):this.return()}_readNextMessageAndValidate(e){return this._reader.readMessage(e)}}class M0 extends Qz{constructor(e,t){super(t),this._reader=new Dde(this._handle=e)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return bt(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(e){return bt(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=Jz(this,e),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(e){return bt(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(e):Qn})}return(e){return bt(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(e):Qn})}next(){return bt(this,void 0,void 0,function*(){if(this.closed)return Qn;let e;const{_reader:t}=this;for(;e=yield this._readNextMessageAndValidate();)if(e.isSchema())yield this.reset(e.header());else if(e.isRecordBatch()){this._recordBatchIndex++;const i=e.header(),r=yield t.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(i,r)}}else if(e.isDictionaryBatch()){this._dictionaryIndex++;const i=e.header(),r=yield t.readMessageBody(e.bodyLength),s=this._loadDictionaryBatch(i,r);this.dictionaries.set(i.id,s)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new TR(this.schema)}):yield this.return()})}_readNextMessageAndValidate(e){return bt(this,void 0,void 0,function*(){return yield this._reader.readMessage(e)})}}class Zz extends E0{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,t){super(e instanceof hL?e:new hL(e),t)}isSync(){return!0}isFile(){return!0}open(e){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const t of this._footer.dictionaryBatches())t&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(e)}readRecordBatch(e){var t;if(this.closed)return null;this._footer||this.open();const i=(t=this._footer)===null||t===void 0?void 0:t.getRecordBatch(e);if(i&&this._handle.seek(i.offset)){const r=this._reader.readMessage(Qt.RecordBatch);if(r!=null&&r.isRecordBatch()){const s=r.header(),a=this._reader.readMessageBody(r.bodyLength);return this._loadRecordBatch(s,a)}}return null}_readDictionaryBatch(e){var t;const i=(t=this._footer)===null||t===void 0?void 0:t.getDictionaryBatch(e);if(i&&this._handle.seek(i.offset)){const r=this._reader.readMessage(Qt.DictionaryBatch);if(r!=null&&r.isDictionaryBatch()){const s=r.header(),a=this._reader.readMessageBody(r.bodyLength),o=this._loadDictionaryBatch(s,a);this.dictionaries.set(s.id,o)}}}_readFooter(){const{_handle:e}=this,t=e.size-Yz,i=e.readInt32(t),r=e.readAt(t-i,i);return Jm.decode(r)}_readNextMessageAndValidate(e){var t;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const i=(t=this._footer)===null||t===void 0?void 0:t.getRecordBatch(this._recordBatchIndex);if(i&&this._handle.seek(i.offset))return this._reader.readMessage(e)}return null}}class Ode extends M0{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,...t){const i=typeof t[0]!="number"?t.shift():void 0,r=t[0]instanceof Map?t.shift():void 0;super(e instanceof S0?e:new S0(e,i),r)}isFile(){return!0}isAsync(){return!0}open(e){const t=Object.create(null,{open:{get:()=>super.open}});return bt(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const i of this._footer.dictionaryBatches())i&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield t.open.call(this,e)})}readRecordBatch(e){return bt(this,void 0,void 0,function*(){var t;if(this.closed)return null;this._footer||(yield this.open());const i=(t=this._footer)===null||t===void 0?void 0:t.getRecordBatch(e);if(i&&(yield this._handle.seek(i.offset))){const r=yield this._reader.readMessage(Qt.RecordBatch);if(r!=null&&r.isRecordBatch()){const s=r.header(),a=yield this._reader.readMessageBody(r.bodyLength);return this._loadRecordBatch(s,a)}}return null})}_readDictionaryBatch(e){return bt(this,void 0,void 0,function*(){var t;const i=(t=this._footer)===null||t===void 0?void 0:t.getDictionaryBatch(e);if(i&&(yield this._handle.seek(i.offset))){const r=yield this._reader.readMessage(Qt.DictionaryBatch);if(r!=null&&r.isDictionaryBatch()){const s=r.header(),a=yield this._reader.readMessageBody(r.bodyLength),o=this._loadDictionaryBatch(s,a);this.dictionaries.set(s.id,o)}}})}_readFooter(){return bt(this,void 0,void 0,function*(){const{_handle:e}=this;e._pending&&(yield e._pending);const t=e.size-Yz,i=yield e.readInt32(t),r=yield e.readAt(t-i,i);return Jm.decode(r)})}_readNextMessageAndValidate(e){return bt(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const t=this._footer.getRecordBatch(this._recordBatchIndex);if(t&&(yield this._handle.seek(t.offset)))return yield this._reader.readMessage(e)}return null})}}class Ide extends E0{constructor(e,t){super(e,t)}_loadVectors(e,t,i){return new Yhe(t,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(i)}}function Jz(n,e){return e&&typeof e.autoDestroy=="boolean"?e.autoDestroy:n.autoDestroy}function*vL(n){const e=Gs.from(n);try{if(!e.open({autoDestroy:!1}).closed)do yield e;while(!e.reset().open().closed)}finally{e.cancel()}}function bL(n){return za(this,arguments,function*(){const t=yield At(Gs.from(n));try{if(!(yield At(t.open({autoDestroy:!1}))).closed)do yield yield At(t);while(!(yield At(t.reset().open())).closed)}finally{yield At(t.cancel())}})}function Bde(n){return new x0(new Ide(n))}function Fde(n){const e=n.peek(Hg+7&-8);return e&&e.byteLength>=4?wR(e)?new Kz(new Zz(n.read())):new x0(new E0(n)):new x0(new E0(function*(){}()))}function kde(n){return bt(this,void 0,void 0,function*(){const e=yield n.peek(Hg+7&-8);return e&&e.byteLength>=4?wR(e)?new Kz(new Zz(yield n.read())):new T0(new M0(n)):new T0(new M0(function(){return za(this,arguments,function*(){})}()))})}function zde(n){return bt(this,void 0,void 0,function*(){const{size:e}=yield n.stat(),t=new S0(n,e);return e>=Pde&&wR(yield t.readAt(0,Hg+7&-8))?new Ude(new Ode(t)):new T0(new M0(t))})}class Jn extends Ut{static assemble(...e){const t=r=>r.flatMap(s=>Array.isArray(s)?t(s):s instanceof Ur?s.data.children:s.data),i=new Jn;return i.visitMany(t(e)),i}constructor(){super(),this._byteLength=0,this._nodes=[],this._buffers=[],this._bufferRegions=[]}visit(e){if(e instanceof sn)return this.visitMany(e.data),this;const{type:t}=e;if(!Ge.isDictionary(t)){const{length:i}=e;if(i>2147483647)throw new RangeError("Cannot write arrays larger than 2^31 - 1 in length");if(Ge.isUnion(t))this.nodes.push(new hu(i,0));else{const{nullCount:r}=e;Ge.isNull(t)||ha.call(this,r<=0?new Uint8Array(0):m0(e.offset,i,e.nullBitmap)),this.nodes.push(new hu(i,r))}}return super.visit(e)}visitNull(e){return this}visitDictionary(e){return this.visit(e.clone(e.type.indices))}get nodes(){return this._nodes}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get bufferRegions(){return this._bufferRegions}}function ha(n){const e=n.byteLength+7&-8;return this.buffers.push(n),this.bufferRegions.push(new Ga(this._byteLength,e)),this._byteLength+=e,this}function Gde(n){var e;const{type:t,length:i,typeIds:r,valueOffsets:s}=n;if(ha.call(this,r),t.mode===sr.Sparse)return pM.call(this,n);if(t.mode===sr.Dense){if(n.offset<=0)return ha.call(this,s),pM.call(this,n);{const a=new Int32Array(i),o=Object.create(null),l=Object.create(null);for(let u,c,h=-1;++h<i;)(u=r[h])!==void 0&&((c=o[u])===void 0&&(c=o[u]=s[h]),a[h]=s[h]-c,l[u]=((e=l[u])!==null&&e!==void 0?e:0)+1);ha.call(this,a),this.visitMany(n.children.map((u,c)=>{const h=t.typeIds[c],d=o[h],f=l[h];return u.slice(d,Math.min(i,f))}))}}return this}function Vde(n){let e;return n.nullCount>=n.length?ha.call(this,new Uint8Array(0)):(e=n.values)instanceof Uint8Array?ha.call(this,m0(n.offset,n.length,e)):ha.call(this,g0(n.values))}function cl(n){return ha.call(this,n.values.subarray(0,n.length*n.stride))}function Cb(n){const{length:e,values:t,valueOffsets:i}=n,r=Rn(i[0]),s=Rn(i[e]),a=Math.min(s-r,t.byteLength-r);return ha.call(this,sk(-r,e+1,i)),ha.call(this,t.subarray(r,r+a)),this}function AR(n){const{length:e,valueOffsets:t}=n;if(t){const{[0]:i,[e]:r}=t;return ha.call(this,sk(-i,e+1,t)),this.visit(n.children[0].slice(i,r-i))}return this.visit(n.children[0])}function pM(n){return this.visitMany(n.type.children.map((e,t)=>n.children[t]).filter(Boolean))[0]}Jn.prototype.visitBool=Vde;Jn.prototype.visitInt=cl;Jn.prototype.visitFloat=cl;Jn.prototype.visitUtf8=Cb;Jn.prototype.visitLargeUtf8=Cb;Jn.prototype.visitBinary=Cb;Jn.prototype.visitLargeBinary=Cb;Jn.prototype.visitFixedSizeBinary=cl;Jn.prototype.visitDate=cl;Jn.prototype.visitTimestamp=cl;Jn.prototype.visitTime=cl;Jn.prototype.visitDecimal=cl;Jn.prototype.visitList=AR;Jn.prototype.visitStruct=pM;Jn.prototype.visitUnion=Gde;Jn.prototype.visitInterval=cl;Jn.prototype.visitDuration=cl;Jn.prototype.visitFixedSizeList=AR;Jn.prototype.visitMap=AR;class eG extends yR{static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,t){throw new Error('"throughDOM" not available in this environment')}constructor(e){super(),this._position=0,this._started=!1,this._sink=new Wy,this._schema=null,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,Wr(e)||(e={autoDestroy:!0,writeLegacyIpcFormat:!1}),this._autoDestroy=typeof e.autoDestroy=="boolean"?e.autoDestroy:!0,this._writeLegacyIpcFormat=typeof e.writeLegacyIpcFormat=="boolean"?e.writeLegacyIpcFormat:!1}toString(e=!1){return this._sink.toString(e)}toUint8Array(e=!1){return this._sink.toUint8Array(e)}writeAll(e){return xc(e)?e.then(t=>this.writeAll(t)):Pf(e)?DR(this,e):CR(this,e)}get closed(){return this._sink.closed}[Symbol.asyncIterator](){return this._sink[Symbol.asyncIterator]()}toDOMStream(e){return this._sink.toDOMStream(e)}toNodeStream(e){return this._sink.toNodeStream(e)}close(){return this.reset()._sink.close()}abort(e){return this.reset()._sink.abort(e)}finish(){return this._autoDestroy?this.close():this.reset(this._sink,this._schema),this}reset(e=this._sink,t=null){return e===this._sink||e instanceof Wy?this._sink=e:(this._sink=new Wy,e&&vce(e)?this.toDOMStream({type:"bytes"}).pipeTo(e):e&&bce(e)&&this.toNodeStream({objectMode:!1}).pipe(e)),this._started&&this._schema&&this._writeFooter(this._schema),this._started=!1,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,(!t||!dM(t,this._schema))&&(t==null?(this._position=0,this._schema=null):(this._started=!0,this._schema=t,this._writeSchema(t))),this}write(e){let t=null;if(this._sink){if(e==null)return this.finish()&&void 0;if(e instanceof fr&&!(t=e.schema))return this.finish()&&void 0;if(e instanceof Ur&&!(t=e.schema))return this.finish()&&void 0}else throw new Error("RecordBatchWriter is closed");if(t&&!dM(t,this._schema)){if(this._started&&this._autoDestroy)return this.close();this.reset(this._sink,t)}e instanceof Ur?e instanceof TR||this._writeRecordBatch(e):e instanceof fr?this.writeAll(e.batches):kg(e)&&this.writeAll(e)}_writeMessage(e,t=8){const i=t-1,r=yr.encode(e),s=r.byteLength,a=this._writeLegacyIpcFormat?4:8,o=s+a+i&~i,l=o-s-a;return e.headerType===Qt.RecordBatch?this._recordBatchBlocks.push(new uu(o,e.bodyLength,this._position)):e.headerType===Qt.DictionaryBatch&&this._dictionaryBlocks.push(new uu(o,e.bodyLength,this._position)),this._writeLegacyIpcFormat||this._write(Int32Array.of(-1)),this._write(Int32Array.of(o-a)),s>0&&this._write(r),this._writePadding(l)}_write(e){if(this._started){const t=Vt(e);t&&t.byteLength>0&&(this._sink.write(t),this._position+=t.byteLength)}return this}_writeSchema(e){return this._writeMessage(yr.from(e))}_writeFooter(e){return this._writeLegacyIpcFormat?this._write(Int32Array.of(0)):this._write(Int32Array.of(-1,0))}_writeMagic(){return this._write(eg)}_writePadding(e){return e>0?this._write(new Uint8Array(e)):this}_writeRecordBatch(e){const{byteLength:t,nodes:i,bufferRegions:r,buffers:s}=Jn.assemble(e),a=new Ss(e.numRows,i,r),o=yr.from(a,t);return this._writeDictionaries(e)._writeMessage(o)._writeBodyBuffers(s)}_writeDictionaryBatch(e,t,i=!1){const{byteLength:r,nodes:s,bufferRegions:a,buffers:o}=Jn.assemble(new sn([e])),l=new Ss(e.length,s,a),u=new eo(l,t,i),c=yr.from(u,r);return this._writeMessage(c)._writeBodyBuffers(o)}_writeBodyBuffers(e){let t,i,r;for(let s=-1,a=e.length;++s<a;)(t=e[s])&&(i=t.byteLength)>0&&(this._write(t),(r=(i+7&-8)-i)>0&&this._writePadding(r));return this}_writeDictionaries(e){var t,i;for(const[r,s]of e.dictionaries){const a=(t=s==null?void 0:s.data)!==null&&t!==void 0?t:[],o=this._seenDictionaries.get(r),l=(i=this._dictionaryDeltaOffsets.get(r))!==null&&i!==void 0?i:0;if(!o||o.data[0]!==a[0])for(const[u,c]of a.entries())this._writeDictionaryBatch(c,r,u>0);else if(l<a.length)for(const u of a.slice(l))this._writeDictionaryBatch(u,r,!0);this._seenDictionaries.set(r,s),this._dictionaryDeltaOffsets.set(r,a.length)}return this}}class RR extends eG{static writeAll(e,t){const i=new RR(t);return xc(e)?e.then(r=>i.writeAll(r)):Pf(e)?DR(i,e):CR(i,e)}}class NR extends eG{static writeAll(e){const t=new NR;return xc(e)?e.then(i=>t.writeAll(i)):Pf(e)?DR(t,e):CR(t,e)}constructor(){super(),this._autoDestroy=!0}_writeSchema(e){return this._writeMagic()._writePadding(2)}_writeDictionaryBatch(e,t,i=!1){if(!i&&this._seenDictionaries.has(t))throw new Error("The Arrow File format does not support replacement dictionaries. ");return super._writeDictionaryBatch(e,t,i)}_writeFooter(e){const t=Jm.encode(new Jm(e,ci.V5,this._recordBatchBlocks,this._dictionaryBlocks));return super._writeFooter(e)._write(t)._write(Int32Array.of(t.byteLength))._writeMagic()}}function CR(n,e){let t=e;e instanceof fr&&(t=e.batches,n.reset(void 0,e.schema));for(const i of t)n.write(i);return n.finish()}function DR(n,e){return bt(this,void 0,void 0,function*(){var t,i,r,s,a,o,l;try{for(t=!0,i=uc(e);r=yield i.next(),s=r.done,!s;t=!0){l=r.value,t=!1;const u=l;n.write(u)}}catch(u){a={error:u}}finally{try{!t&&!s&&(o=i.return)&&(yield o.call(i))}finally{if(a)throw a.error}}return n.finish()})}function Hde(n,e="stream"){return(e==="stream"?RR:NR).writeAll(n).toUint8Array(!0)}var $de=Object.create,tG=Object.defineProperty,Wde=Object.getOwnPropertyDescriptor,jde=Object.getOwnPropertyNames,qde=Object.getPrototypeOf,Xde=Object.prototype.hasOwnProperty,Yde=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Kde=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of jde(e))!Xde.call(n,r)&&r!==t&&tG(n,r,{get:()=>e[r],enumerable:!(i=Wde(e,r))||i.enumerable});return n},Qde=(n,e,t)=>(t=n!=null?$de(qde(n)):{},Kde(!n||!n.__esModule?tG(t,"default",{value:n,enumerable:!0}):t,n)),Zde=Yde((n,e)=>{e.exports=Worker}),Jde=(n=>(n[n.UNDEFINED=0]="UNDEFINED",n[n.AUTOMATIC=1]="AUTOMATIC",n[n.READ_ONLY=2]="READ_ONLY",n[n.READ_WRITE=3]="READ_WRITE",n))(Jde||{}),efe=(n=>(n[n.IDENTIFIER=0]="IDENTIFIER",n[n.NUMERIC_CONSTANT=1]="NUMERIC_CONSTANT",n[n.STRING_CONSTANT=2]="STRING_CONSTANT",n[n.OPERATOR=3]="OPERATOR",n[n.KEYWORD=4]="KEYWORD",n[n.COMMENT=5]="COMMENT",n))(efe||{}),tfe=(n=>(n[n.NONE=0]="NONE",n[n.DEBUG=1]="DEBUG",n[n.INFO=2]="INFO",n[n.WARNING=3]="WARNING",n[n.ERROR=4]="ERROR",n))(tfe||{}),nfe=(n=>(n[n.NONE=0]="NONE",n[n.CONNECT=1]="CONNECT",n[n.DISCONNECT=2]="DISCONNECT",n[n.OPEN=3]="OPEN",n[n.QUERY=4]="QUERY",n[n.INSTANTIATE=5]="INSTANTIATE",n))(nfe||{}),ife=(n=>(n[n.NONE=0]="NONE",n[n.OK=1]="OK",n[n.ERROR=2]="ERROR",n[n.START=3]="START",n[n.RUN=4]="RUN",n[n.CAPTURE=5]="CAPTURE",n))(ife||{}),rfe=(n=>(n[n.NONE=0]="NONE",n[n.WEB_WORKER=1]="WEB_WORKER",n[n.NODE_WORKER=2]="NODE_WORKER",n[n.BINDINGS=3]="BINDINGS",n[n.ASYNC_DUCKDB=4]="ASYNC_DUCKDB",n))(rfe||{}),sfe=class{constructor(n=2){this.level=n}log(n){n.level>=this.level&&console.log(n)}},afe=(n=>(n[n.SUCCESS=0]="SUCCESS",n[n.MAX_ARROW_ERROR=255]="MAX_ARROW_ERROR",n[n.DUCKDB_WASM_RETRY=256]="DUCKDB_WASM_RETRY",n))(afe||{}),ofe=class{constructor(n,e){this._bindings=n,this._conn=e}get bindings(){return this._bindings}async close(){return this._bindings.disconnect(this._conn)}useUnsafe(n){return n(this._bindings,this._conn)}async query(n){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:n});let e=await this._bindings.runQuery(this._conn,n),t=Gs.from(e);return console.assert(t.isSync(),"Reader is not sync"),console.assert(t.isFile(),"Reader is not file"),new fr(t)}async send(n,e=!1){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:n});let t=await this._bindings.startPendingQuery(this._conn,n,e);for(;t==null;)t=await this._bindings.pollPendingQuery(this._conn);let i=new nG(this._bindings,this._conn,t),r=await Gs.from(i);return console.assert(r.isAsync()),console.assert(r.isStream()),r}async cancelSent(){return await this._bindings.cancelPendingQuery(this._conn)}async getTableNames(n){return await this._bindings.getTableNames(this._conn,n)}async prepare(n){let e=await this._bindings.createPrepared(this._conn,n);return new lfe(this._bindings,this._conn,e)}async insertArrowTable(n,e){let t=Hde(n,"stream");await this.insertArrowFromIPCStream(t,e)}async insertArrowFromIPCStream(n,e){await this._bindings.insertArrowFromIPCStream(this._conn,n,e)}async insertCSVFromPath(n,e){await this._bindings.insertCSVFromPath(this._conn,n,e)}async insertJSONFromPath(n,e){await this._bindings.insertJSONFromPath(this._conn,n,e)}},nG=class{constructor(n,e,t){this.db=n,this.conn=e,this.header=t,this._first=!0,this._depleted=!1,this._inFlight=null}async next(){if(this._first)return this._first=!1,{done:!1,value:this.header};if(this._depleted)return{done:!0,value:null};let n=null;for(this._inFlight!=null&&(n=await this._inFlight,this._inFlight=null);n==null;)n=await this.db.fetchQueryResults(this.conn);return this._depleted=n.length==0,this._depleted||(this._inFlight=this.db.fetchQueryResults(this.conn)),{done:this._depleted,value:n}}[Symbol.asyncIterator](){return this}},lfe=class{constructor(n,e,t){this.bindings=n,this.connectionId=e,this.statementId=t}async close(){await this.bindings.closePrepared(this.connectionId,this.statementId)}async query(...n){let e=await this.bindings.runPrepared(this.connectionId,this.statementId,n),t=Gs.from(e);return console.assert(t.isSync()),console.assert(t.isFile()),new fr(t)}async send(...n){let e=await this.bindings.sendPrepared(this.connectionId,this.statementId,n),t=new nG(this.bindings,this.connectionId,e),i=await Gs.from(t);return console.assert(i.isAsync()),console.assert(i.isStream()),i}},ufe=(n=>(n.CANCEL_PENDING_QUERY="CANCEL_PENDING_QUERY",n.CLOSE_PREPARED="CLOSE_PREPARED",n.COLLECT_FILE_STATISTICS="COLLECT_FILE_STATISTICS",n.REGISTER_OPFS_FILE_NAME="REGISTER_OPFS_FILE_NAME",n.CONNECT="CONNECT",n.COPY_FILE_TO_BUFFER="COPY_FILE_TO_BUFFER",n.COPY_FILE_TO_PATH="COPY_FILE_TO_PATH",n.CREATE_PREPARED="CREATE_PREPARED",n.DISCONNECT="DISCONNECT",n.DROP_FILE="DROP_FILE",n.DROP_FILES="DROP_FILES",n.EXPORT_FILE_STATISTICS="EXPORT_FILE_STATISTICS",n.FETCH_QUERY_RESULTS="FETCH_QUERY_RESULTS",n.FLUSH_FILES="FLUSH_FILES",n.GET_FEATURE_FLAGS="GET_FEATURE_FLAGS",n.GET_TABLE_NAMES="GET_TABLE_NAMES",n.GET_VERSION="GET_VERSION",n.GLOB_FILE_INFOS="GLOB_FILE_INFOS",n.INSERT_ARROW_FROM_IPC_STREAM="INSERT_ARROW_FROM_IPC_STREAM",n.INSERT_CSV_FROM_PATH="IMPORT_CSV_FROM_PATH",n.INSERT_JSON_FROM_PATH="IMPORT_JSON_FROM_PATH",n.INSTANTIATE="INSTANTIATE",n.OPEN="OPEN",n.PING="PING",n.POLL_PENDING_QUERY="POLL_PENDING_QUERY",n.REGISTER_FILE_BUFFER="REGISTER_FILE_BUFFER",n.REGISTER_FILE_HANDLE="REGISTER_FILE_HANDLE",n.REGISTER_FILE_URL="REGISTER_FILE_URL",n.RESET="RESET",n.RUN_PREPARED="RUN_PREPARED",n.RUN_QUERY="RUN_QUERY",n.SEND_PREPARED="SEND_PREPARED",n.START_PENDING_QUERY="START_PENDING_QUERY",n.TOKENIZE="TOKENIZE",n))(ufe||{}),cfe=(n=>(n.CONNECTION_INFO="CONNECTION_INFO",n.ERROR="ERROR",n.FEATURE_FLAGS="FEATURE_FLAGS",n.FILE_BUFFER="FILE_BUFFER",n.FILE_INFOS="FILE_INFOS",n.FILE_SIZE="FILE_SIZE",n.FILE_STATISTICS="FILE_STATISTICS",n.INSTANTIATE_PROGRESS="INSTANTIATE_PROGRESS",n.LOG="LOG",n.PROGRESS_UPDATE="PROGRESS_UPDATE",n.OK="OK",n.PREPARED_STATEMENT_ID="PREPARED_STATEMENT_ID",n.QUERY_PLAN="QUERY_PLAN",n.QUERY_RESULT="QUERY_RESULT",n.QUERY_RESULT_CHUNK="QUERY_RESULT_CHUNK",n.QUERY_RESULT_HEADER="QUERY_RESULT_HEADER",n.QUERY_RESULT_HEADER_OR_NULL="QUERY_RESULT_HEADER_OR_NULL",n.REGISTERED_FILE="REGISTERED_FILE",n.SCRIPT_TOKENS="SCRIPT_TOKENS",n.SUCCESS="SUCCESS",n.TABLE_NAMES="TABLE_NAMES",n.VERSION_STRING="VERSION_STRING",n))(cfe||{}),Ht=class{constructor(n,e){this.promiseResolver=()=>{},this.promiseRejecter=()=>{},this.type=n,this.data=e,this.promise=new Promise((t,i)=>{this.promiseResolver=t,this.promiseRejecter=i})}};function Xy(n){switch(n.typeId){case B.Binary:return{sqlType:"binary"};case B.Bool:return{sqlType:"bool"};case B.Date:return{sqlType:"date"};case B.DateDay:return{sqlType:"date32[d]"};case B.DateMillisecond:return{sqlType:"date64[ms]"};case B.Decimal:{let e=n;return{sqlType:"decimal",precision:e.precision,scale:e.scale}}case B.Float:return{sqlType:"float"};case B.Float16:return{sqlType:"float16"};case B.Float32:return{sqlType:"float32"};case B.Float64:return{sqlType:"float64"};case B.Int:return{sqlType:"int32"};case B.Int16:return{sqlType:"int16"};case B.Int32:return{sqlType:"int32"};case B.Int64:return{sqlType:"int64"};case B.Uint16:return{sqlType:"uint16"};case B.Uint32:return{sqlType:"uint32"};case B.Uint64:return{sqlType:"uint64"};case B.Uint8:return{sqlType:"uint8"};case B.IntervalDayTime:return{sqlType:"interval[dt]"};case B.IntervalYearMonth:return{sqlType:"interval[m]"};case B.List:return{sqlType:"list",valueType:Xy(n.valueType)};case B.FixedSizeBinary:return{sqlType:"fixedsizebinary",byteWidth:n.byteWidth};case B.Null:return{sqlType:"null"};case B.Utf8:return{sqlType:"utf8"};case B.Struct:return{sqlType:"struct",fields:n.children.map(e=>mM(e.name,e.type))};case B.Map:{let e=n;return{sqlType:"map",keyType:Xy(e.keyType),valueType:Xy(e.valueType)}}case B.Time:return{sqlType:"time[s]"};case B.TimeMicrosecond:return{sqlType:"time[us]"};case B.TimeMillisecond:return{sqlType:"time[ms]"};case B.TimeNanosecond:return{sqlType:"time[ns]"};case B.TimeSecond:return{sqlType:"time[s]"};case B.Timestamp:return{sqlType:"timestamp",timezone:n.timezone||void 0};case B.TimestampSecond:return{sqlType:"timestamp[s]",timezone:n.timezone||void 0};case B.TimestampMicrosecond:return{sqlType:"timestamp[us]",timezone:n.timezone||void 0};case B.TimestampNanosecond:return{sqlType:"timestamp[ns]",timezone:n.timezone||void 0};case B.TimestampMillisecond:return{sqlType:"timestamp[ms]",timezone:n.timezone||void 0}}throw new Error("unsupported arrow type: ".concat(n.toString()))}function mM(n,e){let t=Xy(e);return t.name=n,t}var hfe=new TextEncoder,dfe=class{constructor(n,e=null){this._onInstantiationProgress=[],this._onExecutionProgress=[],this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{},this._nextMessageId=0,this._pendingRequests=new Map,this._logger=n,this._onMessageHandler=this.onMessage.bind(this),this._onErrorHandler=this.onError.bind(this),this._onCloseHandler=this.onClose.bind(this),e!=null&&this.attach(e)}get logger(){return this._logger}attach(n){this._worker=n,this._worker.addEventListener("message",this._onMessageHandler),this._worker.addEventListener("error",this._onErrorHandler),this._worker.addEventListener("close",this._onCloseHandler),this._workerShutdownPromise=new Promise((e,t)=>{this._workerShutdownResolver=e})}detach(){this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler),this._worker.removeEventListener("error",this._onErrorHandler),this._worker.removeEventListener("close",this._onCloseHandler),this._worker=null,this._workerShutdownResolver(null),this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async terminate(){this._worker&&(this._worker.terminate(),this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async postTask(n,e=[]){if(!this._worker){console.error("cannot send a message since the worker is not set!");return}let t=this._nextMessageId++;return this._pendingRequests.set(t,n),this._worker.postMessage({messageId:t,type:n.type,data:n.data},e),await n.promise}onMessage(n){var e;let t=n.data;switch(t.type){case"PROGRESS_UPDATE":{for(let r of this._onExecutionProgress)r(t.data);return}case"LOG":{this._logger.log(t.data);return}case"INSTANTIATE_PROGRESS":{for(let r of this._onInstantiationProgress)r(t.data);return}}let i=this._pendingRequests.get(t.requestId);if(!i){console.warn("unassociated response: [".concat(t.requestId,", ").concat(t.type.toString(),"]"));return}if(this._pendingRequests.delete(t.requestId),t.type=="ERROR"){let r=new Error(t.data.message);r.name=t.data.name,(e=Object.getOwnPropertyDescriptor(r,"stack"))!=null&&e.writable&&(r.stack=t.data.stack),i.promiseRejecter(r);return}switch(i.type){case"CLOSE_PREPARED":case"COLLECT_FILE_STATISTICS":case"REGISTER_OPFS_FILE_NAME":case"COPY_FILE_TO_PATH":case"DISCONNECT":case"DROP_FILE":case"DROP_FILES":case"FLUSH_FILES":case"INSERT_ARROW_FROM_IPC_STREAM":case"IMPORT_CSV_FROM_PATH":case"IMPORT_JSON_FROM_PATH":case"OPEN":case"PING":case"REGISTER_FILE_BUFFER":case"REGISTER_FILE_HANDLE":case"REGISTER_FILE_URL":case"RESET":if(t.type=="OK"){i.promiseResolver(t.data);return}break;case"INSTANTIATE":if(this._onInstantiationProgress=[],t.type=="OK"){i.promiseResolver(t.data);return}break;case"GLOB_FILE_INFOS":if(t.type=="FILE_INFOS"){i.promiseResolver(t.data);return}break;case"GET_VERSION":if(t.type=="VERSION_STRING"){i.promiseResolver(t.data);return}break;case"GET_FEATURE_FLAGS":if(t.type=="FEATURE_FLAGS"){i.promiseResolver(t.data);return}break;case"GET_TABLE_NAMES":if(t.type=="TABLE_NAMES"){i.promiseResolver(t.data);return}break;case"TOKENIZE":if(t.type=="SCRIPT_TOKENS"){i.promiseResolver(t.data);return}break;case"COPY_FILE_TO_BUFFER":if(t.type=="FILE_BUFFER"){i.promiseResolver(t.data);return}break;case"EXPORT_FILE_STATISTICS":if(t.type=="FILE_STATISTICS"){i.promiseResolver(t.data);return}break;case"CONNECT":if(t.type=="CONNECTION_INFO"){i.promiseResolver(t.data);return}break;case"RUN_PREPARED":case"RUN_QUERY":if(t.type=="QUERY_RESULT"){i.promiseResolver(t.data);return}break;case"SEND_PREPARED":if(t.type=="QUERY_RESULT_HEADER"){i.promiseResolver(t.data);return}break;case"START_PENDING_QUERY":if(t.type=="QUERY_RESULT_HEADER_OR_NULL"){i.promiseResolver(t.data);return}break;case"POLL_PENDING_QUERY":if(t.type=="QUERY_RESULT_HEADER_OR_NULL"){i.promiseResolver(t.data);return}break;case"CANCEL_PENDING_QUERY":if(this._onInstantiationProgress=[],t.type=="SUCCESS"){i.promiseResolver(t.data);return}break;case"FETCH_QUERY_RESULTS":if(t.type=="QUERY_RESULT_CHUNK"){i.promiseResolver(t.data);return}break;case"CREATE_PREPARED":if(t.type=="PREPARED_STATEMENT_ID"){i.promiseResolver(t.data);return}break}i.promiseRejecter(new Error("unexpected response type: ".concat(t.type.toString())))}onError(n){console.error(n),console.error("error in duckdb worker: ".concat(n.message)),this._pendingRequests.clear()}onClose(){if(this._workerShutdownResolver(null),this._pendingRequests.size!=0){console.warn("worker terminated with ".concat(this._pendingRequests.size," pending requests"));return}this._pendingRequests.clear()}async reset(){let n=new Ht("RESET",null);return await this.postTask(n)}async ping(){let n=new Ht("PING",null);await this.postTask(n)}async dropFile(n){let e=new Ht("DROP_FILE",n);return await this.postTask(e)}async dropFiles(){let n=new Ht("DROP_FILES",null);return await this.postTask(n)}async flushFiles(){let n=new Ht("FLUSH_FILES",null);return await this.postTask(n)}async instantiate(n,e=null,t=i=>{}){this._onInstantiationProgress.push(t);let i=new Ht("INSTANTIATE",[n,e]);return await this.postTask(i)}async getVersion(){let n=new Ht("GET_VERSION",null);return await this.postTask(n)}async getFeatureFlags(){let n=new Ht("GET_FEATURE_FLAGS",null);return await this.postTask(n)}async open(n){let e=new Ht("OPEN",n);await this.postTask(e)}async tokenize(n){let e=new Ht("TOKENIZE",n);return await this.postTask(e)}async connectInternal(){let n=new Ht("CONNECT",null);return await this.postTask(n)}async connect(){let n=await this.connectInternal();return new ofe(this,n)}async disconnect(n){let e=new Ht("DISCONNECT",n);await this.postTask(e)}async runQuery(n,e){let t=new Ht("RUN_QUERY",[n,e]);return await this.postTask(t)}async startPendingQuery(n,e,t=!1){let i=new Ht("START_PENDING_QUERY",[n,e,t]);return await this.postTask(i)}async pollPendingQuery(n){let e=new Ht("POLL_PENDING_QUERY",n);return await this.postTask(e)}async cancelPendingQuery(n){let e=new Ht("CANCEL_PENDING_QUERY",n);return await this.postTask(e)}async fetchQueryResults(n){let e=new Ht("FETCH_QUERY_RESULTS",n);return await this.postTask(e)}async getTableNames(n,e){let t=new Ht("GET_TABLE_NAMES",[n,e]);return await this.postTask(t)}async createPrepared(n,e){let t=new Ht("CREATE_PREPARED",[n,e]);return await this.postTask(t)}async closePrepared(n,e){let t=new Ht("CLOSE_PREPARED",[n,e]);await this.postTask(t)}async runPrepared(n,e,t){let i=new Ht("RUN_PREPARED",[n,e,t]);return await this.postTask(i)}async sendPrepared(n,e,t){let i=new Ht("SEND_PREPARED",[n,e,t]);return await this.postTask(i)}async globFiles(n){let e=new Ht("GLOB_FILE_INFOS",n);return await this.postTask(e)}async registerFileText(n,e){let t=hfe.encode(e);await this.registerFileBuffer(n,t)}async registerFileURL(n,e,t,i){e===void 0&&(e=n);let r=new Ht("REGISTER_FILE_URL",[n,e,t,i]);await this.postTask(r)}async registerEmptyFileBuffer(n){}async registerFileBuffer(n,e){let t=new Ht("REGISTER_FILE_BUFFER",[n,e]);await this.postTask(t,[e.buffer])}async registerFileHandle(n,e,t,i){let r=new Ht("REGISTER_FILE_HANDLE",[n,e,t,i]);await this.postTask(r,[])}async registerOPFSFileName(n){let e=new Ht("REGISTER_OPFS_FILE_NAME",[n]);await this.postTask(e,[])}async collectFileStatistics(n,e){let t=new Ht("COLLECT_FILE_STATISTICS",[n,e]);await this.postTask(t,[])}async exportFileStatistics(n){let e=new Ht("EXPORT_FILE_STATISTICS",n);return await this.postTask(e,[])}async copyFileToBuffer(n){let e=new Ht("COPY_FILE_TO_BUFFER",n);return await this.postTask(e)}async copyFileToPath(n,e){let t=new Ht("COPY_FILE_TO_PATH",[n,e]);await this.postTask(t)}async insertArrowFromIPCStream(n,e,t){if(e.length==0)return;let i=new Ht("INSERT_ARROW_FROM_IPC_STREAM",[n,e,t]);await this.postTask(i,[e.buffer])}async insertCSVFromPath(n,e,t){if(t.columns!==void 0){let r=[];for(let s in t.columns){let a=t.columns[s];r.push(mM(s,a))}t.columnsFlat=r,delete t.columns}let i=new Ht("IMPORT_CSV_FROM_PATH",[n,e,t]);await this.postTask(i)}async insertJSONFromPath(n,e,t){if(t.columns!==void 0){let r=[];for(let s in t.columns){let a=t.columns[s];r.push(mM(s,a))}t.columnsFlat=r,delete t.columns}let i=new Ht("IMPORT_JSON_FROM_PATH",[n,e,t]);await this.postTask(i)}};function ffe(){let n=new TextDecoder;return e=>(typeof SharedArrayBuffer<"u"&&e.buffer instanceof SharedArrayBuffer&&(e=new Uint8Array(e)),n.decode(e))}ffe();var pfe=(n=>(n[n.BUFFER=0]="BUFFER",n[n.NODE_FS=1]="NODE_FS",n[n.BROWSER_FILEREADER=2]="BROWSER_FILEREADER",n[n.BROWSER_FSACCESS=3]="BROWSER_FSACCESS",n[n.HTTP=4]="HTTP",n[n.S3=5]="S3",n))(pfe||{}),mfe=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])),gfe=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),_fe=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),yfe=()=>(async n=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(n)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),LR={name:"@duckdb/duckdb-wasm",version:"1.30.0"},vfe=LR.name,bfe=LR.version,PR=LR.version.split(".");PR[0];PR[1];PR[2];var Sfe=()=>typeof navigator>"u";function xfe(){let n="https://cdn.jsdelivr.net/npm/".concat(vfe,"@").concat(bfe,"/dist/");return{mvp:{mainModule:"".concat(n,"duckdb-mvp.wasm"),mainWorker:"".concat(n,"duckdb-browser-mvp.worker.js")},eh:{mainModule:"".concat(n,"duckdb-eh.wasm"),mainWorker:"".concat(n,"duckdb-browser-eh.worker.js")}}}var rT=null,sT=null,aT=null,oT=null,lT=null;async function Tfe(){return rT==null&&(rT=typeof BigInt64Array<"u"),sT==null&&(sT=await gfe()),aT==null&&(aT=await yfe()),oT==null&&(oT=await _fe()),lT==null&&(lT=await mfe()),{bigInt64Array:rT,crossOriginIsolated:Sfe()||globalThis.crossOriginIsolated||!1,wasmExceptions:sT,wasmSIMD:oT,wasmThreads:aT,wasmBulkMemory:lT}}async function Efe(n){let e=await Tfe();if(e.wasmExceptions){if(e.wasmSIMD&&e.wasmThreads&&e.crossOriginIsolated&&n.coi)return{mainModule:n.coi.mainModule,mainWorker:n.coi.mainWorker,pthreadWorker:n.coi.pthreadWorker};if(n.eh)return{mainModule:n.eh.mainModule,mainWorker:n.eh.mainWorker,pthreadWorker:null}}return{mainModule:n.mvp.mainModule,mainWorker:n.mvp.mainWorker,pthreadWorker:null}}Qde(Zde());async function Mfe(){const n=xfe(),e=await Efe(n);if(!e.mainWorker||!e.mainModule)throw new Error("No suitable DuckDB-WASM bundle found for this browser.");const t=e.mainWorker.startsWith("http")?new Worker(e.mainWorker):new Worker(new URL(e.mainWorker,import.meta.url),{type:"module"}),i=new dfe(new sfe,t);await i.instantiate(e.mainModule,e.pthreadWorker??void 0);const r=await i.connect();return await r.query("INSTALL httpfs; LOAD httpfs; SET enable_http_metadata_cache=true;"),r}var wfe={};const SL=wfe.VITE_MANIFEST_URL??new URL("/manifests/index.json",window.location.href).toString();function Afe(n){const e=n.toLowerCase();return e.includes("policy")||e.includes("regulat")?"policy":e.includes("agent")?"agents":e.includes("robot")?"robotics":e.includes("safety")||e.includes("alignment")?"safety":e.includes("chip")||e.includes("nvidia")?"chips":e.includes("openai")||e.includes("anthropic")||e.includes("deepmind")?"frontier":"other"}function Rfe(){const[n,e]=ne.useState([]),[t,i]=ne.useState(!0),[r,s]=ne.useState(null);return ne.useEffect(()=>{(async()=>{try{i(!0),s(null);const a=await fetch(SL),o=a.headers.get("content-type")||"";if(!a.ok||!o.includes("application/json")){const g=await a.text().catch(()=>"");throw new Error(`Manifest is not JSON at ${SL}. status=${a.status} content-type=${o} sample="${g.slice(0,80)}"`)}const l=await a.json(),u=Array.isArray(l.files)?l.files:[];if(!u.length){e([]);return}const c=await Mfe(),h=u.map(g=>`'${g}'`).join(",");await c.query(`
          CREATE OR REPLACE VIEW articles AS
          SELECT * FROM read_parquet([${h}]);
        `);const f=(await c.query(`
          SELECT
            id::STRING as id,
            url::STRING as url,
            title::STRING as title,
            published_at::TIMESTAMPTZ as published_at,
            domain::STRING as domain,
            language::STRING as language
          FROM articles
          WHERE published_at >= now() - INTERVAL 7 DAY
        `)).toArray(),m=Date.now(),_=f.map(([g,p,y,v,b,S])=>{const x=v?(m-v.getTime())/36e5:999,T=Math.max(1,10-x/6),w=Afe(y??"");return{id:g,url:p,title:y,published_at:v?v.toISOString():null,domain:b,language:S,topic:w,val:T}});e(_)}catch(a){s(a instanceof Error?a.message:String(a))}finally{i(!1)}})()},[]),Tt.jsxs("main",{id:"main",className:"max-w-6xl mx-auto px-4 py-8",children:[Tt.jsxs("header",{className:"mb-6",children:[Tt.jsx("h1",{className:"text-2xl font-semibold",children:"AI News Explorer"}),Tt.jsx("p",{className:"text-sm text-zinc-500",children:"Reading Parquet over HTTP with DuckDB-WASM (last 7 days)."})]}),t&&Tt.jsx("p",{className:"text-zinc-400",children:"Loading…"}),r&&Tt.jsxs("p",{className:"text-red-500",children:["Error: ",r]}),!t&&!r&&n.length===0&&Tt.jsxs("p",{className:"text-zinc-400",children:["No data yet. Check ",Tt.jsx("code",{children:"/manifests/index.json"}),"."]}),n.length>0&&Tt.jsx(mce,{nodes:n})]})}function Nfe(){return Tt.jsxs("div",{className:"text-center py-24",children:[Tt.jsx("h1",{className:"text-5xl font-extrabold tracking-tight",children:"404"}),Tt.jsx("p",{className:"mt-3 text-muted",children:"Sorry, that page doesn’t exist."}),Tt.jsx("a",{href:"/",className:"btn mt-6",children:"Go home"})]})}function Cfe(){return Tt.jsx(C6,{children:Tt.jsxs(KH,{children:[Tt.jsx(sE,{path:"/",element:Tt.jsx(Rfe,{})}),Tt.jsx(sE,{path:"*",element:Tt.jsx(Nfe,{})})]})})}sH.createRoot(document.getElementById("root")).render(Tt.jsx(DL.StrictMode,{children:Tt.jsx(v6,{children:Tt.jsx(Cfe,{})})}));
